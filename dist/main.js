(()=>{var i0=Object.create;var ad=Object.defineProperty;var o0=Object.getOwnPropertyDescriptor;var l0=Object.getOwnPropertyNames;var c0=Object.getPrototypeOf,u0=Object.prototype.hasOwnProperty;var y=(n,e)=>()=>(n&&(e=n(n=0)),e);var k=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Yi=(n,e)=>{for(var t in e)ad(n,t,{get:e[t],enumerable:!0})},d0=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of l0(e))!u0.call(n,s)&&s!==t&&ad(n,s,{get:()=>e[s],enumerable:!(r=o0(e,s))||r.enumerable});return n};var Ct=(n,e,t)=>(t=n!=null?i0(c0(n)):{},d0(e||!n||!n.__esModule?ad(t,"default",{value:n,enumerable:!0}):t,n));var gm,mm,ym,Al=y(()=>{gm=Symbol("Let zodToJsonSchema decide on which parser to use"),mm={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},ym=n=>typeof n=="string"?{...mm,name:n}:{...mm,...n}});var bm,id=y(()=>{Al();bm=n=>{let e=ym(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}}});function od(n,e,t,r){r?.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function ee(n,e,t,r,s){n[e]=t,od(n,e,r,s)}var sn=y(()=>{});var El,Il=y(()=>{El=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")}});var Z,ld,T,sr,Zi=y(()=>{(function(n){n.assertEqual=s=>{};function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{let a={};for(let i of s)a[i]=i;return a},n.getValidEnumValues=s=>{let a=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(let o of a)i[o]=s[o];return n.objectValues(i)},n.objectValues=s=>n.objectKeys(s).map(function(a){return s[a]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let a=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&a.push(i);return a},n.find=(s,a)=>{for(let i of s)if(a(i))return i},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,a=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}n.joinValues=r,n.jsonStringifyReplacer=(s,a)=>typeof a=="bigint"?a.toString():a})(Z||(Z={}));(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(ld||(ld={}));T=Z.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),sr=n=>{switch(typeof n){case"undefined":return T.undefined;case"string":return T.string;case"number":return Number.isNaN(n)?T.nan:T.number;case"boolean":return T.boolean;case"function":return T.function;case"bigint":return T.bigint;case"symbol":return T.symbol;case"object":return Array.isArray(n)?T.array:n===null?T.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?T.promise:typeof Map<"u"&&n instanceof Map?T.map:typeof Set<"u"&&n instanceof Set?T.set:typeof Date<"u"&&n instanceof Date?T.date:T.object;default:return T.unknown}}});var v,f0,lt,Ol=y(()=>{Zi();v=Z.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),f0=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),lt=class n extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(a){return a.message},r={_errors:[]},s=a=>{for(let i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(t(i));else{let o=r,l=0;for(;l<i.path.length;){let c=i.path[l];l===i.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(i))):o[c]=o[c]||{_errors:[]},o=o[c],l++}}};return s(this),r}static assert(e){if(!(e instanceof n))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Z.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},r=[];for(let s of this.issues)if(s.path.length>0){let a=s.path[0];t[a]=t[a]||[],t[a].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};lt.create=n=>new lt(n)});var h0,Sr,cd=y(()=>{Ol();Zi();h0=(n,e)=>{let t;switch(n.code){case v.invalid_type:n.received===T.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case v.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,Z.jsonStringifyReplacer)}`;break;case v.unrecognized_keys:t=`Unrecognized key(s) in object: ${Z.joinValues(n.keys,", ")}`;break;case v.invalid_union:t="Invalid input";break;case v.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Z.joinValues(n.options)}`;break;case v.invalid_enum_value:t=`Invalid enum value. Expected ${Z.joinValues(n.options)}, received '${n.received}'`;break;case v.invalid_arguments:t="Invalid function arguments";break;case v.invalid_return_type:t="Invalid function return type";break;case v.invalid_date:t="Invalid date";break;case v.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:Z.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case v.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case v.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case v.custom:t="Invalid input";break;case v.invalid_intersection_types:t="Intersection results could not be merged";break;case v.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case v.not_finite:t="Number must be finite";break;default:t=e.defaultError,Z.assertNever(n)}return{message:t}},Sr=h0});function m0(n){wm=n}function la(){return wm}var wm,Tl=y(()=>{cd();wm=Sr});function I(n,e){let t=la(),r=Xi({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===Sr?void 0:Sr].filter(s=>!!s)});n.common.issues.push(r)}var Xi,g0,Fe,L,qn,Ke,Cl,Pl,an,ca,ud=y(()=>{Tl();cd();Xi=n=>{let{data:e,path:t,errorMaps:r,issueData:s}=n,a=[...t,...s.path||[]],i={...s,path:a};if(s.message!==void 0)return{...s,path:a,message:s.message};let o="",l=r.filter(c=>!!c).slice().reverse();for(let c of l)o=c(i,{data:e,defaultError:o}).message;return{...s,path:a,message:o}},g0=[];Fe=class n{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let s of t){if(s.status==="aborted")return L;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let s of t){let a=await s.key,i=await s.value;r.push({key:a,value:i})}return n.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let s of t){let{key:a,value:i}=s;if(a.status==="aborted"||i.status==="aborted")return L;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||s.alwaysSet)&&(r[a.value]=i.value)}return{status:e.value,value:r}}},L=Object.freeze({status:"aborted"}),qn=n=>({status:"dirty",value:n}),Ke=n=>({status:"valid",value:n}),Cl=n=>n.status==="aborted",Pl=n=>n.status==="dirty",an=n=>n.status==="valid",ca=n=>typeof Promise<"u"&&n instanceof Promise});var _m=y(()=>{});var N,vm=y(()=>{(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(N||(N={}))});function z(n){if(!n)return{};let{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(i,o)=>{let{message:l}=n;return i.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:l??r??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:l??t??o.defaultError}},description:s}}function Im(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);let t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function N0(n){return new RegExp(`^${Im(n)}$`)}function Om(n){let e=`${Em}T${Im(n)}`,t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function $0(n,e){return!!((e==="v4"||!e)&&O0.test(n)||(e==="v6"||!e)&&C0.test(n))}function M0(n,e){if(!x0.test(n))return!1;try{let[t]=n.split(".");if(!t)return!1;let r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function j0(n,e){return!!((e==="v4"||!e)&&T0.test(n)||(e==="v6"||!e)&&P0.test(n))}function L0(n,e){let t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,a=Number.parseInt(n.toFixed(s).replace(".","")),i=Number.parseInt(e.toFixed(s).replace(".",""));return a%i/10**s}function ua(n){if(n instanceof ct){let e={};for(let t in n.shape){let r=n.shape[t];e[t]=Pt.create(ua(r))}return new ct({...n._def,shape:()=>e})}else return n instanceof Nr?new Nr({...n._def,type:ua(n.element)}):n instanceof Pt?Pt.create(ua(n.unwrap())):n instanceof ir?ir.create(ua(n.unwrap())):n instanceof ar?ar.create(n.items.map(e=>ua(e))):n}function pd(n,e){let t=sr(n),r=sr(e);if(n===e)return{valid:!0,data:n};if(t===T.object&&r===T.object){let s=Z.objectKeys(e),a=Z.objectKeys(n).filter(o=>s.indexOf(o)!==-1),i={...n,...e};for(let o of a){let l=pd(n[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(t===T.array&&r===T.array){if(n.length!==e.length)return{valid:!1};let s=[];for(let a=0;a<n.length;a++){let i=n[a],o=e[a],l=pd(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return t===T.date&&r===T.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}function Tm(n,e){return new es({values:n,typeName:x.ZodEnum,...z(e)})}function Am(n,e){let t=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof t=="string"?{message:t}:t}function Cm(n,e={},t){return n?ln.create().superRefine((r,s)=>{let a=n(r);if(a instanceof Promise)return a.then(i=>{if(!i){let o=Am(e,r),l=o.fatal??t??!0;s.addIssue({code:"custom",...o,fatal:l})}});if(!a){let i=Am(e,r),o=i.fatal??t??!0;s.addIssue({code:"custom",...i,fatal:o})}}):ln.create()}var St,xm,H,y0,b0,w0,_0,v0,x0,A0,E0,I0,dd,O0,T0,C0,P0,S0,R0,Em,k0,on,Hn,Vn,Gn,Kn,da,Wn,Jn,ln,kr,qt,pa,Nr,ct,Yn,Rr,Sl,Zn,ar,Rl,fa,ha,kl,Xn,Qn,es,ts,cn,Rt,Pt,ir,rs,ns,ma,F0,Qi,eo,ss,D0,x,U0,Pm,Sm,B0,z0,Rm,q0,H0,V0,G0,K0,W0,J0,Y0,Z0,X0,Q0,ex,tx,rx,nx,sx,ax,ix,ox,lx,cx,ux,dx,px,fx,hx,mx,gx,yx,bx,wx,_x,vx,xx,km=y(()=>{Ol();Tl();vm();ud();Zi();St=class{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},xm=(n,e)=>{if(an(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new lt(n.common.issues);return this._error=t,this._error}}};H=class{get description(){return this._def.description}_getType(e){return sr(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:sr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Fe,ctx:{common:e.parent.common,data:e.data,parsedType:sr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(ca(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:sr(e)},s=this._parseSync({data:e,path:r.path,parent:r});return xm(r,s)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:sr(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return an(r)?{value:r.value}:{issues:t.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(r=>an(r)?{value:r.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:sr(e)},s=this._parse({data:e,path:r.path,parent:r}),a=await(ca(s)?s:Promise.resolve(s));return xm(r,a)}refine(e,t){let r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,a)=>{let i=e(s),o=()=>a.addIssue({code:v.custom,...r(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new Rt({schema:this,typeName:x.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Pt.create(this,this._def)}nullable(){return ir.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Nr.create(this)}promise(){return cn.create(this,this._def)}or(e){return Yn.create([this,e],this._def)}and(e){return Zn.create(this,e,this._def)}transform(e){return new Rt({...z(this._def),schema:this,typeName:x.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new rs({...z(this._def),innerType:this,defaultValue:t,typeName:x.ZodDefault})}brand(){return new Qi({typeName:x.ZodBranded,type:this,...z(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new ns({...z(this._def),innerType:this,catchValue:t,typeName:x.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return eo.create(this,e)}readonly(){return ss.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},y0=/^c[^\s-]{8,}$/i,b0=/^[0-9a-z]+$/,w0=/^[0-9A-HJKMNP-TV-Z]{26}$/i,_0=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,v0=/^[a-z0-9_-]{21}$/i,x0=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,A0=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,E0=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,I0="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",O0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,T0=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C0=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,P0=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,S0=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,R0=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Em="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",k0=new RegExp(`^${Em}$`);on=class n extends H{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==T.string){let a=this._getOrReturnCtx(e);return I(a,{code:v.invalid_type,expected:T.string,received:a.parsedType}),L}let r=new Fe,s;for(let a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(s=this._getOrReturnCtx(e,s),I(s,{code:v.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(s=this._getOrReturnCtx(e,s),I(s,{code:v.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){let i=e.data.length>a.value,o=e.data.length<a.value;(i||o)&&(s=this._getOrReturnCtx(e,s),i?I(s,{code:v.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&I(s,{code:v.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")E0.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"email",code:v.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")dd||(dd=new RegExp(I0,"u")),dd.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"emoji",code:v.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")_0.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"uuid",code:v.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")v0.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"nanoid",code:v.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")y0.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"cuid",code:v.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")b0.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"cuid2",code:v.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")w0.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"ulid",code:v.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),I(s,{validation:"url",code:v.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"regex",code:v.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(s=this._getOrReturnCtx(e,s),I(s,{code:v.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(s=this._getOrReturnCtx(e,s),I(s,{code:v.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(s=this._getOrReturnCtx(e,s),I(s,{code:v.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?Om(a).test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{code:v.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?k0.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{code:v.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?N0(a).test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{code:v.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?A0.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"duration",code:v.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?$0(e.data,a.version)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"ip",code:v.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?M0(e.data,a.alg)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"jwt",code:v.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?j0(e.data,a.version)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"cidr",code:v.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?S0.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"base64",code:v.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?R0.test(e.data)||(s=this._getOrReturnCtx(e,s),I(s,{validation:"base64url",code:v.invalid_string,message:a.message}),r.dirty()):Z.assertNever(a);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:v.invalid_string,...N.errToObj(r)})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...N.errToObj(e)})}url(e){return this._addCheck({kind:"url",...N.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...N.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...N.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...N.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...N.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...N.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...N.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...N.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...N.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...N.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...N.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...N.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...N.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...N.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...N.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...N.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...N.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...N.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...N.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...N.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...N.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...N.errToObj(t)})}nonempty(e){return this.min(1,N.errToObj(e))}trim(){return new n({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};on.create=n=>new on({checks:[],typeName:x.ZodString,coerce:n?.coerce??!1,...z(n)});Hn=class n extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==T.number){let a=this._getOrReturnCtx(e);return I(a,{code:v.invalid_type,expected:T.number,received:a.parsedType}),L}let r,s=new Fe;for(let a of this._def.checks)a.kind==="int"?Z.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),I(r,{code:v.invalid_type,expected:"integer",received:"float",message:a.message}),s.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),I(r,{code:v.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),I(r,{code:v.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),s.dirty()):a.kind==="multipleOf"?L0(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),I(r,{code:v.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),I(r,{code:v.not_finite,message:a.message}),s.dirty()):Z.assertNever(a);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,N.toString(t))}gt(e,t){return this.setLimit("min",e,!1,N.toString(t))}lte(e,t){return this.setLimit("max",e,!0,N.toString(t))}lt(e,t){return this.setLimit("max",e,!1,N.toString(t))}setLimit(e,t,r,s){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:N.toString(s)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:N.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:N.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:N.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:N.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:N.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Z.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Hn.create=n=>new Hn({checks:[],typeName:x.ZodNumber,coerce:n?.coerce||!1,...z(n)});Vn=class n extends H{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==T.bigint)return this._getInvalidInput(e);let r,s=new Fe;for(let a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),I(r,{code:v.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),I(r,{code:v.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),s.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),I(r,{code:v.not_multiple_of,multipleOf:a.value,message:a.message}),s.dirty()):Z.assertNever(a);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return I(t,{code:v.invalid_type,expected:T.bigint,received:t.parsedType}),L}gte(e,t){return this.setLimit("min",e,!0,N.toString(t))}gt(e,t){return this.setLimit("min",e,!1,N.toString(t))}lte(e,t){return this.setLimit("max",e,!0,N.toString(t))}lt(e,t){return this.setLimit("max",e,!1,N.toString(t))}setLimit(e,t,r,s){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:N.toString(s)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:N.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:N.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:N.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:N.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:N.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Vn.create=n=>new Vn({checks:[],typeName:x.ZodBigInt,coerce:n?.coerce??!1,...z(n)});Gn=class extends H{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==T.boolean){let r=this._getOrReturnCtx(e);return I(r,{code:v.invalid_type,expected:T.boolean,received:r.parsedType}),L}return Ke(e.data)}};Gn.create=n=>new Gn({typeName:x.ZodBoolean,coerce:n?.coerce||!1,...z(n)});Kn=class n extends H{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==T.date){let a=this._getOrReturnCtx(e);return I(a,{code:v.invalid_type,expected:T.date,received:a.parsedType}),L}if(Number.isNaN(e.data.getTime())){let a=this._getOrReturnCtx(e);return I(a,{code:v.invalid_date}),L}let r=new Fe,s;for(let a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(s=this._getOrReturnCtx(e,s),I(s,{code:v.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(s=this._getOrReturnCtx(e,s),I(s,{code:v.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):Z.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:N.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:N.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Kn.create=n=>new Kn({checks:[],coerce:n?.coerce||!1,typeName:x.ZodDate,...z(n)});da=class extends H{_parse(e){if(this._getType(e)!==T.symbol){let r=this._getOrReturnCtx(e);return I(r,{code:v.invalid_type,expected:T.symbol,received:r.parsedType}),L}return Ke(e.data)}};da.create=n=>new da({typeName:x.ZodSymbol,...z(n)});Wn=class extends H{_parse(e){if(this._getType(e)!==T.undefined){let r=this._getOrReturnCtx(e);return I(r,{code:v.invalid_type,expected:T.undefined,received:r.parsedType}),L}return Ke(e.data)}};Wn.create=n=>new Wn({typeName:x.ZodUndefined,...z(n)});Jn=class extends H{_parse(e){if(this._getType(e)!==T.null){let r=this._getOrReturnCtx(e);return I(r,{code:v.invalid_type,expected:T.null,received:r.parsedType}),L}return Ke(e.data)}};Jn.create=n=>new Jn({typeName:x.ZodNull,...z(n)});ln=class extends H{constructor(){super(...arguments),this._any=!0}_parse(e){return Ke(e.data)}};ln.create=n=>new ln({typeName:x.ZodAny,...z(n)});kr=class extends H{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ke(e.data)}};kr.create=n=>new kr({typeName:x.ZodUnknown,...z(n)});qt=class extends H{_parse(e){let t=this._getOrReturnCtx(e);return I(t,{code:v.invalid_type,expected:T.never,received:t.parsedType}),L}};qt.create=n=>new qt({typeName:x.ZodNever,...z(n)});pa=class extends H{_parse(e){if(this._getType(e)!==T.undefined){let r=this._getOrReturnCtx(e);return I(r,{code:v.invalid_type,expected:T.void,received:r.parsedType}),L}return Ke(e.data)}};pa.create=n=>new pa({typeName:x.ZodVoid,...z(n)});Nr=class n extends H{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==T.array)return I(t,{code:v.invalid_type,expected:T.array,received:t.parsedType}),L;if(s.exactLength!==null){let i=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(i||o)&&(I(t,{code:i?v.too_big:v.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(I(t,{code:v.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(I(t,{code:v.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>s.type._parseAsync(new St(t,i,t.path,o)))).then(i=>Fe.mergeArray(r,i));let a=[...t.data].map((i,o)=>s.type._parseSync(new St(t,i,t.path,o)));return Fe.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new n({...this._def,minLength:{value:e,message:N.toString(t)}})}max(e,t){return new n({...this._def,maxLength:{value:e,message:N.toString(t)}})}length(e,t){return new n({...this._def,exactLength:{value:e,message:N.toString(t)}})}nonempty(e){return this.min(1,e)}};Nr.create=(n,e)=>new Nr({type:n,minLength:null,maxLength:null,exactLength:null,typeName:x.ZodArray,...z(e)});ct=class n extends H{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=Z.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==T.object){let c=this._getOrReturnCtx(e);return I(c,{code:v.invalid_type,expected:T.object,received:c.parsedType}),L}let{status:r,ctx:s}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof qt&&this._def.unknownKeys==="strip"))for(let c in s.data)i.includes(c)||o.push(c);let l=[];for(let c of i){let u=a[c],d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new St(s,d,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof qt){let c=this._def.unknownKeys;if(c==="passthrough")for(let u of o)l.push({key:{status:"valid",value:u},value:{status:"valid",value:s.data[u]}});else if(c==="strict")o.length>0&&(I(s,{code:v.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let u of o){let d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new St(s,d,s.path,u)),alwaysSet:u in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let c=[];for(let u of l){let d=await u.key,p=await u.value;c.push({key:d,value:p,alwaysSet:u.alwaysSet})}return c}).then(c=>Fe.mergeObjectSync(r,c)):Fe.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return N.errToObj,new n({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{let s=this._def.errorMap?.(t,r).message??r.defaultError;return t.code==="unrecognized_keys"?{message:N.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new n({...this._def,unknownKeys:"strip"})}passthrough(){return new n({...this._def,unknownKeys:"passthrough"})}extend(e){return new n({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new n({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:x.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new n({...this._def,catchall:e})}pick(e){let t={};for(let r of Z.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new n({...this._def,shape:()=>t})}omit(e){let t={};for(let r of Z.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new n({...this._def,shape:()=>t})}deepPartial(){return ua(this)}partial(e){let t={};for(let r of Z.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}return new n({...this._def,shape:()=>t})}required(e){let t={};for(let r of Z.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof Pt;)a=a._def.innerType;t[r]=a}return new n({...this._def,shape:()=>t})}keyof(){return Tm(Z.objectKeys(this.shape))}};ct.create=(n,e)=>new ct({shape:()=>n,unknownKeys:"strip",catchall:qt.create(),typeName:x.ZodObject,...z(e)});ct.strictCreate=(n,e)=>new ct({shape:()=>n,unknownKeys:"strict",catchall:qt.create(),typeName:x.ZodObject,...z(e)});ct.lazycreate=(n,e)=>new ct({shape:n,unknownKeys:"strip",catchall:qt.create(),typeName:x.ZodObject,...z(e)});Yn=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;function s(a){for(let o of a)if(o.result.status==="valid")return o.result;for(let o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let i=a.map(o=>new lt(o.ctx.common.issues));return I(t,{code:v.invalid_union,unionErrors:i}),L}if(t.common.async)return Promise.all(r.map(async a=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(s);{let a,i=[];for(let l of r){let c={...t,common:{...t.common,issues:[]},parent:null},u=l._parseSync({data:t.data,path:t.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!a&&(a={result:u,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;let o=i.map(l=>new lt(l));return I(t,{code:v.invalid_union,unionErrors:o}),L}}get options(){return this._def.options}};Yn.create=(n,e)=>new Yn({options:n,typeName:x.ZodUnion,...z(e)});Rr=n=>n instanceof Xn?Rr(n.schema):n instanceof Rt?Rr(n.innerType()):n instanceof Qn?[n.value]:n instanceof es?n.options:n instanceof ts?Z.objectValues(n.enum):n instanceof rs?Rr(n._def.innerType):n instanceof Wn?[void 0]:n instanceof Jn?[null]:n instanceof Pt?[void 0,...Rr(n.unwrap())]:n instanceof ir?[null,...Rr(n.unwrap())]:n instanceof Qi||n instanceof ss?Rr(n.unwrap()):n instanceof ns?Rr(n._def.innerType):[],Sl=class n extends H{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.object)return I(t,{code:v.invalid_type,expected:T.object,received:t.parsedType}),L;let r=this.discriminator,s=t.data[r],a=this.optionsMap.get(s);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(I(t,{code:v.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),L)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let s=new Map;for(let a of t){let i=Rr(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,a)}}return new n({typeName:x.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...z(r)})}};Zn=class extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=(a,i)=>{if(Cl(a)||Cl(i))return L;let o=pd(a.value,i.value);return o.valid?((Pl(a)||Pl(i))&&t.dirty(),{status:t.value,value:o.data}):(I(r,{code:v.invalid_intersection_types}),L)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,i])=>s(a,i)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};Zn.create=(n,e,t)=>new Zn({left:n,right:e,typeName:x.ZodIntersection,...z(t)});ar=class n extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==T.array)return I(r,{code:v.invalid_type,expected:T.array,received:r.parsedType}),L;if(r.data.length<this._def.items.length)return I(r,{code:v.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),L;!this._def.rest&&r.data.length>this._def.items.length&&(I(r,{code:v.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((i,o)=>{let l=this._def.items[o]||this._def.rest;return l?l._parse(new St(r,i,r.path,o)):null}).filter(i=>!!i);return r.common.async?Promise.all(a).then(i=>Fe.mergeArray(t,i)):Fe.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new n({...this._def,rest:e})}};ar.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ar({items:n,typeName:x.ZodTuple,rest:null,...z(e)})};Rl=class n extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==T.object)return I(r,{code:v.invalid_type,expected:T.object,received:r.parsedType}),L;let s=[],a=this._def.keyType,i=this._def.valueType;for(let o in r.data)s.push({key:a._parse(new St(r,o,r.path,o)),value:i._parse(new St(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Fe.mergeObjectAsync(t,s):Fe.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof H?new n({keyType:e,valueType:t,typeName:x.ZodRecord,...z(r)}):new n({keyType:on.create(),valueType:e,typeName:x.ZodRecord,...z(t)})}},fa=class extends H{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==T.map)return I(r,{code:v.invalid_type,expected:T.map,received:r.parsedType}),L;let s=this._def.keyType,a=this._def.valueType,i=[...r.data.entries()].map(([o,l],c)=>({key:s._parse(new St(r,o,r.path,[c,"key"])),value:a._parse(new St(r,l,r.path,[c,"value"]))}));if(r.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let l of i){let c=await l.key,u=await l.value;if(c.status==="aborted"||u.status==="aborted")return L;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(c.value,u.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let l of i){let c=l.key,u=l.value;if(c.status==="aborted"||u.status==="aborted")return L;(c.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(c.value,u.value)}return{status:t.value,value:o}}}};fa.create=(n,e,t)=>new fa({valueType:e,keyType:n,typeName:x.ZodMap,...z(t)});ha=class n extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==T.set)return I(r,{code:v.invalid_type,expected:T.set,received:r.parsedType}),L;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(I(r,{code:v.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(I(r,{code:v.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let a=this._def.valueType;function i(l){let c=new Set;for(let u of l){if(u.status==="aborted")return L;u.status==="dirty"&&t.dirty(),c.add(u.value)}return{status:t.value,value:c}}let o=[...r.data.values()].map((l,c)=>a._parse(new St(r,l,r.path,c)));return r.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,t){return new n({...this._def,minSize:{value:e,message:N.toString(t)}})}max(e,t){return new n({...this._def,maxSize:{value:e,message:N.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};ha.create=(n,e)=>new ha({valueType:n,minSize:null,maxSize:null,typeName:x.ZodSet,...z(e)});kl=class n extends H{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.function)return I(t,{code:v.invalid_type,expected:T.function,received:t.parsedType}),L;function r(o,l){return Xi({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,la(),Sr].filter(c=>!!c),issueData:{code:v.invalid_arguments,argumentsError:l}})}function s(o,l){return Xi({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,la(),Sr].filter(c=>!!c),issueData:{code:v.invalid_return_type,returnTypeError:l}})}let a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof cn){let o=this;return Ke(async function(...l){let c=new lt([]),u=await o._def.args.parseAsync(l,a).catch(f=>{throw c.addIssue(r(l,f)),c}),d=await Reflect.apply(i,this,u);return await o._def.returns._def.type.parseAsync(d,a).catch(f=>{throw c.addIssue(s(d,f)),c})})}else{let o=this;return Ke(function(...l){let c=o._def.args.safeParse(l,a);if(!c.success)throw new lt([r(l,c.error)]);let u=Reflect.apply(i,this,c.data),d=o._def.returns.safeParse(u,a);if(!d.success)throw new lt([s(u,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new n({...this._def,args:ar.create(e).rest(kr.create())})}returns(e){return new n({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new n({args:e||ar.create([]).rest(kr.create()),returns:t||kr.create(),typeName:x.ZodFunction,...z(r)})}},Xn=class extends H{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Xn.create=(n,e)=>new Xn({getter:n,typeName:x.ZodLazy,...z(e)});Qn=class extends H{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return I(t,{received:t.data,code:v.invalid_literal,expected:this._def.value}),L}return{status:"valid",value:e.data}}get value(){return this._def.value}};Qn.create=(n,e)=>new Qn({value:n,typeName:x.ZodLiteral,...z(e)});es=class n extends H{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),r=this._def.values;return I(t,{expected:Z.joinValues(r),received:t.parsedType,code:v.invalid_type}),L}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return I(t,{received:t.data,code:v.invalid_enum_value,options:r}),L}return Ke(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return n.create(e,{...this._def,...t})}exclude(e,t=this._def){return n.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}};es.create=Tm;ts=class extends H{_parse(e){let t=Z.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==T.string&&r.parsedType!==T.number){let s=Z.objectValues(t);return I(r,{expected:Z.joinValues(s),received:r.parsedType,code:v.invalid_type}),L}if(this._cache||(this._cache=new Set(Z.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let s=Z.objectValues(t);return I(r,{received:r.data,code:v.invalid_enum_value,options:s}),L}return Ke(e.data)}get enum(){return this._def.values}};ts.create=(n,e)=>new ts({values:n,typeName:x.ZodNativeEnum,...z(e)});cn=class extends H{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==T.promise&&t.common.async===!1)return I(t,{code:v.invalid_type,expected:T.promise,received:t.parsedType}),L;let r=t.parsedType===T.promise?t.data:Promise.resolve(t.data);return Ke(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};cn.create=(n,e)=>new cn({type:n,typeName:x.ZodPromise,...z(e)});Rt=class extends H{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===x.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,a={addIssue:i=>{I(r,i),i.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),s.type==="preprocess"){let i=s.transform(r.data,a);if(r.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return L;let l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?L:l.status==="dirty"?qn(l.value):t.value==="dirty"?qn(l.value):l});{if(t.value==="aborted")return L;let o=this._def.schema._parseSync({data:i,path:r.path,parent:r});return o.status==="aborted"?L:o.status==="dirty"?qn(o.value):t.value==="dirty"?qn(o.value):o}}if(s.type==="refinement"){let i=o=>{let l=s.refinement(o,a);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){let o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?L:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?L:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!an(i))return L;let o=s.transform(i.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>an(i)?Promise.resolve(s.transform(i.value,a)).then(o=>({status:t.value,value:o})):L);Z.assertNever(s)}};Rt.create=(n,e,t)=>new Rt({schema:n,typeName:x.ZodEffects,effect:e,...z(t)});Rt.createWithPreprocess=(n,e,t)=>new Rt({schema:e,effect:{type:"preprocess",transform:n},typeName:x.ZodEffects,...z(t)});Pt=class extends H{_parse(e){return this._getType(e)===T.undefined?Ke(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Pt.create=(n,e)=>new Pt({innerType:n,typeName:x.ZodOptional,...z(e)});ir=class extends H{_parse(e){return this._getType(e)===T.null?Ke(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ir.create=(n,e)=>new ir({innerType:n,typeName:x.ZodNullable,...z(e)});rs=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===T.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};rs.create=(n,e)=>new rs({innerType:n,typeName:x.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...z(e)});ns=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ca(s)?s.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new lt(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new lt(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};ns.create=(n,e)=>new ns({innerType:n,typeName:x.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...z(e)});ma=class extends H{_parse(e){if(this._getType(e)!==T.nan){let r=this._getOrReturnCtx(e);return I(r,{code:v.invalid_type,expected:T.nan,received:r.parsedType}),L}return{status:"valid",value:e.data}}};ma.create=n=>new ma({typeName:x.ZodNaN,...z(n)});F0=Symbol("zod_brand"),Qi=class extends H{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},eo=class n extends H{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?L:a.status==="dirty"?(t.dirty(),qn(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?L:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new n({in:e,out:t,typeName:x.ZodPipeline})}},ss=class extends H{_parse(e){let t=this._def.innerType._parse(e),r=s=>(an(s)&&(s.value=Object.freeze(s.value)),s);return ca(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}};ss.create=(n,e)=>new ss({innerType:n,typeName:x.ZodReadonly,...z(e)});D0={object:ct.lazycreate};(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(x||(x={}));U0=(n,e={message:`Input not instance of ${n.name}`})=>Cm(t=>t instanceof n,e),Pm=on.create,Sm=Hn.create,B0=ma.create,z0=Vn.create,Rm=Gn.create,q0=Kn.create,H0=da.create,V0=Wn.create,G0=Jn.create,K0=ln.create,W0=kr.create,J0=qt.create,Y0=pa.create,Z0=Nr.create,X0=ct.create,Q0=ct.strictCreate,ex=Yn.create,tx=Sl.create,rx=Zn.create,nx=ar.create,sx=Rl.create,ax=fa.create,ix=ha.create,ox=kl.create,lx=Xn.create,cx=Qn.create,ux=es.create,dx=ts.create,px=cn.create,fx=Rt.create,hx=Pt.create,mx=ir.create,gx=Rt.createWithPreprocess,yx=eo.create,bx=()=>Pm().optional(),wx=()=>Sm().optional(),_x=()=>Rm().optional(),vx={string:n=>on.create({...n,coerce:!0}),number:n=>Hn.create({...n,coerce:!0}),boolean:n=>Gn.create({...n,coerce:!0}),bigint:n=>Vn.create({...n,coerce:!0}),date:n=>Kn.create({...n,coerce:!0})},xx=L});var ut={};Yi(ut,{BRAND:()=>F0,DIRTY:()=>qn,EMPTY_PATH:()=>g0,INVALID:()=>L,NEVER:()=>xx,OK:()=>Ke,ParseStatus:()=>Fe,Schema:()=>H,ZodAny:()=>ln,ZodArray:()=>Nr,ZodBigInt:()=>Vn,ZodBoolean:()=>Gn,ZodBranded:()=>Qi,ZodCatch:()=>ns,ZodDate:()=>Kn,ZodDefault:()=>rs,ZodDiscriminatedUnion:()=>Sl,ZodEffects:()=>Rt,ZodEnum:()=>es,ZodError:()=>lt,ZodFirstPartyTypeKind:()=>x,ZodFunction:()=>kl,ZodIntersection:()=>Zn,ZodIssueCode:()=>v,ZodLazy:()=>Xn,ZodLiteral:()=>Qn,ZodMap:()=>fa,ZodNaN:()=>ma,ZodNativeEnum:()=>ts,ZodNever:()=>qt,ZodNull:()=>Jn,ZodNullable:()=>ir,ZodNumber:()=>Hn,ZodObject:()=>ct,ZodOptional:()=>Pt,ZodParsedType:()=>T,ZodPipeline:()=>eo,ZodPromise:()=>cn,ZodReadonly:()=>ss,ZodRecord:()=>Rl,ZodSchema:()=>H,ZodSet:()=>ha,ZodString:()=>on,ZodSymbol:()=>da,ZodTransformer:()=>Rt,ZodTuple:()=>ar,ZodType:()=>H,ZodUndefined:()=>Wn,ZodUnion:()=>Yn,ZodUnknown:()=>kr,ZodVoid:()=>pa,addIssueToContext:()=>I,any:()=>K0,array:()=>Z0,bigint:()=>z0,boolean:()=>Rm,coerce:()=>vx,custom:()=>Cm,date:()=>q0,datetimeRegex:()=>Om,defaultErrorMap:()=>Sr,discriminatedUnion:()=>tx,effect:()=>fx,enum:()=>ux,function:()=>ox,getErrorMap:()=>la,getParsedType:()=>sr,instanceof:()=>U0,intersection:()=>rx,isAborted:()=>Cl,isAsync:()=>ca,isDirty:()=>Pl,isValid:()=>an,late:()=>D0,lazy:()=>lx,literal:()=>cx,makeIssue:()=>Xi,map:()=>ax,nan:()=>B0,nativeEnum:()=>dx,never:()=>J0,null:()=>G0,nullable:()=>mx,number:()=>Sm,object:()=>X0,objectUtil:()=>ld,oboolean:()=>_x,onumber:()=>wx,optional:()=>hx,ostring:()=>bx,pipeline:()=>yx,preprocess:()=>gx,promise:()=>px,quotelessJson:()=>f0,record:()=>sx,set:()=>ix,setErrorMap:()=>m0,strictObject:()=>Q0,string:()=>Pm,symbol:()=>H0,transformer:()=>fx,tuple:()=>nx,undefined:()=>V0,union:()=>ex,unknown:()=>W0,util:()=>Z,void:()=>Y0});var fd=y(()=>{Tl();ud();_m();Zi();km();Ol()});var as=y(()=>{fd();fd()});function le(n){if(n.target!=="openAi")return{};let e=[...n.basePath,n.definitionPath,n.openAiAnyTypeName];return n.flags.hasReferencedOpenAiAnyType=!0,{$ref:n.$refStrategy==="relative"?El(e,n.currentPath):e.join("/")}}var kt=y(()=>{Il()});function Nm(n,e){let t={type:"array"};return n.type?._def&&n.type?._def?.typeName!==x.ZodAny&&(t.items=F(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&ee(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&ee(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(ee(t,"minItems",n.exactLength.value,n.exactLength.message,e),ee(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}var hd=y(()=>{as();sn();we()});function $m(n,e){let t={type:"integer",format:"int64"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?ee(t,"minimum",r.value,r.message,e):ee(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),ee(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ee(t,"maximum",r.value,r.message,e):ee(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),ee(t,"maximum",r.value,r.message,e));break;case"multipleOf":ee(t,"multipleOf",r.value,r.message,e);break}return t}var md=y(()=>{sn()});function Mm(){return{type:"boolean"}}var gd=y(()=>{});function Nl(n,e){return F(n.type._def,e)}var $l=y(()=>{we()});var jm,yd=y(()=>{we();jm=(n,e)=>F(n.innerType._def,e)});function bd(n,e,t){let r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,a)=>bd(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Ax(n,e)}}var Ax,wd=y(()=>{sn();Ax=(n,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let r of n.checks)switch(r.kind){case"min":ee(t,"minimum",r.value,r.message,e);break;case"max":ee(t,"maximum",r.value,r.message,e);break}return t}});function Lm(n,e){return{...F(n.innerType._def,e),default:n.defaultValue()}}var _d=y(()=>{we()});function Fm(n,e){return e.effectStrategy==="input"?F(n.schema._def,e):le(e)}var vd=y(()=>{we();kt()});function Dm(n){return{type:"string",enum:Array.from(n.values)}}var xd=y(()=>{});function Um(n,e){let t=[F(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),F(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a),r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,s=[];return t.forEach(a=>{if(Ex(a))s.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let i=a;if("additionalProperties"in a&&a.additionalProperties===!1){let{additionalProperties:o,...l}=a;i=l}else r=void 0;s.push(i)}}),s.length?{allOf:s,...r}:void 0}var Ex,Ad=y(()=>{we();Ex=n=>"type"in n&&n.type==="string"?!1:"allOf"in n});function Bm(n,e){let t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}var Ed=y(()=>{});function Ml(n,e){let t={type:"string"};if(n.checks)for(let r of n.checks)switch(r.kind){case"min":ee(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":ee(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Vt(t,"email",r.message,e);break;case"format:idn-email":Vt(t,"idn-email",r.message,e);break;case"pattern:zod":et(t,Ht.email,r.message,e);break}break;case"url":Vt(t,"uri",r.message,e);break;case"uuid":Vt(t,"uuid",r.message,e);break;case"regex":et(t,r.regex,r.message,e);break;case"cuid":et(t,Ht.cuid,r.message,e);break;case"cuid2":et(t,Ht.cuid2,r.message,e);break;case"startsWith":et(t,RegExp(`^${Od(r.value,e)}`),r.message,e);break;case"endsWith":et(t,RegExp(`${Od(r.value,e)}$`),r.message,e);break;case"datetime":Vt(t,"date-time",r.message,e);break;case"date":Vt(t,"date",r.message,e);break;case"time":Vt(t,"time",r.message,e);break;case"duration":Vt(t,"duration",r.message,e);break;case"length":ee(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),ee(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{et(t,RegExp(Od(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Vt(t,"ipv4",r.message,e),r.version!=="v4"&&Vt(t,"ipv6",r.message,e);break}case"base64url":et(t,Ht.base64url,r.message,e);break;case"jwt":et(t,Ht.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&et(t,Ht.ipv4Cidr,r.message,e),r.version!=="v4"&&et(t,Ht.ipv6Cidr,r.message,e);break}case"emoji":et(t,Ht.emoji(),r.message,e);break;case"ulid":{et(t,Ht.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Vt(t,"binary",r.message,e);break}case"contentEncoding:base64":{ee(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{et(t,Ht.base64,r.message,e);break}}break}case"nanoid":et(t,Ht.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function Od(n,e){return e.patternStrategy==="escape"?Ox(n):n}function Ox(n){let e="";for(let t=0;t<n.length;t++)Ix.has(n[t])||(e+="\\"),e+=n[t];return e}function Vt(n,e,t,r){n.format||n.anyOf?.some(s=>s.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):ee(n,"format",e,t,r)}function et(n,e,t,r){n.pattern||n.allOf?.some(s=>s.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:zm(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):ee(n,"pattern",zm(e,r),t,r)}function zm(n,e){if(!e.applyRegexFlags||!n.flags)return n.source;let t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source,s="",a=!1,i=!1,o=!1;for(let l=0;l<r.length;l++){if(a){s+=r[l],a=!1;continue}if(t.i){if(i){if(r[l].match(/[a-z]/)){o?(s+=r[l],s+=`${r[l-2]}-${r[l]}`.toUpperCase(),o=!1):r[l+1]==="-"&&r[l+2]?.match(/[a-z]/)?(s+=r[l],o=!0):s+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){s+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(t.m){if(r[l]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&r[l]==="."){s+=i?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}s+=r[l],r[l]==="\\"?a=!0:i&&r[l]==="]"?i=!1:!i&&r[l]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return s}var Id,Ht,Ix,jl=y(()=>{sn();Ht={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Id===void 0&&(Id=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Id),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};Ix=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789")});function Ll(n,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&n.keyType?._def.typeName===x.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((r,s)=>({...r,[s]:F(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",s]})??le(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:F(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(n.keyType?._def.typeName===x.ZodString&&n.keyType._def.checks?.length){let{type:r,...s}=Ml(n.keyType._def,e);return{...t,propertyNames:s}}else{if(n.keyType?._def.typeName===x.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(n.keyType?._def.typeName===x.ZodBranded&&n.keyType._def.type._def.typeName===x.ZodString&&n.keyType._def.type._def.checks?.length){let{type:r,...s}=Nl(n.keyType._def,e);return{...t,propertyNames:s}}}return t}var Fl=y(()=>{as();we();jl();$l();kt()});function qm(n,e){if(e.mapStrategy==="record")return Ll(n,e);let t=F(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||le(e),r=F(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||le(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}var Td=y(()=>{we();Fl();kt()});function Hm(n){let e=n.values,r=Object.keys(n.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),s=Array.from(new Set(r.map(a=>typeof a)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}var Cd=y(()=>{});function Vm(n){return n.target==="openAi"?void 0:{not:le({...n,currentPath:[...n.currentPath,"not"]})}}var Pd=y(()=>{kt()});function Gm(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var Sd=y(()=>{});function Wm(n,e){if(e.target==="openApi3")return Km(n,e);let t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in to&&(!r._def.checks||!r._def.checks.length))){let r=t.reduce((s,a)=>{let i=to[a._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=t.reduce((s,a)=>{let i=typeof a._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(a._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){let s=r.filter((a,i,o)=>o.indexOf(a)===i);return{type:s.length>1?s:s[0],enum:t.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(a=>!r.includes(a))],[])};return Km(n,e)}var to,Km,Dl=y(()=>{we();to={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};Km=(n,e)=>{let t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>F(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0}});function Jm(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:to[n.innerType._def.typeName],nullable:!0}:{type:[to[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let r=F(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let t=F(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}var Rd=y(()=>{we();Dl()});function Ym(n,e){let t={type:"number"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"int":t.type="integer",od(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?ee(t,"minimum",r.value,r.message,e):ee(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),ee(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ee(t,"maximum",r.value,r.message,e):ee(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),ee(t,"maximum",r.value,r.message,e));break;case"multipleOf":ee(t,"multipleOf",r.value,r.message,e);break}return t}var kd=y(()=>{sn()});function Zm(n,e){let t=e.target==="openAi",r={type:"object",properties:{}},s=[],a=n.shape();for(let o in a){let l=a[o];if(l===void 0||l._def===void 0)continue;let c=Cx(l);c&&t&&(l._def.typeName==="ZodOptional"&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),c=!1);let u=F(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});u!==void 0&&(r.properties[o]=u,c||s.push(o))}s.length&&(r.required=s);let i=Tx(n,e);return i!==void 0&&(r.additionalProperties=i),r}function Tx(n,e){if(n.catchall._def.typeName!=="ZodNever")return F(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Cx(n){try{return n.isOptional()}catch{return!0}}var Nd=y(()=>{we()});var Xm,$d=y(()=>{we();kt();Xm=(n,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return F(n.innerType._def,e);let t=F(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:le(e)},t]}:le(e)}});var Qm,Md=y(()=>{we();Qm=(n,e)=>{if(e.pipeStrategy==="input")return F(n.in._def,e);if(e.pipeStrategy==="output")return F(n.out._def,e);let t=F(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=F(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}}});function eg(n,e){return F(n.type._def,e)}var jd=y(()=>{we()});function tg(n,e){let r={type:"array",uniqueItems:!0,items:F(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&ee(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&ee(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}var Ld=y(()=>{sn();we()});function rg(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>F(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:F(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>F(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}var Fd=y(()=>{we()});function ng(n){return{not:le(n)}}var Dd=y(()=>{kt()});function sg(n){return le(n)}var Ud=y(()=>{kt()});var ag,Bd=y(()=>{we();ag=(n,e)=>F(n.innerType._def,e)});var ig,zd=y(()=>{as();kt();hd();md();gd();$l();yd();wd();_d();vd();xd();Ad();Ed();Td();Cd();Pd();Sd();Rd();kd();Nd();$d();Md();jd();Fl();Ld();jl();Fd();Dd();Dl();Ud();Bd();ig=(n,e,t)=>{switch(e){case x.ZodString:return Ml(n,t);case x.ZodNumber:return Ym(n,t);case x.ZodObject:return Zm(n,t);case x.ZodBigInt:return $m(n,t);case x.ZodBoolean:return Mm();case x.ZodDate:return bd(n,t);case x.ZodUndefined:return ng(t);case x.ZodNull:return Gm(t);case x.ZodArray:return Nm(n,t);case x.ZodUnion:case x.ZodDiscriminatedUnion:return Wm(n,t);case x.ZodIntersection:return Um(n,t);case x.ZodTuple:return rg(n,t);case x.ZodRecord:return Ll(n,t);case x.ZodLiteral:return Bm(n,t);case x.ZodEnum:return Dm(n);case x.ZodNativeEnum:return Hm(n);case x.ZodNullable:return Jm(n,t);case x.ZodOptional:return Xm(n,t);case x.ZodMap:return qm(n,t);case x.ZodSet:return tg(n,t);case x.ZodLazy:return()=>n.getter()._def;case x.ZodPromise:return eg(n,t);case x.ZodNaN:case x.ZodNever:return Vm(t);case x.ZodEffects:return Fm(n,t);case x.ZodAny:return le(t);case x.ZodUnknown:return sg(t);case x.ZodDefault:return Lm(n,t);case x.ZodBranded:return Nl(n,t);case x.ZodReadonly:return ag(n,t);case x.ZodCatch:return jm(n,t);case x.ZodPipeline:return Qm(n,t);case x.ZodFunction:case x.ZodVoid:case x.ZodSymbol:return;default:return(r=>{})(e)}}});function F(n,e,t=!1){let r=e.seen.get(n);if(e.override){let o=e.override?.(n,e,r,t);if(o!==gm)return o}if(r&&!t){let o=Px(r,e);if(o!==void 0)return o}let s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);let a=ig(n,n.typeName,e),i=typeof a=="function"?F(a(),e):a;if(i&&Sx(n,e,i),e.postProcess){let o=e.postProcess(i,n,e);return s.jsonSchema=i,o}return s.jsonSchema=i,i}var Px,Sx,we=y(()=>{Al();zd();Il();kt();Px=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:El(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),le(e)):e.$refStrategy==="seen"?le(e):void 0}},Sx=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t)});var og=y(()=>{});var We,qd=y(()=>{we();id();kt();We=(n,e)=>{let t=bm(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[c,u])=>({...l,[c]:F(u._def,{...t,currentPath:[...t.basePath,t.definitionPath,c]},!0)??le(t)}),{}):void 0,s=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,a=F(n._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1)??le(t),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(a.title=i),t.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[t.openAiAnyTypeName]||(r[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let o=s===void 0?r?{...a,[t.definitionPath]:r}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:a}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o}});var $r=y(()=>{Al();id();sn();Il();we();og();kt();hd();md();gd();$l();yd();wd();_d();vd();xd();Ad();Ed();Td();Cd();Pd();Sd();Rd();kd();Nd();$d();Md();jd();Bd();Fl();Ld();jl();Fd();Dd();Dl();Ud();zd();qd();qd()});function Hd(n,e=ga){n=n.trim();let t=/```(json)?(.*)```/s.exec(n);return e(t?t[2]:n)}function ga(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="",t=[],r=!1,s=!1;for(let a of n){if(r)a==='"'&&!s?r=!1:a===`
`&&!s?a="\\n":a==="\\"?s=!s:s=!1;else if(a==='"')r=!0,s=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}r&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}var Vd=y(()=>{});var cg=k((o1,lg)=>{"use strict";lg.exports=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var gg=k((l1,Gd)=>{"use strict";var Rx=/[\p{Lu}]/u,kx=/[\p{Ll}]/u,ug=/^[\p{Lu}](?![\p{Lu}])/gu,fg=/([\p{Alpha}\p{N}_]|$)/u,hg=/[_.\- ]+/,Nx=new RegExp("^"+hg.source),dg=new RegExp(hg.source+fg.source,"gu"),pg=new RegExp("\\d+"+fg.source,"gu"),$x=(n,e,t)=>{let r=!1,s=!1,a=!1;for(let i=0;i<n.length;i++){let o=n[i];r&&Rx.test(o)?(n=n.slice(0,i)+"-"+n.slice(i),r=!1,a=s,s=!0,i++):s&&a&&kx.test(o)?(n=n.slice(0,i-1)+"-"+n.slice(i-1),a=s,s=!1,r=!0):(r=e(o)===o&&t(o)!==o,a=s,s=t(o)===o&&e(o)!==o)}return n},Mx=(n,e)=>(ug.lastIndex=0,n.replace(ug,t=>e(t))),jx=(n,e)=>(dg.lastIndex=0,pg.lastIndex=0,n.replace(dg,(t,r)=>e(r)).replace(pg,t=>e(t))),mg=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(a=>a.trim()).filter(a=>a.length).join("-"):n=n.trim(),n.length===0)return"";let t=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),r=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=$x(n,t,r)),n=n.replace(Nx,""),e.preserveConsecutiveUppercase?n=Mx(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),jx(n,r))};Gd.exports=mg;Gd.exports.default=mg});function bg(n,e){return e?.[n]||(0,yg.default)(n)}function wg(n,e,t){let r={};for(let s in n)Object.hasOwn(n,s)&&(r[e(s,t)]=n[s]);return r}var yg,Lx,_g=y(()=>{yg=Ct(cg(),1),Lx=Ct(gg(),1)});function vg(n){return Array.isArray(n)?[...n]:{...n}}function Fx(n,e){let t=vg(n);for(let[r,s]of Object.entries(e)){let[a,...i]=r.split(".").reverse(),o=t;for(let l of i.reverse()){if(o[l]===void 0)break;o[l]=vg(o[l]),o=o[l]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[s]})}return t}function Kd(n){let e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}var vt,ya=y(()=>{_g();vt=class n{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Kd(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof n||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((s,a)=>(s[a]=a in this?this[a]:this.lc_kwargs[a],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let a=this,i=r,[o,...l]=s.split(".").reverse();for(let c of l.reverse()){if(!(c in a)||a[c]===void 0)return;(!(c in i)||i[c]===void 0)&&(typeof a[c]=="object"&&a[c]!=null?i[c]={}:Array.isArray(a[c])&&(i[c]=[])),a=a[c],i=i[c]}o in a&&a[o]!==void 0&&(i[o]=i[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:wg(Object.keys(t).length?Fx(r,t):r,bg,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}});function Nt(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?ro(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function xg(n,e){return n==="error"||e==="error"?"error":"success"}function Dx(n,e){function t(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(i=>t(i,s+1));let a={};for(let i of Object.keys(r))a[i]=t(r[i],s+1);return a}return JSON.stringify(t(n,0),null,2)}function ge(n,e){let t={...n};for(let[r,s]of Object.entries(e))if(t[r]==null)t[r]=s;else{if(s==null)continue;if(typeof t[r]!=typeof s||Array.isArray(t[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=s}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=ge(t[r],s);else if(Array.isArray(t[r]))t[r]=ro(t[r],s);else{if(t[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function ro(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{let t=[...n];for(let r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){let s=t.findIndex(a=>a.index===r.index);s!==-1?t[s]=ge(t[s],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}function Ag(n,e){if(!n&&!e)throw new Error("Cannot merge two undefined objects.");if(!n||!e)return n||e;if(typeof n!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof n}
Right ${typeof e}`);if(typeof n=="string"&&typeof e=="string")return n+e;if(Array.isArray(n)&&Array.isArray(e))return ro(n,e);if(typeof n=="object"&&typeof e=="object")return ge(n,e);if(n===e)return n;throw new Error(`Can not merge objects of different types.
Left ${n}
Right ${e}`)}function Eg(n){return typeof n.role=="string"}function pt(n){return typeof n?._getType=="function"}function Ig(n){return pt(n)&&typeof n.concat=="function"}var Ee,dt,Gt=y(()=>{ya();Ee=class extends vt{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=Dx(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};dt=class extends Ee{}});function Og(n){let e=[],t=[];for(let r of n)if(r.function){let s=r.function.name;try{let a=JSON.parse(r.function.arguments),i={name:s||"",args:a||{},id:r.id};e.push(i)}catch{t.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}var Mr,ba,wa=y(()=>{Gt();Mr=class extends Ee{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},ba=class n extends dt{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new n({content:Nt(this.content,e.content),additional_kwargs:ge(this.additional_kwargs,e.additional_kwargs),response_metadata:ge(this.response_metadata,e.response_metadata),artifact:Ag(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:xg(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}});function is(n){return n._getType()==="ai"}var ce,he,os=y(()=>{Vd();Gt();wa();ce=class extends Ee{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;let s=r.additional_kwargs?.tool_calls,a=r.tool_calls;s!=null&&s.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(s!=null&&a===void 0){let[i,o]=Og(s);r.tool_calls=i??[],r.invalid_tool_calls=o??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}};he=class n extends dt{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]};else{let r=[],s=[];for(let a of e.tool_call_chunks){let i={};try{if(i=ga(a.args||"{}"),i===null||typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:i,id:a.id,type:"tool_call"})}catch{s.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:s}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:Nt(this.content,e.content),additional_kwargs:ge(this.additional_kwargs,e.additional_kwargs),response_metadata:ge(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let r=ro(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a={input_tokens:r.input_tokens+s.input_tokens,output_tokens:r.output_tokens+s.output_tokens,total_tokens:r.total_tokens+s.total_tokens};t.usage_metadata=a}return new n(t)}}});var De,jr,Ul=y(()=>{Gt();De=class n extends Ee{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return n}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},jr=class n extends dt{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new n({content:Nt(this.content,e.content),additional_kwargs:ge(this.additional_kwargs,e.additional_kwargs),response_metadata:ge(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}});var ls,Bl=y(()=>{Gt();ls=class n extends dt{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new n({content:Nt(this.content,e.content),additional_kwargs:ge(this.additional_kwargs,e.additional_kwargs),response_metadata:ge(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}});var Ie,Lr,no=y(()=>{Gt();Ie=class extends Ee{static lc_name(){return"HumanMessage"}_getType(){return"human"}},Lr=class n extends dt{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new n({content:Nt(this.content,e.content),additional_kwargs:ge(this.additional_kwargs,e.additional_kwargs),response_metadata:ge(this.response_metadata,e.response_metadata),id:this.id??e.id})}}});var cs,Fr,zl=y(()=>{Gt();cs=class extends Ee{static lc_name(){return"SystemMessage"}_getType(){return"system"}},Fr=class n extends dt{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new n({content:Nt(this.content,e.content),additional_kwargs:ge(this.additional_kwargs,e.additional_kwargs),response_metadata:ge(this.response_metadata,e.response_metadata),id:this.id??e.id})}}});function va(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}var _a,ql=y(()=>{_a=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}});function Bx(n){return va(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function Wd(n){let{type:e,...t}=n;if(e==="human"||e==="user")return new Ie(t);if(e==="ai"||e==="assistant"){let{tool_calls:r,...s}=t;if(!Array.isArray(r))return new ce(t);let a=r.map(Bx);return new ce({...s,tool_calls:a})}else{if(e==="system")return new cs(t);if(e==="tool"&&"tool_call_id"in t)return new Mr({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}}function Kt(n){if(typeof n=="string")return new Ie(n);if(pt(n))return n;if(Array.isArray(n)){let[e,t]=n;return Wd({type:e,content:t})}else if(Eg(n)){let{role:e,...t}=n;return Wd({...t,type:e})}else return Wd(n)}function so(n,e="Human",t="AI"){let r=[];for(let s of n){let a;if(s._getType()==="human")a=e;else if(s._getType()==="ai")a=t;else if(s._getType()==="system")a="System";else if(s._getType()==="function")a="Function";else if(s._getType()==="tool")a="Tool";else if(s._getType()==="generic")a=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);let i=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);r.push(`${a}: ${i}${o}`)}return r.join(`
`)}function Jd(n){let e=n._getType();if(e==="human")return new Lr({...n});if(e==="ai"){let t={...n};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(r=>({...r,type:"tool_call_chunk",index:void 0,args:JSON.stringify(r.args)}))}),new he({...t})}else{if(e==="system")return new Fr({...n});if(e==="function")return new ls({...n});if(De.isInstance(n))return new jr({...n});throw new Error("Unknown message type.")}}var un=y(()=>{ql();os();Gt();Ul();Bl();no();zl();wa()});var Cg=k((F1,Tg)=>{function $t(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Tg.exports=$t;$t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};$t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};$t.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};$t.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};$t.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};$t.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};$t.prototype.start=$t.prototype.try;$t.prototype.errors=function(){return this._errors};$t.prototype.attempts=function(){return this._attempts};$t.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var s=this._errors[r],a=s.message,i=(n[a]||0)+1;n[a]=i,i>=t&&(e=s,t=i)}return e}});var Pg=k(us=>{var zx=Cg();us.operation=function(n){var e=us.timeouts(n);return new zx(e,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})};us.timeouts=function(n){if(n instanceof Array)return[].concat(n);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in n)e[t]=n[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],s=0;s<e.retries;s++)r.push(this.createTimeout(s,e));return n&&n.forever&&!r.length&&r.push(this.createTimeout(s,e)),r.sort(function(a,i){return a-i}),r};us.createTimeout=function(n,e){var t=e.randomize?Math.random()+1:1,r=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,n));return r=Math.min(r,e.maxTimeout),r};us.wrap=function(n,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var r in n)typeof n[r]=="function"&&t.push(r)}for(var s=0;s<t.length;s++){var a=t[s],i=n[a];n[a]=function(l){var c=us.operation(e),u=Array.prototype.slice.call(arguments,1),d=u.pop();u.push(function(p){c.retry(p)||(p&&(arguments[0]=c.mainError()),d.apply(this,arguments))}),c.attempt(function(){l.apply(n,u)})}.bind(n,i),n[a].options=e}}});var Rg=k((U1,Sg)=>{Sg.exports=Pg()});var Gl=k((B1,Vl)=>{"use strict";var qx=Rg(),Hx=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Hl=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},Vx=(n,e,t)=>{let r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},Gx=n=>Hx.includes(n),kg=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};let s=qx.operation(e);s.attempt(async a=>{try{t(await n(a))}catch(i){if(!(i instanceof Error)){r(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof Hl)s.stop(),r(i.originalError);else if(i instanceof TypeError&&!Gx(i.message))s.stop(),r(i);else{Vx(i,a,e);try{await e.onFailedAttempt(i)}catch(o){r(o);return}s.retry(i)||r(s.mainError())}}})});Vl.exports=kg;Vl.exports.default=kg;Vl.exports.AbortError=Hl});var Ng,$g=y(()=>{Ng=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});function Kx(n){return typeof n=="string"&&Ng.test(n)}var ao,Mg=y(()=>{$g();ao=Kx});function jg(n,e=0){return(Ue[n[e+0]]+Ue[n[e+1]]+Ue[n[e+2]]+Ue[n[e+3]]+"-"+Ue[n[e+4]]+Ue[n[e+5]]+"-"+Ue[n[e+6]]+Ue[n[e+7]]+"-"+Ue[n[e+8]]+Ue[n[e+9]]+"-"+Ue[n[e+10]]+Ue[n[e+11]]+Ue[n[e+12]]+Ue[n[e+13]]+Ue[n[e+14]]+Ue[n[e+15]]).toLowerCase()}var Ue,Kl,Lg=y(()=>{Ue=[];for(Kl=0;Kl<256;++Kl)Ue.push((Kl+256).toString(16).slice(1))});function Yd(){if(!Wl&&(Wl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Wl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Wl(Wx)}var Wl,Wx,Fg=y(()=>{Wx=new Uint8Array(16)});var Jx,Zd,Dg=y(()=>{Jx=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Zd={randomUUID:Jx}});function Yx(n,e,t){if(Zd.randomUUID&&!e&&!n)return Zd.randomUUID();n=n||{};var r=n.random||(n.rng||Yd)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=r[s];return e}return jg(r)}var ft,Ug=y(()=>{Dg();Fg();Lg();ft=Yx});var io=y(()=>{Ug();Mg()});var Bg,zg=y(()=>{Bg=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});function Xx(n){return typeof n=="string"&&Bg.test(n)}var Xd,qg=y(()=>{zg();Xd=Xx});function Hg(n,e=0){return(Be[n[e+0]]+Be[n[e+1]]+Be[n[e+2]]+Be[n[e+3]]+"-"+Be[n[e+4]]+Be[n[e+5]]+"-"+Be[n[e+6]]+Be[n[e+7]]+"-"+Be[n[e+8]]+Be[n[e+9]]+"-"+Be[n[e+10]]+Be[n[e+11]]+Be[n[e+12]]+Be[n[e+13]]+Be[n[e+14]]+Be[n[e+15]]).toLowerCase()}var Be,Jl,Vg=y(()=>{Be=[];for(Jl=0;Jl<256;++Jl)Be.push((Jl+256).toString(16).slice(1))});function Qd(){if(!Yl&&(Yl=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Yl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Yl(Qx)}var Yl,Qx,Gg=y(()=>{Qx=new Uint8Array(16)});var eA,ep,Kg=y(()=>{eA=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ep={randomUUID:eA}});function tA(n,e,t){if(ep.randomUUID&&!e&&!n)return ep.randomUUID();n=n||{};var r=n.random||(n.rng||Qd)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=r[s];return e}return Hg(r)}var ds,Wg=y(()=>{Kg();Gg();Vg();ds=tA});var Zl=y(()=>{Wg();qg()});var Yg=k((pM,rp)=>{"use strict";var rA=Object.prototype.hasOwnProperty,tt="~";function oo(){}Object.create&&(oo.prototype=Object.create(null),new oo().__proto__||(tt=!1));function nA(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function Jg(n,e,t,r,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var a=new nA(t,r||n,s),i=tt?tt+e:e;return n._events[i]?n._events[i].fn?n._events[i]=[n._events[i],a]:n._events[i].push(a):(n._events[i]=a,n._eventsCount++),n}function Xl(n,e){--n._eventsCount===0?n._events=new oo:delete n._events[e]}function Je(){this._events=new oo,this._eventsCount=0}Je.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)rA.call(t,r)&&e.push(tt?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Je.prototype.listeners=function(e){var t=tt?tt+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,a=r.length,i=new Array(a);s<a;s++)i[s]=r[s].fn;return i};Je.prototype.listenerCount=function(e){var t=tt?tt+e:e,r=this._events[t];return r?r.fn?1:r.length:0};Je.prototype.emit=function(e,t,r,s,a,i){var o=tt?tt+e:e;if(!this._events[o])return!1;var l=this._events[o],c=arguments.length,u,d;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),c){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,s),!0;case 5:return l.fn.call(l.context,t,r,s,a),!0;case 6:return l.fn.call(l.context,t,r,s,a,i),!0}for(d=1,u=new Array(c-1);d<c;d++)u[d-1]=arguments[d];l.fn.apply(l.context,u)}else{var p=l.length,f;for(d=0;d<p;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),c){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,r);break;case 4:l[d].fn.call(l[d].context,t,r,s);break;default:if(!u)for(f=1,u=new Array(c-1);f<c;f++)u[f-1]=arguments[f];l[d].fn.apply(l[d].context,u)}}return!0};Je.prototype.on=function(e,t,r){return Jg(this,e,t,r,!1)};Je.prototype.once=function(e,t,r){return Jg(this,e,t,r,!0)};Je.prototype.removeListener=function(e,t,r,s){var a=tt?tt+e:e;if(!this._events[a])return this;if(!t)return Xl(this,a),this;var i=this._events[a];if(i.fn)i.fn===t&&(!s||i.once)&&(!r||i.context===r)&&Xl(this,a);else{for(var o=0,l=[],c=i.length;o<c;o++)(i[o].fn!==t||s&&!i[o].once||r&&i[o].context!==r)&&l.push(i[o]);l.length?this._events[a]=l.length===1?l[0]:l:Xl(this,a)}return this};Je.prototype.removeAllListeners=function(e){var t;return e?(t=tt?tt+e:e,this._events[t]&&Xl(this,t)):(this._events=new oo,this._eventsCount=0),this};Je.prototype.off=Je.prototype.removeListener;Je.prototype.addListener=Je.prototype.on;Je.prefixed=tt;Je.EventEmitter=Je;typeof rp<"u"&&(rp.exports=Je)});var Xg=k((fM,Zg)=>{"use strict";Zg.exports=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))});var ey=k((hM,ec)=>{"use strict";var sA=Xg(),Ql=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Qg=(n,e,t)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}let a=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(l){s(l)}return}let i=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Ql(i);typeof n.cancel=="function"&&n.cancel(),s(o)},e);sA(n.then(r,s),()=>{clearTimeout(a)})});ec.exports=Qg;ec.exports.default=Qg;ec.exports.TimeoutError=Ql});var ty=k(np=>{"use strict";Object.defineProperty(np,"__esModule",{value:!0});function aA(n,e,t){let r=0,s=n.length;for(;s>0;){let a=s/2|0,i=r+a;t(n[i],e)<=0?(r=++i,s-=a+1):s=a}return r}np.default=aA});var ry=k(ap=>{"use strict";Object.defineProperty(ap,"__esModule",{value:!0});var iA=ty(),sp=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let s=iA.default(this._queue,r,(a,i)=>i.priority-a.priority);this._queue.splice(s,0,r)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};ap.default=sp});var rc=k(op=>{"use strict";Object.defineProperty(op,"__esModule",{value:!0});var oA=Yg(),ny=ey(),lA=ry(),tc=()=>{},cA=new ny.TimeoutError,ip=class extends oA{constructor(e){var t,r,s,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=tc,this._resolveIdle=tc,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:lA.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(a=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=tc,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=tc,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,s)=>{let a=async()=>{this._pendingCount++,this._intervalCount++;try{let i=this._timeout===void 0&&t.timeout===void 0?e():ny.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&s(cA)});r(await i)}catch(i){s(i)}this._next()};this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};op.default=ip});var uA,dA,M,nc=y(()=>{uA=(...n)=>fetch(...n),dA=Symbol.for("ls:fetch_implementation"),M=()=>globalThis[dA]??uA});var sy,sc,pA,fA,lo,ay=y(()=>{sy=Ct(Gl(),1),sc=Ct(rc(),1);nc();pA=[400,401,403,404,405,406,407,408],fA=[409],lo=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in sc.default?this.queue=new sc.default.default({concurrency:this.maxConcurrency}):this.queue=new sc.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>(0,sy.default)(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||s?.code==="ECONNABORTED")throw s;let a=s?.response,i=a?.status;if(i){if(pA.includes(+i))throw s;if(fA.includes(+i))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,a)=>{e.signal?.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>M()(...e).then(t=>t.ok?t:Promise.reject(t)))}}});function lp(n){return typeof n?._getType=="function"}function cp(n){let e={type:n._getType(),data:{content:n.content}};return n?.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}var iy=y(()=>{});function X(n,e){if(!Xd(n)){let t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}var oy=y(()=>{Zl()});function ac(n){ly[n]||(console.warn(n),ly[n]=!0)}var ly,up=y(()=>{ly={}});var co=k((EM,cy)=>{"use strict";var hA="2.0.0",mA=Number.MAX_SAFE_INTEGER||9007199254740991,gA=16,yA=250,bA=["major","premajor","minor","preminor","patch","prepatch","prerelease"];cy.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:gA,MAX_SAFE_BUILD_LENGTH:yA,MAX_SAFE_INTEGER:mA,RELEASE_TYPES:bA,SEMVER_SPEC_VERSION:hA,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var uo=k((IM,uy)=>{"use strict";var wA=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};uy.exports=wA});var xa=k((or,dy)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:dp,MAX_SAFE_BUILD_LENGTH:_A,MAX_LENGTH:vA}=co(),xA=uo();or=dy.exports={};var AA=or.re=[],EA=or.safeRe=[],C=or.src=[],IA=or.safeSrc=[],P=or.t={},OA=0,pp="[a-zA-Z0-9-]",TA=[["\\s",1],["\\d",vA],[pp,_A]],CA=n=>{for(let[e,t]of TA)n=n.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return n},B=(n,e,t)=>{let r=CA(e),s=OA++;xA(n,s,e),P[n]=s,C[s]=e,IA[s]=r,AA[s]=new RegExp(e,t?"g":void 0),EA[s]=new RegExp(r,t?"g":void 0)};B("NUMERICIDENTIFIER","0|[1-9]\\d*");B("NUMERICIDENTIFIERLOOSE","\\d+");B("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${pp}*`);B("MAINVERSION",`(${C[P.NUMERICIDENTIFIER]})\\.(${C[P.NUMERICIDENTIFIER]})\\.(${C[P.NUMERICIDENTIFIER]})`);B("MAINVERSIONLOOSE",`(${C[P.NUMERICIDENTIFIERLOOSE]})\\.(${C[P.NUMERICIDENTIFIERLOOSE]})\\.(${C[P.NUMERICIDENTIFIERLOOSE]})`);B("PRERELEASEIDENTIFIER",`(?:${C[P.NONNUMERICIDENTIFIER]}|${C[P.NUMERICIDENTIFIER]})`);B("PRERELEASEIDENTIFIERLOOSE",`(?:${C[P.NONNUMERICIDENTIFIER]}|${C[P.NUMERICIDENTIFIERLOOSE]})`);B("PRERELEASE",`(?:-(${C[P.PRERELEASEIDENTIFIER]}(?:\\.${C[P.PRERELEASEIDENTIFIER]})*))`);B("PRERELEASELOOSE",`(?:-?(${C[P.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${C[P.PRERELEASEIDENTIFIERLOOSE]})*))`);B("BUILDIDENTIFIER",`${pp}+`);B("BUILD",`(?:\\+(${C[P.BUILDIDENTIFIER]}(?:\\.${C[P.BUILDIDENTIFIER]})*))`);B("FULLPLAIN",`v?${C[P.MAINVERSION]}${C[P.PRERELEASE]}?${C[P.BUILD]}?`);B("FULL",`^${C[P.FULLPLAIN]}$`);B("LOOSEPLAIN",`[v=\\s]*${C[P.MAINVERSIONLOOSE]}${C[P.PRERELEASELOOSE]}?${C[P.BUILD]}?`);B("LOOSE",`^${C[P.LOOSEPLAIN]}$`);B("GTLT","((?:<|>)?=?)");B("XRANGEIDENTIFIERLOOSE",`${C[P.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);B("XRANGEIDENTIFIER",`${C[P.NUMERICIDENTIFIER]}|x|X|\\*`);B("XRANGEPLAIN",`[v=\\s]*(${C[P.XRANGEIDENTIFIER]})(?:\\.(${C[P.XRANGEIDENTIFIER]})(?:\\.(${C[P.XRANGEIDENTIFIER]})(?:${C[P.PRERELEASE]})?${C[P.BUILD]}?)?)?`);B("XRANGEPLAINLOOSE",`[v=\\s]*(${C[P.XRANGEIDENTIFIERLOOSE]})(?:\\.(${C[P.XRANGEIDENTIFIERLOOSE]})(?:\\.(${C[P.XRANGEIDENTIFIERLOOSE]})(?:${C[P.PRERELEASELOOSE]})?${C[P.BUILD]}?)?)?`);B("XRANGE",`^${C[P.GTLT]}\\s*${C[P.XRANGEPLAIN]}$`);B("XRANGELOOSE",`^${C[P.GTLT]}\\s*${C[P.XRANGEPLAINLOOSE]}$`);B("COERCEPLAIN",`(^|[^\\d])(\\d{1,${dp}})(?:\\.(\\d{1,${dp}}))?(?:\\.(\\d{1,${dp}}))?`);B("COERCE",`${C[P.COERCEPLAIN]}(?:$|[^\\d])`);B("COERCEFULL",C[P.COERCEPLAIN]+`(?:${C[P.PRERELEASE]})?(?:${C[P.BUILD]})?(?:$|[^\\d])`);B("COERCERTL",C[P.COERCE],!0);B("COERCERTLFULL",C[P.COERCEFULL],!0);B("LONETILDE","(?:~>?)");B("TILDETRIM",`(\\s*)${C[P.LONETILDE]}\\s+`,!0);or.tildeTrimReplace="$1~";B("TILDE",`^${C[P.LONETILDE]}${C[P.XRANGEPLAIN]}$`);B("TILDELOOSE",`^${C[P.LONETILDE]}${C[P.XRANGEPLAINLOOSE]}$`);B("LONECARET","(?:\\^)");B("CARETTRIM",`(\\s*)${C[P.LONECARET]}\\s+`,!0);or.caretTrimReplace="$1^";B("CARET",`^${C[P.LONECARET]}${C[P.XRANGEPLAIN]}$`);B("CARETLOOSE",`^${C[P.LONECARET]}${C[P.XRANGEPLAINLOOSE]}$`);B("COMPARATORLOOSE",`^${C[P.GTLT]}\\s*(${C[P.LOOSEPLAIN]})$|^$`);B("COMPARATOR",`^${C[P.GTLT]}\\s*(${C[P.FULLPLAIN]})$|^$`);B("COMPARATORTRIM",`(\\s*)${C[P.GTLT]}\\s*(${C[P.LOOSEPLAIN]}|${C[P.XRANGEPLAIN]})`,!0);or.comparatorTrimReplace="$1$2$3";B("HYPHENRANGE",`^\\s*(${C[P.XRANGEPLAIN]})\\s+-\\s+(${C[P.XRANGEPLAIN]})\\s*$`);B("HYPHENRANGELOOSE",`^\\s*(${C[P.XRANGEPLAINLOOSE]})\\s+-\\s+(${C[P.XRANGEPLAINLOOSE]})\\s*$`);B("STAR","(<|>)?=?\\s*\\*");B("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");B("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var ic=k((OM,py)=>{"use strict";var PA=Object.freeze({loose:!0}),SA=Object.freeze({}),RA=n=>n?typeof n!="object"?PA:n:SA;py.exports=RA});var fp=k((TM,my)=>{"use strict";var fy=/^[0-9]+$/,hy=(n,e)=>{let t=fy.test(n),r=fy.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},kA=(n,e)=>hy(e,n);my.exports={compareIdentifiers:hy,rcompareIdentifiers:kA}});var Ye=k((CM,yy)=>{"use strict";var oc=uo(),{MAX_LENGTH:gy,MAX_SAFE_INTEGER:lc}=co(),{safeRe:cc,t:uc}=xa(),NA=ic(),{compareIdentifiers:Aa}=fp(),hp=class n{constructor(e,t){if(t=NA(t),e instanceof n){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>gy)throw new TypeError(`version is longer than ${gy} characters`);oc("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?cc[uc.LOOSE]:cc[uc.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>lc||this.major<0)throw new TypeError("Invalid major version");if(this.minor>lc||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>lc||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let a=+s;if(a>=0&&a<lc)return a}return s}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(oc("SemVer.compare",this.version,this.options,e),!(e instanceof n)){if(typeof e=="string"&&e===this.version)return 0;e=new n(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof n||(e=new n(e,this.options)),Aa(this.major,e.major)||Aa(this.minor,e.minor)||Aa(this.patch,e.patch)}comparePre(e){if(e instanceof n||(e=new n(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],s=e.prerelease[t];if(oc("prerelease compare",t,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return Aa(r,s)}while(++t)}compareBuild(e){e instanceof n||(e=new n(e,this.options));let t=0;do{let r=this.build[t],s=e.build[t];if(oc("build compare",t,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return Aa(r,s)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let s=`-${t}`.match(this.options.loose?cc[uc.PRERELEASELOOSE]:cc[uc.PRERELEASE]);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let a=this.prerelease.length;for(;--a>=0;)typeof this.prerelease[a]=="number"&&(this.prerelease[a]++,a=-2);if(a===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let a=[t,s];r===!1&&(a=[t]),Aa(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=a):this.prerelease=a}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};yy.exports=hp});var ps=k((PM,wy)=>{"use strict";var by=Ye(),$A=(n,e,t=!1)=>{if(n instanceof by)return n;try{return new by(n,e)}catch(r){if(!t)return null;throw r}};wy.exports=$A});var vy=k((SM,_y)=>{"use strict";var MA=ps(),jA=(n,e)=>{let t=MA(n,e);return t?t.version:null};_y.exports=jA});var Ay=k((RM,xy)=>{"use strict";var LA=ps(),FA=(n,e)=>{let t=LA(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null};xy.exports=FA});var Oy=k((kM,Iy)=>{"use strict";var Ey=Ye(),DA=(n,e,t,r,s)=>{typeof t=="string"&&(s=r,r=t,t=void 0);try{return new Ey(n instanceof Ey?n.version:n,t).inc(e,r,s).version}catch{return null}};Iy.exports=DA});var Py=k((NM,Cy)=>{"use strict";var Ty=ps(),UA=(n,e)=>{let t=Ty(n,null,!0),r=Ty(e,null,!0),s=t.compare(r);if(s===0)return null;let a=s>0,i=a?t:r,o=a?r:t,l=!!i.prerelease.length;if(!!o.prerelease.length&&!l){if(!o.patch&&!o.minor)return"major";if(o.compareMain(i)===0)return o.minor&&!o.patch?"minor":"patch"}let u=l?"pre":"";return t.major!==r.major?u+"major":t.minor!==r.minor?u+"minor":t.patch!==r.patch?u+"patch":"prerelease"};Cy.exports=UA});var Ry=k(($M,Sy)=>{"use strict";var BA=Ye(),zA=(n,e)=>new BA(n,e).major;Sy.exports=zA});var Ny=k((MM,ky)=>{"use strict";var qA=Ye(),HA=(n,e)=>new qA(n,e).minor;ky.exports=HA});var My=k((jM,$y)=>{"use strict";var VA=Ye(),GA=(n,e)=>new VA(n,e).patch;$y.exports=GA});var Ly=k((LM,jy)=>{"use strict";var KA=ps(),WA=(n,e)=>{let t=KA(n,e);return t&&t.prerelease.length?t.prerelease:null};jy.exports=WA});var Mt=k((FM,Dy)=>{"use strict";var Fy=Ye(),JA=(n,e,t)=>new Fy(n,t).compare(new Fy(e,t));Dy.exports=JA});var By=k((DM,Uy)=>{"use strict";var YA=Mt(),ZA=(n,e,t)=>YA(e,n,t);Uy.exports=ZA});var qy=k((UM,zy)=>{"use strict";var XA=Mt(),QA=(n,e)=>XA(n,e,!0);zy.exports=QA});var dc=k((BM,Vy)=>{"use strict";var Hy=Ye(),eE=(n,e,t)=>{let r=new Hy(n,t),s=new Hy(e,t);return r.compare(s)||r.compareBuild(s)};Vy.exports=eE});var Ky=k((zM,Gy)=>{"use strict";var tE=dc(),rE=(n,e)=>n.sort((t,r)=>tE(t,r,e));Gy.exports=rE});var Jy=k((qM,Wy)=>{"use strict";var nE=dc(),sE=(n,e)=>n.sort((t,r)=>nE(r,t,e));Wy.exports=sE});var po=k((HM,Yy)=>{"use strict";var aE=Mt(),iE=(n,e,t)=>aE(n,e,t)>0;Yy.exports=iE});var pc=k((VM,Zy)=>{"use strict";var oE=Mt(),lE=(n,e,t)=>oE(n,e,t)<0;Zy.exports=lE});var mp=k((GM,Xy)=>{"use strict";var cE=Mt(),uE=(n,e,t)=>cE(n,e,t)===0;Xy.exports=uE});var gp=k((KM,Qy)=>{"use strict";var dE=Mt(),pE=(n,e,t)=>dE(n,e,t)!==0;Qy.exports=pE});var fc=k((WM,eb)=>{"use strict";var fE=Mt(),hE=(n,e,t)=>fE(n,e,t)>=0;eb.exports=hE});var hc=k((JM,tb)=>{"use strict";var mE=Mt(),gE=(n,e,t)=>mE(n,e,t)<=0;tb.exports=gE});var yp=k((YM,rb)=>{"use strict";var yE=mp(),bE=gp(),wE=po(),_E=fc(),vE=pc(),xE=hc(),AE=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return yE(n,t,r);case"!=":return bE(n,t,r);case">":return wE(n,t,r);case">=":return _E(n,t,r);case"<":return vE(n,t,r);case"<=":return xE(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};rb.exports=AE});var sb=k((ZM,nb)=>{"use strict";var EE=Ye(),IE=ps(),{safeRe:mc,t:gc}=xa(),OE=(n,e)=>{if(n instanceof EE)return n;if(typeof n=="number"&&(n=String(n)),typeof n!="string")return null;e=e||{};let t=null;if(!e.rtl)t=n.match(e.includePrerelease?mc[gc.COERCEFULL]:mc[gc.COERCE]);else{let l=e.includePrerelease?mc[gc.COERCERTLFULL]:mc[gc.COERCERTL],c;for(;(c=l.exec(n))&&(!t||t.index+t[0].length!==n.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),l.lastIndex=c.index+c[1].length+c[2].length;l.lastIndex=-1}if(t===null)return null;let r=t[2],s=t[3]||"0",a=t[4]||"0",i=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return IE(`${r}.${s}.${a}${i}${o}`,e)};nb.exports=OE});var ib=k((XM,ab)=>{"use strict";var bp=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let s=this.map.keys().next().value;this.delete(s)}this.map.set(e,t)}return this}};ab.exports=bp});var jt=k((QM,ub)=>{"use strict";var TE=/\s+/g,wp=class n{constructor(e,t){if(t=PE(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof _p)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(TE," "),this.set=this.raw.split("||").map(r=>this.parseRange(r.trim())).filter(r=>r.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let r=this.set[0];if(this.set=this.set.filter(s=>!lb(s[0])),this.set.length===0)this.set=[r];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&jE(s[0])){this.set=[s];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let r=0;r<t.length;r++)r>0&&(this.formatted+=" "),this.formatted+=t[r].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let r=((this.options.includePrerelease&&$E)|(this.options.loose&&ME))+":"+e,s=ob.get(r);if(s)return s;let a=this.options.loose,i=a?ht[rt.HYPHENRANGELOOSE]:ht[rt.HYPHENRANGE];e=e.replace(i,GE(this.options.includePrerelease)),oe("hyphen replace",e),e=e.replace(ht[rt.COMPARATORTRIM],RE),oe("comparator trim",e),e=e.replace(ht[rt.TILDETRIM],kE),oe("tilde trim",e),e=e.replace(ht[rt.CARETTRIM],NE),oe("caret trim",e);let o=e.split(" ").map(d=>LE(d,this.options)).join(" ").split(/\s+/).map(d=>VE(d,this.options));a&&(o=o.filter(d=>(oe("loose invalid filter",d,this.options),!!d.match(ht[rt.COMPARATORLOOSE])))),oe("range list",o);let l=new Map,c=o.map(d=>new _p(d,this.options));for(let d of c){if(lb(d))return[d];l.set(d.value,d)}l.size>1&&l.has("")&&l.delete("");let u=[...l.values()];return ob.set(r,u),u}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some(r=>cb(r,t)&&e.set.some(s=>cb(s,t)&&r.every(a=>s.every(i=>a.intersects(i,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new SE(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(KE(this.set[t],e,this.options))return!0;return!1}};ub.exports=wp;var CE=ib(),ob=new CE,PE=ic(),_p=fo(),oe=uo(),SE=Ye(),{safeRe:ht,t:rt,comparatorTrimReplace:RE,tildeTrimReplace:kE,caretTrimReplace:NE}=xa(),{FLAG_INCLUDE_PRERELEASE:$E,FLAG_LOOSE:ME}=co(),lb=n=>n.value==="<0.0.0-0",jE=n=>n.value==="",cb=(n,e)=>{let t=!0,r=n.slice(),s=r.pop();for(;t&&r.length;)t=r.every(a=>s.intersects(a,e)),s=r.pop();return t},LE=(n,e)=>(oe("comp",n,e),n=UE(n,e),oe("caret",n),n=FE(n,e),oe("tildes",n),n=zE(n,e),oe("xrange",n),n=HE(n,e),oe("stars",n),n),nt=n=>!n||n.toLowerCase()==="x"||n==="*",FE=(n,e)=>n.trim().split(/\s+/).map(t=>DE(t,e)).join(" "),DE=(n,e)=>{let t=e.loose?ht[rt.TILDELOOSE]:ht[rt.TILDE];return n.replace(t,(r,s,a,i,o)=>{oe("tilde",n,r,s,a,i,o);let l;return nt(s)?l="":nt(a)?l=`>=${s}.0.0 <${+s+1}.0.0-0`:nt(i)?l=`>=${s}.${a}.0 <${s}.${+a+1}.0-0`:o?(oe("replaceTilde pr",o),l=`>=${s}.${a}.${i}-${o} <${s}.${+a+1}.0-0`):l=`>=${s}.${a}.${i} <${s}.${+a+1}.0-0`,oe("tilde return",l),l})},UE=(n,e)=>n.trim().split(/\s+/).map(t=>BE(t,e)).join(" "),BE=(n,e)=>{oe("caret",n,e);let t=e.loose?ht[rt.CARETLOOSE]:ht[rt.CARET],r=e.includePrerelease?"-0":"";return n.replace(t,(s,a,i,o,l)=>{oe("caret",n,s,a,i,o,l);let c;return nt(a)?c="":nt(i)?c=`>=${a}.0.0${r} <${+a+1}.0.0-0`:nt(o)?a==="0"?c=`>=${a}.${i}.0${r} <${a}.${+i+1}.0-0`:c=`>=${a}.${i}.0${r} <${+a+1}.0.0-0`:l?(oe("replaceCaret pr",l),a==="0"?i==="0"?c=`>=${a}.${i}.${o}-${l} <${a}.${i}.${+o+1}-0`:c=`>=${a}.${i}.${o}-${l} <${a}.${+i+1}.0-0`:c=`>=${a}.${i}.${o}-${l} <${+a+1}.0.0-0`):(oe("no pr"),a==="0"?i==="0"?c=`>=${a}.${i}.${o}${r} <${a}.${i}.${+o+1}-0`:c=`>=${a}.${i}.${o}${r} <${a}.${+i+1}.0-0`:c=`>=${a}.${i}.${o} <${+a+1}.0.0-0`),oe("caret return",c),c})},zE=(n,e)=>(oe("replaceXRanges",n,e),n.split(/\s+/).map(t=>qE(t,e)).join(" ")),qE=(n,e)=>{n=n.trim();let t=e.loose?ht[rt.XRANGELOOSE]:ht[rt.XRANGE];return n.replace(t,(r,s,a,i,o,l)=>{oe("xRange",n,r,s,a,i,o,l);let c=nt(a),u=c||nt(i),d=u||nt(o),p=d;return s==="="&&p&&(s=""),l=e.includePrerelease?"-0":"",c?s===">"||s==="<"?r="<0.0.0-0":r="*":s&&p?(u&&(i=0),o=0,s===">"?(s=">=",u?(a=+a+1,i=0,o=0):(i=+i+1,o=0)):s==="<="&&(s="<",u?a=+a+1:i=+i+1),s==="<"&&(l="-0"),r=`${s+a}.${i}.${o}${l}`):u?r=`>=${a}.0.0${l} <${+a+1}.0.0-0`:d&&(r=`>=${a}.${i}.0${l} <${a}.${+i+1}.0-0`),oe("xRange return",r),r})},HE=(n,e)=>(oe("replaceStars",n,e),n.trim().replace(ht[rt.STAR],"")),VE=(n,e)=>(oe("replaceGTE0",n,e),n.trim().replace(ht[e.includePrerelease?rt.GTE0PRE:rt.GTE0],"")),GE=n=>(e,t,r,s,a,i,o,l,c,u,d,p)=>(nt(r)?t="":nt(s)?t=`>=${r}.0.0${n?"-0":""}`:nt(a)?t=`>=${r}.${s}.0${n?"-0":""}`:i?t=`>=${t}`:t=`>=${t}${n?"-0":""}`,nt(c)?l="":nt(u)?l=`<${+c+1}.0.0-0`:nt(d)?l=`<${c}.${+u+1}.0-0`:p?l=`<=${c}.${u}.${d}-${p}`:n?l=`<${c}.${u}.${+d+1}-0`:l=`<=${l}`,`${t} ${l}`.trim()),KE=(n,e,t)=>{for(let r=0;r<n.length;r++)if(!n[r].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let r=0;r<n.length;r++)if(oe(n[r].semver),n[r].semver!==_p.ANY&&n[r].semver.prerelease.length>0){let s=n[r].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var fo=k((ej,gb)=>{"use strict";var ho=Symbol("SemVer ANY"),Ap=class n{static get ANY(){return ho}constructor(e,t){if(t=db(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),xp("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ho?this.value="":this.value=this.operator+this.semver.version,xp("comp",this)}parse(e){let t=this.options.loose?pb[fb.COMPARATORLOOSE]:pb[fb.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=r[1]!==void 0?r[1]:"",this.operator==="="&&(this.operator=""),r[2]?this.semver=new hb(r[2],this.options.loose):this.semver=ho}toString(){return this.value}test(e){if(xp("Comparator.test",e,this.options.loose),this.semver===ho||e===ho)return!0;if(typeof e=="string")try{e=new hb(e,this.options)}catch{return!1}return vp(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new mb(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new mb(this.value,t).test(e.semver):(t=db(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||vp(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||vp(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};gb.exports=Ap;var db=ic(),{safeRe:pb,t:fb}=xa(),vp=yp(),xp=uo(),hb=Ye(),mb=jt()});var mo=k((tj,yb)=>{"use strict";var WE=jt(),JE=(n,e,t)=>{try{e=new WE(e,t)}catch{return!1}return e.test(n)};yb.exports=JE});var wb=k((rj,bb)=>{"use strict";var YE=jt(),ZE=(n,e)=>new YE(n,e).set.map(t=>t.map(r=>r.value).join(" ").trim().split(" "));bb.exports=ZE});var vb=k((nj,_b)=>{"use strict";var XE=Ye(),QE=jt(),eI=(n,e,t)=>{let r=null,s=null,a=null;try{a=new QE(e,t)}catch{return null}return n.forEach(i=>{a.test(i)&&(!r||s.compare(i)===-1)&&(r=i,s=new XE(r,t))}),r};_b.exports=eI});var Ab=k((sj,xb)=>{"use strict";var tI=Ye(),rI=jt(),nI=(n,e,t)=>{let r=null,s=null,a=null;try{a=new rI(e,t)}catch{return null}return n.forEach(i=>{a.test(i)&&(!r||s.compare(i)===1)&&(r=i,s=new tI(r,t))}),r};xb.exports=nI});var Ob=k((aj,Ib)=>{"use strict";var Ep=Ye(),sI=jt(),Eb=po(),aI=(n,e)=>{n=new sI(n,e);let t=new Ep("0.0.0");if(n.test(t)||(t=new Ep("0.0.0-0"),n.test(t)))return t;t=null;for(let r=0;r<n.set.length;++r){let s=n.set[r],a=null;s.forEach(i=>{let o=new Ep(i.semver.version);switch(i.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!a||Eb(o,a))&&(a=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${i.operator}`)}}),a&&(!t||Eb(t,a))&&(t=a)}return t&&n.test(t)?t:null};Ib.exports=aI});var Cb=k((ij,Tb)=>{"use strict";var iI=jt(),oI=(n,e)=>{try{return new iI(n,e).range||"*"}catch{return null}};Tb.exports=oI});var yc=k((oj,kb)=>{"use strict";var lI=Ye(),Rb=fo(),{ANY:cI}=Rb,uI=jt(),dI=mo(),Pb=po(),Sb=pc(),pI=hc(),fI=fc(),hI=(n,e,t,r)=>{n=new lI(n,r),e=new uI(e,r);let s,a,i,o,l;switch(t){case">":s=Pb,a=pI,i=Sb,o=">",l=">=";break;case"<":s=Sb,a=fI,i=Pb,o="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(dI(n,e,r))return!1;for(let c=0;c<e.set.length;++c){let u=e.set[c],d=null,p=null;if(u.forEach(f=>{f.semver===cI&&(f=new Rb(">=0.0.0")),d=d||f,p=p||f,s(f.semver,d.semver,r)?d=f:i(f.semver,p.semver,r)&&(p=f)}),d.operator===o||d.operator===l||(!p.operator||p.operator===o)&&a(n,p.semver))return!1;if(p.operator===l&&i(n,p.semver))return!1}return!0};kb.exports=hI});var $b=k((lj,Nb)=>{"use strict";var mI=yc(),gI=(n,e,t)=>mI(n,e,">",t);Nb.exports=gI});var jb=k((cj,Mb)=>{"use strict";var yI=yc(),bI=(n,e,t)=>yI(n,e,"<",t);Mb.exports=bI});var Db=k((uj,Fb)=>{"use strict";var Lb=jt(),wI=(n,e,t)=>(n=new Lb(n,t),e=new Lb(e,t),n.intersects(e,t));Fb.exports=wI});var Bb=k((dj,Ub)=>{"use strict";var _I=mo(),vI=Mt();Ub.exports=(n,e,t)=>{let r=[],s=null,a=null,i=n.sort((u,d)=>vI(u,d,t));for(let u of i)_I(u,e,t)?(a=u,s||(s=u)):(a&&r.push([s,a]),a=null,s=null);s&&r.push([s,null]);let o=[];for(let[u,d]of r)u===d?o.push(u):!d&&u===i[0]?o.push("*"):d?u===i[0]?o.push(`<=${d}`):o.push(`${u} - ${d}`):o.push(`>=${u}`);let l=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return l.length<c.length?l:e}});var Kb=k((pj,Gb)=>{"use strict";var zb=jt(),Op=fo(),{ANY:Ip}=Op,go=mo(),Tp=Mt(),xI=(n,e,t={})=>{if(n===e)return!0;n=new zb(n,t),e=new zb(e,t);let r=!1;e:for(let s of n.set){for(let a of e.set){let i=EI(s,a,t);if(r=r||i!==null,i)continue e}if(r)return!1}return!0},AI=[new Op(">=0.0.0-0")],qb=[new Op(">=0.0.0")],EI=(n,e,t)=>{if(n===e)return!0;if(n.length===1&&n[0].semver===Ip){if(e.length===1&&e[0].semver===Ip)return!0;t.includePrerelease?n=AI:n=qb}if(e.length===1&&e[0].semver===Ip){if(t.includePrerelease)return!0;e=qb}let r=new Set,s,a;for(let f of n)f.operator===">"||f.operator===">="?s=Hb(s,f,t):f.operator==="<"||f.operator==="<="?a=Vb(a,f,t):r.add(f.semver);if(r.size>1)return null;let i;if(s&&a){if(i=Tp(s.semver,a.semver,t),i>0)return null;if(i===0&&(s.operator!==">="||a.operator!=="<="))return null}for(let f of r){if(s&&!go(f,String(s),t)||a&&!go(f,String(a),t))return null;for(let h of e)if(!go(f,String(h),t))return!1;return!0}let o,l,c,u,d=a&&!t.includePrerelease&&a.semver.prerelease.length?a.semver:!1,p=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;d&&d.prerelease.length===1&&a.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let f of e){if(u=u||f.operator===">"||f.operator===">=",c=c||f.operator==="<"||f.operator==="<=",s){if(p&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===p.major&&f.semver.minor===p.minor&&f.semver.patch===p.patch&&(p=!1),f.operator===">"||f.operator===">="){if(o=Hb(s,f,t),o===f&&o!==s)return!1}else if(s.operator===">="&&!go(s.semver,String(f),t))return!1}if(a){if(d&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===d.major&&f.semver.minor===d.minor&&f.semver.patch===d.patch&&(d=!1),f.operator==="<"||f.operator==="<="){if(l=Vb(a,f,t),l===f&&l!==a)return!1}else if(a.operator==="<="&&!go(a.semver,String(f),t))return!1}if(!f.operator&&(a||s)&&i!==0)return!1}return!(s&&c&&!a&&i!==0||a&&u&&!s&&i!==0||p||d)},Hb=(n,e,t)=>{if(!n)return e;let r=Tp(n.semver,e.semver,t);return r>0?n:r<0||e.operator===">"&&n.operator===">="?e:n},Vb=(n,e,t)=>{if(!n)return e;let r=Tp(n.semver,e.semver,t);return r<0?n:r>0||e.operator==="<"&&n.operator==="<="?e:n};Gb.exports=xI});var Zb=k((fj,Yb)=>{"use strict";var Cp=xa(),Wb=co(),II=Ye(),Jb=fp(),OI=ps(),TI=vy(),CI=Ay(),PI=Oy(),SI=Py(),RI=Ry(),kI=Ny(),NI=My(),$I=Ly(),MI=Mt(),jI=By(),LI=qy(),FI=dc(),DI=Ky(),UI=Jy(),BI=po(),zI=pc(),qI=mp(),HI=gp(),VI=fc(),GI=hc(),KI=yp(),WI=sb(),JI=fo(),YI=jt(),ZI=mo(),XI=wb(),QI=vb(),eO=Ab(),tO=Ob(),rO=Cb(),nO=yc(),sO=$b(),aO=jb(),iO=Db(),oO=Bb(),lO=Kb();Yb.exports={parse:OI,valid:TI,clean:CI,inc:PI,diff:SI,major:RI,minor:kI,patch:NI,prerelease:$I,compare:MI,rcompare:jI,compareLoose:LI,compareBuild:FI,sort:DI,rsort:UI,gt:BI,lt:zI,eq:qI,neq:HI,gte:VI,lte:GI,cmp:KI,coerce:WI,Comparator:JI,Range:YI,satisfies:ZI,toComparators:XI,maxSatisfying:QI,minSatisfying:eO,minVersion:tO,validRange:rO,outside:nO,gtr:sO,ltr:aO,intersects:iO,simplifyRange:oO,subset:lO,SemVer:II,re:Cp.re,src:Cp.src,tokens:Cp.t,SEMVER_SPEC_VERSION:Wb.SEMVER_SPEC_VERSION,RELEASE_TYPES:Wb.RELEASE_TYPES,compareIdentifiers:Jb.compareIdentifiers,rcompareIdentifiers:Jb.rcompareIdentifiers}});function Xb(n,e){let t=(0,Pp.parse)(n),r=(0,Pp.parse)(e);if(!t||!r)throw new Error("Invalid version format.");return t.compare(r)>=0}function Dr(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);let[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){let[s,a]=e.split("/",2);if(!s||!a)throw new Error(`Invalid identifier format: ${n}`);return[s,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}var Pp,Qb=y(()=>{Pp=Ct(Zb(),1)});async function K(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();let s=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new Sp(s):new Error(s)}var Sp,ew=y(()=>{Sp=class extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}});function uO(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function fs(n,e,t,r){try{return JSON.stringify(n,e,t)}catch(i){if(!i.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=uO()),kp(n,"",0,[],void 0,0,r);var s;try{Ea.length===0?s=JSON.stringify(n,e,t):s=JSON.stringify(n,dO(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;bc.length!==0;){var a=bc.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return s}}function Rp(n,e,t,r){var s=Object.getOwnPropertyDescriptor(r,t);s.get!==void 0?s.configurable?(Object.defineProperty(r,t,{value:n}),bc.push([r,t,e,s])):Ea.push([e,t,n]):(r[t]=n,bc.push([r,t,e]))}function kp(n,e,t,r,s,a,i){a+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){Rp(cO,n,e,s);return}if(typeof i.depthLimit<"u"&&a>i.depthLimit){Rp(tw,n,e,s);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){Rp(tw,n,e,s);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)kp(n[o],o,o,r,n,a,i);else{var l=Object.keys(n);for(o=0;o<l.length;o++){var c=l[o];kp(n[c],c,o,r,n,a,i)}}r.pop()}}function dO(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Ea.length>0)for(var r=0;r<Ea.length;r++){var s=Ea[r];if(s[1]===e&&s[0]===t){t=s[2],Ea.splice(r,1);break}}return n.call(this,e,t)}}var tw,cO,bc,Ea,rw=y(()=>{tw="[...]",cO={result:"[Circular]"},bc=[],Ea=[]});function nw(n){let e=vc(),t=sw(),r=n.extra??{},s=r.metadata;return n.extra={...r,runtime:{...e,...r?.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...s}},n}async function hO(n){let e=[];for await(let t of n)e.push(t);return e}function Np(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var pO,fO,mO,$p,gO,yO,hs,Mp=y(()=>{Zl();ay();iy();xc();_c();oy();up();Qb();ew();nc();rw();pO=()=>{let n=Ur("TRACING_SAMPLING_RATE");if(n===void 0)return;let e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},fO=n=>{let t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};mO=async n=>{if(n?.status===429){let e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1},$p=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,r=new Promise(a=>{t=a}),s=fs(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:s}),this.sizeBytes+=s,r}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let t=[],r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0;){let s=this.items.shift();s&&(t.push(s),r+=s.size,this.sizeBytes-=s.size)}if(t.length===0&&this.items.length>0){let s=this.items.shift();t.push(s),r+=s.size,this.sizeBytes-=s.size}return[t.map(s=>({action:s.action,item:s.payload})),()=>t.forEach(s=>s.itemPromiseResolve())]}},gO=20971520,yO=1e3,hs=class n{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new $p}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=n.getDefaultClientConfig();this.tracingSampleRate=pO(),this.apiUrl=Np(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Np(e.apiKey??t.apiKey),this.webUrl=Np(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??12e3,this.caller=new lo(e.callerOptions??{}),this.batchIngestCaller=new lo({...e.callerOptions??{},onFailedResponseHook:mO}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){let e=Ur("API_KEY"),t=Ur("ENDPOINT")??"https://api.smith.langchain.com",r=Ur("HIDE_INPUTS")==="true",s=Ur("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:fO(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${wc}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",s=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(M(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let s=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(a));let i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(M(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(o,`Failed to fetch ${e}`);let l=r?r(await o.json()):await o.json();if(l.length===0||(yield l,l.length<a))break;s+=l.length}}async*_getCursorPaginatedList(e,t=null,r="POST",s="runs"){let a=t?{...t}:{};for(;;){let o=await(await this.caller.call(M(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[s])break;yield o[s];let l=o.cursors;if(!l||!l.next)break;a.cursor=l.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let r=[];for(let s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):r.push(s);return r}else{let r=[];for(let s of e)s.id!==s.trace_id&&!this.filteredPostUuids.has(s.trace_id)||Math.random()<this.tracingSampleRate?r.push(s):this.filteredPostUuids.add(s.id);return r}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??gO}async drainAutoBatchQueue(){for(;this.autoBatchQueue.items.length>=0;){let[e,t]=this.autoBatchQueue.pop(await this._getBatchSizeLimitBytes());if(!e.length){t();return}try{let r={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)};(await this._ensureServerInfo())?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(r):await this.batchIngestRuns(r)}finally{t()}}}async processRunOperation(e,t){let r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=nw(e.item));let s=this.autoBatchQueue.push(e),a=await this._getBatchSizeLimitBytes();return(t||this.autoBatchQueue.sizeBytes>a)&&await this.drainAutoBatchQueue().catch(console.error),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),s}async _getServerInfo(){let e=await M()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(yO),...this.fetchOptions});return await K(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to single calls and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async createRun(e){if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}let a=nw(s),i=await this.caller.call(M(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:fs(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=e?.map(l=>this.prepareRunCreateOrUpdateInputs(l))??[],s=t?.map(l=>this.prepareRunCreateOrUpdateInputs(l))??[];if(r.length>0&&s.length>0){let l=r.reduce((u,d)=>(d.id&&(u[d.id]=d),u),{}),c=[];for(let u of s)u.id!==void 0&&l[u.id]?l[u.id]={...l[u.id],...u}:c.push(u);r=Object.values(l),s=c}let a={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!a.post.length&&!a.patch.length)return;if((await this._ensureServerInfo()).version===void 0){this.autoBatchTracing=!1;for(let l of a.post)await this.createRun(l);for(let l of a.patch)l.id!==void 0&&await this.updateRun(l.id,l);return}let o={post:[],patch:[]};for(let l of["post","patch"]){let c=l,u=a[c].reverse(),d=u.pop();for(;d!==void 0;)o[c].push(d),d=u.pop()}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(fs(o))}async _postBatchIngestRuns(e){let t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(M(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r={},s=[];for(let u of e??[]){let d=this.prepareRunCreateOrUpdateInputs(u);d.id!==void 0&&d.attachments!==void 0&&(r[d.id]=d.attachments),delete d.attachments,s.push(d)}let a=[];for(let u of t??[])a.push(this.prepareRunCreateOrUpdateInputs(u));if(s.find(u=>u.trace_id===void 0||u.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(u=>u.trace_id===void 0||u.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&a.length>0){let u=s.reduce((p,f)=>(f.id&&(p[f.id]=f),p),{}),d=[];for(let p of a)p.id!==void 0&&u[p.id]?u[p.id]={...u[p.id],...p}:d.push(p);s=Object.values(u),a=d}if(s.length===0&&a.length===0)return;let l=[],c=[];for(let[u,d]of[["post",s],["patch",a]])for(let p of d){let{inputs:f,outputs:h,events:m,...g}=p,w={inputs:f,outputs:h,events:m},b=fs(g);c.push({name:`${u}.${g.id}`,payload:new Blob([b],{type:`application/json; length=${b.length}`})});for(let[E,O]of Object.entries(w)){if(O===void 0)continue;let S=fs(O);c.push({name:`${u}.${g.id}.${E}`,payload:new Blob([S],{type:`application/json; length=${S.length}`})})}if(g.id!==void 0){let E=r[g.id];if(E){delete r[g.id];for(let[O,[S,J]]of Object.entries(E))c.push({name:`attachment.${g.id}.${O}`,payload:new Blob([J],{type:`${S}; length=${J.length}`})})}}l.push(`trace=${g.trace_id},id=${g.id}`)}await this._sendMultipartRequest(c,l.join("; "))}async _sendMultipartRequest(e,t){try{let r=new FormData;for(let s of e)r.append(s.name,s.payload);await this.batchIngestCaller.call(M(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers},body:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})}catch(r){let s="Failed to multipart ingest runs";r instanceof Error?s+=`: ${r.stack||r.message}`:s+=`: ${String(r)}`,console.warn(`${s.trim()}

Context: ${t}`)}}async updateRun(e,t){X(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization){await this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}let s={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(M(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:fs(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){X(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let s;t.session_id?s=t.session_id:r?.projectName?s=(await this.readProject({projectName:r?.projectName})).id:r?.projectId?s=r?.projectId:s=(await this.readProject({projectName:Ur("PROJECT")||"default"})).id;let a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){let s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await hO(this.listRuns({id:e.child_run_ids})),r={},s={};t.sort((a,i)=>(a?.dotted_order??"").localeCompare(i?.dotted_order??""));for(let a of t){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),s[a.id]=a}e.child_runs=r[e.id]||[];for(let a in r)a!==e.id&&(s[a].child_runs=r[a]);return e}async*listRuns(e){let{projectId:t,projectName:r,parentRunId:s,traceId:a,referenceExampleId:i,startTime:o,executionOrder:l,isRoot:c,runType:u,error:d,id:p,query:f,filter:h,traceFilter:m,treeFilter:g,limit:w,select:b}=e,E=[];if(t&&(E=Array.isArray(t)?t:[t]),r){let te=Array.isArray(r)?r:[r],G=await Promise.all(te.map(q=>this.readProject({projectName:q}).then(Y=>Y.id)));E.push(...G)}let O=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],S={session:E.length?E:null,run_type:u,reference_example:i,query:f,filter:h,trace_filter:m,tree_filter:g,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:p,limit:w,trace:a,select:b||O,is_root:c},J=0;for await(let te of this._getCursorPaginatedList("/runs/query",S))if(w){if(J>=w)break;if(te.length+J>w){yield*te.slice(0,w-J);break}J+=te.length,yield*te}else yield*te}async getRunStats({id:e,trace:t,parentRun:r,runType:s,projectNames:a,projectIds:i,referenceExampleIds:o,startTime:l,endTime:c,error:u,query:d,filter:p,traceFilter:f,treeFilter:h,isRoot:m,dataSourceType:g}){let w=i||[];a&&(w=[...i||[],...await Promise.all(a.map(J=>this.readProject({projectName:J}).then(te=>te.id)))]);let E=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:s,session:w,reference_example:o,start_time:l,end_time:c,error:u,query:d,filter:p,trace_filter:f,tree_filter:h,is_root:m,data_source_type:g}).filter(([J,te])=>te!==void 0));return await(await this.caller.call(M(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(E),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||ds()};X(e);let a=await(await this.caller.call(M(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){X(e);let t=await this.caller.call(M(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(t,"unshare run",!0)}async readRunSharedLink(e){X(e);let r=await(await this.caller.call(M(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(t!==void 0)for(let i of t)r.append("id",i);return X(e),await(await this.caller.call(M(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),X(e);let s=await(await this.caller.call(M(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};X(e);let a=await(await this.caller.call(M(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){X(e);let t=await this.caller.call(M(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(t,"unshare dataset",!0)}async readSharedDataset(e){return X(e),await(await this.caller.call(M(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let s=new URLSearchParams;Object.entries(r).forEach(([o,l])=>{Array.isArray(l)?l.forEach(c=>s.append(o,c)):s.append(o,l)});let a=await this.caller.call(M(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await a.json();if(!a.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:s=!1,projectExtra:a=null,referenceDatasetId:i=null}){let o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,c=a||{};r&&(c.metadata=r);let u={name:e,extra:c,description:t};i!==null&&(u.reference_dataset_id=i);let d=await this.caller.call(M(),l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:r=null,metadata:s=null,projectExtra:a=null,endTime:i=null}){let o=`${this.apiUrl}/sessions/${e}`,l=a;s&&(l={...l||{},metadata:s});let c={name:t,extra:l,description:r,end_time:i?new Date(i).toISOString():null},u=await this.caller.call(M(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(u,"update project"),await u.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)X(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");let a=await this.caller.call(M(),`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let i=await a.json();return a.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let s="/sessions",a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)X(e),s+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());let i=await this._get(s,a),o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:s,referenceDatasetName:a,referenceFree:i,metadata:o}={}){let l=new URLSearchParams;if(e!==void 0)for(let c of e)l.append("id",c);if(t!==void 0&&l.append("name",t),r!==void 0&&l.append("name_contains",r),s!==void 0)l.append("reference_dataset",s);else if(a!==void 0){let c=await this.readDataset({datasetName:a});l.append("reference_dataset",c.id)}i!==void 0&&l.append("reference_free",i.toString()),o!==void 0&&l.append("metadata",JSON.stringify(o));for await(let c of this._getPaginated("/sessions",l))yield*c}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,X(r);let s=await this.caller.call(M(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(s,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:a,dataType:i,name:o}){let l=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),r.forEach(p=>{c.append("input_keys",p)}),s.forEach(p=>{c.append("output_keys",p)}),a&&c.append("description",a),i&&c.append("data_type",i),o&&c.append("name",o);let u=await this.caller.call(M(),l,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(u,"upload CSV"),await u.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:s,outputsSchema:a,metadata:i}={}){let o={name:e,description:t,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),a&&(o.outputs_schema_definition=a);let l=await this.caller.call(M(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(l,"create dataset"),await l.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets",s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)X(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");let a=await this._get(r,s),i;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=a[0]}else i=a;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:s}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);let i=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){let r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:s,datasetNameContains:a,metadata:i}={}){let o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(let c of r)l.append("id",c);s!==void 0&&l.append("name",s),a!==void 0&&l.append("name_contains",a),i!==void 0&&l.append("metadata",JSON.stringify(i));for await(let c of this._getPaginated(o,l))yield*c}async updateDataset(e){let{datasetId:t,datasetName:r,...s}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");let a=t??(await this.readDataset({datasetName:r})).id;X(a);let i=await this.caller.call(M(),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(i,"update dataset"),await i.json()}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)X(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");let a=await this.caller.call(M(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),X(s);let a={tag:r},i=await this.caller.call(M(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(i,"index dataset"),await i.json()}async similarExamples(e,t,r,{filter:s}={}){let a={limit:r,inputs:e};s!==void 0&&(a.filter=s),X(t);let i=await this.caller.call(M(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,t,{datasetId:r,datasetName:s,createdAt:a,exampleId:i,metadata:o,split:l,sourceRunId:c}){let u=r;if(u===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:s})).id);let p={dataset_id:u,inputs:e,outputs:t,created_at:(a||new Date)?.toISOString(),id:i,metadata:o,split:l,source_run_id:c},f=await this.caller.call(M(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(p),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(f,"create example"),await f.json()}async createExamples(e){let{inputs:t,outputs:r,metadata:s,sourceRunIds:a,exampleIds:i,datasetId:o,datasetName:l}=e,c=o;if(c===void 0&&l===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&l!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:l})).id);let u=t.map((f,h)=>({dataset_id:c,inputs:f,outputs:r?r[h]:void 0,metadata:s?s[h]:void 0,split:e.splits?e.splits[h]:void 0,id:i?i[h]:void 0,source_run_id:a?a[h]:void 0})),d=await this.caller.call(M(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(d,"create examples"),await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let s=e.map(i=>lp(i)?cp(i):i),a=lp(t)?cp(t):t;return this.createExample({input:s},{output:a},r)}async readExample(e){X(e);let t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:s,splits:a,inlineS3Urls:i,metadata:o,limit:l,offset:c,filter:u}={}){let d;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(t!==void 0)d=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");let p=new URLSearchParams({dataset:d}),f=s?typeof s=="string"?s:s?.toISOString():void 0;f&&p.append("as_of",f);let h=i??!0;if(p.append("inline_s3_urls",h.toString()),r!==void 0)for(let g of r)p.append("id",g);if(a!==void 0)for(let g of a)p.append("splits",g);if(o!==void 0){let g=JSON.stringify(o);p.append("metadata",g)}l!==void 0&&p.append("limit",l.toString()),c!==void 0&&p.append("offset",c.toString()),u!==void 0&&p.append("filter",u);let m=0;for await(let g of this._getPaginated("/examples",p)){for(let w of g)yield w,m++;if(l!==void 0&&m>=l)break}}async deleteExample(e){X(e);let t=`/examples/${e}`,r=await this.caller.call(M(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(r,`delete ${t}`),await r.json()}async updateExample(e,t){X(e);let r=await this.caller.call(M(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(r,"update example"),await r.json()}async updateExamples(e){let t=await this.caller.call(M(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(t,"update examples"),await t.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,X(s);let a=new URLSearchParams,i=r?typeof r=="string"?r:r?.toISOString():void 0;return i&&a.append("as_of",i),await this._get(`/datasets/${s}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:s,remove:a=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,X(i);let o={split_name:r,examples:s.map(c=>(X(c),c)),remove:a},l=await this.caller.call(M(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(l,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s,referenceExample:a}={loadChildRuns:!1}){ac("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(a=await this.readExample(i.reference_example_id));let o=await t.evaluateRun(i,a),[l,c]=await this._logEvaluationFeedback(o,i,r);return c[0]}async createFeedback(e,t,{score:r,value:s,correction:a,comment:i,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:c,feedbackId:u,feedbackConfig:d,projectId:p,comparativeExperimentId:f}){if(!e&&!p)throw new Error("One of runId or projectId must be provided");if(e&&p)throw new Error("Only one of runId or projectId can be provided");let h={type:l??"api",metadata:o??{}};c!==void 0&&h?.metadata!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:c}),h?.metadata!==void 0&&h.metadata.__run?.run_id!==void 0&&X(h.metadata.__run.run_id);let m={id:u??ds(),run_id:e,key:t,score:r,value:s,correction:a,comment:i,feedback_source:h,comparative_experiment_id:f,feedbackConfig:d,session_id:p},g=`${this.apiUrl}/feedback`,w=await this.caller.call(M(),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(w,"create feedback",!0),m}async updateFeedback(e,{score:t,value:r,correction:s,comment:a}){let i={};t!=null&&(i.score=t),r!=null&&(i.value=r),s!=null&&(i.correction=s),a!=null&&(i.comment=a),X(e);let o=await this.caller.call(M(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(o,"update feedback",!0)}async readFeedback(e){X(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){X(e);let t=`/feedback/${e}`,r=await this.caller.call(M(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(let a of t)s.append("key",a);if(r)for(let a of r)s.append("source",a);for await(let a of this._getPaginated("/feedback",s))yield*a}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:s}={}){let a={run_id:e,feedback_key:t,feedback_config:s};return r?typeof r=="string"?a.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call(M(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:s,description:a,metadata:i,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");let l={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:a,created_at:(s??new Date)?.toISOString(),extra:{}};return i&&(l.extra.metadata=i),await(await this.caller.call(M(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){X(e);let t=new URLSearchParams({run_id:e});for await(let r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,r){let s=this._selectEvalResults(e),a=[];for(let i of s){let o=r||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let l=null;i.targetRunId?l=i.targetRunId:t&&(l=t.id),a.push(await this.createFeedback(l,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[s,a]}async logEvaluationFeedback(e,t,r){let[s]=await this._logEvaluationFeedback(e,t,r);return s}async*listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:s,limit:a}=e,i=new URLSearchParams;t&&t.forEach((l,c)=>{X(l,`queueIds[${c}]`),i.append("ids",l)}),r&&i.append("name",r),s&&i.append("name_contains",s),i.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(let l of this._getPaginated("/annotation-queues",i))if(yield*l,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:s}=e,a={name:t,description:r,id:s||ds()},i=await this.caller.call(M(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(a).filter(([l,c])=>c!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){let t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){let{name:r,description:s}=t,a=await this.caller.call(M(),`${this.apiUrl}/annotation-queues/${X(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(a,"update annotation queue")}async deleteAnnotationQueue(e){let t=await this.caller.call(M(),`${this.apiUrl}/annotation-queues/${X(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){let r=await this.caller.call(M(),`${this.apiUrl}/annotation-queues/${X(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,a)=>X(s,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${X(e,"queueId")}/run`,s=await this.caller.call(M(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(s,"get run from annotation queue"),await s.json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call(M(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){let s=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw a.statusCode=t.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,s,a]=Dr(e),i=await this.caller.call(M(),`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(i,`${t?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){let[t,r,s]=Dr(e);if(await this._currentTenantIsOwner(t)){let a=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(let r of this._getPaginated("/repos",t,s=>s.repos))yield*r}async getPrompt(e){let[t,r,s]=Dr(e),a=await this.caller.call(M(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await K(a,"get prompt");let i=await a.json();return i.repo?i.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[s,a,i]=Dr(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);let o={repo_handle:a,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},l=await this.caller.call(M(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(l,"create prompt");let{repo:c}=await l.json();return c}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[s,a,i]=Dr(e),o=r?.parentCommitHash==="latest"||!r?.parentCommitHash?await this._getLatestCommitHash(`${s}/${a}`):r?.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=await this.caller.call(M(),`${this.apiUrl}/commits/${s}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(c,"create commit");let u=await c.json();return this._getPromptUrl(`${s}/${a}${u.commit_hash?`:${u.commit_hash}`:""}`)}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[r,s]=Dr(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let a={};if(t?.description!==void 0&&(a.description=t.description),t?.readme!==void 0&&(a.readme=t.readme),t?.tags!==void 0&&(a.tags=t.tags),t?.isPublic!==void 0&&(a.is_public=t.isPublic),t?.isArchived!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");let i=await this.caller.call(M(),`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await K(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[t,r,s]=Dr(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(M(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){let[r,s,a]=Dr(e),i=await this._getServerInfo(),o=Xb(i.version,"0.5.23"),l=a;if(!o&&a==="latest"){let d=await this._getLatestCommitHash(`${r}/${s}`);if(d)l=d;else throw new Error("No commits found")}let c=await this.caller.call(M(),`${this.apiUrl}/commits/${r}/${s}/${l}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await K(c,"pull prompt commit");let u=await c.json();return{owner:r,repo:s,commit_hash:u.commit_hash,manifest:u.manifest,examples:u.examples}}async _pullPrompt(e,t){let r=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:s}=t,[a,i]=this.parseTokenOrUrl(e,r),o=new n({apiUrl:a,apiKey:"placeholder"}),l=await o.readSharedDataset(i),c=s||l.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}let u=await o.listSharedExamples(i),d=await this.createDataset(c,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(p=>p.inputs),outputs:u.flatMap(p=>p.outputs?[p.outputs]:[]),datasetId:d.id})}catch(p){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),p}}parseTokenOrUrl(e,t,r=2,s="dataset"){try{return X(e),[t,e]}catch{}try{let i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=r){let o=i[i.length-r];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return Promise.all(this.autoBatchQueue.items.map(({itemPromise:e})=>e))}}});var wc,_c=y(()=>{Mp();Ac();nc();wc="0.1.68"});function vc(){if(jp===void 0){let n=xO(),e=EO();jp={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:wc,...e}}return jp}function sw(){let n=AO()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[r,s]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof s=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function AO(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function pn(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}function Ur(n){return pn(`LANGSMITH_${n}`)||pn(`LANGCHAIN_${n}`)}function EO(){if(Lp!==void 0)return Lp;let n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of n){let r=pn(t);r!==void 0&&(e[t]=r)}return Lp=e,e}var Br,bO,wO,_O,aw,vO,xO,jp,Lp,xc=y(()=>{_c();bO=()=>typeof window<"u"&&typeof window.document<"u",wO=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",_O=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),aw=()=>typeof Deno<"u",vO=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!aw(),xO=()=>Br||(bO()?Br="browser":vO()?Br="node":wO()?Br="webworker":_O()?Br="jsdom":aw()?Br="deno":Br="other",Br)});var iw,ow=y(()=>{xc();iw=n=>n!==void 0?n:!!["TRACING_V2","TRACING"].find(t=>Ur(t)==="true")});var Ec,lw=y(()=>{Ec=Symbol.for("lc:context_variables")});function IO(n){return n.replace(/[-:.]/g,"")}function OO(n,e,t=1){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return IO(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Fp(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function uw(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function cw(n){return Array.isArray(n)&&n.some(e=>uw(e))}function TO(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function CO(n){return n!==void 0&&typeof n.callbacks=="object"&&(cw(n.callbacks?.handlers)||cw(n.callbacks))}var Ic,dn,Ac=y(()=>{Zl();xc();Mp();ow();up();lw();Ic=class n{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){let t=e.split(","),r={},s=[];for(let a of t){let[i,o]=a.split("="),l=decodeURIComponent(o);i==="langsmith-metadata"?r=JSON.parse(l):i==="langsmith-tags"&&(s=l.split(","))}return new n(r,s)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}},dn=class n{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Fp(e)){Object.assign(this,{...e});return}let t=n.getDefaultConfig(),{metadata:r,...s}=e,a=s.client??n.getSharedClient(),i={...r,...s?.extra?.metadata};if(s.extra={...s.extra,metadata:i},Object.assign(this,{...t,...s,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let o=OO(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+o:this.dotted_order=o}}static getDefaultConfig(){return{id:ds(),run_type:"chain",project_name:pn("LANGCHAIN_PROJECT")??pn("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:pn("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:pn("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return n.sharedClient||(n.sharedClient=new hs),n.sharedClient}createChild(e){let t=this.child_execution_order+1,r=new n({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});Ec in this&&(r[Ec]=this[Ec]);let s=Symbol.for("lc:child_config"),a=e.extra?.[s]??this.extra[s];if(CO(a)){let l={...a},c=TO(l.callbacks)?l.callbacks.copy?.():void 0;c&&(Object.assign(c,{_parentRunId:r.id}),c.handlers?.find(uw)?.updateFromRunTree?.(r),l.callbacks=c),r.extra[s]=l}let i=new Set,o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,r=!0){let s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(let[l,c]of Object.entries(t))s.runtime[l]||(s.runtime[l]=c);let a,i;return r?(i=e.parent_run?.id,a=[]):(a=e.child_runs.map(l=>this._convertToCreate(l,t,r)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){try{let t=vc(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){ac("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){try{let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){let r=e?.callbacks,s,a,i,o=iw();if(r){let c=r?.getParentRunId?.()??"",u=r?.handlers?.find(d=>d?.name=="langchain_tracer");s=u?.getRun?.(c),a=u?.projectName,i=u?.client,o=o||!!u}return s?new n({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:i,tracingEnabled:o,project_name:a,tags:[...new Set((s?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...s?.extra?.metadata,...e?.metadata}}}).createChild(t):new n({...t,client:i,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;let a=s.trim(),i=a.split(".").map(c=>{let[u,d]=c.split("Z");return{strTime:u,time:Date.parse(u+"Z"),uuid:d}}),o=i[0].uuid,l={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:i.at(-1)?.uuid,trace_id:o,dotted_order:a};if(r.baggage&&typeof r.baggage=="string"){let c=Ic.fromHeader(r.baggage);l.metadata=c.metadata,l.tags=c.tags}return new n(l)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new Ic(this.extra?.metadata,this.tags).toHeader()};if(e)for(let[r,s]of Object.entries(t))e.set(r,s);return t}};Object.defineProperty(dn,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null})});function Oc(n){return typeof n=="function"&&"langsmith:traceable"in n}var Up,Dp,PO,Bp,SO,dw,Vj,pw=y(()=>{Ac();Up=class{getStore(){}run(e,t){return t()}},Dp=Symbol.for("ls:tracing_async_local_storage"),PO=new Up,Bp=class{getInstance(){return globalThis[Dp]??PO}initializeGlobalInstance(e){globalThis[Dp]===void 0&&(globalThis[Dp]=e)}},SO=new Bp,dw=()=>{let n=SO.getInstance().getStore();if(!Fp(n))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return n},Vj=Symbol.for("langsmith:traceable:root")});var zp=y(()=>{pw()});function Cc(n,e){return RO.call(n,e)}function Pc(n){if(Array.isArray(n)){let t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)Cc(n,t)&&e.push(t);return e}function Ze(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function Sc(n){let e=0,t=n.length,r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function lr(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function yo(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function Tc(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Tc(n[t]))return!0}else if(typeof n=="object"){let t=Pc(n),r=t.length;for(var e=0;e<r;e++)if(Tc(n[t[e]]))return!0}}return!1}function fw(n,e){let t=[n];for(let r in e){let s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&t.push(`${r}: ${s}`)}return t.join(`
`)}var RO,ms,bo=y(()=>{RO=Object.prototype.hasOwnProperty;ms=class extends Error{constructor(e,t,r,s,a){super(fw(e,{name:t,index:r,operation:s,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=fw(e,{name:t,index:r,operation:s,tree:a})}}});var qp={};Yi(qp,{JsonPatchError:()=>me,_areEquals:()=>wo,applyOperation:()=>gs,applyPatch:()=>fn,applyReducer:()=>$O,deepClone:()=>kO,getValueByPointer:()=>Rc,validate:()=>hw,validator:()=>kc});function Rc(n,e){if(e=="")return n;var t={op:"_get",path:e};return gs(n,t),t.value}function gs(n,e,t=!1,r=!0,s=!0,a=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):kc(e,0)),e.path===""){let i={newDocument:n};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=n,i;if(e.op==="move"||e.op==="copy")return i.newDocument=Rc(n,e.from),e.op==="move"&&(i.removed=n),i;if(e.op==="test"){if(i.test=wo(n,e.value),i.test===!1)throw new me("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return i.newDocument=n,i}else{if(e.op==="remove")return i.removed=n,i.newDocument=null,i;if(e.op==="_get")return e.value=n,i;if(t)throw new me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,n);return i}}else{r||(n=Ze(n));let o=(e.path||"").split("/"),l=n,c=1,u=o.length,d,p,f;for(typeof t=="function"?f=t:f=kc;;){if(p=o[c],p&&p.indexOf("~")!=-1&&(p=yo(p)),s&&(p=="__proto__"||p=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(l[p]===void 0?d=o.slice(0,c).join("/"):c==u-1&&(d=e.path),d!==void 0&&f(e,0,n,d)),c++,Array.isArray(l)){if(p==="-")p=l.length;else{if(t&&!Sc(p))throw new me("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,n);Sc(p)&&(p=~~p)}if(c>=u){if(t&&e.op==="add"&&p>l.length)throw new me("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,n);let h=NO[e.op].call(e,l,p,n);if(h.test===!1)throw new me("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return h}}else if(c>=u){let h=Ia[e.op].call(e,l,p,n);if(h.test===!1)throw new me("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return h}if(l=l[p],t&&c<u&&(!l||typeof l!="object"))throw new me("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,n)}}}function fn(n,e,t,r=!0,s=!0){if(t&&!Array.isArray(e))throw new me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=Ze(n));let a=new Array(e.length);for(let i=0,o=e.length;i<o;i++)a[i]=gs(n,e[i],t,!0,s,i),n=a[i].newDocument;return a.newDocument=n,a}function $O(n,e,t){let r=gs(n,e);if(r.test===!1)throw new me("Test operation failed","TEST_OPERATION_FAILED",t,e,n);return r.newDocument}function kc(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new me("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Ia[n.op]){if(typeof n.path!="string")throw new me("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new me('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new me("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&Tc(n.value))throw new me("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var s=n.path.split("/").length,a=r.split("/").length;if(s!==a+1&&s!==a)throw new me("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new me("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var i={op:"_get",path:n.from,value:void 0},o=hw([i],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new me("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new me("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function hw(n,e,t){try{if(!Array.isArray(n))throw new me("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)fn(Ze(e),Ze(n),t||!0);else{t=t||kc;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(s){if(s instanceof me)return s;throw s}}function wo(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),s,a,i;if(t&&r){if(a=n.length,a!=e.length)return!1;for(s=a;s--!==0;)if(!wo(n[s],e[s]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(a=o.length,a!==Object.keys(e).length)return!1;for(s=a;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=a;s--!==0;)if(i=o[s],!wo(n[i],e[i]))return!1;return!0}return n!==n&&e!==e}var me,kO,Ia,NO,Nc=y(()=>{bo();me=ms,kO=Ze,Ia={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=Rc(t,this.path);r&&(r=Ze(r));let s=gs(t,{op:"remove",path:this.from}).removed;return gs(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:r}},copy:function(n,e,t){let r=Rc(t,this.from);return gs(t,{op:"add",path:this.path,value:Ze(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:wo(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}},NO={add:function(n,e,t){return Sc(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Ia.move,copy:Ia.copy,test:Ia.test,_get:Ia._get}});function mw(n,e,t,r,s){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=Pc(e),i=Pc(n),o=!1,l=!1,c=i.length-1;c>=0;c--){var u=i[c],d=n[u];if(Cc(e,u)&&!(e[u]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var p=e[u];typeof d=="object"&&d!=null&&typeof p=="object"&&p!=null&&Array.isArray(d)===Array.isArray(p)?mw(d,p,t,r+"/"+lr(u),s):d!==p&&(o=!0,s&&t.push({op:"test",path:r+"/"+lr(u),value:Ze(d)}),t.push({op:"replace",path:r+"/"+lr(u),value:Ze(p)}))}else Array.isArray(n)===Array.isArray(e)?(s&&t.push({op:"test",path:r+"/"+lr(u),value:Ze(d)}),t.push({op:"remove",path:r+"/"+lr(u)}),l=!0):(s&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}),o=!0)}if(!(!l&&a.length==i.length))for(var c=0;c<a.length;c++){var u=a[c];!Cc(n,u)&&e[u]!==void 0&&t.push({op:"add",path:r+"/"+lr(u),value:Ze(e[u])})}}}function $c(n,e,t=!1){var r=[];return mw(n,e,r,"",t),r}var gw=y(()=>{bo();Nc();});var tL,Hp=y(()=>{Nc();gw();bo();Nc();bo();tL={...qp,JsonPatchError:ms,deepClone:Ze,escapePathComponent:lr,unescapePathComponent:yo}});async function bw(){return Vp===void 0&&(Vp={library:"langchain-js",runtime:DO()}),Vp}function ne(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}var MO,jO,LO,yw,FO,DO,Vp,Oa=y(()=>{MO=()=>typeof window<"u"&&typeof window.document<"u",jO=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",LO=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),yw=()=>typeof Deno<"u",FO=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!yw(),DO=()=>{let n;return MO()?n="browser":FO()?n="node":jO()?n="webworker":LO()?n="jsdom":yw()?n="deno":n="other",n}});var Gp,ys,Kp=y(()=>{io();ya();Oa();Gp=class{},ys=class n extends Gp{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Kd(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:ne("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return vt.prototype.toJSON.call(this)}toJSONNotImplemented(){return vt.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends n{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ft()}),Object.assign(this,e)}}return new t}}});function Wp(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function UO(n){return n.replace(/[-:.]/g,"")}function BO(n,e,t){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return UO(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Ta(n){return typeof n._addRunToRunMap=="function"}var Lt,bs=y(()=>{Kp();Lt=class extends ys{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let t=BO(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){let s=this.runMap.get(r.parent_run_id);s&&(this._addChildRun(s,r),s.child_execution_order=Math.max(s.child_execution_order,r.child_execution_order),r.trace_id=s.trace_id,s.dotted_order!==void 0&&(r.dotted_order=[s.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){let t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,s,a,i,o,l){let c=this._getExecutionOrder(s),u=Date.now(),d=o?{...a,metadata:o}:a,p={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(p)}async handleLLMStart(e,t,r,s,a,i,o,l){let c=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,s,a,i,o,l);return await this.onRunCreate?.(c),await this.onLLMStart?.(c),c}_createRunForChatModelStart(e,t,r,s,a,i,o,l){let c=this._getExecutionOrder(s),u=Date.now(),d=o?{...a,metadata:o}:a,p={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(p)}async handleChatModelStart(e,t,r,s,a,i,o,l){let c=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,s,a,i,o,l);return await this.onRunCreate?.(c),await this.onLLMStart?.(c),c}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onLLMEnd?.(r),await this._endTrace(r),r}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onLLMError?.(r),await this._endTrace(r),r}_createRunForChainStart(e,t,r,s,a,i,o,l){let c=this._getExecutionOrder(s),u=Date.now(),d={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,r,s,a,i,o,l){let c=this.runMap.get(r)??this._createRunForChainStart(e,t,r,s,a,i,o,l);return await this.onRunCreate?.(c),await this.onChainStart?.(c),c}async handleChainEnd(e,t,r,s,a){let i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=Wp(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),a?.inputs!==void 0&&(i.inputs=Wp(a.inputs,"input")),await this.onChainEnd?.(i),await this._endTrace(i),i}async handleChainError(e,t,r,s,a){let i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),a?.inputs!==void 0&&(i.inputs=Wp(a.inputs,"input")),await this.onChainError?.(i),await this._endTrace(i),i}_createRunForToolStart(e,t,r,s,a,i,o){let l=this._getExecutionOrder(s),c=Date.now(),u={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(u)}async handleToolStart(e,t,r,s,a,i,o){let l=this.runMap.get(r)??this._createRunForToolStart(e,t,r,s,a,i,o);return await this.onRunCreate?.(l),await this.onToolStart?.(l),l}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="chain")return;let s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r)}async handleAgentEnd(e,t){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,s,a,i,o){let l=this._getExecutionOrder(s),c=Date.now(),u={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:a||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,t,r,s,a,i,o){let l=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,s,a,i,o);return await this.onRunCreate?.(l),await this.onRetrieverStart?.(l),l}async handleRetrieverEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,s,a,i){let o=this.runMap.get(r);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await this.onLLMNewToken?.(o,e,{chunk:i?.chunk}),o}}});var Jp=y(()=>{_c()});var xw=k((hL,vw)=>{"use strict";var ww=(n=0)=>e=>`\x1B[${38+n};5;${e}m`,_w=(n=0)=>(e,t,r)=>`\x1B[${38+n};2;${e};${t};${r}m`;function zO(){let n=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,r]of Object.entries(e)){for(let[s,a]of Object.entries(r))e[s]={open:`\x1B[${a[0]}m`,close:`\x1B[${a[1]}m`},r[s]=e[s],n.set(a[0],a[1]);Object.defineProperty(e,t,{value:r,enumerable:!1})}return Object.defineProperty(e,"codes",{value:n,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=ww(),e.color.ansi16m=_w(),e.bgColor.ansi256=ww(10),e.bgColor.ansi16m=_w(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,r,s)=>t===r&&r===s?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(s/255*5),enumerable:!1},hexToRgb:{value:t=>{let r=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!r)return[0,0,0];let{colorString:s}=r.groups;s.length===3&&(s=s.split("").map(i=>i+i).join(""));let a=Number.parseInt(s,16);return[a>>16&255,a>>8&255,a&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(vw,"exports",{enumerable:!0,get:zO})});function st(n,e){return`${n.open}${e}${n.close}`}function Ft(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function Aw(n){return typeof n=="string"?n.trim():n==null?n:Ft(n,n.toString())}function hn(n){if(!n.end_time)return"";let e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var Yp,mt,_o,Ew=y(()=>{Yp=Ct(xw(),1);bs();({color:mt}=Yp.default),_o=class extends Lt{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let s=this.runMap.get(r.parent_run_id);if(s)t.push(s),r=s;else break}return t}getBreadcrumbs(e){let r=[...this.getParents(e).reverse(),e].map((s,a,i)=>{let o=`${s.execution_order}:${s.run_type}:${s.name}`;return a===i.length-1?st(Yp.default.bold,o):o}).join(" > ");return st(mt.grey,r)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Ft(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.cyan,"[chain/end]")} [${t}] [${hn(e)}] Exiting Chain run with output: ${Ft(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.red,"[chain/error]")} [${t}] [${hn(e)}] Chain run errored with error: ${Ft(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${st(mt.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Ft(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.cyan,"[llm/end]")} [${t}] [${hn(e)}] Exiting LLM run with output: ${Ft(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.red,"[llm/error]")} [${t}] [${hn(e)}] LLM run errored with error: ${Ft(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Aw(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.cyan,"[tool/end]")} [${t}] [${hn(e)}] Exiting Tool run with output: "${Aw(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.red,"[tool/error]")} [${t}] [${hn(e)}] Tool run errored with error: ${Ft(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Ft(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.cyan,"[retriever/end]")} [${t}] [${hn(e)}] Exiting Retriever run with output: ${Ft(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${st(mt.red,"[retriever/error]")} [${t}] [${hn(e)}] Retriever run errored with error: ${Ft(e.error,"[error]")}`)}onAgentAction(e){let t=e,r=this.getBreadcrumbs(e);console.log(`${st(mt.blue,"[agent/action]")} [${r}] Agent selected action: ${Ft(t.actions[t.actions.length-1],"[action]")}`)}}});var Iw=y(()=>{Ac()});var Ca,Ow=y(()=>{Jp();Iw();zp();Oa();bs();Ca=class n extends Lt{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:s}=e;this.projectName=r??ne("LANGCHAIN_PROJECT")??ne("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??new hs({});let a=n.getTraceableRunTree();a&&this.updateFromRunTree(a)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await bw()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e,r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();let s=[t];for(;s.length>0;){let a=s.shift();!a||r.has(a.id)||(r.add(a.id),this.runMap.set(a.id,a),a.child_runs&&s.push(...a.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){let t={},r=[];for(let[s,a]of this.runMap){let i=new dn({...a,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=i,r.push([s,a.dotted_order])}r.sort((s,a)=>!s[1]||!a[1]?0:s[1].localeCompare(a[1]));for(let[s]of r){let a=this.runMap.get(s),i=t[s];if(!(!a||!i)&&a.parent_run_id){let o=t[a.parent_run_id];o&&(o.child_runs.push(i),i.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return dw()}catch{return}}}});function qO(){let n="default"in Mc.default?Mc.default.default:Mc.default;return new n({autoStart:!0,concurrency:1})}async function _e(n,e){e===!0?await n():(typeof Zp>"u"&&(Zp=qO()),Zp.add(n))}var Mc,Zp,Tw=y(()=>{Mc=Ct(rc(),1)});var Xp,Cw=y(()=>{Oa();Xp=n=>n!==void 0?n:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>ne(t)==="true")});function Pw(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}function vo(n){return"name"in n?n:ys.fromMethods(n)}var Qp,Pa,ef,jc,tf,rf,ze,Sa=y(()=>{io();Kp();Ew();un();Oa();Ow();Tw();Cw();bs();Xp()&&ne("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join(`
`);Qp=class{setHandler(e){return this.setHandlers([e])}},Pa=class{constructor(e,t,r,s,a,i,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>_e(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,s,a){await Promise.all(this.handlers.map(i=>_e(async()=>{try{await i.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}},ef=class extends Pa{getChild(e){let t=new ze(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>_e(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw r}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>_e(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}},jc=class extends Pa{async handleLLMNewToken(e,t,r,s,a,i){await Promise.all(this.handlers.map(o=>_e(async()=>{if(!o.ignoreLLM)try{await o.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i)}catch(l){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${l}`),o.raiseError)throw l}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>_e(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>_e(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},tf=class extends Pa{getChild(e){let t=new ze(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,s,a){await Promise.all(this.handlers.map(i=>_e(async()=>{if(!i.ignoreChain)try{await i.handleChainError?.(e,this.runId,this._parentRunId,this.tags,a)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleChainEnd(e,t,r,s,a){await Promise.all(this.handlers.map(i=>_e(async()=>{if(!i.ignoreChain)try{await i.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,a)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>_e(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>_e(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},rf=class extends Pa{getChild(e){let t=new ze(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>_e(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>_e(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},ze=class n extends Qp{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(c,u)=>{let d=u===0&&r?r:ft();return await Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return Ta(p)&&p._createRunForLLMStart(e,[c],d,this._parentRunId,a,this.tags,this.metadata,l),_e(async()=>{try{await p.handleLLMStart?.(e,[c],d,this._parentRunId,a,this.tags,this.metadata,l)}catch(f){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${f}`),p.raiseError)throw f}},p.awaitHandlers)})),new jc(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,s=void 0,a=void 0,i=void 0,o=void 0,l=void 0){return Promise.all(t.map(async(c,u)=>{let d=u===0&&r?r:ft();return await Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return Ta(p)&&p._createRunForChatModelStart(e,[c],d,this._parentRunId,a,this.tags,this.metadata,l),_e(async()=>{try{if(p.handleChatModelStart)await p.handleChatModelStart?.(e,[c],d,this._parentRunId,a,this.tags,this.metadata,l);else if(p.handleLLMStart){let f=so(c);await p.handleLLMStart?.(e,[f],d,this._parentRunId,a,this.tags,this.metadata,l)}}catch(f){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${f}`),p.raiseError)throw f}},p.awaitHandlers)})),new jc(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=ft(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return Ta(l)&&l._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,s,o),_e(async()=>{try{await l.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s,o)}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new tf(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=ft(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return Ta(l)&&l._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),_e(async()=>{try{await l.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new rf(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=ft(),s=void 0,a=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return Ta(l)&&l._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),_e(async()=>{try{await l.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new ef(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,s,a){await Promise.all(this.handlers.map(i=>_e(async()=>{if(!i.ignoreCustomEvent)try{await i.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new n(this._parentRunId);for(let s of this.handlers){let a=this.inheritableHandlers.includes(s);r.addHandler(s,a)}for(let s of this.tags){let a=this.inheritableTags.includes(s);r.addTags([s],a)}for(let s of Object.keys(this.metadata)){let a=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},a)}for(let s of e)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===s.name)||r.addHandler(s,t);return r}static fromHandlers(e){class t extends ys{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:ft()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static async configure(e,t,r,s,a,i,o){return this._configureSync(e,t,r,s,a,i,o)}static _configureSync(e,t,r,s,a,i,o){let l;(e||t)&&(Array.isArray(e)||!e?(l=new n,l.setHandlers(e?.map(vo)??[],!0)):l=e,l=l.copy(Array.isArray(t)?t.map(vo):t?.handlers,!1));let c=ne("LANGCHAIN_VERBOSE")==="true"||o?.verbose,u=Ca.getTraceableRunTree()?.tracingEnabled||Xp(),d=u||(ne("LANGCHAIN_TRACING")??!1);if(c||d){if(l||(l=new n),c&&!l.handlers.some(p=>p.name===_o.prototype.name)){let p=new _o;l.addHandler(p,!0)}if(d&&!l.handlers.some(p=>p.name==="langchain_tracer")&&u){let p=new Ca;l.addHandler(p,!0),l._parentRunId=Ca.getTraceableRunTree()?.id??l._parentRunId}}return(r||s)&&l&&(l.addTags(r??[]),l.addTags(s??[],!1)),(a||i)&&l&&(l.addMetadata(a??{}),l.addMetadata(i??{},!1)),l}}});var sf,HO,nf,Sw,af,Dt,Ra=y(()=>{Jp();Sa();sf=class{getStore(){}run(e,t){return t()}},HO=new sf,nf=Symbol.for("ls:tracing_async_local_storage"),Sw=Symbol.for("lc:child_config"),af=class{getInstance(){return globalThis[nf]??HO}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[Sw]}runWithConfig(e,t,r){let s=ze._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),a=this.getInstance(),i=s?.getParentRunId(),o=s?.handlers?.find(c=>c?.name==="langchain_tracer"),l;return o&&i?l=o.convertToRunTree(i):r||(l=new dn({name:"<runnable_lambda>",tracingEnabled:!1})),l&&(l.extra={...l.extra,[Sw]:e}),a.run(l,t)}initializeGlobalInstance(e){globalThis[nf]===void 0&&(globalThis[nf]=e)}},Dt=new af});async function cr(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!e?.aborted)throw r}),new Promise((r,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}var of=y(()=>{});function lf(n,e=2){let t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){let a=await n.next();for(let i of t)i.push(a)}else{if(s[0].done)return;yield s.shift().value}})}function Xe(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){let t={...n};for(let[r,s]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=Xe(t[r],s):t[r]=s;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}async function Rw(n,e,t,r,...s){let a=new zr({generator:e,startSetup:t,signal:r}),i=await a.setup;return{output:n(a,i,...s),setup:i}}var ke,zr,ur=y(()=>{Ra();of();ke=class n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new n({start(r){return s();function s(){return t.read().then(({done:a,value:i})=>{if(a){r.close();return}return r.enqueue(i),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new n({async pull(t){let{value:r,done:s}=await e.next();s&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}};zr=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{Dt.runWithConfig(e.config,async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(s=>t(void 0),r)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?Dt.runWithConfig(this.config,this.signal?async()=>cr(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}});async function kw(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input}async function Nw(n,e){let{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t}function VO(n){return n!==void 0&&n.message!==void 0}var Wt,xo,Eo,Ao,Lc=y(()=>{Hp();bs();ur();os();Wt=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=fn({},t);return new xo({ops:t,state:r[r.length-1].newDocument})}},xo=class n extends Wt{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=fn(this.state,e.ops);return new n({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=fn({},e.ops);return new n({ops:e.ops,state:t[t.length-1].newDocument})}},Eo=n=>n.name==="log_stream_tracer";Ao=class extends Lt{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ke.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(s=>!this.excludeTags?.includes(s))),r}async*tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let s=this.keyMapByRunId[e];s&&await this.writer.write(new Wt({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Wt({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await kw(e,this._schemaFormat)),await this.writer.write(new Wt({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await kw(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await Nw(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let s=new Wt({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){let t=new Wt({ops:[{op:"replace",path:"/final_output",value:await Nw(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let s=this.keyMapByRunId[e.id];if(s===void 0)return;let a=e.inputs.messages!==void 0,i;a?VO(r?.chunk)?i=r?.chunk:i=new he({id:`run-${e.id}`,content:t}):i=t;let o=new Wt({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:i}]});await this.writer.write(o)}}});var Fc,Jt,Ne,ka=y(()=>{Fc="__run",Jt=class n{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},Ne=class n extends Jt{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}});function Dc({name:n,serialized:e}){return n!==void 0?n:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var Io,Uc,Bc=y(()=>{bs();ur();os();ka();Io=n=>n.name==="event_stream_tracer",Uc=class extends Lt{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ke.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(s=>this.includeTags?.includes(s))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(s=>!this.excludeTags?.includes(s))),r}async*tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}function a(o,l){return o==="llm"&&typeof l=="string"?new Jt({text:l}):l}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(l=>{o=l}),this.tappedPromises.set(e,i);try{let l={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...l,data:{chunk:a(s.runType,r.value)}},s),yield r.value;for await(let c of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...l,data:{chunk:a(s.runType,c)}},s),yield c}finally{o()}}else{yield r.value;for await(let o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=Dc(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);let a=`on_${r}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onLLMNewToken(e,t,r){let s=this.runInfoMap.get(e.id),a,i;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")i="on_chat_model_stream",r?.chunk===void 0?a=new he({content:t,id:`run-${e.id}`}):a=r.chunk.message;else if(s.runType==="llm")i="on_llm_stream",r?.chunk===void 0?a=new Jt({text:t}):a=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:i,data:{chunk:a},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let s=e.outputs?.generations,a;if(t.runType==="chat_model"){for(let i of s??[]){if(a!==void 0)break;a=i[0]?.message}r="on_chat_model_end"}else if(t.runType==="llm")a={generations:s?.map(i=>i.map(o=>({text:o.text,generationInfo:o.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){let t=Dc(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},s.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,s.inputs=e.inputs.input):(a.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},i={output:e.outputs?.output??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(i.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:r,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=Dc(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=Dc(e),s={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},s)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let s=this.runInfoMap.get(r);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}});async function gt(n){return ze._configureSync(n?.callbacks,void 0,n?.tags,void 0,n?.metadata)}function qc(...n){let e={};for(let t of n.filter(r=>!!r))for(let r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){let s=e[r]??[];e[r]=[...new Set(s.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){let s=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!s)e.callbacks=a;else if(Array.isArray(s))e.callbacks=s.concat(a);else{let i=s.copy();for(let o of a)i.addHandler(vo(o),!0);e.callbacks=i}else if(a)if(!s)e.callbacks=a;else if(Array.isArray(s)){let i=a.copy();for(let o of s)i.addHandler(vo(o),!0);e.callbacks=i}else e.callbacks=new ze(a._parentRunId,{handlers:s.handlers.concat(a.handlers),inheritableHandlers:s.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(a.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(a.inheritableTags))),metadata:{...s.metadata,...a.metadata}})}else{let s=r;e[s]=t[s]??e[s]}return e}function Q(n){let e=Dt.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let{runId:r,runName:s,...a}=e;t=Object.entries(a).reduce((i,[o,l])=>(l!==void 0&&(i[o]=l),i),t)}if(n&&(t=Object.entries(n).reduce((r,[s,a])=>(a!==void 0&&(r[s]=a),r),t)),t?.configurable)for(let r of Object.keys(t.configurable))GO.has(typeof t.configurable[r])&&!t.metadata?.[r]&&(t.metadata||(t.metadata={}),t.metadata[r]=t.configurable[r]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let r=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,r])):t.signal=r,delete t.timeout}return t}function ve(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:s,configurable:a,runId:i}={}){let o=Q(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),a!==void 0&&(o.configurable={...o.configurable,...a}),i!==void 0&&delete o.runId,o}var zc,GO,ws=y(()=>{Sa();Ra();zc=25;GO=new Set(["string","number","boolean"])});var $w,Hc,KO,WO,qr,Oo=y(()=>{$w=Ct(Gl(),1),Hc=Ct(rc(),1),KO=[400,401,402,403,404,405,406,407,409],WO=n=>{if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||n?.code==="ECONNABORTED")throw n;let e=n?.response?.status??n?.status;if(e&&KO.includes(+e))throw n;if(n?.error?.code==="insufficient_quota"){let t=new Error(n?.message);throw t.name="InsufficientQuotaError",t}},qr=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??WO;let t="default"in Hc.default?Hc.default.default:Hc.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,$w.default)(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,a)=>{e.signal?.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}});var To,Mw=y(()=>{bs();To=class extends Lt{constructor({config:e,onStart:t,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}}});function Co(n){return n?n.lc_runnable:!1}var Vc,cf=y(()=>{Vc=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||s.some(a=>this.includeTags?.includes(a))),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&s.every(a=>!this.excludeTags?.includes(a))),r}}});function uf(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}function JO(n,e){let t=e[n.source]??n.source,r=e[n.target]??n.target;return[t,r]}function YO(n){let e="";for(let[t,r]of Object.entries(n))e+=`	classDef ${t}class fill:${r};
`;return e}function jw(n,e,t){let{firstNodeLabel:r,lastNodeLabel:s,nodeColors:a,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=t??{},c=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){let d="default",p={[d]:"{0}([{1}]):::otherclass"};r!==void 0&&(p[r]="{0}[{0}]:::startclass"),s!==void 0&&(p[s]="{0}[{0}]:::endclass");for(let f of Object.values(n)){let h=p[f]??p[d],m=uf(f),g=f.split(":"),w=g[g.length-1];c+=`	${h.replace(/\{0\}/g,m).replace(/\{1\}/g,w)};
`}}let u="";for(let d of e){let p=d.source.includes(":")?d.source.split(":")[0]:void 0,f=d.target.includes(":")?d.target.split(":")[0]:void 0;u!==""&&(u!==p||u!==f)&&(c+=`	end
`,u=""),u===""&&p!==void 0&&p===f&&(c=`	subgraph ${p}
`,u=p);let[h,m]=JO(d,n),g="";if(d.data!==void 0){let w=d.data,b=w.split(" ");b.length>l&&(w=b.reduce((E,O,S)=>(S%l===0&&E.push(""),E[E.length-1]+=` ${O}`,E),[]).join("<br>")),d.conditional?g=` -. ${w} .-> `:g=` -- ${w} --> `}else d.conditional?g=" -.-> ":g=" --> ";c+=`	${uf(h)}${g}${uf(m)};
`}return u!==""&&(c+=`end
`),i&&a!==void 0&&(c+=YO(a)),c}async function Lw(n,e){let{backgroundColor:t="white"}=e??{},r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let s=`https://mermaid.ink/img/${r}?bgColor=${t}`,a=await fetch(s);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}var Fw=y(()=>{});function df(n){if(ao(n.id))if(Co(n.data))try{let e=n.data.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e.length>Dw&&(e=`${e.substring(0,Dw)}...`),e}catch{return n.data.getName()}else return n.data.name??"UnknownSchema";else return n.id}function ZO(n){return Co(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...We(n.data.schema),title:n.data.name}}}var Dw,Po,Uw=y(()=>{$r();io();cf();Fw();Dw=42;Po=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=ao(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...ZO(t)})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let r=t||ft(),s={id:r,data:e};return this.nodes[r]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let a={source:e.id,target:t.id,data:r,conditional:s};return this.edges.push(a),a}firstNode(){let e=new Set(this.edges.map(r=>r.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){let e=new Set(this.edges.map(r=>r.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e,t=""){let r=t;Object.values(e.nodes).map(c=>c.id).every(ao)&&(r="");let a=c=>r?`${r}:${c}`:c;Object.entries(e.nodes).forEach(([c,u])=>{this.nodes[a(c)]={...u,id:a(c)}});let i=e.edges.map(c=>({...c,source:a(c.source),target:a(c.target)}));this.edges=[...this.edges,...i];let o=e.firstNode(),l=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,l?{id:a(l.id),data:l.data}:void 0]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:s={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:a}=e??{},i={};for(let d of Object.values(this.nodes))i[d.id]=df(d);let o=this.firstNode(),l=o?df(o):void 0,c=this.lastNode(),u=c?df(c):void 0;return jw(i,this.edges,{firstNodeLabel:l,lastNodeLabel:u,withStyles:t,curveStyle:r,nodeColors:s,wrapLabelNWords:a})}async drawMermaidPng(e){let t=this.drawMermaid(e);return Lw(t,{backgroundColor:e?.backgroundColor})}}});function Bw(n){let e=new TextEncoder,t=new ReadableStream({async start(r){for await(let s of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return ke.fromReadableStream(t)}var zw=y(()=>{ur()});function pf(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}function Gc(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*ff(n,e){for(;;){let{value:t,done:r}=Dt.runWithConfig(n,e.next.bind(e),!0);if(r)break;yield t}}async function*hf(n,e){let t=e[Symbol.asyncIterator]();for(;;){let{value:r,done:s}=await Dt.runWithConfig(n,t.next.bind(e),!0);if(s)break;yield r}}var qw,Hw=y(()=>{Ra();qw=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function"});function Oe(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}function XO(n){if(Oc(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}function Hr(n){if(typeof n=="function")return new pr({func:n});if(re.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){let e={};for(let[t,r]of Object.entries(n))e[t]=Hr(r);return new mn({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}function QO(n,e){let t=e.name??n.getName(),r=e.description??e.schema?.description;return e.schema.constructor===ut.ZodString?new So({name:t,description:r,schema:ut.object({input:ut.string()}).transform(s=>s.input),bound:n}):new So({name:t,description:r,schema:e.schema,bound:n})}var mf,re,dr,Kc,Wc,xt,mn,gf,pr,Jc,Na,Yc,So,Ut=y(()=>{as();mf=Ct(Gl(),1);io();zp();Lc();Bc();ya();ur();of();ws();Oo();Mw();cf();Ra();Uw();zw();Hw();ql();re=class extends vt{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new dr({bound:this,kwargs:e,config:{}})}map(){return new Kc({bound:this})}withRetry(e){return new Wc({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new dr({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new Jc({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Q);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,a)=>Q(a===0?e:r))}return Array.from({length:t},()=>Q(e))}async batch(e,t,r){let s=this._getOptionsList(t??{},e.length),a=s[0]?.maxConcurrency??r?.maxConcurrency,i=new qr({maxConcurrency:a,onFailedAttempt:l=>{throw l}}),o=e.map((l,c)=>i.call(async()=>{try{return await this.invoke(l,s[c])}catch(u){if(r?.returnExceptions)return u;throw u}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=Q(t),s=new zr({generator:this._streamIterator(e,r),config:r});return await s.setup,ke.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Q(e):t=Q({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let s=Q(r),i=await(await gt(s))?.handleChainStart(this.toJSON(),Oe(t,"input"),s.runId,s?.runType,void 0,void 0,s?.runName??this.getName());delete s.runId;let o;try{let l=e.call(this,t,s,i);o=await cr(l,r?.signal)}catch(l){throw await i?.handleChainError(l),l}return await i?.handleChainEnd(Oe(o,"output")),o}async _batchWithConfig(e,t,r,s){let a=this._getOptionsList(r??{},t.length),i=await Promise.all(a.map(gt)),o=await Promise.all(i.map(async(c,u)=>{let d=await c?.handleChainStart(this.toJSON(),Oe(t[u],"input"),a[u].runId,a[u].runType,void 0,void 0,a[u].runName??this.getName());return delete a[u].runId,d})),l;try{let c=e.call(this,t,a,o,s);l=await cr(c,a?.[0]?.signal)}catch(c){throw await Promise.all(o.map(u=>u?.handleChainError(c))),c}return await Promise.all(o.map(c=>c?.handleChainEnd(Oe(l,"output")))),l}async*_transformStreamWithConfig(e,t,r){let s,a=!0,i,o=!0,l=Q(r),c=await gt(l);async function*u(){for await(let p of e){if(a)if(s===void 0)s=p;else try{s=Xe(s,p)}catch{s=void 0,a=!1}yield p}}let d;try{let p=await Rw(t.bind(this),u(),async()=>c?.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r?.signal,l);delete l.runId,d=p.setup;let f=d?.handlers.find(Io),h=p.output;f!==void 0&&d!==void 0&&(h=f.tapOutputIterable(d.runId,h));let m=d?.handlers.find(Eo);m!==void 0&&d!==void 0&&(h=m.tapOutputIterable(d.runId,h));for await(let g of h)if(yield g,o)if(i===void 0)i=g;else try{i=Xe(i,g)}catch{i=void 0,o=!1}}catch(p){throw await d?.handleChainError(p,void 0,void 0,void 0,{inputs:Oe(s,"input")}),p}await d?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:Oe(s,"input")})}getGraph(e){let t=new Po,r=t.addNode({name:`${this.getName()}Input`,schema:ut.any()}),s=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:ut.any()});return t.addEdge(r,s),t.addEdge(s,a),t}pipe(e){return new xt({first:this,last:Hr(e)})}pick(e){return this.pipe(new Yc(e))}assign(e){return this.pipe(new Na(new mn({steps:e})))}async*transform(e,t){let r;for await(let s of e)r===void 0?r=s:r=Xe(r,s);yield*this._streamIterator(r,Q(t))}async*streamLog(e,t,r){let s=new Ao({...r,autoClose:!1,_schemaFormat:"original"}),a=Q(t);yield*this._streamLog(e,s,a)}async*_streamLog(e,t,r){let{callbacks:s}=r;if(s===void 0)r.callbacks=[t];else if(Array.isArray(s))r.callbacks=s.concat([t]);else{let l=s.copy();l.addHandler(t,!0),r.callbacks=l}let a=this.stream(e,r);async function i(){try{let l=await a;for await(let c of l){let u=new Wt({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(u)}}finally{await t.writer.close()}}let o=i();try{for await(let l of t)yield l}finally{await o}}streamEvents(e,t,r){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,r);else if(t.version==="v2")s=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?Bw(s):ke.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,r){let s=new Uc({...r,autoClose:!1}),a=Q(t),i=a.runId??ft();a.runId=i;let o=a.callbacks;if(o===void 0)a.callbacks=[s];else if(Array.isArray(o))a.callbacks=o.concat(s);else{let f=o.copy();f.addHandler(s,!0),a.callbacks=f}let l=this;async function c(){try{let f=await l.stream(e,a),h=s.tapOutputIterable(i,f);for await(let m of h);}finally{await s.finish()}}let u=c(),d=!1,p;try{for await(let f of s){if(!d){f.data.input=e,d=!0,p=f.run_id,yield f;continue}f.run_id===p&&f.event.endsWith("_end")&&f.data?.input&&delete f.data.input,yield f}}finally{await u}}async*_streamEventsV1(e,t,r){let s,a=!1,i=Q(t),o=i.tags??[],l=i.metadata??{},c=i.runName??this.getName(),u=new Ao({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Vc({...r}),p=this._streamLog(e,u,i);for await(let h of p){if(s?s=s.concat(h):s=xo.fromRunLogPatch(h),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;let b={...s.state},E={run_id:b.id,event:`on_${b.type}_start`,name:c,tags:o,metadata:l,data:{input:e}};d.includeEvent(E,b.type)&&(yield E)}let m=h.ops.filter(b=>b.path.startsWith("/logs/")).map(b=>b.path.split("/")[2]),g=[...new Set(m)];for(let b of g){let E,O={},S=s.state.logs[b];if(S.end_time===void 0?S.streamed_output.length>0?E="stream":E="start":E="end",E==="start")S.inputs!==void 0&&(O.input=S.inputs);else if(E==="end")S.inputs!==void 0&&(O.input=S.inputs),O.output=S.final_output;else if(E==="stream"){let J=S.streamed_output.length;if(J!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${J} instead. Encountered in: "${S.name}"`);O={chunk:S.streamed_output[0]},S.streamed_output=[]}yield{event:`on_${S.type}_${E}`,name:S.name,run_id:S.id,tags:S.tags,metadata:S.metadata,data:O}}let{state:w}=s;if(w.streamed_output.length>0){let b=w.streamed_output.length;if(b!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${b} instead. Encountered in: "${w.name}"`);let E={chunk:w.streamed_output[0]};w.streamed_output=[];let O={event:`on_${w.type}_stream`,run_id:w.id,tags:o,metadata:l,name:c,data:E};d.includeEvent(O,w.type)&&(yield O)}}let f=s?.state;if(f!==void 0){let h={event:`on_${f.type}_end`,name:c,run_id:f.id,tags:o,metadata:l,data:{output:f.final_output}};d.includeEvent(h,f.type)&&(yield h)}}static isRunnable(e){return Co(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new dr({bound:this,config:{},configFactories:[s=>({callbacks:[new To({config:s,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return QO(this,e)}},dr=class n extends re{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=qc(this.config,...e);return qc(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Q(t),this.kwargs))}async batch(e,t,r){let s=Array.isArray(t)?await Promise.all(t.map(async a=>this._mergeConfig(Q(a),this.kwargs))):await this._mergeConfig(Q(t),this.kwargs);return this.bound.batch(e,s,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Q(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Q(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Q(t),this.kwargs))}streamEvents(e,t,r){let s=this,a=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(Q(t),s.kwargs),version:t.version},r)};return ke.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&re.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new To({config:s,onStart:e,onEnd:t,onError:r})]})]})}},Kc=class n extends re{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new n({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,ve(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}},Wc=class extends dr{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let s=e>1?`retry:attempt:${e}`:void 0;return ve(t,{callbacks:r?.getChild(s)})}async _invoke(e,t,r){return(0,mf.default)(s=>super.invoke(e,this._patchConfigForRetry(s,t,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,s){let a={};try{await(0,mf.default)(async i=>{let o=e.map((p,f)=>f).filter(p=>a[p.toString()]===void 0||a[p.toString()]instanceof Error),l=o.map(p=>e[p]),c=o.map(p=>this._patchConfigForRetry(i,t?.[p],r?.[p])),u=await super.batch(l,c,{...s,returnExceptions:!0}),d;for(let p=0;p<u.length;p+=1){let f=u[p],h=o[p];f instanceof Error&&d===void 0&&(d=f,d.input=l[p]),a[h.toString()]=f}if(d)throw d;return u},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if(s?.returnExceptions!==!0)throw i}return Object.keys(a).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>a[parseInt(i,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}},xt=class n extends re{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r=Q(t),a=await(await gt(r))?.handleChainStart(this.toJSON(),Oe(e,"input"),r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i=e,o;try{let l=[this.first,...this.middle];for(let c=0;c<l.length;c+=1){let d=l[c].invoke(i,ve(r,{callbacks:a?.getChild(`seq:step:${c+1}`)}));i=await cr(d,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");o=await this.last.invoke(i,ve(r,{callbacks:a?.getChild(`seq:step:${this.steps.length}`)}))}catch(l){throw await a?.handleChainError(l),l}return await a?.handleChainEnd(Oe(o,"output")),o}async batch(e,t,r){let s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(gt)),i=await Promise.all(a.map(async(l,c)=>{let u=await l?.handleChainStart(this.toJSON(),Oe(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName);return delete s[c].runId,u})),o=e;try{for(let l=0;l<this.steps.length;l+=1){let u=this.steps[l].batch(o,i.map((d,p)=>{let f=d?.getChild(`seq:step:${l+1}`);return ve(s[p],{callbacks:f})}),r);o=await cr(u,s[0]?.signal)}}catch(l){throw await Promise.all(i.map(c=>c?.handleChainError(l))),l}return await Promise.all(i.map(l=>l?.handleChainEnd(Oe(o,"output")))),o}async*_streamIterator(e,t){let r=await gt(t),{runId:s,...a}=t??{},i=await r?.handleChainStart(this.toJSON(),Oe(e,"input"),s,void 0,void 0,void 0,a?.runName),o=[this.first,...this.middle,this.last],l=!0,c;async function*u(){yield e}try{let d=o[0].transform(u(),ve(a,{callbacks:i?.getChild("seq:step:1")}));for(let p=1;p<o.length;p+=1)d=await o[p].transform(d,ve(a,{callbacks:i?.getChild(`seq:step:${p+1}`)}));for await(let p of d)if(t?.signal?.throwIfAborted(),yield p,l)if(c===void 0)c=p;else try{c=Xe(c,p)}catch{c=void 0,l=!1}}catch(d){throw await i?.handleChainError(d),d}await i?.handleChainEnd(Oe(c,"output"))}getGraph(e){let t=new Po,r=null;return this.steps.forEach((s,a)=>{let i=s.getGraph(e);a!==0&&i.trimFirstNode(),a!==this.steps.length-1&&i.trimLastNode(),t.extend(i);let o=i.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&t.addEdge(r,o),r=i.lastNode()}),t}pipe(e){return n.isRunnableSequence(e)?new n({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new n({first:this.first,middle:[...this.middle,this.last],last:Hr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&re.isRunnable(e)}static from([e,...t],r){return new n({first:Hr(e),middle:t.slice(0,-1).map(Hr),last:Hr(t[t.length-1]),name:r})}},mn=class n extends re{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,r]of Object.entries(e.steps))this.steps[t]=Hr(r)}static from(e){return new n({steps:e})}async invoke(e,t){let r=Q(t),a=await(await gt(r))?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i={};try{let o=Object.entries(this.steps).map(async([l,c])=>{i[l]=await c.invoke(e,ve(r,{callbacks:a?.getChild(`map:key:${l}`)}))});await cr(Promise.all(o),t?.signal)}catch(o){throw await a?.handleChainError(o),o}return await a?.handleChainEnd(i),i}async*_transform(e,t,r){let s={...this.steps},a=lf(e,Object.keys(s).length),i=new Map(Object.entries(s).map(([o,l],c)=>{let u=l.transform(a[c],ve(r,{callbacks:t?.getChild(`map:key:${o}`)}));return[o,u.next().then(d=>({key:o,gen:u,result:d}))]}));for(;i.size;){let o=Promise.race(i.values()),{key:l,result:c,gen:u}=await cr(o,r?.signal);i.delete(l),c.done||(yield{[l]:c.value},i.set(l,u.next().then(d=>({key:l,gen:u,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=Q(t),a=new zr({generator:this.transform(r(),s),config:s});return await a.setup,ke.fromAsyncGenerator(a)}},gf=class n extends re{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Oc(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),s=await gt(r),a=this.func(ve(r,{callbacks:s}),e);return cr(a,r?.signal)}async*_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(Gc(s)){for await(let a of s)r?.signal?.throwIfAborted(),yield a;return}if(qw(s)){for(;;){r?.signal?.throwIfAborted();let a=s.next();if(a.done)break;yield a.value}return}yield s}static from(e){return new n({func:e})}};pr=class n extends re{static lc_name(){return"RunnableLambda"}constructor(e){if(Oc(e.func))return gf.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),XO(e.func),this.func=e.func}static from(e){return new n({func:e})}async _invoke(e,t,r){return new Promise((s,a)=>{let i=ve(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??zc)-1});Dt.runWithConfig(i,async()=>{try{let o=await this.func(e,{...i,config:i});if(o&&re.isRunnable(o)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...i,recursionLimit:(i.recursionLimit??zc)-1})}else if(Gc(o)){let l;for await(let c of hf(i,o))if(t?.signal?.throwIfAborted(),l===void 0)l=c;else try{l=Xe(l,c)}catch{l=c}o=l}else if(pf(o)){let l;for(let c of ff(i,o))if(t?.signal?.throwIfAborted(),l===void 0)l=c;else try{l=Xe(l,c)}catch{l=c}o=l}s(o)}catch(o){a(o)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){let s;for await(let o of e)if(s===void 0)s=o;else try{s=Xe(s,o)}catch{s=o}let a=ve(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??zc)-1}),i=await new Promise((o,l)=>{Dt.runWithConfig(a,async()=>{try{let c=await this.func(s,{...a,config:a});o(c)}catch(c){l(c)}})});if(i&&re.isRunnable(i)){if(r?.recursionLimit===0)throw new Error("Recursion limit reached.");let o=await i.stream(s,a);for await(let l of o)yield l}else if(Gc(i))for await(let o of hf(a,i))r?.signal?.throwIfAborted(),yield o;else if(pf(i))for(let o of ff(a,i))r?.signal?.throwIfAborted(),yield o;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=Q(t),a=new zr({generator:this.transform(r(),s),config:s});return await a.setup,ke.fromAsyncGenerator(a)}},Jc=class extends re{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,t){let r=Q(t),s=await gt(t),{runId:a,...i}=r,o=await s?.handleChainStart(this.toJSON(),Oe(e,"input"),a,void 0,void 0,void 0,i?.runName),l;for(let c of this.runnables()){r?.signal?.throwIfAborted();try{let u=await c.invoke(e,ve(i,{callbacks:o?.getChild()}));return await o?.handleChainEnd(Oe(u,"output")),u}catch(u){l===void 0&&(l=u)}}throw l===void 0?new Error("No error stored at end of fallback."):(await o?.handleChainError(l),l)}async*_streamIterator(e,t){let r=Q(t),s=await gt(t),{runId:a,...i}=r,o=await s?.handleChainStart(this.toJSON(),Oe(e,"input"),a,void 0,void 0,void 0,i?.runName),l,c;for(let d of this.runnables()){r?.signal?.throwIfAborted();let p=ve(i,{callbacks:o?.getChild()});try{c=await d.stream(e,p);break}catch(f){l===void 0&&(l=f)}}if(c===void 0){let d=l??new Error("No error stored at end of fallback.");throw await o?.handleChainError(d),d}let u;try{for await(let d of c){yield d;try{u=u===void 0?u:Xe(u,d)}catch{u=void 0}}}catch(d){throw await o?.handleChainError(d),d}await o?.handleChainEnd(Oe(u,"output"))}async batch(e,t,r){if(r?.returnExceptions)throw new Error("Not implemented.");let s=this._getOptionsList(t??{},e.length),a=await Promise.all(s.map(l=>gt(l))),i=await Promise.all(a.map(async(l,c)=>{let u=await l?.handleChainStart(this.toJSON(),Oe(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName);return delete s[c].runId,u})),o;for(let l of this.runnables()){s[0].signal?.throwIfAborted();try{let c=await l.batch(e,i.map((u,d)=>ve(s[d],{callbacks:u?.getChild()})),r);return await Promise.all(i.map((u,d)=>u?.handleChainEnd(Oe(c[d],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(i.map(l=>l?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};Na=class extends re{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof mn&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){let s=this.mapper.getStepsKeys(),[a,i]=lf(e),o=this.mapper.transform(i,ve(r,{callbacks:t?.getChild()})),l=o.next();for await(let c of a){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);let u=Object.fromEntries(Object.entries(c).filter(([d])=>!s.includes(d)));Object.keys(u).length>0&&(yield u)}yield(await l).value;for await(let c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=Q(t),a=new zr({generator:this.transform(r(),s),config:s});return await a.setup,ke.fromAsyncGenerator(a)}},Yc=class extends re{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(let t of e){let r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let s=Q(t),a=new zr({generator:this.transform(r(),s),config:s});return await a.setup,ke.fromAsyncGenerator(a)}},So=class extends dr{constructor(e){let t=xt.from([pr.from(async r=>{let s;if(va(r))try{s=await this.schema.parseAsync(r.args)}catch{throw new _a("Received tool input did not match expected schema",JSON.stringify(r.args))}else s=r;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}});var yf=y(()=>{Gt()});var Vw=y(()=>{Ut();os();Ul();Bl();no();yf();zl();wa();un()});var _s=y(()=>{os();Gt();Ul();Bl();no();zl();un();Vw();yf();wa()});var Ro,$a,Ma,Xc,ko=y(()=>{ya();no();un();Ro=class extends vt{},$a=class extends Ro{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Ie(this.value)]}},Ma=class extends Ro{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return so(this.messages)}toChatMessages(){return this.messages}},Xc=class extends Ro{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new Ie({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}});var Jw=k(Qc=>{"use strict";Qc.byteLength=sT;Qc.toByteArray=iT;Qc.fromByteArray=cT;var fr=[],Bt=[],nT=typeof Uint8Array<"u"?Uint8Array:Array,_f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(vs=0,Kw=_f.length;vs<Kw;++vs)fr[vs]=_f[vs],Bt[_f.charCodeAt(vs)]=vs;var vs,Kw;Bt[45]=62;Bt[95]=63;function Ww(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function sT(n){var e=Ww(n),t=e[0],r=e[1];return(t+r)*3/4-r}function aT(n,e,t){return(e+t)*3/4-t}function iT(n){var e,t=Ww(n),r=t[0],s=t[1],a=new nT(aT(n,r,s)),i=0,o=s>0?r-4:r,l;for(l=0;l<o;l+=4)e=Bt[n.charCodeAt(l)]<<18|Bt[n.charCodeAt(l+1)]<<12|Bt[n.charCodeAt(l+2)]<<6|Bt[n.charCodeAt(l+3)],a[i++]=e>>16&255,a[i++]=e>>8&255,a[i++]=e&255;return s===2&&(e=Bt[n.charCodeAt(l)]<<2|Bt[n.charCodeAt(l+1)]>>4,a[i++]=e&255),s===1&&(e=Bt[n.charCodeAt(l)]<<10|Bt[n.charCodeAt(l+1)]<<4|Bt[n.charCodeAt(l+2)]>>2,a[i++]=e>>8&255,a[i++]=e&255),a}function oT(n){return fr[n>>18&63]+fr[n>>12&63]+fr[n>>6&63]+fr[n&63]}function lT(n,e,t){for(var r,s=[],a=e;a<t;a+=3)r=(n[a]<<16&16711680)+(n[a+1]<<8&65280)+(n[a+2]&255),s.push(oT(r));return s.join("")}function cT(n){for(var e,t=n.length,r=t%3,s=[],a=16383,i=0,o=t-r;i<o;i+=a)s.push(lT(n,i,i+a>o?o:i+a));return r===1?(e=n[t-1],s.push(fr[e>>2]+fr[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],s.push(fr[e>>10]+fr[e>>4&63]+fr[e<<2&63]+"=")),s.join("")}});var Gr,Uo=y(()=>{ko();Da();Gr=class extends Kr{async formatPromptValue(e){let t=await this.format(e);return new $a(t)}}});function If(n){return typeof n=="function"}function XT(n){return Ba(n)?"array":typeof n}function Ef(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function n_(n,e){return n!=null&&typeof n=="object"&&e in n}function QT(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}function tC(n,e){return eC.call(n,e)}function nC(n){return!tC(rC,n)}function aC(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return sC[t]})}function uC(n,e){if(!n)return[];var t=!1,r=[],s=[],a=[],i=!1,o=!1,l="",c=0;function u(){if(i&&!o)for(;a.length;)delete s[a.pop()];else a=[];i=!1,o=!1}var d,p,f;function h(G){if(typeof G=="string"&&(G=G.split(oC,2)),!Ba(G)||G.length!==2)throw new Error("Invalid tags: "+G);d=new RegExp(Ef(G[0])+"\\s*"),p=new RegExp("\\s*"+Ef(G[1])),f=new RegExp("\\s*"+Ef("}"+G[1]))}h(e||zt.tags);for(var m=new zo(n),g,w,b,E,O,S;!m.eos();){if(g=m.pos,b=m.scanUntil(d),b)for(var J=0,te=b.length;J<te;++J)E=b.charAt(J),nC(E)?(a.push(s.length),l+=E):(o=!0,t=!0,l+=" "),s.push(["text",E,g,g+1]),g+=1,E===`
`&&(u(),l="",c=0,t=!1);if(!m.scan(d))break;if(i=!0,w=m.scan(cC)||"name",m.scan(iC),w==="="?(b=m.scanUntil(s_),m.scan(s_),m.scanUntil(p)):w==="{"?(b=m.scanUntil(f),m.scan(lC),m.scanUntil(p),w="&"):b=m.scanUntil(p),!m.scan(p))throw new Error("Unclosed tag at "+m.pos);if(w==">"?O=[w,b,g,m.pos,l,c,t]:O=[w,b,g,m.pos],c++,s.push(O),w==="#"||w==="^")r.push(O);else if(w==="/"){if(S=r.pop(),!S)throw new Error('Unopened section "'+b+'" at '+g);if(S[1]!==b)throw new Error('Unclosed section "'+S[1]+'" at '+g)}else w==="name"||w==="{"||w==="&"?o=!0:w==="="&&h(b)}if(u(),S=r.pop(),S)throw new Error('Unclosed section "'+S[1]+'" at '+m.pos);return pC(dC(s))}function dC(n){for(var e=[],t,r,s=0,a=n.length;s<a;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function pC(n){for(var e=[],t=e,r=[],s,a,i=0,o=n.length;i<o;++i)switch(s=n[i],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":a=r.pop(),a[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}function zo(n){this.string=n,this.tail=n,this.pos=0}function Ua(n,e){this.view=n,this.cache={".":this.view},this.parent=e}function at(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}var ZT,Ba,eC,rC,sC,iC,oC,s_,lC,cC,zt,Bo,su,a_=y(()=>{ZT=Object.prototype.toString,Ba=Array.isArray||function(e){return ZT.call(e)==="[object Array]"};eC=RegExp.prototype.test;rC=/\S/;sC={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};iC=/\s*/,oC=/\s+/,s_=/\s*=/,lC=/\s*\}/,cC=/#|\^|\/|>|\{|&|=|!/;zo.prototype.eos=function(){return this.tail===""};zo.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};zo.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};Ua.prototype.push=function(e){return new Ua(e,this)};Ua.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,a,i,o,l=!1;s;){if(e.indexOf(".")>0)for(a=s.view,i=e.split("."),o=0;a!=null&&o<i.length;)o===i.length-1&&(l=n_(a,i[o])||QT(a,i[o])),a=a[i[o++]];else a=s.view[e],l=n_(s.view,e);if(l){r=a;break}s=s.parent}t[e]=r}return If(r)&&(r=r.call(this.view)),r};at.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};at.prototype.parse=function(e,t){var r=this.templateCache,s=e+":"+(t||zt.tags).join(":"),a=typeof r<"u",i=a?r.get(s):void 0;return i==null&&(i=uC(e,t),a&&r.set(s,i)),i};at.prototype.render=function(e,t,r,s){var a=this.getConfigTags(s),i=this.parse(e,a),o=t instanceof Ua?t:new Ua(t,void 0);return this.renderTokens(i,o,r,e,s)};at.prototype.renderTokens=function(e,t,r,s,a){for(var i="",o,l,c,u=0,d=e.length;u<d;++u)c=void 0,o=e[u],l=o[0],l==="#"?c=this.renderSection(o,t,r,s,a):l==="^"?c=this.renderInverted(o,t,r,s,a):l===">"?c=this.renderPartial(o,t,r,a):l==="&"?c=this.unescapedValue(o,t):l==="name"?c=this.escapedValue(o,t,a):l==="text"&&(c=this.rawValue(o)),c!==void 0&&(i+=c);return i};at.prototype.renderSection=function(e,t,r,s,a){var i=this,o="",l=t.lookup(e[1]);function c(p){return i.render(p,t,r,a)}if(l){if(Ba(l))for(var u=0,d=l.length;u<d;++u)o+=this.renderTokens(e[4],t.push(l[u]),r,s,a);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")o+=this.renderTokens(e[4],t.push(l),r,s,a);else if(If(l)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(t.view,s.slice(e[3],e[5]),c),l!=null&&(o+=l)}else o+=this.renderTokens(e[4],t,r,s,a);return o}};at.prototype.renderInverted=function(e,t,r,s,a){var i=t.lookup(e[1]);if(!i||Ba(i)&&i.length===0)return this.renderTokens(e[4],t,r,s,a)};at.prototype.indentPartial=function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),a=e.split(`
`),i=0;i<a.length;i++)a[i].length&&(i>0||!r)&&(a[i]=s+a[i]);return a.join(`
`)};at.prototype.renderPartial=function(e,t,r,s){if(r){var a=this.getConfigTags(s),i=If(r)?r(e[1]):r[e[1]];if(i!=null){var o=e[6],l=e[5],c=e[4],u=i;l==0&&c&&(u=this.indentPartial(i,c,o));var d=this.parse(u,a);return this.renderTokens(d,t,r,u,s)}}};at.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};at.prototype.escapedValue=function(e,t,r){var s=this.getConfigEscape(r)||zt.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&s===zt.escape?String(a):s(a)};at.prototype.rawValue=function(e){return e[1]};at.prototype.getConfigTags=function(e){return Ba(e)?e:e&&typeof e=="object"?e.tags:void 0};at.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Ba(e))return e.escape};zt={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){Bo.templateCache=n},get templateCache(){return Bo.templateCache}},Bo=new at;zt.clearCache=function(){return Bo.clearCache()};zt.parse=function(e,t){return Bo.parse(e,t)};zt.render=function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+XT(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Bo.render(e,t,r,s)};zt.escape=aC;zt.Scanner=zo;zt.Context=Ua;zt.Writer=at;su=zt});function i_(){su.escape=n=>n}var qo,fC,au,hC,mC,Of,gC,Xt,o_,Es,za=y(()=>{a_();qo=n=>{let e=n.split(""),t=[],r=(a,i)=>{for(let o=i;o<e.length;o+=1)if(a.includes(e[o]))return o;return-1},s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")t.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")t.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){let a=r("}",s);if(a<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(s+1,a).join("")}),s=a+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{let a=r("{}",s),i=(a<0?e.slice(s):e.slice(s,a)).join("");t.push({type:"literal",text:i}),s=a<0?e.length:a}}return t},fC=n=>n.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),au=n=>{i_();let e=su.parse(n);return fC(e)},hC=(n,e)=>qo(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e)return t+e[r.name];throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),mC=(n,e)=>(i_(),su.render(n,e)),Of={"f-string":hC,mustache:mC},gC={"f-string":qo,mustache:au},Xt=(n,e,t)=>Of[e](n,t),o_=(n,e)=>gC[e](n),Es=(n,e,t)=>{if(!(e in Of)){let r=Object.keys(Of);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{let r=t.reduce((s,a)=>(s[a]="foo",s),{});Array.isArray(n)?n.forEach(s=>{if(s.type==="text")Xt(s.text,e,r);else if(s.type==="image_url")if(typeof s.image_url=="string")Xt(s.image_url,e,r);else{let a=s.image_url.url;Xt(a,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(s,null,2)}`)}):Xt(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}}});var Tf={};Yi(Tf,{PromptTemplate:()=>Qt});var Qt,qa=y(()=>{Uo();za();Qt=class n extends Gr{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Es(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return Xt(this.template,this.templateFormat,t)}static fromExamples(e,t,r,s=`

`,a=""){let i=[a,...e,t].join(s);return new n({inputVariables:r,template:i})}static fromTemplate(e,t){let{templateFormat:r="f-string",...s}=t??{},a=new Set;return o_(e,r).forEach(i=>{i.type==="variable"&&a.add(i.name)}),new n({inputVariables:[...a],templateFormat:r,template:e,...s})}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new n({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}});var Ha,Cf=y(()=>{ko();Da();za();Ha=class n extends Kr{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Es([{type:"image_url",image_url:this.template}],this.templateFormat,t)}}_getPromptType(){return"prompt"}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}async format(e){let t={};for(let[i,o]of Object.entries(this.template))typeof o=="string"?t[i]=Xt(o,this.templateFormat,e):t[i]=o;let r=e.url||t.url,s=e.detail||t.detail;if(!r)throw new Error("Must provide either an image URL.");if(typeof r!="string")throw new Error("url must be a string.");let a={url:r};return s&&(a.detail=s),a}async formatPromptValue(e){let t=await this.format(e);return new Xc(t)}}});function yC(n){return typeof n.formatMessages=="function"}function bC(n,e){if(yC(n)||pt(n))return n;if(Array.isArray(n)&&n[0]==="placeholder"){let s=n[1];if(typeof s!="string"||s[0]!=="{"||s[s.length-1]!=="}")throw new Error(`Invalid placeholder template: "${n[1]}". Expected a variable name surrounded by curly braces.`);let a=s.slice(1,-1);return new Pf({variableName:a,optional:!0})}let t=Kt(n),r;if(typeof t.content=="string"?r=t.content:r=t.content.map(s=>"text"in s?{...s,text:s.text}:"image_url"in s?{...s,image_url:s.image_url}:s),t._getType()==="human")return iu.fromTemplate(r,e);if(t._getType()==="ai")return kf.fromTemplate(r,e);if(t._getType()==="system")return Nf.fromTemplate(r,e);if(De.isInstance(t))return Rf.fromTemplate(t.content,t.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}function wC(n){return n.constructor.lc_name()==="MessagesPlaceholder"}var Ho,Pf,Sf,Vo,Rf,Go,iu,kf,Nf,Is,Ko=y(()=>{_s();ko();Ut();Uo();Da();qa();Cf();za();Ho=class extends re{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}},Pf=class extends Ho{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){let t=e[this.variableName];if(this.optional&&!t)return[];if(!t){let s=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw s.name="InputFormatError",s}let r;try{Array.isArray(t)?r=t.map(Kt):r=[Kt(t)]}catch(s){let a=typeof t=="string"?t:JSON.stringify(t,null,2),i=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${a}`,`Additional message: ${s.message}`].join(`

`));throw i.name="InputFormatError",i}return r}},Sf=class extends Ho{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}},Vo=class extends Kr{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new Ma(t)}},Rf=class extends Sf{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new De(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(Qt.fromTemplate(e,{templateFormat:r?.templateFormat}),t)}},Go=class extends Ho{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let r=[];this.prompt.forEach(s=>{"inputVariables"in s&&(r=r.concat(s.inputVariables))}),this.inputVariables=r}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){let t=this.constructor;if(t._messageClass()){let r=t._messageClass();return new r({content:e})}else if(t.chatMessageClass){let r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if(typeof e=="string")return new this(Qt.fromTemplate(e,t));let r=[];for(let s of e)if(typeof s=="string"||typeof s=="object"&&"text"in s){let a="";typeof s=="string"?a=s:typeof s.text=="string"&&(a=s.text??"");let i={...t,...typeof s!="string"?{additionalContentFields:s}:{}};r.push(Qt.fromTemplate(a,i))}else if(typeof s=="object"&&"image_url"in s){let a=s.image_url??"",i,o=[];if(typeof a=="string"){let l;t?.templateFormat==="mustache"?l=au(a):l=qo(a);let c=l.flatMap(u=>u.type==="variable"?[u.name]:[]);if((c?.length??0)>0){if(c.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${c}
From: ${a}`);o=[c[0]]}else o=[];a={url:a},i=new Ha({template:a,inputVariables:o,templateFormat:t?.templateFormat,additionalContentFields:s})}else if(typeof a=="object"){if("url"in a){let l;t?.templateFormat==="mustache"?l=au(a.url):l=qo(a.url),o=l.flatMap(c=>c.type==="variable"?[c.name]:[])}else o=[];i=new Ha({template:a,inputVariables:o,templateFormat:t?.templateFormat,additionalContentFields:s})}else throw new Error("Invalid image template");r.push(i)}return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof Gr){let t=await this.prompt.format(e);return this.createMessage(t)}else{let t=[];for(let r of this.prompt){let s={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(let a of r.inputVariables)s||(s={[a]:e[a]}),s={...s,[a]:e[a]};if(r instanceof Gr){let a=await r.format(s),i;"additionalContentFields"in r&&(i=r.additionalContentFields),t.push({...i,type:"text",text:a})}else if(r instanceof Ha){let a=await r.format(s),i;"additionalContentFields"in r&&(i=r.additionalContentFields),t.push({...i,type:"image_url",image_url:a})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}},iu=class extends Go{static _messageClass(){return Ie}static lc_name(){return"HumanMessagePromptTemplate"}},kf=class extends Go{static _messageClass(){return ce}static lc_name(){return"AIMessagePromptTemplate"}},Nf=class extends Go{static _messageClass(){return cs}static lc_name(){return"SystemMessagePromptTemplate"}};Is=class n extends Vo{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){let t=new Set;for(let o of this.promptMessages)if(!(o instanceof Ee))for(let l of o.inputVariables)t.add(l);let r=this.inputVariables,s=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),a=new Set([...s].filter(o=>!t.has(o)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);let i=new Set([...t].filter(o=>!s.has(o)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if(typeof e.content=="string")return e;let r=await Promise.all(e.content.map(async s=>{if(s.type!=="image_url")return s;let a="";typeof s.image_url=="string"?a=s.image_url:a=s.image_url.url;let o=await Qt.fromTemplate(a,{templateFormat:this.templateFormat}).format(t);return typeof s.image_url!="string"&&"url"in s.image_url?s.image_url.url=o:s.image_url=o,s}));return e.content=r,e}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=[];for(let s of this.promptMessages)if(s instanceof Ee)r.push(await this._parseImagePrompts(s,t));else{let a=s.inputVariables.reduce((o,l)=>{if(!(l in t)&&!(wC(s)&&s.optional))throw new Error(`Missing value for input variable \`${l.toString()}\``);return o[l]=t[l],o},{}),i=await s.formatMessages(a);r=r.concat(i)}return r}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}static fromTemplate(e,t){let r=Qt.fromTemplate(e,t),s=new iu({prompt:r});return this.fromMessages([s])}static fromMessages(e,t){let r=e.reduce((i,o)=>i.concat(o instanceof n?o.promptMessages:[bC(o,t)]),[]),s=e.reduce((i,o)=>o instanceof n?Object.assign(i,o.partialVariables):i,Object.create(null)),a=new Set;for(let i of r)if(!(i instanceof Ee))for(let o of i.inputVariables)o in s||a.add(o);return new this({...t,inputVariables:[...a],promptMessages:r,partialVariables:s,templateFormat:t?.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}});var l_={};Yi(l_,{FewShotChatMessagePromptTemplate:()=>Mf,FewShotPromptTemplate:()=>$f});var $f,Mf,jf=y(()=>{Uo();za();qa();Ko();$f=class n extends Gr{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Es(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),s=await Promise.all(r.map(i=>this.examplePrompt.format(i))),a=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return Xt(a,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");let r=await Qt.deserialize(t),s;if(Array.isArray(e.examples))s=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new n({inputVariables:e.input_variables,examplePrompt:r,examples:s,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}},Mf=class n extends Vo{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??`

`,this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Es(this.prefix+this.suffix,this.templateFormat,t)}}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t);r=r.map(a=>{let i={};return this.examplePrompt.inputVariables.forEach(o=>{i[o]=a[o]}),i});let s=[];for(let a of r){let i=await this.examplePrompt.formatMessages(a);s.push(...i)}return s}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=(await Promise.all(r.map(o=>this.examplePrompt.formatMessages(o)))).flat().map(o=>o.content),i=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return Xt(i,this.templateFormat,t)}async partial(e){let t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new n(s)}}});var Kr,Da=y(()=>{Ut();Kr=class extends re{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},r={};for(let[a,i]of Object.entries(t))typeof i=="string"?r[a]=i:r[a]=await i();return{...r,...e}}async invoke(e,t){return this._callWithConfig(r=>this.formatPromptValue(r),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{let{PromptTemplate:t}=await Promise.resolve().then(()=>(qa(),Tf));return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=await Promise.resolve().then(()=>(qa(),Tf));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>(jf(),l_));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}});var Hv=k((tK,qv)=>{qv.exports=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,t=[],r=0;r<n.rangeCount;r++)t.push(n.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||t.forEach(function(s){n.addRange(s)}),e&&e.focus()}}});var Kv=k((rK,Gv)=>{"use strict";var lR=Hv(),Vv={"text/plain":"Text","text/html":"Url",default:"Text"},cR="Copy to clipboard: #{key}, Enter";function uR(n){var e=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return n.replace(/#{\s*key\s*}/g,e)}function dR(n,e){var t,r,s,a,i,o,l=!1;e||(e={}),t=e.debug||!1;try{s=lR(),a=document.createRange(),i=document.getSelection(),o=document.createElement("span"),o.textContent=n,o.ariaHidden="true",o.style.all="unset",o.style.position="fixed",o.style.top=0,o.style.clip="rect(0, 0, 0, 0)",o.style.whiteSpace="pre",o.style.webkitUserSelect="text",o.style.MozUserSelect="text",o.style.msUserSelect="text",o.style.userSelect="text",o.addEventListener("copy",function(u){if(u.stopPropagation(),e.format)if(u.preventDefault(),typeof u.clipboardData>"u"){t&&console.warn("unable to use e.clipboardData"),t&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var d=Vv[e.format]||Vv.default;window.clipboardData.setData(d,n)}else u.clipboardData.clearData(),u.clipboardData.setData(e.format,n);e.onCopy&&(u.preventDefault(),e.onCopy(u.clipboardData))}),document.body.appendChild(o),a.selectNodeContents(o),i.addRange(a);var c=document.execCommand("copy");if(!c)throw new Error("copy command was unsuccessful");l=!0}catch(u){t&&console.error("unable to copy using execCommand: ",u),t&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",n),e.onCopy&&e.onCopy(window.clipboardData),l=!0}catch(d){t&&console.error("unable to copy using clipboardData: ",d),t&&console.error("falling back to prompt"),r=uR("message"in e?e.message:cR),window.prompt(r,n)}}finally{i&&(typeof i.removeRange=="function"?i.removeRange(a):i.removeAllRanges()),o&&document.body.removeChild(o),s()}return l}Gv.exports=dR});var wl={id:"acode.plugin.cli",name:"Renz Ai Cli",main:"dist/main.js",version:"1.0.0",readme:"readme.md",icon:"icon.png",minVersionCode:290,files:["assets/ai_assistant.svg","assets/user_avatar.png","assets/insert-context.svg","assets/github-dark.css","assets/highlight.min.js","assets/markdown-it.min.js"],price:0,author:{name:"Renz",email:"renzaja11@gmail.com",github:"RenzMc"}};var lm=`/* Modern Galaxy-Themed Responsive SCSS for Acode AI CLI Plugin */
:root {
  --galaxy-primary: #0f0f1e;
  --galaxy-secondary: #1a1a2e;
  --galaxy-accent: #16213e;
  --galaxy-star-blue: #00d4ff;
  --galaxy-star-purple: #9d4edd;
  --galaxy-star-pink: #ff006e;
  --galaxy-nebula-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --galaxy-cosmic-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
  --galaxy-text-primary: #ffffff;
  --galaxy-text-secondary: #b8b8ff;
  --galaxy-text-muted: #8892b0;
  --galaxy-border: rgba(0, 212, 255, 0.3);
  --galaxy-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  --galaxy-glow: 0 0 20px rgba(0, 212, 255, 0.3);
  --galaxy-hover-bg: rgba(0, 212, 255, 0.1);
  --galaxy-error: #ff4757;
  --galaxy-success: #2ed573;
  --galaxy-warning: #ffa502;
  --mobile-max: 767px;
  --tablet-min: 768px;
  --tablet-max: 1024px;
  --desktop-min: 1025px;
}

* {
  box-sizing: border-box;
}

body > .dialog-backdrop,
body > .dialog-wrapper,
body > [role=dialog],
body > .alert-wrapper,
dialog,
.native-dialog,
.system-dialog {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", sans-serif !important;
  line-height: 1.4 !important;
  letter-spacing: normal !important;
  text-align: left !important;
  display: block !important;
  position: fixed !important;
  z-index: 10000 !important;
  background: white !important;
  color: black !important;
  border: 1px solid #ccc !important;
  border-radius: 8px !important;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
}
body > .dialog-backdrop *,
body > .dialog-wrapper *,
body > [role=dialog] *,
body > .alert-wrapper *,
dialog *,
.native-dialog *,
.system-dialog * {
  color: inherit !important;
  font-family: inherit !important;
  line-height: inherit !important;
}

#acode-ai-assistant .mainApp {
  display: flex;
  flex-direction: column;
  height: 100vh;
  background: var(--galaxy-primary);
  color: var(--galaxy-text-primary);
  font-family: "SF Pro Display", "Segoe UI", "Roboto", -apple-system, BlinkMacSystemFont, sans-serif;
  overflow: hidden;
  position: relative;
}
#acode-ai-assistant .mainApp::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at 20% 80%, rgba(0, 212, 255, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(157, 78, 221, 0.1) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(255, 0, 110, 0.05) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}
#acode-ai-assistant .mainApp > * {
  position: relative;
  z-index: 1;
}
#acode-ai-assistant .chatBox {
  flex: 1;
  padding: 1rem;
  overflow-y: auto;
  scroll-behavior: smooth;
}
#acode-ai-assistant .chatBox::-webkit-scrollbar {
  width: 6px;
}
#acode-ai-assistant .chatBox::-webkit-scrollbar-track {
  background: var(--galaxy-secondary);
  border-radius: 10px;
}
#acode-ai-assistant .chatBox::-webkit-scrollbar-thumb {
  background: var(--galaxy-star-blue);
  border-radius: 10px;
  transition: background 0.3s ease;
}
#acode-ai-assistant .chatBox::-webkit-scrollbar-thumb:hover {
  background: var(--galaxy-star-purple);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .chatBox {
    padding: 0.75rem;
  }
}
#acode-ai-assistant .wrapper, #acode-ai-assistant .ai_wrapper {
  margin-bottom: 1.5rem;
  animation: fadeInUp 0.5s ease-out;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .wrapper, #acode-ai-assistant .ai_wrapper {
    margin-bottom: 1rem;
  }
}
#acode-ai-assistant .chat, #acode-ai-assistant .ai_chat {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  max-width: 100%;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .chat, #acode-ai-assistant .ai_chat {
    gap: 0.75rem;
  }
}
#acode-ai-assistant .profile, #acode-ai-assistant .ai_profile {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
  background: var(--galaxy-nebula-gradient);
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: var(--galaxy-glow);
}
#acode-ai-assistant .profile img, #acode-ai-assistant .ai_profile img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .profile, #acode-ai-assistant .ai_profile {
    width: 32px;
    height: 32px;
  }
}
#acode-ai-assistant .message, #acode-ai-assistant .ai_message {
  background: var(--galaxy-secondary);
  padding: 1rem 1.25rem;
  border-radius: 1.25rem;
  max-width: calc(100% - 60px);
  word-wrap: break-word;
  border: 1px solid var(--galaxy-border);
  box-shadow: var(--galaxy-shadow);
  position: relative;
  line-height: 1.6;
}
#acode-ai-assistant .message::before, #acode-ai-assistant .ai_message::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--galaxy-nebula-gradient);
  opacity: 0.05;
  border-radius: inherit;
  pointer-events: none;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .message, #acode-ai-assistant .ai_message {
    padding: 0.875rem 1rem;
    border-radius: 1rem;
    max-width: calc(100% - 50px);
    font-size: 0.9rem;
  }
}
#acode-ai-assistant .user_message {
  background: var(--galaxy-accent);
  border-color: var(--galaxy-star-blue);
  margin-left: auto;
}
#acode-ai-assistant .ai_message {
  background: var(--galaxy-secondary);
  border-color: var(--galaxy-star-purple);
}
#acode-ai-assistant .ai_message pre {
  background: var(--galaxy-primary);
  border: 1px solid var(--galaxy-border);
  border-radius: 0.5rem;
  overflow-x: auto;
  margin: 0.75rem 0;
}
#acode-ai-assistant .ai_message pre code {
  font-family: "SF Mono", "Monaco", "Consolas", monospace;
  font-size: 0.875rem;
  line-height: 1.5;
}
#acode-ai-assistant .ai_message code:not(pre code) {
  background: var(--galaxy-primary);
  padding: 0.25rem 0.5rem;
  border-radius: 0.375rem;
  font-family: "SF Mono", "Monaco", "Consolas", monospace;
  font-size: 0.875rem;
  border: 1px solid var(--galaxy-border);
}
#acode-ai-assistant .codeBlock {
  position: relative;
  margin: 1rem 0;
  border-radius: 0.75rem;
  overflow: hidden;
  background: var(--galaxy-primary);
  border: 1px solid var(--galaxy-border);
  box-shadow: var(--galaxy-shadow);
}
#acode-ai-assistant .codeBlock .copy-button {
  position: absolute;
  top: 0.75rem;
  right: 0.75rem;
  background: var(--galaxy-star-blue);
  color: var(--galaxy-primary);
  border: none;
  border-radius: 0.375rem;
  padding: 0.5rem 0.75rem;
  cursor: pointer;
  font-size: 0.75rem;
  font-weight: 600;
  transition: all 0.3s ease;
  z-index: 10;
  box-shadow: var(--galaxy-shadow);
}
#acode-ai-assistant .codeBlock .copy-button:hover {
  background: var(--galaxy-star-purple);
  transform: translateY(-1px);
  box-shadow: 0 4px 20px rgba(0, 212, 255, 0.4);
}
#acode-ai-assistant .codeBlock .copy-button:active {
  transform: translateY(0);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .codeBlock .copy-button {
    padding: 0.375rem 0.5rem;
    font-size: 0.7rem;
  }
}
#acode-ai-assistant .codeBlock .codesArea {
  margin: 0;
  padding: 1.25rem;
  background: var(--galaxy-primary);
}
#acode-ai-assistant .codeBlock .codesArea code {
  font-family: "SF Mono", "Monaco", "Consolas", monospace;
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--galaxy-text-primary);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .codeBlock .codesArea {
    padding: 1rem;
  }
  #acode-ai-assistant .codeBlock .codesArea code {
    font-size: 0.8rem;
  }
}
#acode-ai-assistant .inputBox {
  padding: 1.25rem;
  background: var(--galaxy-secondary);
  border-top: 1px solid var(--galaxy-border);
  display: flex;
  align-items: center;
  gap: 1rem;
  position: relative;
}
#acode-ai-assistant .inputBox::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: var(--galaxy-nebula-gradient);
  opacity: 0.6;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .inputBox {
    padding: 1rem;
    gap: 0.75rem;
  }
}
#acode-ai-assistant .chatTextarea {
  flex: 1;
  background: var(--galaxy-primary);
  border: 1px solid var(--galaxy-border);
  border-radius: 1.25rem;
  padding: 1rem 1.25rem;
  color: var(--galaxy-text-primary);
  font-family: inherit;
  font-size: 1rem;
  line-height: 1.5;
  resize: none;
  min-height: 50px;
  max-height: 120px;
  transition: all 0.3s ease;
}
#acode-ai-assistant .chatTextarea::placeholder {
  color: var(--galaxy-text-muted);
}
#acode-ai-assistant .chatTextarea:focus {
  outline: none;
  border-color: var(--galaxy-star-blue);
  box-shadow: var(--galaxy-glow);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .chatTextarea {
    padding: 0.875rem 1rem;
    font-size: 0.9rem;
    border-radius: 1rem;
  }
}
#acode-ai-assistant .sendBtn, #acode-ai-assistant .stopGenerationBtn {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  background: var(--galaxy-star-blue);
  color: var(--galaxy-primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  box-shadow: var(--galaxy-shadow);
}
#acode-ai-assistant .sendBtn svg, #acode-ai-assistant .stopGenerationBtn svg {
  width: 20px;
  height: 20px;
  fill: currentColor;
}
#acode-ai-assistant .sendBtn:hover, #acode-ai-assistant .stopGenerationBtn:hover {
  background: var(--galaxy-star-purple);
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
}
#acode-ai-assistant .sendBtn:active, #acode-ai-assistant .stopGenerationBtn:active {
  transform: translateY(0) scale(1);
}
#acode-ai-assistant .sendBtn.hide, #acode-ai-assistant .stopGenerationBtn.hide {
  display: none;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .sendBtn, #acode-ai-assistant .stopGenerationBtn {
    width: 42px;
    height: 42px;
  }
  #acode-ai-assistant .sendBtn svg, #acode-ai-assistant .stopGenerationBtn svg {
    width: 18px;
    height: 18px;
  }
}
#acode-ai-assistant .stopGenerationBtn {
  background: var(--galaxy-error);
}
#acode-ai-assistant .stopGenerationBtn:hover {
  background: #ff3742;
}
#acode-ai-assistant .icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: 0.75rem;
  background: var(--galaxy-hover-bg);
  color: var(--galaxy-star-blue);
  cursor: pointer;
  transition: all 0.3s ease;
  border: 1px solid transparent;
  font-size: 1.25rem;
}
#acode-ai-assistant .icon:hover {
  background: var(--galaxy-star-blue);
  color: var(--galaxy-primary);
  border-color: var(--galaxy-star-blue);
  transform: translateY(-2px);
  box-shadow: var(--galaxy-glow);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .icon {
    width: 36px;
    height: 36px;
    font-size: 1.1rem;
  }
}
#acode-ai-assistant .token-display {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: var(--galaxy-accent);
  border: 1px solid var(--galaxy-border);
  border-radius: 1.5rem;
  font-size: 0.875rem;
  color: var(--galaxy-text-secondary);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .token-display {
    padding: 0.375rem 0.75rem;
    font-size: 0.8rem;
  }
}
#acode-ai-assistant .dialog {
  background: var(--galaxy-secondary);
  border: 1px solid var(--galaxy-border);
  border-radius: 1rem;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  color: var(--galaxy-text-primary);
}
#acode-ai-assistant .dialog .dialog-header {
  background: var(--galaxy-nebula-gradient);
  padding: 1.25rem;
  border-radius: 1rem 1rem 0 0;
  font-weight: 600;
  font-size: 1.1rem;
}
#acode-ai-assistant .dialog .dialog-content {
  padding: 1.25rem;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .dialog .dialog-content {
    padding: 1rem;
  }
}
#acode-ai-assistant .dialog-item {
  padding: 1rem;
  margin-bottom: 0.75rem;
  background: var(--galaxy-accent);
  border: 1px solid var(--galaxy-border);
  border-radius: 0.75rem;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
#acode-ai-assistant .dialog-item:hover {
  background: var(--galaxy-hover-bg);
  border-color: var(--galaxy-star-blue);
  transform: translateX(4px);
}
#acode-ai-assistant .dialog-item .delete-history-btn {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: none;
  background: var(--galaxy-error);
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.875rem;
  transition: all 0.3s ease;
}
#acode-ai-assistant .dialog-item .delete-history-btn:hover {
  background: #ff3742;
  transform: scale(1.1);
}
#acode-ai-assistant input[type=text],
#acode-ai-assistant input[type=password],
#acode-ai-assistant select,
#acode-ai-assistant textarea {
  background: var(--galaxy-primary);
  border: 1px solid var(--galaxy-border);
  border-radius: 0.75rem;
  padding: 0.875rem 1rem;
  color: var(--galaxy-text-primary);
  font-family: inherit;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}
#acode-ai-assistant input[type=text]::placeholder,
#acode-ai-assistant input[type=password]::placeholder,
#acode-ai-assistant select::placeholder,
#acode-ai-assistant textarea::placeholder {
  color: var(--galaxy-text-muted);
}
#acode-ai-assistant input[type=text]:focus,
#acode-ai-assistant input[type=password]:focus,
#acode-ai-assistant select:focus,
#acode-ai-assistant textarea:focus {
  outline: none;
  border-color: var(--galaxy-star-blue);
  box-shadow: var(--galaxy-glow);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant input[type=text],
  #acode-ai-assistant input[type=password],
  #acode-ai-assistant select,
  #acode-ai-assistant textarea {
    padding: 0.75rem;
    font-size: 0.875rem;
  }
}
#acode-ai-assistant .provider-dropdown {
  position: relative;
}
#acode-ai-assistant .provider-dropdown .provider-select {
  background: var(--galaxy-accent);
  border: 1px solid var(--galaxy-border);
  border-radius: 0.75rem;
  padding: 0.5rem 2rem 0.5rem 0.75rem;
  color: var(--galaxy-text-primary);
  font-size: 0.875rem;
  cursor: pointer;
  appearance: none;
}
#acode-ai-assistant .provider-dropdown .provider-select:focus {
  outline: none;
  border-color: var(--galaxy-star-blue);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .provider-dropdown .provider-select {
    padding: 0.375rem 1.5rem 0.375rem 0.5rem;
    font-size: 0.8rem;
  }
}
#acode-ai-assistant .loading {
  animation: pulse 2s infinite;
}
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}
@keyframes blink {
  0%, 50% {
    opacity: 1;
  }
  51%, 100% {
    opacity: 0;
  }
}
#acode-ai-assistant .streaming-cursor {
  animation: blink 1s infinite;
  color: var(--galaxy-star-blue);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .hide-mobile {
    display: none !important;
  }
}
@media (min-width: var(--tablet-min)) {
  #acode-ai-assistant .hide-tablet {
    display: none !important;
  }
}
@media (prefers-contrast: high) {
  #acode-ai-assistant :root {
    --galaxy-border: #ffffff;
    --galaxy-text-muted: #cccccc;
  }
}
#acode-ai-assistant .system_message {
  background: var(--galaxy-accent);
  border: 1px solid var(--galaxy-border);
  border-radius: 1rem;
  padding: 1rem;
  margin: 1rem 0;
  color: var(--galaxy-text-secondary);
  font-size: 0.9rem;
  line-height: 1.5;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .system_message {
    padding: 0.75rem;
    font-size: 0.85rem;
  }
}
#acode-ai-assistant .ai-edit-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(15, 15, 30, 0.8);
  backdrop-filter: blur(8px);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}
#acode-ai-assistant .ai-edit-popup {
  background: var(--galaxy-secondary);
  border: 1px solid var(--galaxy-border);
  border-radius: 1.25rem;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  max-width: 90vw;
  max-height: 80vh;
  width: 600px;
  overflow: hidden;
  animation: slideIn 0.3s ease-out;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .ai-edit-popup {
    width: 95vw;
    max-height: 90vh;
  }
}
#acode-ai-assistant .ai-edit-popup-header {
  background: var(--galaxy-nebula-gradient);
  padding: 1.25rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .ai-edit-popup-header {
    padding: 1rem;
  }
}
#acode-ai-assistant .ai-edit-popup-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--galaxy-text-primary);
  margin: 0;
}
#acode-ai-assistant .ai-edit-popup-close {
  background: var(--galaxy-error);
  color: white;
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}
#acode-ai-assistant .ai-edit-popup-close:hover {
  background: #ff3742;
  transform: scale(1.1);
}
#acode-ai-assistant .ai-edit-popup-body {
  padding: 1.25rem;
  max-height: 50vh;
  overflow-y: auto;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .ai-edit-popup-body {
    padding: 1rem;
    max-height: 60vh;
  }
}
#acode-ai-assistant .ai-edit-prompt {
  background: var(--galaxy-primary);
  border: 1px solid var(--galaxy-border);
  border-radius: 0.75rem;
  padding: 1rem;
  width: 100%;
  min-height: 120px;
  color: var(--galaxy-text-primary);
  font-family: inherit;
  font-size: 0.9rem;
  line-height: 1.5;
  resize: vertical;
}
#acode-ai-assistant .ai-edit-prompt:focus {
  outline: none;
  border-color: var(--galaxy-star-blue);
  box-shadow: var(--galaxy-glow);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .ai-edit-prompt {
    padding: 0.875rem;
    font-size: 0.85rem;
  }
}
#acode-ai-assistant .ai-edit-actions {
  display: flex;
  gap: 0.75rem;
  margin-top: 1rem;
  justify-content: flex-end;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .ai-edit-actions {
    flex-direction: column-reverse;
  }
}
#acode-ai-assistant .ai-edit-btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 0.75rem;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 500;
  transition: all 0.3s ease;
}
#acode-ai-assistant .ai-edit-btn.primary {
  background: var(--galaxy-star-blue);
  color: var(--galaxy-primary);
}
#acode-ai-assistant .ai-edit-btn.primary:hover {
  background: var(--galaxy-star-purple);
  transform: translateY(-1px);
  box-shadow: var(--galaxy-glow);
}
#acode-ai-assistant .ai-edit-btn.secondary {
  background: var(--galaxy-accent);
  color: var(--galaxy-text-secondary);
  border: 1px solid var(--galaxy-border);
}
#acode-ai-assistant .ai-edit-btn.secondary:hover {
  background: var(--galaxy-hover-bg);
  border-color: var(--galaxy-star-blue);
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .ai-edit-btn {
    padding: 0.875rem 1.25rem;
  }
}
#acode-ai-assistant .ai-suggestion-widget {
  position: absolute;
  background: var(--galaxy-secondary);
  border: 1px solid var(--galaxy-border);
  border-radius: 0.75rem;
  box-shadow: var(--galaxy-shadow);
  max-width: 400px;
  max-height: 300px;
  overflow-y: auto;
  z-index: 100;
  animation: fadeIn 0.2s ease-out;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .ai-suggestion-widget {
    max-width: 90vw;
    max-height: 250px;
  }
}
#acode-ai-assistant .suggestion-header, #acode-ai-assistant .autocomplete-header, #acode-ai-assistant .quickfix-header {
  background: var(--galaxy-accent);
  padding: 0.5rem 0.75rem;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--galaxy-text-secondary);
  border-bottom: 1px solid var(--galaxy-border);
}
#acode-ai-assistant .suggestion-item, #acode-ai-assistant .completion-item, #acode-ai-assistant .quickfix-item {
  padding: 0.75rem;
  cursor: pointer;
  border-bottom: 1px solid rgba(0, 212, 255, 0.1);
  transition: all 0.2s ease;
}
#acode-ai-assistant .suggestion-item:hover, #acode-ai-assistant .completion-item:hover, #acode-ai-assistant .quickfix-item:hover {
  background: var(--galaxy-hover-bg);
  border-left: 3px solid var(--galaxy-star-blue);
}
#acode-ai-assistant .suggestion-item:last-child, #acode-ai-assistant .completion-item:last-child, #acode-ai-assistant .quickfix-item:last-child {
  border-bottom: none;
}
#acode-ai-assistant .suggestion-title, #acode-ai-assistant .completion-label, #acode-ai-assistant .fix-title {
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--galaxy-text-primary);
  margin-bottom: 0.25rem;
}
#acode-ai-assistant .suggestion-description, #acode-ai-assistant .completion-detail, #acode-ai-assistant .fix-description {
  font-size: 0.8rem;
  color: var(--galaxy-text-muted);
  line-height: 1.4;
}
#acode-ai-assistant .completion-icon {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--galaxy-star-blue);
  color: var(--galaxy-primary);
  font-size: 0.7rem;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 0.75rem;
  flex-shrink: 0;
}
#acode-ai-assistant .completion-content {
  flex: 1;
}
#acode-ai-assistant .quickfix-item-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}
#acode-ai-assistant .fix-severity {
  padding: 0.25rem 0.5rem;
  border-radius: 1rem;
  font-size: 0.7rem;
  font-weight: 600;
}
#acode-ai-assistant .fix-severity.error {
  background: var(--galaxy-error);
  color: white;
}
#acode-ai-assistant .fix-severity.warning {
  background: var(--galaxy-warning);
  color: var(--galaxy-primary);
}
#acode-ai-assistant .fix-severity.info {
  background: var(--galaxy-star-blue);
  color: var(--galaxy-primary);
}
#acode-ai-assistant .fix-action {
  margin-top: 0.5rem;
  padding: 0.5rem;
  background: var(--galaxy-primary);
  border-radius: 0.5rem;
  border: 1px solid var(--galaxy-border);
  font-size: 0.8rem;
  color: var(--galaxy-text-secondary);
}
#acode-ai-assistant .realtime-ai-status {
  position: fixed;
  top: 1rem;
  right: 1rem;
  background: var(--galaxy-secondary);
  border: 1px solid var(--galaxy-border);
  border-radius: 2rem;
  padding: 0.5rem 1rem;
  font-size: 0.8rem;
  color: var(--galaxy-text-secondary);
  box-shadow: var(--galaxy-shadow);
  z-index: 50;
}
#acode-ai-assistant .realtime-ai-status.active {
  border-color: var(--galaxy-star-blue);
  box-shadow: var(--galaxy-glow);
}
#acode-ai-assistant .error-box {
  background: rgba(255, 71, 87, 0.1);
  border: 1px solid var(--galaxy-error);
  border-radius: 0.75rem;
  padding: 1rem;
  margin: 1rem 0;
  color: var(--galaxy-error);
  font-size: 0.9rem;
}
@media (max-width: var(--mobile-max)) {
  #acode-ai-assistant .error-box {
    padding: 0.75rem;
    font-size: 0.85rem;
  }
}
#acode-ai-assistant .ai-import-suggestion {
  background: var(--galaxy-accent);
  border: 1px solid var(--galaxy-star-purple);
  border-radius: 0.75rem;
  padding: 0.75rem;
  margin: 0.5rem 0;
  font-size: 0.85rem;
  color: var(--galaxy-text-secondary);
  cursor: pointer;
  transition: all 0.3s ease;
}
#acode-ai-assistant .ai-import-suggestion:hover {
  background: var(--galaxy-hover-bg);
  border-color: var(--galaxy-star-blue);
  transform: translateX(4px);
}
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
@media (prefers-reduced-motion: reduce) {
  #acode-ai-assistant * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
@media (prefers-color-scheme: light) {
  #acode-ai-assistant :root {
    --galaxy-primary: #f8f9fa;
    --galaxy-secondary: #e9ecef;
    --galaxy-accent: #dee2e6;
    --galaxy-text-primary: #212529;
    --galaxy-text-secondary: #495057;
    --galaxy-text-muted: #6c757d;
  }
}`;var cm;(function(n){n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT"})(cm||(cm={}));var _l;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(_l||(_l={}));var vl;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(vl||(vl={}));var um;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(um||(um={}));var dm;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(dm||(dm={}));var xl;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.OTHER="OTHER"})(xl||(xl={}));var pm;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(pm||(pm={}));var fm;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(fm||(fm={}));var hm;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(hm||(hm={}));var BR=[xl.RECITATION,xl.SAFETY];$r();_s();ka();var eT=typeof window=="object"?window:{},V="0123456789abcdef".split(""),tT=[-2147483648,8388608,32768,128],Yt=[24,16,8,0];var $e=[];function Zt(n){n?($e[0]=$e[16]=$e[1]=$e[2]=$e[3]=$e[4]=$e[5]=$e[6]=$e[7]=$e[8]=$e[9]=$e[10]=$e[11]=$e[12]=$e[13]=$e[14]=$e[15]=0,this.blocks=$e):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Zt.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===eT.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,s,a=n.length||0,i=this.blocks;r<a;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(s=this.start;r<a&&s<64;++r)i[s>>2]|=n[r]<<Yt[s++&3];else for(s=this.start;r<a&&s<64;++r)t=n.charCodeAt(r),t<128?i[s>>2]|=t<<Yt[s++&3]:t<2048?(i[s>>2]|=(192|t>>6)<<Yt[s++&3],i[s>>2]|=(128|t&63)<<Yt[s++&3]):t<55296||t>=57344?(i[s>>2]|=(224|t>>12)<<Yt[s++&3],i[s>>2]|=(128|t>>6&63)<<Yt[s++&3],i[s>>2]|=(128|t&63)<<Yt[s++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),i[s>>2]|=(240|t>>18)<<Yt[s++&3],i[s>>2]|=(128|t>>12&63)<<Yt[s++&3],i[s>>2]|=(128|t>>6&63)<<Yt[s++&3],i[s>>2]|=(128|t&63)<<Yt[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=i[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Zt.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=tT[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};Zt.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4,a,i,o,l=this.blocks;for(i=16;i<80;++i)o=l[i-3]^l[i-8]^l[i-14]^l[i-16],l[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)a=e&t|~e&r,o=n<<5|n>>>27,s=o+a+s+1518500249+l[i]<<0,e=e<<30|e>>>2,a=n&e|~n&t,o=s<<5|s>>>27,r=o+a+r+1518500249+l[i+1]<<0,n=n<<30|n>>>2,a=s&n|~s&e,o=r<<5|r>>>27,t=o+a+t+1518500249+l[i+2]<<0,s=s<<30|s>>>2,a=r&s|~r&n,o=t<<5|t>>>27,e=o+a+e+1518500249+l[i+3]<<0,r=r<<30|r>>>2,a=t&r|~t&s,o=e<<5|e>>>27,n=o+a+n+1518500249+l[i+4]<<0,t=t<<30|t>>>2;for(;i<40;i+=5)a=e^t^r,o=n<<5|n>>>27,s=o+a+s+1859775393+l[i]<<0,e=e<<30|e>>>2,a=n^e^t,o=s<<5|s>>>27,r=o+a+r+1859775393+l[i+1]<<0,n=n<<30|n>>>2,a=s^n^e,o=r<<5|r>>>27,t=o+a+t+1859775393+l[i+2]<<0,s=s<<30|s>>>2,a=r^s^n,o=t<<5|t>>>27,e=o+a+e+1859775393+l[i+3]<<0,r=r<<30|r>>>2,a=t^r^s,o=e<<5|e>>>27,n=o+a+n+1859775393+l[i+4]<<0,t=t<<30|t>>>2;for(;i<60;i+=5)a=e&t|e&r|t&r,o=n<<5|n>>>27,s=o+a+s-1894007588+l[i]<<0,e=e<<30|e>>>2,a=n&e|n&t|e&t,o=s<<5|s>>>27,r=o+a+r-1894007588+l[i+1]<<0,n=n<<30|n>>>2,a=s&n|s&e|n&e,o=r<<5|r>>>27,t=o+a+t-1894007588+l[i+2]<<0,s=s<<30|s>>>2,a=r&s|r&n|s&n,o=t<<5|t>>>27,e=o+a+e-1894007588+l[i+3]<<0,r=r<<30|r>>>2,a=t&r|t&s|r&s,o=e<<5|e>>>27,n=o+a+n-1894007588+l[i+4]<<0,t=t<<30|t>>>2;for(;i<80;i+=5)a=e^t^r,o=n<<5|n>>>27,s=o+a+s-899497514+l[i]<<0,e=e<<30|e>>>2,a=n^e^t,o=s<<5|s>>>27,r=o+a+r-899497514+l[i+1]<<0,n=n<<30|n>>>2,a=s^n^e,o=r<<5|r>>>27,t=o+a+t-899497514+l[i+2]<<0,s=s<<30|s>>>2,a=r^s^n,o=t<<5|t>>>27,e=o+a+e-899497514+l[i+3]<<0,r=r<<30|r>>>2,a=t^r^s,o=e<<5|e>>>27,n=o+a+n-899497514+l[i+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0};Zt.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return V[n>>28&15]+V[n>>24&15]+V[n>>20&15]+V[n>>16&15]+V[n>>12&15]+V[n>>8&15]+V[n>>4&15]+V[n&15]+V[e>>28&15]+V[e>>24&15]+V[e>>20&15]+V[e>>16&15]+V[e>>12&15]+V[e>>8&15]+V[e>>4&15]+V[e&15]+V[t>>28&15]+V[t>>24&15]+V[t>>20&15]+V[t>>16&15]+V[t>>12&15]+V[t>>8&15]+V[t>>4&15]+V[t&15]+V[r>>28&15]+V[r>>24&15]+V[r>>20&15]+V[r>>16&15]+V[r>>12&15]+V[r>>8&15]+V[r>>4&15]+V[r&15]+V[s>>28&15]+V[s>>24&15]+V[s>>20&15]+V[s>>16&15]+V[s>>12&15]+V[s>>8&15]+V[s>>4&15]+V[s&15]};Zt.prototype.toString=Zt.prototype.hex;Zt.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]};Zt.prototype.array=Zt.prototype.digest;Zt.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};var bf=n=>new Zt(!0).update(n).hex();un();var Gw=(...n)=>bf(n.join("_"));var wf=class{},rT=new Map,Zc=class n extends wf{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Gw(e,t))??null)}async update(e,t,r){this.cache.set(Gw(e,t),r)}static global(){return new n(rT)}};ko();un();Oo();var Yw=Ct(Jw(),1),uT=Object.defineProperty,dT=(n,e,t)=>e in n?uT(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,pT=(n,e,t)=>(dT(n,typeof e!="symbol"?e+"":e,t),t);function fT(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){let a=n.slice(t[s].start,t[s+1].end),i=e.get(a.join(","));i!=null&&(r==null||i<r[0])&&(r=[i,s])}if(r!=null){let s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function hT(n,e){return n.length===1?[e.get(n.join(","))]:fT(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function mT(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var vf=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(n,e){this.patStr=n.pat_str;let t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{let[a,i,...o]=s.split(" "),l=Number.parseInt(i,10);return o.forEach((c,u)=>r[c]=l+u),r},{});for(let[r,s]of Object.entries(t)){let a=Yw.default.toByteArray(r);this.rankMap.set(a.join(","),s),this.textMap.set(s,a)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,a])=>(r[a]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){let r=new RegExp(this.patStr,"ug"),s=vf.specialTokenRegex(Object.keys(this.specialTokens)),a=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!i.has(c)):t);if(o.size>0){let c=vf.specialTokenRegex([...o]),u=n.match(c);if(u!=null)throw new Error(`The text contains a special token that is not allowed: ${u[0]}`)}let l=0;for(;;){let c=null,u=l;for(;s.lastIndex=u,c=s.exec(n),!(c==null||i.has(c[0]));)u=c.index+1;let d=c?.index??n.length;for(let f of n.substring(l,d).matchAll(r)){let h=this.textEncoder.encode(f[0]),m=this.rankMap.get(h.join(","));if(m!=null){a.push(m);continue}a.push(...hT(h,this.rankMap))}if(c==null)break;let p=this.specialTokens[c[0]];a.push(p),l=c.index+c[0].length}return a}decode(n){let e=[],t=0;for(let a=0;a<n.length;++a){let i=n[a],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}let r=new Uint8Array(t),s=0;for(let a of e)r.set(a,s),s+=a.length;return this.textDecoder.decode(r)}},eu=vf;pT(eu,"specialTokenRegex",n=>new RegExp(n.map(e=>mT(e)).join("|"),"g"));function xf(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}Oo();var tu={},gT=new qr({});async function yT(n){return n in tu||(tu[n]=gT.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new eu(e)).catch(e=>{throw delete tu[n],e})),await tu[n]}async function Zw(n){return yT(xf(n))}Ut();var bT=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n;var wT=()=>!1,No=class extends re{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??wT(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},$o=class extends No{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r.cache=="object"?this.cache=r.cache:r.cache?this.cache=Zc.global():this.cache=void 0,this.caller=new qr(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await Zw("modelName"in this?bT(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new $a(e):Array.isArray(e)?new Ma(e.map(Kt)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){let r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};Sa();Ut();Bc();Lc();ur();ur();Ut();ws();var qe=class extends re{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let r=Q(t);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,t){let r=Q(t),s,a=!0;for await(let i of this._transformStreamWithConfig(e,o=>o,r))if(yield i,a)if(s===void 0)s=i;else try{s=Xe(s,i)}catch{s=void 0,a=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new Na(new mn({steps:e}))}};function hr(n){return typeof n?.parse=="function"}var Vr=class n extends $o{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){let r=n._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===n.prototype._streamResponseChunks)yield this.invoke(e,t);else{let s=n._convertInputToPromptValue(e).toChatMessages(),[a,i]=this._separateRunnableConfigFromCallOptionsCompat(t),o={...a.metadata,...this.getLsParams(i)},l=await ze.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:i,invocation_params:this?.invocationParams(i),batch_size:1},u=await l?.handleChatModelStart(this.toJSON(),[s],a.runId,void 0,c,void 0,void 0,a.runName),d;try{for await(let p of this._streamResponseChunks(s,i,u?.[0])){if(p.message.id==null){let f=u?.at(0)?.runId;f!=null&&p.message._updateId(`run-${f}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,d?d=d.concat(p):d=p}}catch(p){throw await Promise.all((u??[]).map(f=>f?.handleLLMError(p))),p}await Promise.all((u??[]).map(p=>p?.handleLLMEnd({generations:[[d]]})))}}getLsParams(e){return{ls_model_type:"chat",ls_stop:e.stop}}async _generateUncached(e,t,r){let s=e.map(f=>f.map(Kt)),a={...r.metadata,...this.getLsParams(t)},i=await ze.configure(r.callbacks,this.callbacks,r.tags,this.tags,a,this.metadata,{verbose:this.verbose}),o={options:t,invocation_params:this?.invocationParams(t),batch_size:1},l=await i?.handleChatModelStart(this.toJSON(),s,r.runId,void 0,o,void 0,void 0,r.runName),c=[],u=[];if(!!l?.[0].handlers.find(f=>Io(f)||Eo(f))&&s.length===1&&this._streamResponseChunks!==n.prototype._streamResponseChunks)try{let f=await this._streamResponseChunks(s[0],t,l?.[0]),h;for await(let m of f){if(m.message.id==null){let g=l?.at(0)?.runId;g!=null&&m.message._updateId(`run-${g}`)}h===void 0?h=m:h=Xe(h,m)}if(h===void 0)throw new Error("Received empty response from chat model call.");c.push([h]),await l?.[0].handleLLMEnd({generations:c,llmOutput:{}})}catch(f){throw await l?.[0].handleLLMError(f),f}else{let f=await Promise.allSettled(s.map((h,m)=>this._generate(h,{...t,promptIndex:m},l?.[m])));await Promise.all(f.map(async(h,m)=>{if(h.status==="fulfilled"){let g=h.value;for(let w of g.generations){if(w.message.id==null){let b=l?.at(0)?.runId;b!=null&&w.message._updateId(`run-${b}`)}w.message.response_metadata={...w.generationInfo,...w.message.response_metadata}}return g.generations.length===1&&(g.generations[0].message.response_metadata={...g.llmOutput,...g.generations[0].message.response_metadata}),c[m]=g.generations,u[m]=g.llmOutput,l?.[m]?.handleLLMEnd({generations:[g.generations],llmOutput:g.llmOutput})}else return await l?.[m]?.handleLLMError(h.reason),Promise.reject(h.reason)}))}let p={generations:c,llmOutput:u.length?this._combineLLMOutput?.(...u):void 0};return Object.defineProperty(p,Fc,{value:l?{runIds:l?.map(f=>f.runId)}:void 0,configurable:!0}),p}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:s,handledOptions:a}){let i=e.map(g=>g.map(Kt)),o={...a.metadata,...this.getLsParams(s)},l=await ze.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:s,invocation_params:this?.invocationParams(s),batch_size:1,cached:!0},u=await l?.handleChatModelStart(this.toJSON(),i,a.runId,void 0,c,void 0,void 0,a.runName),d=[],f=(await Promise.allSettled(i.map(async(g,w)=>{let b=n._convertInputToPromptValue(g).toString(),E=await t.lookup(b,r);return E==null&&d.push(w),E}))).map((g,w)=>({result:g,runManager:u?.[w]})).filter(({result:g})=>g.status==="fulfilled"&&g.value!=null||g.status==="rejected"),h=[];await Promise.all(f.map(async({result:g,runManager:w},b)=>{if(g.status==="fulfilled"){let E=g.value;return h[b]=E,E.length&&await w?.handleLLMNewToken(E[0].text),w?.handleLLMEnd({generations:[E]})}else return await w?.handleLLMError(g.reason),Promise.reject(g.reason)}));let m={generations:h,missingPromptIndices:d};return Object.defineProperty(m,Fc,{value:u?{runIds:u?.map(g=>g.runId)}:void 0,configurable:!0}),m}async generate(e,t,r){let s;Array.isArray(t)?s={stop:t}:s=t;let a=e.map(f=>f.map(Kt)),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(a,o,i);let{cache:l}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:u,missingPromptIndices:d}=await this._generateCached({messages:a,cache:l,llmStringKey:c,parsedOptions:o,handledOptions:i}),p={};if(d.length>0){let f=await this._generateUncached(d.map(h=>a[h]),o,i);await Promise.all(f.generations.map(async(h,m)=>{let g=d[m];u[g]=h;let w=n._convertInputToPromptValue(a[g]).toString();return l.update(w,c,h)})),p=f.llmOutput??{}}return{generations:u,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){let s=e.map(a=>a.toChatMessages());return this.generate(s,t,r)}async call(e,t,r){return(await this.generate([e.map(Kt)],t,r)).generations[0][0].message}async callPrompt(e,t,r){let s=e.toChatMessages();return this.call(s,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){let s=new Ie(e),a=await this.call([s],t,r);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');let r=e,s=t?.name,a=r.description??"A function available to call.",i=t?.method,o=t?.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=s??"extract",c;hr(r)?c=[{type:"function",function:{name:l,description:a,parameters:We(r)}}]:("name"in r&&(l=r.name),c=[{type:"function",function:{name:l,description:a,parameters:r}}]);let u=this.bindTools(c),d=pr.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");let g=m.tool_calls.find(w=>w.name===l);if(!g)throw new Error(`No tool call found with name ${l}.`);return g.args});if(!o)return u.pipe(d).withConfig({runName:"StructuredOutput"});let p=qe.assign({parsed:(m,g)=>d.invoke(m.raw,g)}),f=qe.assign({parsed:()=>null}),h=p.withFallbacks({fallbacks:[f]});return xt.from([{raw:u},h]).withConfig({runName:"StructuredOutputRunnable"})}},ru=class extends Vr{async _generate(e,t,r){let s=await this._call(e,t,r),a=new ce(s);if(typeof a.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:a.content,message:a}]}}};_s();ka();ur();async function*Xw(n,e,t){let r=n;r.startsWith("http://localhost:")&&(r=r.replace("http://localhost:","http://127.0.0.1:"));let s=await fetch(r,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",...t.headers},signal:t.signal});if(!s.ok){let l,c=await s.text();try{let u=JSON.parse(c);l=new Error(`Ollama call failed with status code ${s.status}: ${u.error}`)}catch{l=new Error(`Ollama call failed with status code ${s.status}: ${c}`)}throw l.response=s,l}if(!s.body)throw new Error("Could not begin Ollama stream. Please check the given URL and try again.");let a=ke.fromReadableStream(s.body),i=new TextDecoder,o="";for await(let l of a){let u=(o+i.decode(l)).split(`
`);o=u.pop()||"";for(let d of u)try{yield JSON.parse(d)}catch{console.warn(`Received a non-JSON parseable chunk: ${d}`)}}}async function*Qw(n,e,t){yield*Xw(`${n}/api/generate`,e,t)}async function*e_(n,e,t){yield*Xw(`${n}/api/chat`,e,t)}var nu=class extends ru{static lc_name(){return"ChatOllama"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"llama2"}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:"http://localhost:11434"}),Object.defineProperty(this,"keepAlive",{enumerable:!0,configurable:!0,writable:!0,value:"5m"}),Object.defineProperty(this,"embeddingOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"f16KV",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitsAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowVram",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mainGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatEta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatTau",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numBatch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numCtx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGqa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numKeep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numPredict",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numThread",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"penalizeNewline",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatLastN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ropeFrequencyBase",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ropeFrequencyScale",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tfsZ",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typicalP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMLock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMMap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vocabOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e.model??this.model,this.baseUrl=e.baseUrl?.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl??this.baseUrl,this.keepAlive=e.keepAlive??this.keepAlive,this.embeddingOnly=e.embeddingOnly,this.f16KV=e.f16KV,this.frequencyPenalty=e.frequencyPenalty,this.headers=e.headers,this.logitsAll=e.logitsAll,this.lowVram=e.lowVram,this.mainGpu=e.mainGpu,this.mirostat=e.mirostat,this.mirostatEta=e.mirostatEta,this.mirostatTau=e.mirostatTau,this.numBatch=e.numBatch,this.numCtx=e.numCtx,this.numGpu=e.numGpu,this.numGqa=e.numGqa,this.numKeep=e.numKeep,this.numPredict=e.numPredict,this.numThread=e.numThread,this.penalizeNewline=e.penalizeNewline,this.presencePenalty=e.presencePenalty,this.repeatLastN=e.repeatLastN,this.repeatPenalty=e.repeatPenalty,this.ropeFrequencyBase=e.ropeFrequencyBase,this.ropeFrequencyScale=e.ropeFrequencyScale,this.temperature=e.temperature,this.stop=e.stop,this.tfsZ=e.tfsZ,this.topK=e.topK,this.topP=e.topP,this.typicalP=e.typicalP,this.useMLock=e.useMLock,this.useMMap=e.useMMap,this.vocabOnly=e.vocabOnly,this.format=e.format}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"ollama",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.temperature??void 0,ls_stop:this.stop,ls_max_tokens:t.options.num_predict}}_llmType(){return"ollama"}invocationParams(e){return{model:this.model,format:this.format,keep_alive:this.keepAlive,options:{embedding_only:this.embeddingOnly,f16_kv:this.f16KV,frequency_penalty:this.frequencyPenalty,logits_all:this.logitsAll,low_vram:this.lowVram,main_gpu:this.mainGpu,mirostat:this.mirostat,mirostat_eta:this.mirostatEta,mirostat_tau:this.mirostatTau,num_batch:this.numBatch,num_ctx:this.numCtx,num_gpu:this.numGpu,num_gqa:this.numGqa,num_keep:this.numKeep,num_predict:this.numPredict,num_thread:this.numThread,penalize_newline:this.penalizeNewline,presence_penalty:this.presencePenalty,repeat_last_n:this.repeatLastN,repeat_penalty:this.repeatPenalty,rope_frequency_base:this.ropeFrequencyBase,rope_frequency_scale:this.ropeFrequencyScale,temperature:this.temperature,stop:e?.stop??this.stop,tfs_z:this.tfsZ,top_k:this.topK,top_p:this.topP,typical_p:this.typicalP,use_mlock:this.useMLock,use_mmap:this.useMMap,vocab_only:this.vocabOnly}}}_combineLLMOutput(){return{}}async*_streamResponseChunksLegacy(e,t,r){let s=Qw(this.baseUrl,{...this.invocationParams(t),prompt:this._formatMessagesAsPrompt(e)},{...t,headers:this.headers});for await(let a of s)a.done?yield new Ne({text:"",message:new he({content:""}),generationInfo:{model:a.model,total_duration:a.total_duration,load_duration:a.load_duration,prompt_eval_count:a.prompt_eval_count,prompt_eval_duration:a.prompt_eval_duration,eval_count:a.eval_count,eval_duration:a.eval_duration}}):(yield new Ne({text:a.response,message:new he({content:a.response})}),await r?.handleLLMNewToken(a.response??""))}async*_streamResponseChunks(e,t,r){try{let s=await this.caller.call(async()=>e_(this.baseUrl,{...this.invocationParams(t),messages:this._convertMessagesToOllamaMessages(e)},{...t,headers:this.headers}));for await(let a of s)a.done?yield new Ne({text:"",message:new he({content:""}),generationInfo:{model:a.model,total_duration:a.total_duration,load_duration:a.load_duration,prompt_eval_count:a.prompt_eval_count,prompt_eval_duration:a.prompt_eval_duration,eval_count:a.eval_count,eval_duration:a.eval_duration}}):(yield new Ne({text:a.message.content,message:new he({content:a.message.content})}),await r?.handleLLMNewToken(a.message.content??""))}catch(s){if(s.response?.status===404)console.warn("[WARNING]: It seems you are using a legacy version of Ollama. Please upgrade to a newer version for better chat support."),yield*this._streamResponseChunksLegacy(e,t,r);else throw s}}_convertMessagesToOllamaMessages(e){return e.map(t=>{let r;if(t._getType()==="human")r="user";else if(t._getType()==="ai")r="assistant";else if(t._getType()==="system")r="system";else throw new Error(`Unsupported message type for Ollama: ${t._getType()}`);let s="",a=[];if(typeof t.content=="string")s=t.content;else for(let i of t.content)if(i.type==="text")s=`${s}
${i.text}`;else if(i.type==="image_url"&&typeof i.image_url=="string"){let o=i.image_url.split(",");a.push(o[1]??o[0])}else throw new Error('Unsupported message content type. Must either have type "text" or type "image_url" with a string "image_url" field.');return{role:r,content:s,images:a}})}_formatMessagesAsPrompt(e){return e.map(r=>{let s;return r._getType()==="human"?s=`[INST] ${r.content} [/INST]`:r._getType()==="ai"?s=r.content:r._getType()==="system"?s=`<<SYS>> ${r.content} <</SYS>>`:De.isInstance(r)?s=`

${r.role[0].toUpperCase()}${r.role.slice(1)}: ${r.content}`:(console.warn(`Unsupported message type passed to Ollama: "${r._getType()}"`),s=""),s}).join(`
`)}async _call(e,t,r){let s=[];for await(let a of this._streamResponseChunks(e,t,r))s.push(a.message.content);return s.join("")}};ya();_s();var Af=class extends vt{addUserMessage(e){return this.addMessage(new Ie(e))}addAIChatMessage(e){return this.addMessage(new ce(e))}addAIMessage(e){return this.addMessage(new ce(e))}async addMessages(e){for(let t of e)await this.addMessage(t)}clear(){throw new Error("Not implemented.")}},Mo=class extends Af{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}};Ut();ws();Ut();ws();Ut();ws();ur();_s();Ut();var jo=class extends dr{constructor(e){let t=pr.from((i,o)=>this._enterHistory(i,o??{})).withConfig({runName:"loadHistory"}),r=e.historyMessagesKey??e.inputMessagesKey;r&&(t=qe.assign({[r]:t}).withConfig({runName:"insertHistory"}));let s=t.pipe(e.runnable.withListeners({onEnd:(i,o)=>this._exitHistory(i,o??{})})).withConfig({runName:"RunnableWithMessageHistory"}),a=e.config??{};super({...e,config:a,bound:s}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"historyMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getMessageHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if(typeof e=="object"&&!Array.isArray(e)&&!pt(e)){let r;this.inputMessagesKey?r=this.inputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="input",Array.isArray(e[r])&&Array.isArray(e[r][0])?t=e[r][0]:t=e[r]}else t=e;if(typeof t=="string")return[new Ie(t)];if(Array.isArray(t))return t;if(pt(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(!Array.isArray(e)&&!pt(e)&&typeof e!="string"){let r;this.outputMessagesKey!==void 0?r=this.outputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="output",e.generations!==void 0?t=e.generations[0][0].message:t=e[r]}else t=e;if(typeof t=="string")return[new ce(t)];if(Array.isArray(t))return t;if(pt(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){let s=await(t?.configurable?.messageHistory).getMessages();return this.historyMessagesKey===void 0?s.concat(this._getInputMessages(e)):s}async _exitHistory(e,t){let r=t.configurable?.messageHistory,s;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?s=e.inputs[0]:s=e.inputs;let a=this._getInputMessages(s);if(this.historyMessagesKey===void 0){let l=await r.getMessages();a=a.slice(l.length)}let i=e.outputs;if(!i)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);let o=this._getOutputMessages(i);await r.addMessages([...a,...o])}async _mergeConfig(...e){let t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){let s={[this.inputMessagesKey??"input"]:"foo"},a={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(s)}, ${JSON.stringify(a)})`)}let{sessionId:r}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(r),t}};var Lo=class extends re{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,s)=>this.parseResult([{text:r}],s?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,s)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],s?.callbacks),e,{...t,runType:"parser"})}},ja=class extends Lo{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}},mr=class extends Error{constructor(e,t,r,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=s,s&&(r===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}};Gt();un();ka();function Fo(n,e){let t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;let r=n.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!Fo(n[s],e[s]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;let r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(let i of r)if(!Fo(n[i],e[i]))return!1;return!0}return n===e}var H2=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");var vT=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,xT=[0,31,28,31,30,31,30,31,31,30,31,30,31],AT=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,ET=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,IT=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,OT=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,TT=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,CT=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,PT=/^(?:\/(?:[^~/]|~0|~1)*)*$/,ST=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,RT=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,kT=/^\d\d\d\d-[0-1]\d-[0-3]\d$/,NT=/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,$T=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,MT=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,jT=n=>{if(n[0]==='"')return!1;let[e,t,...r]=n.split("@");return!e||!t||r.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},LT=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,FT=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,DT=n=>n.length>1&&n.length<80&&(/^P\d+([.,]\d+)?W$/.test(n)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(n)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(n));function yt(n){return n.test.bind(n)}var UT={date:t_,time:r_.bind(void 0,!1),"date-time":HT,duration:DT,uri:KT,"uri-reference":yt(IT),"uri-template":yt(OT),url:yt(TT),email:jT,hostname:yt(ET),ipv4:yt(LT),ipv6:yt(FT),regex:JT,uuid:yt(CT),"json-pointer":yt(PT),"json-pointer-uri-fragment":yt(ST),"relative-json-pointer":yt(RT)},BT={...UT,date:yt(kT),time:yt(NT),"date-time":yt($T),"uri-reference":yt(MT)};function zT(n){return n%4===0&&(n%100!==0||n%400===0)}function t_(n){let e=n.match(vT);if(!e)return!1;let t=+e[1],r=+e[2],s=+e[3];return r>=1&&r<=12&&s>=1&&s<=(r==2&&zT(t)?29:xT[r])}function r_(n,e){let t=e.match(AT);if(!t)return!1;let r=+t[1],s=+t[2],a=+t[3],i=!!t[5];return(r<=23&&s<=59&&a<=59||r==23&&s==59&&a==60)&&(!n||i)}var qT=/t|\s/i;function HT(n){let e=n.split(qT);return e.length==2&&t_(e[0])&&r_(!0,e[1])}var VT=/\/|:/,GT=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function KT(n){return VT.test(n)&&GT.test(n)}var WT=/[^\\]\\Z/;function JT(n){if(WT.test(n))return!1;try{return new RegExp(n),!0}catch{return!1}}var xs=class extends ja{async*_transform(e){for await(let t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},As=class extends xs{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let t,r;for await(let s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let a;if(Ig(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Ne({message:s,text:s.content})}else if(pt(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");a=new Ne({message:Jd(s),text:s.content})}else a=new Jt({text:s});r===void 0?r=a:r=r.concat(a);let i=await this.parsePartialResult([r]);i!=null&&!Fo(i,t)&&(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}};var Do=class extends xs{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((t,r)=>t+this._messageContentComplexToString(r),"")}};as();$r();var La=class extends ja{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){let t=ut.object(Object.fromEntries(Object.entries(e).map(([r,s])=>[r,ut.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(We(this.schema))}
\`\`\`
`}async parse(e){try{let r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(r))}catch(t){throw new mr(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}};Hp();Vd();var Fa=class extends As{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?$c(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return Hd(e[0].text)}async parse(e){return Hd(e,JSON.parse)}getFormatInstructions(){return""}};Da();Ko();jf();Da();Ko();qa();Uo();za();Cf();Ko();var c_=["user","model","function","system"],u_;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(u_||(u_={}));var d_;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(d_||(d_={}));var p_;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(p_||(p_={}));var f_;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(f_||(f_={}));var lu;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.OTHER="OTHER"})(lu||(lu={}));var h_;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(h_||(h_={}));var m_;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(m_||(m_={}));var g_;(function(n){n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT"})(g_||(g_={}));var it=class extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}},gn=class extends it{constructor(e,t){super(e),this.response=t}};var _C="https://generativelanguage.googleapis.com",vC="v1beta",xC="0.7.1",AC="genai-js",Os;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Os||(Os={}));var cu=class{constructor(e,t,r,s,a){this.model=e,this.task=t,this.apiKey=r,this.stream=s,this.requestOptions=a}toString(){var e,t;let r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||vC,a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||_C}/${r}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}};function EC(n){let e=[];return n?.apiClient&&e.push(n.apiClient),e.push(`${AC}/${xC}`),e.join(" ")}async function IC(n){let e=new Headers;return e.append("Content-Type","application/json"),e.append("x-goog-api-client",EC(n.requestOptions)),e.append("x-goog-api-key",n.apiKey),e}async function OC(n,e,t,r,s,a){let i=new cu(n,e,t,r,a);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},CC(a)),{method:"POST",headers:await IC(i),body:s})}}async function Yo(n,e,t,r,s,a){return TC(n,e,t,r,s,a,fetch)}async function TC(n,e,t,r,s,a,i=fetch){let o=new cu(n,e,t,r,a),l;try{let c=await OC(n,e,t,r,s,a);if(l=await i(c.url,c.fetchOptions),!l.ok){let u="";try{let d=await l.json();u=d.error.message,d.error.details&&(u+=` ${JSON.stringify(d.error.details)}`)}catch{}throw new Error(`[${l.status} ${l.statusText}] ${u}`)}}catch(c){let u=new it(`Error fetching from ${o.toString()}: ${c.message}`);throw u.stack=c.stack,u}return l}function CC(n){let e={};if(n?.timeout>=0){let t=new AbortController,r=t.signal;setTimeout(()=>t.abort(),n.timeout),e.signal=r}return e}function Uf(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),ou(n.candidates[0]))throw new gn(`${yn(n)}`,n);return PC(n)}else if(n.promptFeedback)throw new gn(`Text not available. ${yn(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ou(n.candidates[0]))throw new gn(`${yn(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),y_(n)[0]}else if(n.promptFeedback)throw new gn(`Function call not available. ${yn(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),ou(n.candidates[0]))throw new gn(`${yn(n)}`,n);return y_(n)}else if(n.promptFeedback)throw new gn(`Function call not available. ${yn(n)}`,n)},n}function PC(n){var e,t,r,s;return!((s=(r=(t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0?void 0:t.parts)===null||r===void 0?void 0:r[0])===null||s===void 0)&&s.text?n.candidates[0].content.parts.map(({text:a})=>a).join(""):""}function y_(n){var e,t,r,s;let a=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(let i of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)i.functionCall&&a.push(i.functionCall);if(a.length>0)return a}var SC=[lu.RECITATION,lu.SAFETY];function ou(n){return!!n.finishReason&&SC.includes(n.finishReason)}function yn(n){var e,t,r;let s="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)s+="Response was blocked",!((e=n.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${n.promptFeedback.blockReason}`),!((t=n.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((r=n.candidates)===null||r===void 0)&&r[0]){let a=n.candidates[0];ou(a)&&(s+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(s+=`: ${a.finishMessage}`))}return s}function Wo(n){return this instanceof Wo?(this.v=n,this):new Wo(n)}function RC(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,a=[];return s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(p){r[p]&&(s[p]=function(f){return new Promise(function(h,m){a.push([p,f,h,m])>1||o(p,f)})})}function o(p,f){try{l(r[p](f))}catch(h){d(a[0][3],h)}}function l(p){p.value instanceof Wo?Promise.resolve(p.value.v).then(c,u):d(a[0][2],p)}function c(p){o("next",p)}function u(p){o("throw",p)}function d(p,f){p(f),a.shift(),a.length&&o(a[0][0],a[0][1])}}var b_=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function kC(n){let e=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=MC(e),[r,s]=t.tee();return{stream:$C(r),response:NC(s)}}async function NC(n){let e=[],t=n.getReader();for(;;){let{done:r,value:s}=await t.read();if(r)return Uf(jC(e));e.push(s)}}function $C(n){return RC(this,arguments,function*(){let t=n.getReader();for(;;){let{value:r,done:s}=yield Wo(t.read());if(s)break;yield yield Wo(Uf(r))}})}function MC(n){let e=n.getReader();return new ReadableStream({start(r){let s="";return a();function a(){return e.read().then(({value:i,done:o})=>{if(o){if(s.trim()){r.error(new it("Failed to parse stream"));return}r.close();return}s+=i;let l=s.match(b_),c;for(;l;){try{c=JSON.parse(l[1])}catch{r.error(new it(`Error parsing JSON response: "${l[1]}"`));return}r.enqueue(c),s=s.substring(l[0].length),l=s.match(b_)}return a()})}}})}function jC(n){let e=n[n.length-1],t={promptFeedback:e?.promptFeedback};for(let r of n)if(r.candidates)for(let s of r.candidates){let a=s.index;if(t.candidates||(t.candidates=[]),t.candidates[a]||(t.candidates[a]={index:s.index}),t.candidates[a].citationMetadata=s.citationMetadata,t.candidates[a].finishReason=s.finishReason,t.candidates[a].finishMessage=s.finishMessage,t.candidates[a].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[a].content||(t.candidates[a].content={role:s.content.role||"user",parts:[]});let i={};for(let o of s.content.parts)o.text&&(i.text=o.text),o.functionCall&&(i.functionCall=o.functionCall),Object.keys(i).length===0&&(i.text=""),t.candidates[a].content.parts.push(i)}}return t}async function x_(n,e,t,r){let s=await Yo(e,Os.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(t),r);return kC(s)}async function A_(n,e,t,r){let a=await(await Yo(e,Os.GENERATE_CONTENT,n,!1,JSON.stringify(t),r)).json();return{response:Uf(a)}}function uu(n){let e=[];if(typeof n=="string")e=[{text:n}];else for(let t of n)typeof t=="string"?e.push({text:t}):e.push(t);return LC(e)}function LC(n){let e={role:"user",parts:[]},t={role:"function",parts:[]},r=!1,s=!1;for(let a of n)"functionResponse"in a?(t.parts.push(a),s=!0):(e.parts.push(a),r=!0);if(r&&s)throw new it("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new it("No content is provided for sending chat message.");return r?e:t}function Lf(n){return n.contents?n:{contents:[uu(n)]}}function FC(n){return typeof n=="string"||Array.isArray(n)?{content:uu(n)}:n}var w_=["text","inlineData","functionCall","functionResponse"],DC={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall"],system:["text"]},__={user:["model"],function:["model"],model:["user","function"],system:[]};function UC(n){let e;for(let t of n){let{role:r,parts:s}=t;if(!e&&r!=="user")throw new it(`First content should be with role 'user', got ${r}`);if(!c_.includes(r))throw new it(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(c_)}`);if(!Array.isArray(s))throw new it("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new it("Each Content should have at least one part");let a={text:0,inlineData:0,functionCall:0,functionResponse:0};for(let o of s)for(let l of w_)l in o&&(a[l]+=1);let i=DC[r];for(let o of w_)if(!i.includes(o)&&a[o]>0)throw new it(`Content with role '${r}' can't contain '${o}' part`);if(e&&!__[r].includes(e.role))throw new it(`Content with role '${r}' can't follow '${e.role}'. Valid previous roles: ${JSON.stringify(__)}`);e=t}}var v_="SILENT_ERROR",Ff=class{constructor(e,t,r,s){this.model=t,this.params=r,this.requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r?.history&&(UC(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,r,s,a,i;await this._sendPromise;let o=uu(e),l={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(i=this.params)===null||i===void 0?void 0:i.systemInstruction,contents:[...this._history,o]},c;return this._sendPromise=this._sendPromise.then(()=>A_(this._apiKey,this.model,l,this.requestOptions)).then(u=>{var d;if(u.response.candidates&&u.response.candidates.length>0){this._history.push(o);let p=Object.assign({parts:[],role:"model"},(d=u.response.candidates)===null||d===void 0?void 0:d[0].content);this._history.push(p)}else{let p=yn(u.response);p&&console.warn(`sendMessage() was unsuccessful. ${p}. Inspect response object for details.`)}c=u}),await this._sendPromise,c}async sendMessageStream(e){var t,r,s,a,i;await this._sendPromise;let o=uu(e),l={safetySettings:(t=this.params)===null||t===void 0?void 0:t.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(i=this.params)===null||i===void 0?void 0:i.systemInstruction,contents:[...this._history,o]},c=x_(this._apiKey,this.model,l,this.requestOptions);return this._sendPromise=this._sendPromise.then(()=>c).catch(u=>{throw new Error(v_)}).then(u=>u.response).then(u=>{if(u.candidates&&u.candidates.length>0){this._history.push(o);let d=Object.assign({},u.candidates[0].content);d.role||(d.role="model"),this._history.push(d)}else{let d=yn(u);d&&console.warn(`sendMessageStream() was unsuccessful. ${d}. Inspect response object for details.`)}}).catch(u=>{u.message!==v_&&console.error(u)}),c}};async function BC(n,e,t,r){return(await Yo(e,Os.COUNT_TOKENS,n,!1,JSON.stringify(Object.assign(Object.assign({},t),{model:e})),r)).json()}async function zC(n,e,t,r){return(await Yo(e,Os.EMBED_CONTENT,n,!1,JSON.stringify(t),r)).json()}async function qC(n,e,t,r){let s=t.requests.map(i=>Object.assign(Object.assign({},i),{model:e}));return(await Yo(e,Os.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:s}),r)).json()}var Df=class{constructor(e,t,r){this.apiKey=e,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=t.systemInstruction,this.requestOptions=r||{}}async generateContent(e){let t=Lf(e);return A_(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},t),this.requestOptions)}async generateContentStream(e){let t=Lf(e);return x_(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},t),this.requestOptions)}startChat(e){return new Ff(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction},e),this.requestOptions)}async countTokens(e){let t=Lf(e);return BC(this.apiKey,this.model,t,this.requestOptions)}async embedContent(e){let t=FC(e);return zC(this.apiKey,this.model,t,this.requestOptions)}async batchEmbedContents(e){return qC(this.apiKey,this.model,e,this.requestOptions)}};var Jo=class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new it("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Df(this.apiKey,e,t)}};Oa();$r();function E_(n){let e={...n};if(Object.hasOwn(e,"additionalProperties")&&delete e.additionalProperties,e.properties){let t=Object.keys(e.properties);I_(e.properties,t,0)}return e}function I_(n,e,t){if(t>=e.length||!n)return;let r=e[t];n[r]=E_(n[r]),I_(n,e,t+1)}function du(n){let e=E_(We(n)),{$schema:t,...r}=e;return r}$r();Ut();function O_(n,e){let t=typeof e=="number"?void 0:e;return{name:n.name,description:n.description,parameters:We(n.schema),...t?.strict!==void 0?{strict:t.strict}:{}}}function Va(n,e){let t=typeof e=="number"?void 0:e,r;return GC(n)?r={type:"function",function:O_(n)}:r=n,t?.strict!==void 0&&(r.function.strict=t.strict),r}function Bf(n){return n!==void 0&&Array.isArray(n.lc_namespace)}function HC(n){return n!==void 0&&re.isRunnable(n)&&"lc_name"in n.constructor&&typeof n.constructor.lc_name=="function"&&n.constructor.lc_name()==="RunnableToolLike"}function VC(n){return!!n&&typeof n=="object"&&"name"in n&&"schema"in n&&hr(n.schema)}function GC(n){return VC(n)||HC(n)||Bf(n)}function KC(n){let e=n._getType();return De.isInstance(n)?n.role:n.name??e}function WC(n){switch(n){case"ai":case"model":return"model";case"system":case"human":return"user";default:throw new Error(`Unknown / unsupported author: ${n}`)}}function JC(n){if("mimeType"in n&&"data"in n)return{inlineData:{mimeType:n.mimeType,data:n.data}};throw new Error("Invalid media content")}function YC(n,e){return typeof n=="string"?[{text:n}]:n.map(t=>{if(t.type==="text")return{text:t.text};if(t.type==="image_url"){if(!e)throw new Error("This model does not support images");let r;if(typeof t.image_url=="string")r=t.image_url;else if(typeof t.image_url=="object"&&"url"in t.image_url)r=t.image_url.url;else throw new Error("Please provide image as base64 encoded data URL");let[s,a]=r.split(",");if(!s.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");let[i,o]=s.replace(/^data:/,"").split(";");if(o!=="base64")throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:a,mimeType:i}}}else if(t.type==="media")return JC(t);throw new Error(`Unknown content type ${t.type}`)})}function zf(n,e){return n.reduce((t,r,s)=>{if(!pt(r))throw new Error("Unsupported message input");let a=KC(r);if(a==="system"&&s!==0)throw new Error("System message should be the first one");let i=WC(a),o=t.content[t.content.length];if(!t.mergeWithPreviousContent&&o&&o.role===i)throw new Error("Google Generative AI requires alternate messages between authors");let l=YC(r.content,e);if(t.mergeWithPreviousContent){let u=t.content[t.content.length-1];if(!u)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return u.parts.push(...l),{mergeWithPreviousContent:!1,content:t.content}}let c={role:i,parts:l};return{mergeWithPreviousContent:a==="system",content:[...t.content,c]}},{content:[],mergeWithPreviousContent:!1}).content}function T_(n){if(!n.candidates||n.candidates.length===0||!n.candidates[0])return{generations:[],llmOutput:{filters:n.promptFeedback}};let e=n.functionCalls(),[t]=n.candidates,{content:r,...s}=t,a=r?.parts[0]?.text??"";return{generations:[{text:a,message:new ce({content:a,tool_calls:e,additional_kwargs:{...s}}),generationInfo:s}]}}function C_(n){if(!n.candidates||n.candidates.length===0)return null;let[e]=n.candidates,{content:t,...r}=e,s=t?.parts[0]?.text??"";return new Ne({text:s,message:new he({content:s,name:t?t.role:void 0,additional_kwargs:{}}),generationInfo:r})}function qf(n){return n.every(e=>"functionDeclarations"in e&&Array.isArray(e.functionDeclarations))?n:[{functionDeclarations:n.map(e=>{if(Bf(e)){let t=du(e.schema);return{name:e.name,description:e.description,parameters:t}}return e})}]}var Zo=class extends Lo{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new mr(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){let t=e.flatMap(a=>{let{message:i}=a;return!("tool_calls"in i)||!Array.isArray(i.tool_calls)?[]:i.tool_calls});if(t[0]===void 0)throw new Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");let[r]=t;return await this._validateResult(r.args)}};var pu=class extends Vr{static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modelName=e?.model?.replace(/^models\//,"")??e?.modelName?.replace(/^models\//,"")??this.model,this.model=this.modelName,this.maxOutputTokens=e?.maxOutputTokens??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=e?.temperature??this.temperature,this.temperature&&(this.temperature<0||this.temperature>1))throw new Error("`temperature` must be in the range of [0.0,1.0]");if(this.topP=e?.topP??this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=e?.topK??this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=e?.stopSequences??this.stopSequences,this.apiKey=e?.apiKey??ne("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=e?.safetySettings??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(r=>r.category)).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=e?.streaming??this.streaming,this.client=new Jo(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{candidateCount:1,stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK}},{apiVersion:e?.apiVersion,baseUrl:e?.baseUrl})}getLsParams(e){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:e.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(e,t){return this.bind({tools:qf(e),...t})}invocationParams(e){let t=e?.tools;return Array.isArray(t)&&!t.some(r=>!("lc_namespace"in r))?{tools:qf(e?.tools)}:{tools:e?.tools}}async _generate(e,t,r){let s=zf(e,this._isMultimodalModel),a=this.invocationParams(t);if(this.streaming){let l={},c=this._streamResponseChunks(e,t,r),u={};for await(let p of c){let f=p.generationInfo?.completion??0;u[f]===void 0?u[f]=p:u[f]=u[f].concat(p)}return{generations:Object.entries(u).sort(([p],[f])=>parseInt(p,10)-parseInt(f,10)).map(([p,f])=>f),llmOutput:{estimatedTokenUsage:l}}}let i=await this.caller.callWithOptions({signal:t?.signal},async()=>{let l;try{l=await this.client.generateContent({...a,contents:s})}catch(c){throw c.message?.includes("400 Bad Request")&&(c.status=400),c}return l}),o=T_(i.response);return await r?.handleLLMNewToken(o.generations[0].text??""),o}async*_streamResponseChunks(e,t,r){let s=zf(e,this._isMultimodalModel),a=this.invocationParams(t),i=await this.caller.callWithOptions({signal:t?.signal},async()=>{let{stream:o}=await this.client.generateContentStream({...a,contents:s});return o});for await(let o of i){let l=C_(o);l&&(yield l,await r?.handleLLMNewToken(l.text??""))}}withStructuredOutput(e,t){let r=e,s=t?.name,a=t?.method,i=t?.includeRaw;if(a==="jsonMode")throw new Error('ChatGoogleGenerativeAI only supports "functionCalling" as a method.');let o=s??"extract",l,c;if(hr(r)){let h=du(r);c=[{functionDeclarations:[{name:o,description:h.description??"A function available to call.",parameters:h}]}],l=new Zo({returnSingle:!0,keyName:o,zodSchema:r})}else{let h;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(h=r,o=r.name):h={name:o,description:r.description??"",parameters:r},c=[{functionDeclarations:[h]}],l=new Zo({returnSingle:!0,keyName:o})}let u=this.bind({tools:c});if(!i)return u.pipe(l).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});let d=qe.assign({parsed:(h,m)=>l.invoke(h.raw,m)}),p=qe.assign({parsed:()=>null}),f=d.withFallbacks({fallbacks:[p]});return xt.from([{raw:u},f]).withConfig({runName:"StructuredOutputRunnable"})}};Oo();$r();var Ts="0.3.3";var S_=!1,Cs,Hf,XC,QC,eP,Vf,tP,fu,Gf,Kf,Wf,hu,Jf;function R_(n,e={auto:!1}){if(S_)throw new Error(`you must \`import 'groq-sdk/shims/${n.kind}'\` before importing anything else from groq-sdk`);if(Cs)throw new Error(`can't \`import 'groq-sdk/shims/${n.kind}'\` after \`import 'groq-sdk/shims/${Cs}'\``);S_=e.auto,Cs=n.kind,Hf=n.fetch,XC=n.Request,QC=n.Response,eP=n.Headers,Vf=n.FormData,tP=n.Blob,fu=n.File,Gf=n.ReadableStream,Kf=n.getMultipartRequestOptions,Wf=n.getDefaultAgent,hu=n.fileFromPath,Jf=n.isFsReadStream}var mu=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function k_({manuallyImported:n}={}){let e=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'groq-sdk'`:\n- `import 'groq-sdk/shims/node'` (if you're running on Node)\n- `import 'groq-sdk/shims/web'` (otherwise)\n",t,r,s,a;try{t=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new mu(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:i=>!1}}Cs||R_(k_(),{auto:!0});var Yf={};Yi(Yf,{APIConnectionError:()=>Wr,APIConnectionTimeoutError:()=>Ps,APIError:()=>Te,APIUserAbortError:()=>bn,AuthenticationError:()=>Ka,BadRequestError:()=>Ga,ConflictError:()=>Ya,GroqError:()=>Me,InternalServerError:()=>Qa,NotFoundError:()=>Ja,PermissionDeniedError:()=>Wa,RateLimitError:()=>Xa,UnprocessableEntityError:()=>Za});var Me=class extends Error{},Te=class n extends Me{constructor(e,t,r,s){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,r){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e)return new Wr({cause:gu(t)});let a=t;return e===400?new Ga(e,a,r,s):e===401?new Ka(e,a,r,s):e===403?new Wa(e,a,r,s):e===404?new Ja(e,a,r,s):e===409?new Ya(e,a,r,s):e===422?new Za(e,a,r,s):e===429?new Xa(e,a,r,s):e>=500?new Qa(e,a,r,s):new n(e,a,r,s)}},bn=class extends Te{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Wr=class extends Te{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},Ps=class extends Wr{constructor({message:e}={}){super({message:e??"Request timed out."})}},Ga=class extends Te{constructor(){super(...arguments),this.status=400}},Ka=class extends Te{constructor(){super(...arguments),this.status=401}},Wa=class extends Te{constructor(){super(...arguments),this.status=403}},Ja=class extends Te{constructor(){super(...arguments),this.status=404}},Ya=class extends Te{constructor(){super(...arguments),this.status=409}},Za=class extends Te{constructor(){super(...arguments),this.status=422}},Xa=class extends Te{constructor(){super(...arguments),this.status=429}},Qa=class extends Te{};var yu=class n{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1,s=new Zf;async function*a(){if(!e.body)throw t.abort(),new Me("Attempted to iterate over a response with no body");let o=new ei,l=N_(e.body);for await(let c of l)for(let u of o.decode(c)){let d=s.decode(u);d&&(yield d)}for(let c of o.flush()){let u=s.decode(c);u&&(yield u)}}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(let l of a())if(!o){if(l.data.startsWith("[DONE]")){o=!0;continue}if(l.event===null){let c;try{c=JSON.parse(l.data)}catch(u){throw console.error("Could not parse message into JSON:",l.data),console.error("From chunk:",l.raw),u}if(c&&c.error)throw new Te(void 0,c.error,void 0,void 0);yield c}}o=!0}catch(l){if(l instanceof Error&&l.name==="AbortError")return;throw l}finally{o||t.abort()}}return new n(i,t)}static fromReadableStream(e,t){let r=!1;async function*s(){let i=new ei,o=N_(e);for await(let l of o)for(let c of i.decode(l))yield c;for(let l of i.flush())yield l}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new n(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){let i=r.next();e.push(i),t.push(i)}return a.shift()}});return[new n(()=>s(e),this.controller),new n(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new Gf({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:a,done:i}=await t.next();if(i)return s.close();let o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){await t.return?.()}})}},Zf=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=nP(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}},ei=class n{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=n.NEWLINE_CHARS.has(t[t.length-1]||""),s=t.split(n.NEWLINE_REGEXP);return s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Me(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Me(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Me("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};ei.NEWLINE_CHARS=new Set([`
`,"\r","\v","\f","","","","\x85","\u2028","\u2029"]);ei.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;function nP(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function N_(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var $_=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",sP=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&M_(n),M_=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",aP=n=>sP(n)||$_(n)||Jf(n);async function eh(n,e,t={}){if(n=await n,$_(n)){let s=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new fu([s],e,t)}let r=await iP(n);if(e||(e=lP(n)??"unknown_file"),!t.type){let s=r[0]?.type;typeof s=="string"&&(t={...t,type:s})}return new fu(r,e,t)}async function iP(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(M_(n))e.push(await n.arrayBuffer());else if(cP(n))for await(let t of n)e.push(t);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${n?.constructor?.name}; props: ${oP(n)}`);return e}function oP(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function lP(n){return Xf(n.name)||Xf(n.filename)||Xf(n.path)?.split(/[\\/]/).pop()}var Xf=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},cP=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",th=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var Xo=async n=>{let e=await j_(n.body);return Kf(e,n)},j_=async n=>{let e=new Vf;return await Promise.all(Object.entries(n||{}).map(([t,r])=>Qf(e,t,r))),e};var Qf=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(aP(t)){let r=await eh(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>Qf(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>Qf(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var dP=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},pP=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},bu;async function z_(n){let{response:e}=n;if(n.options.stream)return ti("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):yu.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let t=e.headers.get("content-type");if(t?.includes("application/json")||t?.includes("application/vnd.api+json")){let a=await e.json();return ti("response",e.status,e.url,e.headers,a),a}let s=await e.text();return ti("response",e.status,e.url,e.headers,s),s}var wu=class n extends Promise{constructor(e,t=z_){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new n(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},_u=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e4,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=rh("maxRetries",t),this.timeout=rh("timeout",r),this.httpAgent=s,this.fetch=a??Hf}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...gP(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${AP()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(s=>({method:e,path:t,...s})))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}return null}buildRequest(e){let{method:t,path:r,query:s,headers:a={}}=e,i=th(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(i),l=this.buildURL(r,s);"timeout"in e&&rh("timeout",e.timeout);let c=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??Wf(l),d=c+1e3;typeof u?.options?.timeout=="number"&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let p=this.buildHeaders({options:e,headers:a,contentLength:o});return{req:{method:t,...i&&{body:i},headers:p,...u&&{agent:u},signal:e.signal??null},url:l,timeout:c}}buildHeaders({options:e,headers:t,contentLength:r}){let s={};r&&(s["content-length"]=r);let a=this.defaultHeaders(e);return B_(s,a),B_(s,t),th(e.body)&&Cs!=="node"&&delete s["content-type"],this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return Te.generate(e,t,r,s)}request(e,t=null){return new wu(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e;t==null&&(t=r.maxRetries??this.maxRetries),await this.prepareOptions(r);let{req:s,url:a,timeout:i}=this.buildRequest(r);if(await this.prepareRequest(s,{url:a,options:r}),ti("request",a,r,s.headers),r.signal?.aborted)throw new bn;let o=new AbortController,l=await this.fetchWithTimeout(a,s,i,o).catch(gu);if(l instanceof Error){if(r.signal?.aborted)throw new bn;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new Ps:new Wr({cause:l})}let c=fP(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let m=`retrying, ${t} attempts remaining`;return ti(`response (error; ${m})`,l.status,a,c),this.retryRequest(r,t,c)}let u=await l.text().catch(m=>gu(m).message),d=yP(u),p=d?void 0:u;throw ti(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,c,p),this.makeStatusError(l.status,d,p,c)}return{response:l,options:r,controller:o}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new nh(this,r,e)}buildURL(e,t){let r=wP(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return vP(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Me(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){let{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...i}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s,a=r?.["retry-after-ms"];if(a){let o=parseFloat(a);Number.isNaN(o)||(s=o)}let i=r?.["retry-after"];if(i&&!s){let o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){let o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await _P(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ts}`}},L_=class{constructor(e,t,r,s){bu.set(this,void 0),dP(this,bu,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new Me("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,a]of r)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await pP(this,bu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(bu=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},nh=class extends wu{constructor(e,t,r){super(t,async s=>new r(e,s.response,await z_(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},fP=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}});var hP=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ts,"X-Stainless-OS":D_(Deno.build.os),"X-Stainless-Arch":F_(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":Deno.version};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ts,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ts,"X-Stainless-OS":D_(process.platform),"X-Stainless-Arch":F_(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let n=mP();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ts,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ts,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function mP(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}var F_=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",D_=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),U_,gP=()=>U_??(U_=hP()),yP=n=>{try{return JSON.parse(n)}catch{return}},bP=new RegExp("^(?:[a-z]+:)?//","i"),wP=n=>bP.test(n),_P=n=>new Promise(e=>setTimeout(e,n)),rh=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Me(`${n} must be an integer`);if(e<0)throw new Me(`${n} must be a positive integer`);return e},gu=n=>n instanceof Error?n:new Error(n);var sh=n=>{if(typeof process<"u")return process.env?.[n]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(n)?.trim()};function vP(n){if(!n)return!0;for(let e in n)return!1;return!0}function xP(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function B_(n,e){for(let t in e){if(!xP(e,t))continue;let r=t.toLowerCase();if(!r)continue;let s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function ti(n,...e){typeof process<"u"&&process.env.DEBUG==="true"&&console.log(`Groq:DEBUG:${n}`,...e)}var AP=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),q_=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";var bt=class{constructor(e){this._client=e}};var Ss=class extends bt{create(e,t){return this._client.post("/openai/v1/chat/completions",{body:e,...t,stream:e.stream??!1})}};Ss||(Ss={});var wn=class extends bt{constructor(){super(...arguments),this.completions=new Ss(this._client)}};(function(n){n.Completions=Ss})(wn||(wn={}));var _n=class extends bt{retrieve(e,t){return this._client.get(`/openai/v1/models/${e}`,t)}list(e){return this._client.get("/openai/v1/models",e)}delete(e,t){return this._client.delete(`/openai/v1/models/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}};_n||(_n={});var Rs=class extends bt{create(e,t){return this._client.post("/openai/v1/audio/transcriptions",Xo({body:e,...t}))}};Rs||(Rs={});var ks=class extends bt{create(e,t){return this._client.post("/openai/v1/audio/translations",Xo({body:e,...t}))}};ks||(ks={});var vn=class extends bt{constructor(){super(...arguments),this.transcriptions=new Rs(this._client),this.translations=new ks(this._client)}};(function(n){n.Transcriptions=Rs,n.Translations=ks})(vn||(vn={}));var H_,xe=class extends _u{constructor({baseURL:e=sh("GROQ_BASE_URL"),apiKey:t=sh("GROQ_API_KEY"),...r}={}){if(t===void 0)throw new Me("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");let s={apiKey:t,...r,baseURL:e||"https://api.groq.com"};if(!s.dangerouslyAllowBrowser&&q_())throw new Me("This is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Groq({ dangerouslyAllowBrowser: true })");super({baseURL:s.baseURL,timeout:s.timeout??6e4,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.chat=new wn(this),this.audio=new vn(this),this.models=new _n(this),this._options=s,this.apiKey=t}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}};H_=xe;xe.Groq=H_;xe.GroqError=Me;xe.APIError=Te;xe.APIConnectionError=Wr;xe.APIConnectionTimeoutError=Ps;xe.APIUserAbortError=bn;xe.NotFoundError=Ja;xe.ConflictError=Ya;xe.RateLimitError=Xa;xe.BadRequestError=Ga;xe.AuthenticationError=Ka;xe.InternalServerError=Qa;xe.PermissionDeniedError=Wa;xe.UnprocessableEntityError=Za;var{GroqError:P4,APIError:S4,APIConnectionError:R4,APIConnectionTimeoutError:k4,APIUserAbortError:N4,NotFoundError:$4,ConflictError:M4,RateLimitError:j4,BadRequestError:L4,AuthenticationError:F4,InternalServerError:D4,PermissionDeniedError:U4,UnprocessableEntityError:B4}=Yf;(function(n){n.toFile=eh,n.fileFromPath=hu,n.Chat=wn,n.Audio=vn,n.Models=_n})(xe||(xe={}));var V_=xe;os();function Qo(n,e){if(n.function===void 0)return;let t;if(e?.partial)try{t=ga(n.function.arguments??"{}")}catch{return}else try{t=JSON.parse(n.function.arguments)}catch(s){throw new mr([`Function "${n.function.name}" arguments:`,"",n.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}let r={name:n.function.name,args:t,type:"tool_call"};return e?.returnId&&(r.id=n.id),r}function vu(n){if(n.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:n.id,type:"function",function:{name:n.name,arguments:JSON.stringify(n.args)}}}function xu(n,e){return{name:n.function?.name,args:n.function?.arguments,id:n.id,error:e,type:"invalid_tool_call"}}var ah=class extends As{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let r=e[0].message,s;if(is(r)&&r.tool_calls?.length?s=r.tool_calls.map(i=>{let{id:o,...l}=i;return this.returnId?{id:o,...l}:l}):r.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(o=>Qo(o,{returnId:this.returnId,partial:t}))),!s)return[];let a=[];for(let i of s)if(i!==void 0){let o={type:i.name,args:i.args,id:i.id};Object.defineProperty(o,"name",{get(){return this.type}}),Object.defineProperty(o,"arguments",{get(){return this.args}}),a.push(o)}return a}},xn=class extends ah{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new mr(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let r=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName),s=r;if(r.length)return this.returnId||(s=r.map(a=>a.args)),this.returnSingle?s[0]:s}async parseResult(e){let r=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName),s=r;return r.length?(this.returnId||(s=r.map(i=>i.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(i=>this._validateResult(i)))):void 0}};function PP(n){let e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";default:throw new Error(`Unknown message type: ${e}`)}}function G_(n){return n.map(e=>{if(typeof e.content!="string")throw new Error("Non string message content not supported");let t={role:PP(e),content:e.content,name:e.name,function_call:e.additional_kwargs.function_call,tool_calls:e.additional_kwargs.tool_calls,tool_call_id:e.tool_call_id};return is(e)&&e.tool_calls?.length?t.tool_calls=e.tool_calls.map(vu):(e.additional_kwargs.tool_calls!=null&&(t.tool_calls=e.additional_kwargs.tool_calls),e.tool_call_id!=null&&(t.tool_call_id=e.tool_call_id)),t})}function SP(n){let e=n.tool_calls;switch(n.role){case"assistant":{let t=[],r=[];for(let s of e??[])try{t.push(Qo(s,{returnId:!0}))}catch(a){r.push(xu(s,a.message))}return new ce({content:n.content||"",additional_kwargs:{tool_calls:e},tool_calls:t,invalid_tool_calls:r})}default:return new De(n.content||"",n.role??"unknown")}}function RP(n){let{role:e}=n,t=n.content??"",r;return n.function_call?r={function_call:n.function_call}:n.tool_calls?r={tool_calls:n.tool_calls}:r={},e==="user"?new Lr({content:t}):e==="assistant"?new he({content:t,additional_kwargs:r}):e==="system"?new Fr({content:t}):new jr({content:t,role:e})}var Au=class extends Vr{static lc_name(){return"ChatGroq"}_llmType(){return"groq"}get lc_secrets(){return{apiKey:"GROQ_API_KEY"}}constructor(e){super(e??{}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"mixtral-8x7b-32768"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"mixtral-8x7b-32768"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:.7}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0});let t=e?.apiKey||ne("GROQ_API_KEY");if(!t)throw new Error('Groq API key not found. Please set the GROQ_API_KEY environment variable or provide the key into "apiKey"');this.client=new V_({apiKey:t,dangerouslyAllowBrowser:!0}),this.temperature=e?.temperature??this.temperature,this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.streaming=e?.streaming??this.streaming,this.stop=e?.stopSequences??(typeof e?.stop=="string"?[e.stop]:e?.stop)??[],this.stopSequences=this.stop,this.maxTokens=e?.maxTokens}async completionWithRetry(e,t){return this.caller.call(async()=>this.client.chat.completions.create(e,t))}invocationParams(e){let t=super.invocationParams(e);return e.tool_choice!==void 0&&(t.tool_choice=e.tool_choice),e.tools!==void 0&&(t.tools=e.tools),e.response_format!==void 0&&(t.response_format=e.response_format),{...t,stop:e.stop??this.stopSequences,model:this.model,temperature:this.temperature,max_tokens:this.maxTokens}}bindTools(e,t){return this.bind({tools:e.map(Va),...t})}async*_streamResponseChunks(e,t,r){let s=this.invocationParams(t),a=G_(e);if(t.tools!==void 0&&t.tools.length>0){let o=(await this._generateNonStreaming(e,t,r)).generations[0].message;if(o===void 0||typeof o.content!="string")throw new Error("Could not parse Groq output.");let l=o.tool_calls?.map((c,u)=>({name:c.name,args:JSON.stringify(c.args),id:c.id,index:u}));yield new Ne({message:new he({content:o.content,additional_kwargs:o.additional_kwargs,tool_call_chunks:l}),text:o.content})}else{let i=await this.completionWithRetry({...s,messages:a,stream:!0},{signal:t?.signal,headers:t?.headers});for await(let o of i){let l=o?.choices[0];if(!l)continue;let c=new Ne({message:RP(l.delta??{}),text:l.delta.content??"",generationInfo:{finishReason:l.finish_reason}});yield c,r?.handleLLMNewToken(c.text??"")}if(t.signal?.aborted)throw new Error("AbortError")}}async _generate(e,t,r){if(this.streaming){let s={},a=this._streamResponseChunks(e,t,r),i={};for await(let l of a){let c=l.generationInfo?.completion??0;i[c]===void 0?i[c]=l:i[c]=i[c].concat(l)}return{generations:Object.entries(i).sort(([l],[c])=>parseInt(l,10)-parseInt(c,10)).map(([l,c])=>c),llmOutput:{estimatedTokenUsage:s}}}else return this._generateNonStreaming(e,t,r)}async _generateNonStreaming(e,t,r){let s={},a=this.invocationParams(t),i=G_(e),o=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:t?.signal,headers:t?.headers});if("usage"in o&&o.usage){let{completion_tokens:c,prompt_tokens:u,total_tokens:d}=o.usage;c&&(s.completionTokens=(s.completionTokens??0)+c),u&&(s.promptTokens=(s.promptTokens??0)+u),d&&(s.totalTokens=(s.totalTokens??0)+d)}let l=[];if("choices"in o&&o.choices)for(let c of o.choices){let d={text:c.message?.content??"",message:SP(c.message??{role:"assistant"})};d.generationInfo={...c.finish_reason?{finish_reason:c.finish_reason}:{},...c.logprobs?{logprobs:c.logprobs}:{}},l.push(d)}return{generations:l,llmOutput:{tokenUsage:s}}}withStructuredOutput(e,t){let r=e,s=t?.name,a=t?.method,i=t?.includeRaw,o=s??"extract",l,c;if(a==="jsonMode")c=this.bind({response_format:{type:"json_object"}}),hr(r)?l=La.fromZodSchema(r):l=new Fa;else if(hr(r)){let f=We(r);c=this.bind({tools:[{type:"function",function:{name:o,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:o}}}),l=new xn({returnSingle:!0,keyName:o,zodSchema:r})}else{let f;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(f=r,o=r.name):(o=r.title??o,f={name:o,description:r.description??"",parameters:r}),c=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:o}}}),l=new xn({returnSingle:!0,keyName:o})}if(!i)return c.pipe(l).withConfig({runName:"ChatGroqStructuredOutput"});let u=qe.assign({parsed:(f,h)=>l.invoke(f.raw,h)}),d=qe.assign({parsed:()=>null}),p=u.withFallbacks({fallbacks:[d]});return xt.from([{raw:c},p]).withConfig({runName:"ChatGroqStructuredOutput"})}};var Eu="RFC3986",Iu={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},K_="RFC1738";var kP=Array.isArray,gr=(()=>{let n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})();var ih=1024,W_=(n,e,t,r,s)=>{if(n.length===0)return n;let a=n;if(typeof n=="symbol"?a=Symbol.prototype.toString.call(n):typeof n!="string"&&(a=String(n)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=ih){let l=a.length>=ih?a.slice(o,o+ih):a,c=[];for(let u=0;u<l.length;++u){let d=l.charCodeAt(u);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===K_&&(d===40||d===41)){c[c.length]=l.charAt(u);continue}if(d<128){c[c.length]=gr[d];continue}if(d<2048){c[c.length]=gr[192|d>>6]+gr[128|d&63];continue}if(d<55296||d>=57344){c[c.length]=gr[224|d>>12]+gr[128|d>>6&63]+gr[128|d&63];continue}u+=1,d=65536+((d&1023)<<10|l.charCodeAt(u)&1023),c[c.length]=gr[240|d>>18]+gr[128|d>>12&63]+gr[128|d>>6&63]+gr[128|d&63]}i+=c.join("")}return i};function J_(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function oh(n,e){if(kP(n)){let t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}var NP=Object.prototype.hasOwnProperty,Y_={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},yr=Array.isArray,$P=Array.prototype.push,Z_=function(n,e){$P.apply(n,yr(e)?e:[e])},MP=Date.prototype.toISOString,Ce={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:W_,encodeValuesOnly:!1,format:Eu,formatter:Iu[Eu],indices:!1,serializeDate(n){return MP.call(n)},skipNulls:!1,strictNullHandling:!1};function jP(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}var lh={};function X_(n,e,t,r,s,a,i,o,l,c,u,d,p,f,h,m,g,w){let b=n,E=w,O=0,S=!1;for(;(E=E.get(lh))!==void 0&&!S;){let Y=E.get(n);if(O+=1,typeof Y<"u"){if(Y===O)throw new RangeError("Cyclic object value");S=!0}typeof E.get(lh)>"u"&&(O=0)}if(typeof c=="function"?b=c(e,b):b instanceof Date?b=p?.(b):t==="comma"&&yr(b)&&(b=oh(b,function(Y){return Y instanceof Date?p?.(Y):Y})),b===null){if(a)return l&&!m?l(e,Ce.encoder,g,"key",f):e;b=""}if(jP(b)||J_(b)){if(l){let Y=m?e:l(e,Ce.encoder,g,"key",f);return[h?.(Y)+"="+h?.(l(b,Ce.encoder,g,"value",f))]}return[h?.(e)+"="+h?.(String(b))]}let J=[];if(typeof b>"u")return J;let te;if(t==="comma"&&yr(b))m&&l&&(b=oh(b,l)),te=[{value:b.length>0?b.join(",")||null:void 0}];else if(yr(c))te=c;else{let Y=Object.keys(b);te=u?Y.sort(u):Y}let G=o?String(e).replace(/\./g,"%2E"):String(e),q=r&&yr(b)&&b.length===1?G+"[]":G;if(s&&yr(b)&&b.length===0)return q+"[]";for(let Y=0;Y<te.length;++Y){let ae=te[Y],de=typeof ae=="object"&&typeof ae.value<"u"?ae.value:b[ae];if(i&&de===null)continue;let Pr=d&&o?ae.replace(/\./g,"%2E"):ae,oa=yr(b)?typeof t=="function"?t(q,Pr):q:q+(d?"."+Pr:"["+Pr+"]");w.set(n,O);let bl=new WeakMap;bl.set(lh,w),Z_(J,X_(de,oa,t,r,s,a,i,o,t==="comma"&&m&&yr(b)?null:l,c,u,d,p,f,h,m,g,bl))}return J}function LP(n=Ce){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=n.charset||Ce.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Eu;if(typeof n.format<"u"){if(!NP.call(Iu,n.format))throw new TypeError("Unknown format option provided.");t=n.format}let r=Iu[t],s=Ce.filter;(typeof n.filter=="function"||yr(n.filter))&&(s=n.filter);let a;if(n.arrayFormat&&n.arrayFormat in Y_?a=n.arrayFormat:"indices"in n?a=n.indices?"indices":"repeat":a=Ce.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let i=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:Ce.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:Ce.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:Ce.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:Ce.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?Ce.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:Ce.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:Ce.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:Ce.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:Ce.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:Ce.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:Ce.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:Ce.strictNullHandling}}function ch(n,e={}){let t=n,r=LP(e),s,a;typeof r.filter=="function"?(a=r.filter,t=a("",t)):yr(r.filter)&&(a=r.filter,s=a);let i=[];if(typeof t!="object"||t===null)return"";let o=Y_[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);let c=new WeakMap;for(let p=0;p<s.length;++p){let f=s[p];r.skipNulls&&t[f]===null||Z_(i,X_(t[f],f,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}let u=i.join(r.delimiter),d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""}var Ns="4.104.0";var Q_=!1,$s,uh,DP,UP,BP,dh,zP,Ou,ph,fh,hh,Tu,mh;function ev(n,e={auto:!1}){if(Q_)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if($s)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${$s}'\``);Q_=e.auto,$s=n.kind,uh=n.fetch,DP=n.Request,UP=n.Response,BP=n.Headers,dh=n.FormData,zP=n.Blob,Ou=n.File,ph=n.ReadableStream,fh=n.getMultipartRequestOptions,hh=n.getDefaultAgent,Tu=n.fileFromPath,mh=n.isFsReadStream}var Cu=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function tv({manuallyImported:n}={}){let e=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,r,s,a;try{t=fetch,r=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new Cu(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}var gh=()=>{$s||ev(tv(),{auto:!0})};gh();var R=class extends Error{},Ae=class n extends R{constructor(e,t,r,s){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s?.["x-request-id"],this.error=t;let a=t;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,r){let s=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new Jr({message:r,cause:Pu(t)});let a=t?.error;return e===400?new ri(e,a,r,s):e===401?new ni(e,a,r,s):e===403?new si(e,a,r,s):e===404?new ai(e,a,r,s):e===409?new ii(e,a,r,s):e===422?new oi(e,a,r,s):e===429?new li(e,a,r,s):e>=500?new ci(e,a,r,s):new n(e,a,r,s)}},pe=class extends Ae{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Jr=class extends Ae{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},er=class extends Jr{constructor({message:e}={}){super({message:e??"Request timed out."})}},ri=class extends Ae{},ni=class extends Ae{},si=class extends Ae{},ai=class extends Ae{},ii=class extends Ae{},oi=class extends Ae{},li=class extends Ae{},ci=class extends Ae{},ui=class extends R{constructor(){super("Could not parse response content as the length limit was reached")}},di=class extends R{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Su=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Ms=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},At,js=class{constructor(){At.set(this,void 0),this.buffer=new Uint8Array,Su(this,At,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,r=new Uint8Array(this.buffer.length+t.length);r.set(this.buffer),r.set(t,this.buffer.length),this.buffer=r;let s=[],a;for(;(a=VP(this.buffer,Ms(this,At,"f")))!=null;){if(a.carriage&&Ms(this,At,"f")==null){Su(this,At,a.index,"f");continue}if(Ms(this,At,"f")!=null&&(a.index!==Ms(this,At,"f")+1||a.carriage)){s.push(this.decodeText(this.buffer.slice(0,Ms(this,At,"f")-1))),this.buffer=this.buffer.slice(Ms(this,At,"f")),Su(this,At,null,"f");continue}let i=Ms(this,At,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));s.push(o),this.buffer=this.buffer.slice(a.index),Su(this,At,null,"f")}return s}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new R(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new R(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new R("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};At=new WeakMap;js.NEWLINE_CHARS=new Set([`
`,"\r"]);js.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function VP(n,e){for(let s=e??0;s<n.length;s++){if(n[s]===10)return{preceding:s,index:s+1,carriage:!1};if(n[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function rv(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}function yh(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var br=class n{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(let i of GP(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(o&&o.error)throw new Ae(void 0,o.error,void 0,wh(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(i.event=="error")throw new Ae(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new n(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){let i=new js,o=yh(e);for await(let l of o)for(let c of i.decode(l))yield c;for(let l of i.flush())yield l}async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new n(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),s=a=>({next:()=>{if(a.length===0){let i=r.next();e.push(i),t.push(i)}return a.shift()}});return[new n(()=>s(e),this.controller),new n(()=>s(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new ph({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:a,done:i}=await t.next();if(i)return s.close();let o=r.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){await t.return?.()}})}};async function*GP(n,e){if(!n.body)throw e.abort(),new R("Attempted to iterate over a response with no body");let t=new bh,r=new js,s=yh(n.body);for await(let a of KP(s))for(let i of r.decode(a)){let o=t.decode(i);o&&(yield o)}for(let a of r.flush()){let i=t.decode(a);i&&(yield i)}}async function*KP(n){let e=new Uint8Array;for await(let t of n){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let a;for(;(a=rv(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}var bh=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=WP(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function WP(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}var nv=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",sv=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&el(n),el=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",JP=n=>sv(n)||nv(n)||mh(n);async function xh(n,e,t){if(n=await n,sv(n))return n;if(nv(n)){let s=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");let a=el(s)?[await s.arrayBuffer()]:[s];return new Ou(a,e,t)}let r=await YP(n);if(e||(e=XP(n)??"unknown_file"),!t?.type){let s=r[0]?.type;typeof s=="string"&&(t={...t,type:s})}return new Ou(r,e,t)}async function YP(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(el(n))e.push(await n.arrayBuffer());else if(QP(n))for await(let t of n)e.push(t);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${n?.constructor?.name}; props: ${ZP(n)}`);return e}function ZP(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function XP(n){return _h(n.name)||_h(n.filename)||_h(n.path)?.split(/[\\/]/).pop()}var _h=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},QP=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Ah=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var wt=async n=>{let e=await av(n.body);return fh(e,n)},av=async n=>{let e=new dh;return await Promise.all(Object.entries(n||{}).map(([t,r])=>vh(e,t,r))),e};var vh=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(JP(t)){let r=await xh(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>vh(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>vh(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var tS=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},rS=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ru;gh();async function dv(n){let{response:e}=n;if(n.options.stream)return Yr("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):br.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let r=e.headers.get("content-type")?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){let i=await e.json();return Yr("response",e.status,e.url,e.headers,i),pv(i,e)}let a=await e.text();return Yr("response",e.status,e.url,e.headers,a),a}function pv(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Nu=class n extends Promise{constructor(e,t=dv){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new n(this.responsePromise,async t=>pv(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},$u=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=Eh("maxRetries",t),this.timeout=Eh("timeout",r),this.httpAgent=s,this.fetch=a??uh}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...iS(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${uS()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{let a=s&&el(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:a}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:s,path:a,query:i,headers:o={}}=r,l=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:Ah(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,c=this.calculateContentLength(l),u=this.buildURL(a,i);"timeout"in r&&Eh("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let d=r.httpAgent??this.httpAgent??hh(u),p=r.timeout+1e3;typeof d?.options?.timeout=="number"&&p>(d.options.timeout??0)&&(d.options.timeout=p),this.idempotencyHeader&&s!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let f=this.buildHeaders({options:r,headers:o,contentLength:c,retryCount:t});return{req:{method:s,...l&&{body:l},headers:f,...d&&{agent:d},signal:r.signal??null},url:u,timeout:r.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){let a={};r&&(a["content-length"]=r);let i=this.defaultHeaders(e);return cv(a,i),cv(a,t),Ah(e.body)&&$s!=="node"&&delete a["content-type"],ku(i,"x-stainless-retry-count")===void 0&&ku(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),ku(i,"x-stainless-timeout")===void 0&&ku(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return Ae.generate(e,t,r,s)}request(e,t=null){return new Nu(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);let{req:a,url:i,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(a,{url:i,options:r}),Yr("request",i,r,a.headers),r.signal?.aborted)throw new pe;let l=new AbortController,c=await this.fetchWithTimeout(i,a,o,l).catch(Pu);if(c instanceof Error){if(r.signal?.aborted)throw new pe;if(t)return this.retryRequest(r,t);throw c.name==="AbortError"?new er:new Jr({cause:c})}let u=wh(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){let g=`retrying, ${t} attempts remaining`;return Yr(`response (error; ${g})`,c.status,i,u),this.retryRequest(r,t,u)}let d=await c.text().catch(g=>Pu(g).message),p=oS(d),f=p?void 0:d;throw Yr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,i,u,f),this.makeStatusError(c.status,p,f,u)}return{response:c,options:r,controller:l}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new Ih(this,r,e)}buildURL(e,t){let r=cS(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return fv(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new R(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){let{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());let o=setTimeout(()=>s.abort(),r),l={signal:s.signal,...i};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,e,l).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s,a=r?.["retry-after-ms"];if(a){let o=parseFloat(a);Number.isNaN(o)||(s=o)}let i=r?.["retry-after"];if(i&&!s){let o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){let o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Zr(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ns}`}},tl=class{constructor(e,t,r,s){Ru.set(this,void 0),tS(this,Ru,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new R("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[s,a]of r)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await rS(this,Ru,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ru=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Ih=class extends Nu{constructor(e,t,r){super(t,async s=>new r(e,s.response,await dv(s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},wh=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),nS={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},U=n=>typeof n=="object"&&n!==null&&!fv(n)&&Object.keys(n).every(e=>hv(nS,e)),sS=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ns,"X-Stainless-OS":ov(Deno.build.os),"X-Stainless-Arch":iv(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ns,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ns,"X-Stainless-OS":ov(process.platform),"X-Stainless-Arch":iv(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let n=aS();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ns,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ns,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function aS(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let s=r[1]||0,a=r[2]||0,i=r[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}var iv=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",ov=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),lv,iS=()=>lv??(lv=sS()),oS=n=>{try{return JSON.parse(n)}catch{return}},lS=/^[a-z][a-z0-9+.-]*:/i,cS=n=>lS.test(n),Zr=n=>new Promise(e=>setTimeout(e,n)),Eh=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new R(`${n} must be an integer`);if(e<0)throw new R(`${n} must be a positive integer`);return e},Pu=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)};var rl=n=>{if(typeof process<"u")return process.env?.[n]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(n)?.trim()};function fv(n){if(!n)return!0;for(let e in n)return!1;return!0}function hv(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function cv(n,e){for(let t in e){if(!hv(e,t))continue;let r=t.toLowerCase();if(!r)continue;let s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}var uv=new Set(["authorization","api-key"]);function Yr(n,...e){if(typeof process<"u"&&process?.env?.DEBUG==="true"){let t=e.map(r=>{if(!r)return r;if(r.headers){let a={...r,headers:{...r.headers}};for(let i in r.headers)uv.has(i.toLowerCase())&&(a.headers[i]="REDACTED");return a}let s=null;for(let a in r)uv.has(a.toLowerCase())&&(s??(s={...r}),s[a]="REDACTED");return s??r});console.log(`OpenAI:DEBUG:${n}`,...t)}}var uS=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),mv=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",dS=n=>typeof n?.get=="function";var ku=(n,e)=>{let t=e.toLowerCase();if(dS(n)){let r=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(s,a,i)=>a+i.toUpperCase());for(let s of[e,t,e.toUpperCase(),r]){let a=n.get(s);if(a)return a}}for(let[r,s]of Object.entries(n))if(r.toLowerCase()===t)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${e} header, using the first entry.`),s[0]):s};var gv=n=>{if(typeof Buffer<"u"){let e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};function nl(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}var wr=class extends tl{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},W=class extends tl{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}};var _=class{constructor(e){this._client=e}};var pi=class extends _{list(e,t={},r){return U(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Mu,{query:t,...r})}};var An=class extends _{constructor(){super(...arguments),this.messages=new pi(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/chat/completions",En,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}},En=class extends W{},Mu=class extends W{};An.ChatCompletionsPage=En;An.Messages=pi;var Qr=class extends _{constructor(){super(...arguments),this.completions=new An(this._client)}};Qr.Completions=An;Qr.ChatCompletionsPage=En;var fi=class extends _{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}};var hi=class extends _{create(e,t){return this._client.post("/audio/transcriptions",wt({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}};var mi=class extends _{create(e,t){return this._client.post("/audio/translations",wt({body:e,...t,__metadata:{model:e.model}}))}};var _r=class extends _{constructor(){super(...arguments),this.transcriptions=new hi(this._client),this.translations=new mi(this._client),this.speech=new fi(this._client)}};_r.Transcriptions=hi;_r.Translations=mi;_r.Speech=fi;var In=class extends _{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/batches",Ls,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},Ls=class extends W{};In.BatchesPage=Ls;var tr=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},fe=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Oh,ju,Lu,sl,al,Fu,il,en,ol,Du,Uu,gi,yv,On=class{constructor(){Oh.add(this),this.controller=new AbortController,ju.set(this,void 0),Lu.set(this,()=>{}),sl.set(this,()=>{}),al.set(this,void 0),Fu.set(this,()=>{}),il.set(this,()=>{}),en.set(this,{}),ol.set(this,!1),Du.set(this,!1),Uu.set(this,!1),gi.set(this,!1),tr(this,ju,new Promise((e,t)=>{tr(this,Lu,e,"f"),tr(this,sl,t,"f")}),"f"),tr(this,al,new Promise((e,t)=>{tr(this,Fu,e,"f"),tr(this,il,t,"f")}),"f"),fe(this,ju,"f").catch(()=>{}),fe(this,al,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},fe(this,Oh,"m",yv).bind(this))},0)}_connected(){this.ended||(fe(this,Lu,"f").call(this),this._emit("connect"))}get ended(){return fe(this,ol,"f")}get errored(){return fe(this,Du,"f")}get aborted(){return fe(this,Uu,"f")}abort(){this.controller.abort()}on(e,t){return(fe(this,en,"f")[e]||(fe(this,en,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=fe(this,en,"f")[e];if(!r)return this;let s=r.findIndex(a=>a.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(fe(this,en,"f")[e]||(fe(this,en,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{tr(this,gi,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){tr(this,gi,!0,"f"),await fe(this,al,"f")}_emit(e,...t){if(fe(this,ol,"f"))return;e==="end"&&(tr(this,ol,!0,"f"),fe(this,Fu,"f").call(this));let r=fe(this,en,"f")[e];if(r&&(fe(this,en,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){let s=t[0];!fe(this,gi,"f")&&!r?.length&&Promise.reject(s),fe(this,sl,"f").call(this,s),fe(this,il,"f").call(this,s),this._emit("end");return}if(e==="error"){let s=t[0];!fe(this,gi,"f")&&!r?.length&&Promise.reject(s),fe(this,sl,"f").call(this,s),fe(this,il,"f").call(this,s),this._emit("end")}}_emitFinal(){}};ju=new WeakMap,Lu=new WeakMap,sl=new WeakMap,al=new WeakMap,Fu=new WeakMap,il=new WeakMap,en=new WeakMap,ol=new WeakMap,Du=new WeakMap,Uu=new WeakMap,gi=new WeakMap,Oh=new WeakSet,yv=function(e){if(tr(this,Du,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new pe),e instanceof pe)return tr(this,Uu,!0,"f"),this._emit("abort",e);if(e instanceof R)return this._emit("error",e);if(e instanceof Error){let t=new R(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new R(String(e)))};var $=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Et=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},He,Th,vr,Bu,rr,Ds,yi,Fs,Hu,It,zu,qu,ul,ll,cl,bv,wv,_v,vv,xv,Av,Ev,xr=class n extends On{constructor(){super(...arguments),He.add(this),Th.set(this,[]),vr.set(this,{}),Bu.set(this,{}),rr.set(this,void 0),Ds.set(this,void 0),yi.set(this,void 0),Fs.set(this,void 0),Hu.set(this,void 0),It.set(this,void 0),zu.set(this,void 0),qu.set(this,void 0),ul.set(this,void 0)}[(Th=new WeakMap,vr=new WeakMap,Bu=new WeakMap,rr=new WeakMap,Ds=new WeakMap,yi=new WeakMap,Fs=new WeakMap,Hu=new WeakMap,It=new WeakMap,zu=new WeakMap,qu=new WeakMap,ul=new WeakMap,He=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new n;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let s=br.fromReadableStream(e,this.controller);for await(let a of s)$(this,He,"m",ll).call(this,a);if(s.controller.signal?.aborted)throw new pe;return this._addRun($(this,He,"m",cl).call(this))}toReadableStream(){return new br(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,a){let i=new n;return i._run(()=>i._runToolAssistantStream(e,t,r,s,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,s,a){let i=a?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let o={...s,stream:!0},l=await e.submitToolOutputs(t,r,o,{...a,signal:this.controller.signal});this._connected();for await(let c of l)$(this,He,"m",ll).call(this,c);if(l.controller.signal?.aborted)throw new pe;return this._addRun($(this,He,"m",cl).call(this))}static createThreadAssistantStream(e,t,r){let s=new n;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){let a=new n;return a._run(()=>a._runAssistantStream(e,t,r,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return $(this,zu,"f")}currentRun(){return $(this,qu,"f")}currentMessageSnapshot(){return $(this,rr,"f")}currentRunStepSnapshot(){return $(this,ul,"f")}async finalRunSteps(){return await this.done(),Object.values($(this,vr,"f"))}async finalMessages(){return await this.done(),Object.values($(this,Bu,"f"))}async finalRun(){if(await this.done(),!$(this,Ds,"f"))throw Error("Final run was not received.");return $(this,Ds,"f")}async _createThreadAssistantStream(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...t,stream:!0},i=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(let o of i)$(this,He,"m",ll).call(this,o);if(i.controller.signal?.aborted)throw new pe;return this._addRun($(this,He,"m",cl).call(this))}async _createAssistantStream(e,t,r,s){let a=s?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},o=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(let l of o)$(this,He,"m",ll).call(this,l);if(o.controller.signal?.aborted)throw new pe;return this._addRun($(this,He,"m",cl).call(this))}static accumulateDelta(e,t){for(let[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let a=e[r];if(a==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(nl(a)&&nl(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(let i of s){if(!nl(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);let o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let l=a[o];l==null?a.push(i):a[o]=this.accumulateDelta(l,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,a){return await this._createToolAssistantStream(r,e,t,s,a)}};ll=function(e){if(!this.ended)switch(Et(this,zu,e,"f"),$(this,He,"m",_v).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":$(this,He,"m",Ev).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":$(this,He,"m",wv).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":$(this,He,"m",bv).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},cl=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");if(!$(this,Ds,"f"))throw Error("Final run has not been received");return $(this,Ds,"f")},bv=function(e){let[t,r]=$(this,He,"m",xv).call(this,e,$(this,rr,"f"));Et(this,rr,t,"f"),$(this,Bu,"f")[t.id]=t;for(let s of r){let a=t.content[s.index];a?.type=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=$(this,yi,"f")){if($(this,Fs,"f"))switch($(this,Fs,"f").type){case"text":this._emit("textDone",$(this,Fs,"f").text,$(this,rr,"f"));break;case"image_file":this._emit("imageFileDone",$(this,Fs,"f").image_file,$(this,rr,"f"));break}Et(this,yi,s.index,"f")}Et(this,Fs,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if($(this,yi,"f")!==void 0){let s=e.data.content[$(this,yi,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,$(this,rr,"f"));break;case"text":this._emit("textDone",s.text,$(this,rr,"f"));break}}$(this,rr,"f")&&this._emit("messageDone",e.data),Et(this,rr,void 0,"f")}},wv=function(e){let t=$(this,He,"m",vv).call(this,e);switch(Et(this,ul,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let a of r.step_details.tool_calls)a.index==$(this,Hu,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):($(this,It,"f")&&this._emit("toolCallDone",$(this,It,"f")),Et(this,Hu,a.index,"f"),Et(this,It,t.step_details.tool_calls[a.index],"f"),$(this,It,"f")&&this._emit("toolCallCreated",$(this,It,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Et(this,ul,void 0,"f"),e.data.step_details.type=="tool_calls"&&$(this,It,"f")&&(this._emit("toolCallDone",$(this,It,"f")),Et(this,It,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},_v=function(e){$(this,Th,"f").push(e),this._emit("event",e)},vv=function(e){switch(e.event){case"thread.run.step.created":return $(this,vr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=$(this,vr,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let s=xr.accumulateDelta(t,r.delta);$(this,vr,"f")[e.data.id]=s}return $(this,vr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":$(this,vr,"f")[e.data.id]=e.data;break}if($(this,vr,"f")[e.data.id])return $(this,vr,"f")[e.data.id];throw new Error("No snapshot available")},xv=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(let a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=$(this,He,"m",Av).call(this,a,i)}else t.content[a.index]=a,r.push(a);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Av=function(e,t){return xr.accumulateDelta(t,e)},Ev=function(e){switch(Et(this,qu,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Et(this,Ds,e.data,"f"),$(this,It,"f")&&(this._emit("toolCallDone",$(this,It,"f")),Et(this,It,void 0,"f"));break;case"thread.run.cancelling":break}};var Us=class extends _{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/assistants",bi,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}},bi=class extends W{};Us.AssistantsPage=bi;function Ch(n){return typeof n.parse=="function"}var Tn=n=>n?.role==="assistant",Ph=n=>n?.role==="function",Sh=n=>n?.role==="tool";function dl(n){return n?.$brand==="auto-parseable-response-format"}function Bs(n){return n?.$brand==="auto-parseable-tool"}function Iv(n,e){return!e||!Rh(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:pl(n,e)}function pl(n,e){let t=n.choices.map(r=>{if(r.finish_reason==="length")throw new ui;if(r.finish_reason==="content_filter")throw new di;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:r.message.tool_calls?.map(s=>wS(e,s))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?bS(e,r.message.content):null}}});return{...n,choices:t}}function bS(n,e){return n.response_format?.type!=="json_schema"?null:n.response_format?.type==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function wS(n,e){let t=n.tools?.find(r=>r.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:Bs(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function Ov(n,e){if(!n)return!1;let t=n.tools?.find(r=>r.function?.name===e.function.name);return Bs(t)||t?.function.strict||!1}function Rh(n){return dl(n.response_format)?!0:n.tools?.some(e=>Bs(e)||e.type==="function"&&e.function.strict===!0)??!1}function Tv(n){for(let e of n??[]){if(e.type!=="function")throw new R(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new R(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var _t=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Qe,kh,Vu,Nh,$h,Mh,Pv,jh,Cv=10,wi=class extends On{constructor(){super(...arguments),Qe.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Ph(e)||Sh(e))&&e.content)this._emit("functionCallResult",e.content);else if(Tn(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Tn(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new R("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),_t(this,Qe,"m",kh).call(this)}async finalMessage(){return await this.done(),_t(this,Qe,"m",Vu).call(this)}async finalFunctionCall(){return await this.done(),_t(this,Qe,"m",Nh).call(this)}async finalFunctionCallResult(){return await this.done(),_t(this,Qe,"m",$h).call(this)}async totalUsage(){return await this.done(),_t(this,Qe,"m",Mh).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=_t(this,Qe,"m",Vu).call(this);t&&this._emit("finalMessage",t);let r=_t(this,Qe,"m",kh).call(this);r&&this._emit("finalContent",r);let s=_t(this,Qe,"m",Nh).call(this);s&&this._emit("finalFunctionCall",s);let a=_t(this,Qe,"m",$h).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",_t(this,Qe,"m",Mh).call(this))}async _createChatCompletion(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),_t(this,Qe,"m",Pv).call(this,t);let a=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(pl(a,t))}async _runChatCompletion(e,t,r){for(let s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){let s="function",{function_call:a="auto",stream:i,...o}=t,l=typeof a!="string"&&a?.name,{maxChatCompletions:c=Cv}=r||{},u={};for(let p of t.functions)u[p.name||p.function.name]=p;let d=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<c;++p){let h=(await this._createChatCompletion(e,{...o,function_call:a,functions:d,messages:[...this.messages]},r)).choices[0]?.message;if(!h)throw new R("missing message in ChatCompletion response");if(!h.function_call)return;let{name:m,arguments:g}=h.function_call,w=u[m];if(w){if(l&&l!==m){let S=`Invalid function_call: ${JSON.stringify(m)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:m,content:S});continue}}else{let S=`Invalid function_call: ${JSON.stringify(m)}. Available options are: ${d.map(J=>JSON.stringify(J.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:m,content:S});continue}let b;try{b=Ch(w)?await w.parse(g):g}catch(S){this._addMessage({role:s,name:m,content:S instanceof Error?S.message:String(S)});continue}let E=await w.function(b,this),O=_t(this,Qe,"m",jh).call(this,E);if(this._addMessage({role:s,name:m,content:O}),l)return}}async _runTools(e,t,r){let s="tool",{tool_choice:a="auto",stream:i,...o}=t,l=typeof a!="string"&&a?.function?.name,{maxChatCompletions:c=Cv}=r||{},u=t.tools.map(f=>{if(Bs(f)){if(!f.$callback)throw new R("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:f.$callback,name:f.function.name,description:f.function.description||"",parameters:f.function.parameters,parse:f.$parseRaw,strict:!0}}}return f}),d={};for(let f of u)f.type==="function"&&(d[f.function.name||f.function.function.name]=f.function);let p="tools"in t?u.map(f=>f.type==="function"?{type:"function",function:{name:f.function.name||f.function.function.name,parameters:f.function.parameters,description:f.function.description,strict:f.function.strict}}:f):void 0;for(let f of t.messages)this._addMessage(f,!1);for(let f=0;f<c;++f){let m=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:p,messages:[...this.messages]},r)).choices[0]?.message;if(!m)throw new R("missing message in ChatCompletion response");if(!m.tool_calls?.length)return;for(let g of m.tool_calls){if(g.type!=="function")continue;let w=g.id,{name:b,arguments:E}=g.function,O=d[b];if(O){if(l&&l!==b){let G=`Invalid tool_call: ${JSON.stringify(b)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:w,content:G});continue}}else{let G=`Invalid tool_call: ${JSON.stringify(b)}. Available options are: ${Object.keys(d).map(q=>JSON.stringify(q)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:w,content:G});continue}let S;try{S=Ch(O)?await O.parse(E):E}catch(G){let q=G instanceof Error?G.message:String(G);this._addMessage({role:s,tool_call_id:w,content:q});continue}let J=await O.function(S,this),te=_t(this,Qe,"m",jh).call(this,J);if(this._addMessage({role:s,tool_call_id:w,content:te}),l)return}}}};Qe=new WeakSet,kh=function(){return _t(this,Qe,"m",Vu).call(this).content??null},Vu=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(Tn(t)){let{function_call:r,...s}=t,a={...s,content:t.content??null,refusal:t.refusal??null};return r&&(a.function_call=r),a}}throw new R("stream ended without producing a ChatCompletionMessage with role=assistant")},Nh=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Tn(t)&&t?.function_call)return t.function_call;if(Tn(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},$h=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Ph(t)&&t.content!=null||Sh(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>r.role==="assistant"&&r.tool_calls?.some(s=>s.type==="function"&&s.id===t.tool_call_id)))return t.content}},Mh=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Pv=function(e){if(e.n!=null&&e.n>1)throw new R("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},jh=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var fl=class n extends wi{static runFunctions(e,t,r){let s=new n,a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,r){let s=new n,a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e,t=!0){super._addMessage(e,t),Tn(e)&&e.content&&this._emit("content",e.content)}};var je={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Lh=class extends Error{},Fh=class extends Error{};function _S(n,e=je.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return vS(n.trim(),e)}var vS=(n,e)=>{let t=n.length,r=0,s=p=>{throw new Lh(`${p} at position ${r}`)},a=p=>{throw new Fh(`${p} at position ${r}`)},i=()=>(d(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?l():n[r]==="["?c():n.substring(r,r+4)==="null"||je.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||je.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||je.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||je.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||je.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||je.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):u()),o=()=>{let p=r,f=!1;for(r++;r<t&&(n[r]!=='"'||f&&n[r-1]==="\\");)f=n[r]==="\\"?!f:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(p,++r-Number(f)))}catch(h){a(String(h))}else if(je.STR&e)try{return JSON.parse(n.substring(p,r-Number(f))+'"')}catch{return JSON.parse(n.substring(p,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,d();let p={};try{for(;n[r]!=="}";){if(d(),r>=t&&je.OBJ&e)return p;let f=o();d(),r++;try{let h=i();Object.defineProperty(p,f,{value:h,writable:!0,enumerable:!0,configurable:!0})}catch(h){if(je.OBJ&e)return p;throw h}d(),n[r]===","&&r++}}catch{if(je.OBJ&e)return p;s("Expected '}' at end of object")}return r++,p},c=()=>{r++;let p=[];try{for(;n[r]!=="]";)p.push(i()),d(),n[r]===","&&r++}catch{if(je.ARR&e)return p;s("Expected ']' at end of array")}return r++,p},u=()=>{if(r===0){n==="-"&&je.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(f){if(je.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}a(String(f))}}let p=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(je.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(p,r))}catch{n.substring(p,r)==="-"&&je.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(p,n.lastIndexOf("e")))}catch(h){a(String(h))}}},d=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return i()},Dh=n=>_S(n,je.ALL^je.NUM);var _i=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},se=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Pe,tn,vi,Cn,Uh,Gu,Bh,zh,qh,Ku,Hh,Sv,xi=class n extends wi{constructor(e){super(),Pe.add(this),tn.set(this,void 0),vi.set(this,void 0),Cn.set(this,void 0),_i(this,tn,e,"f"),_i(this,vi,[],"f")}get currentChatCompletionSnapshot(){return se(this,Cn,"f")}static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let s=new n(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){super._createChatCompletion;let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),se(this,Pe,"m",Uh).call(this);let a=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let i of a)se(this,Pe,"m",Bh).call(this,i);if(a.controller.signal?.aborted)throw new pe;return this._addChatCompletion(se(this,Pe,"m",Ku).call(this))}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),se(this,Pe,"m",Uh).call(this),this._connected();let s=br.fromReadableStream(e,this.controller),a;for await(let i of s)a&&a!==i.id&&this._addChatCompletion(se(this,Pe,"m",Ku).call(this)),se(this,Pe,"m",Bh).call(this,i),a=i.id;if(s.controller.signal?.aborted)throw new pe;return this._addChatCompletion(se(this,Pe,"m",Ku).call(this))}[(tn=new WeakMap,vi=new WeakMap,Cn=new WeakMap,Pe=new WeakSet,Uh=function(){this.ended||_i(this,Cn,void 0,"f")},Gu=function(t){let r=se(this,vi,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},se(this,vi,"f")[t.index]=r,r)},Bh=function(t){if(this.ended)return;let r=se(this,Pe,"m",Sv).call(this,t);this._emit("chunk",t,r);for(let s of t.choices){let a=r.choices[s.index];s.delta.content!=null&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",s.delta.content,a.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),s.delta.refusal!=null&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:a.message.refusal}),s.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:a.logprobs?.content??[]}),s.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});let i=se(this,Pe,"m",Gu).call(this,a);a.finish_reason&&(se(this,Pe,"m",qh).call(this,a),i.current_tool_call_index!=null&&se(this,Pe,"m",zh).call(this,a,i.current_tool_call_index));for(let o of s.delta.tool_calls??[])i.current_tool_call_index!==o.index&&(se(this,Pe,"m",qh).call(this,a),i.current_tool_call_index!=null&&se(this,Pe,"m",zh).call(this,a,i.current_tool_call_index)),i.current_tool_call_index=o.index;for(let o of s.delta.tool_calls??[]){let l=a.message.tool_calls?.[o.index];l?.type&&(l?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:l.function?.name,index:o.index,arguments:l.function.arguments,parsed_arguments:l.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(l?.type,void 0))}}},zh=function(t,r){if(se(this,Pe,"m",Gu).call(this,t).done_tool_calls.has(r))return;let a=t.message.tool_calls?.[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){let i=se(this,tn,"f")?.tools?.find(o=>o.type==="function"&&o.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:Bs(i)?i.$parseRaw(a.function.arguments):i?.function.strict?JSON.parse(a.function.arguments):null})}else a.type},qh=function(t){let r=se(this,Pe,"m",Gu).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let s=se(this,Pe,"m",Hh).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Ku=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");let t=se(this,Cn,"f");if(!t)throw new R("request ended without sending any chunks");return _i(this,Cn,void 0,"f"),_i(this,vi,[],"f"),xS(t,se(this,tn,"f"))},Hh=function(){let t=se(this,tn,"f")?.response_format;return dl(t)?t:null},Sv=function(t){var r,s,a,i;let o=se(this,Cn,"f"),{choices:l,...c}=t;o?Object.assign(o,c):o=_i(this,Cn,{...c,choices:[]},"f");for(let{delta:u,finish_reason:d,index:p,logprobs:f=null,...h}of t.choices){let m=o.choices[p];if(m||(m=o.choices[p]={finish_reason:d,index:p,message:{},logprobs:f,...h}),f)if(!m.logprobs)m.logprobs=Object.assign({},f);else{let{content:J,refusal:te,...G}=f;Object.assign(m.logprobs,G),J&&((r=m.logprobs).content??(r.content=[]),m.logprobs.content.push(...J)),te&&((s=m.logprobs).refusal??(s.refusal=[]),m.logprobs.refusal.push(...te))}if(d&&(m.finish_reason=d,se(this,tn,"f")&&Rh(se(this,tn,"f")))){if(d==="length")throw new ui;if(d==="content_filter")throw new di}if(Object.assign(m,h),!u)continue;let{content:g,refusal:w,function_call:b,role:E,tool_calls:O,...S}=u;if(Object.assign(m.message,S),w&&(m.message.refusal=(m.message.refusal||"")+w),E&&(m.message.role=E),b&&(m.message.function_call?(b.name&&(m.message.function_call.name=b.name),b.arguments&&((a=m.message.function_call).arguments??(a.arguments=""),m.message.function_call.arguments+=b.arguments)):m.message.function_call=b),g&&(m.message.content=(m.message.content||"")+g,!m.message.refusal&&se(this,Pe,"m",Hh).call(this)&&(m.message.parsed=Dh(m.message.content))),O){m.message.tool_calls||(m.message.tool_calls=[]);for(let{index:J,id:te,type:G,function:q,...Y}of O){let ae=(i=m.message.tool_calls)[J]??(i[J]={});Object.assign(ae,Y),te&&(ae.id=te),G&&(ae.type=G),q&&(ae.function??(ae.function={name:q.name??"",arguments:""})),q?.name&&(ae.function.name=q.name),q?.arguments&&(ae.function.arguments+=q.arguments,Ov(se(this,tn,"f"),ae)&&(ae.function.parsed_arguments=Dh(ae.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new br(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function xS(n,e){let{id:t,choices:r,created:s,model:a,system_fingerprint:i,...o}=n,l={...o,id:t,choices:r.map(({message:c,finish_reason:u,index:d,logprobs:p,...f})=>{if(!u)throw new R(`missing finish_reason for choice ${d}`);let{content:h=null,function_call:m,tool_calls:g,...w}=c,b=c.role;if(!b)throw new R(`missing role for choice ${d}`);if(m){let{arguments:E,name:O}=m;if(E==null)throw new R(`missing function_call.arguments for choice ${d}`);if(!O)throw new R(`missing function_call.name for choice ${d}`);return{...f,message:{content:h,function_call:{arguments:E,name:O},role:b,refusal:c.refusal??null},finish_reason:u,index:d,logprobs:p}}return g?{...f,index:d,finish_reason:u,logprobs:p,message:{...w,role:b,content:h,refusal:c.refusal??null,tool_calls:g.map((E,O)=>{let{function:S,type:J,id:te,...G}=E,{arguments:q,name:Y,...ae}=S||{};if(te==null)throw new R(`missing choices[${d}].tool_calls[${O}].id
${Wu(n)}`);if(J==null)throw new R(`missing choices[${d}].tool_calls[${O}].type
${Wu(n)}`);if(Y==null)throw new R(`missing choices[${d}].tool_calls[${O}].function.name
${Wu(n)}`);if(q==null)throw new R(`missing choices[${d}].tool_calls[${O}].function.arguments
${Wu(n)}`);return{...G,id:te,type:J,function:{...ae,name:Y,arguments:q}}})}}:{...f,message:{...w,content:h,role:b,refusal:c.refusal??null},finish_reason:u,index:d,logprobs:p}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Iv(l,e)}function Wu(n){return JSON.stringify(n)}var hl=class n extends xi{static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let s=new n(null),a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,r){let s=new n(t),a={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}};var ml=class extends _{parse(e,t){return Tv(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>pl(r,e))}runFunctions(e,t){return e.stream?hl.runFunctions(this._client,e,t):fl.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?hl.runTools(this._client,e,t):fl.runTools(this._client,e,t)}stream(e,t){return xi.createChatCompletion(this._client,e,t)}};var Ai=class extends _{constructor(){super(...arguments),this.completions=new ml(this._client)}};(function(n){n.Completions=ml})(Ai||(Ai={}));var Ei=class extends _{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var Ii=class extends _{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var Pn=class extends _{constructor(){super(...arguments),this.sessions=new Ei(this._client),this.transcriptionSessions=new Ii(this._client)}};Pn.Sessions=Ei;Pn.TranscriptionSessions=Ii;var zs=class extends _{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},r){return U(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Oi,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},Oi=class extends W{};zs.MessagesPage=Oi;var qs=class extends _{retrieve(e,t,r,s={},a){return U(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}list(e,t,r={},s){return U(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Ti,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}},Ti=class extends W{};qs.RunStepsPage=Ti;var rn=class extends _{constructor(){super(...arguments),this.steps=new qs(this._client)}create(e,t,r){let{include:s,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},r){return U(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Ci,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return xr.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let s={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let l=i.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await Zr(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,r){return xr.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){let a=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,r,s){return xr.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}},Ci=class extends W{};rn.RunsPage=Ci;rn.Steps=qs;rn.RunStepsPage=Ti;var Ar=class extends _{constructor(){super(...arguments),this.runs=new rn(this._client),this.messages=new zs(this._client)}create(e={},t){return U(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return xr.createThreadAssistantStream(e,this._client.beta.threads,t)}};Ar.Runs=rn;Ar.RunsPage=Ci;Ar.Messages=zs;Ar.MessagesPage=Oi;var nr=class extends _{constructor(){super(...arguments),this.realtime=new Pn(this._client),this.chat=new Ai(this._client),this.assistants=new Us(this._client),this.threads=new Ar(this._client)}};nr.Realtime=Pn;nr.Assistants=Us;nr.AssistantsPage=bi;nr.Threads=Ar;var Hs=class extends _{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var Pi=class extends _{retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}/content`,{...r,headers:{Accept:"application/binary",...r?.headers},__binaryResponse:!0})}};var Sn=class extends _{constructor(){super(...arguments),this.content=new Pi(this._client)}create(e,t,r){return this._client.post(`/containers/${e}/files`,wt({body:t,...r}))}retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}`,r)}list(e,t={},r){return U(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,Si,{query:t,...r})}del(e,t,r){return this._client.delete(`/containers/${e}/files/${t}`,{...r,headers:{Accept:"*/*",...r?.headers}})}},Si=class extends W{};Sn.FileListResponsesPage=Si;Sn.Content=Pi;var Er=class extends _{constructor(){super(...arguments),this.files=new Sn(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/containers",Vs,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}},Vs=class extends W{};Er.ContainerListResponsesPage=Vs;Er.Files=Sn;Er.FileListResponsesPage=Si;var Gs=class extends _{create(e,t){let r=!!e.encoding_format,s=r?e.encoding_format:"base64";r&&Yr("Request","User defined encoding_format:",e.encoding_format);let a=this._client.post("/embeddings",{body:{...e,encoding_format:s},...t});return r?a:(Yr("response","Decoding base64 embeddings to float32 array"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{let l=o.embedding;o.embedding=gv(l)}),i)))}};var Ks=class extends _{retrieve(e,t,r,s){return this._client.get(`/evals/${e}/runs/${t}/output_items/${r}`,s)}list(e,t,r={},s){return U(r)?this.list(e,t,{},r):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,Ri,{query:r,...s})}},Ri=class extends W{};Ks.OutputItemListResponsesPage=Ri;var nn=class extends _{constructor(){super(...arguments),this.outputItems=new Ks(this._client)}create(e,t,r){return this._client.post(`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){return this._client.get(`/evals/${e}/runs/${t}`,r)}list(e,t={},r){return U(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,ki,{query:t,...r})}del(e,t,r){return this._client.delete(`/evals/${e}/runs/${t}`,r)}cancel(e,t,r){return this._client.post(`/evals/${e}/runs/${t}`,r)}},ki=class extends W{};nn.RunListResponsesPage=ki;nn.OutputItems=Ks;nn.OutputItemListResponsesPage=Ri;var Ir=class extends _{constructor(){super(...arguments),this.runs=new nn(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,r){return this._client.post(`/evals/${e}`,{body:t,...r})}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/evals",Ws,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}},Ws=class extends W{};Ir.EvalListResponsesPage=Ws;Ir.Runs=nn;Ir.RunListResponsesPage=ki;var Rn=class extends _{create(e,t){return this._client.post("/files",wt({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/files",Js,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){let s=new Set(["processed","error","deleted"]),a=Date.now(),i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await Zr(t),i=await this.retrieve(e),Date.now()-a>r)throw new er({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}},Js=class extends W{};Rn.FileObjectsPage=Js;var Ni=class extends _{};var $i=class extends _{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var Ys=class extends _{constructor(){super(...arguments),this.graders=new $i(this._client)}};Ys.Graders=$i;var Zs=class extends _{create(e,t,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Mi,{body:t,method:"post",...r})}retrieve(e,t={},r){return U(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}del(e,t,r){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,r)}},Mi=class extends wr{};Zs.PermissionCreateResponsesPage=Mi;var kn=class extends _{constructor(){super(...arguments),this.permissions=new Zs(this._client)}};kn.Permissions=Zs;kn.PermissionCreateResponsesPage=Mi;var Xs=class extends _{list(e,t={},r){return U(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ji,{query:t,...r})}},ji=class extends W{};Xs.FineTuningJobCheckpointsPage=ji;var Or=class extends _{constructor(){super(...arguments),this.checkpoints=new Xs(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Li,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return U(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Fi,{query:t,...r})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}},Li=class extends W{},Fi=class extends W{};Or.FineTuningJobsPage=Li;Or.FineTuningJobEventsPage=Fi;Or.Checkpoints=Xs;Or.FineTuningJobCheckpointsPage=ji;var Ot=class extends _{constructor(){super(...arguments),this.methods=new Ni(this._client),this.jobs=new Or(this._client),this.checkpoints=new kn(this._client),this.alpha=new Ys(this._client)}};Ot.Methods=Ni;Ot.Jobs=Or;Ot.FineTuningJobsPage=Li;Ot.FineTuningJobEventsPage=Fi;Ot.Checkpoints=kn;Ot.Alpha=Ys;var Di=class extends _{};var Nn=class extends _{constructor(){super(...arguments),this.graderModels=new Di(this._client)}};Nn.GraderModels=Di;var Qs=class extends _{createVariation(e,t){return this._client.post("/images/variations",wt({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",wt({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var $n=class extends _{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",ea,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},ea=class extends wr{};$n.ModelsPage=ea;var ta=class extends _{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function Rv(n,e){return!e||!VS(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:Vh(n,e)}function Vh(n,e){let t=n.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:WS(e,s)};if(s.type==="message"){let a=s.content.map(i=>i.type==="output_text"?{...i,parsed:HS(e,i.text)}:i);return{...s,content:a}}return s}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||Gh(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let s of r.output)if(s.type==="message"){for(let a of s.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),r}function HS(n,e){return n.text?.format?.type!=="json_schema"?null:"$parseRaw"in n.text?.format?(n.text?.format).$parseRaw(e):JSON.parse(e)}function VS(n){return!!dl(n.text?.format)}function GS(n){return n?.$brand==="auto-parseable-tool"}function KS(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function WS(n,e){let t=KS(n.tools??[],e.name);return{...e,...e,parsed_arguments:GS(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function Gh(n){let e=[];for(let t of n.output)if(t.type==="message")for(let r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var Ui=class extends _{list(e,t={},r){return U(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,Ju,{query:t,...r})}};var Bi=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Mn=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},zi,Yu,jn,Zu,kv,Nv,$v,Mv,Xu=class n extends On{constructor(e){super(),zi.add(this),Yu.set(this,void 0),jn.set(this,void 0),Zu.set(this,void 0),Bi(this,Yu,e,"f")}static createResponse(e,t,r){let s=new n(t);return s._run(()=>s._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,t,r){let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Mn(this,zi,"m",kv).call(this);let a,i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(let o of a)Mn(this,zi,"m",Nv).call(this,o,i);if(a.controller.signal?.aborted)throw new pe;return Mn(this,zi,"m",$v).call(this)}[(Yu=new WeakMap,jn=new WeakMap,Zu=new WeakMap,zi=new WeakSet,kv=function(){this.ended||Bi(this,jn,void 0,"f")},Nv=function(t,r){if(this.ended)return;let s=(i,o)=>{(r==null||o.sequence_number>r)&&this._emit(i,o)},a=Mn(this,zi,"m",Mv).call(this,t);switch(s("event",t),t.type){case"response.output_text.delta":{let i=a.output[t.output_index];if(!i)throw new R(`missing output at index ${t.output_index}`);if(i.type==="message"){let o=i.content[t.content_index];if(!o)throw new R(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new R(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let i=a.output[t.output_index];if(!i)throw new R(`missing output at index ${t.output_index}`);i.type==="function_call"&&s("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:s(t.type,t);break}},$v=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");let t=Mn(this,jn,"f");if(!t)throw new R("request ended without sending any events");Bi(this,jn,void 0,"f");let r=YS(t,Mn(this,Yu,"f"));return Bi(this,Zu,r,"f"),r},Mv=function(t){let r=Mn(this,jn,"f");if(!r){if(t.type!=="response.created")throw new R(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=Bi(this,jn,t.response,"f"),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{let s=r.output[t.output_index];if(!s)throw new R(`missing output at index ${t.output_index}`);s.type==="message"&&s.content.push(t.part);break}case"response.output_text.delta":{let s=r.output[t.output_index];if(!s)throw new R(`missing output at index ${t.output_index}`);if(s.type==="message"){let a=s.content[t.content_index];if(!a)throw new R(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new R(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{let s=r.output[t.output_index];if(!s)throw new R(`missing output at index ${t.output_index}`);s.type==="function_call"&&(s.arguments+=t.delta);break}case"response.completed":{Bi(this,jn,t.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",s=>{let a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(let s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(let a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=Mn(this,Zu,"f");if(!e)throw new R("stream ended without producing a ChatCompletion");return e}};function YS(n,e){return Rv(n,e)}var Ln=class extends _{constructor(){super(...arguments),this.inputItems=new Ui(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&Gh(r),r))}retrieve(e,t={},r){return this._client.get(`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>Vh(r,e))}stream(e,t){return Xu.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}},Ju=class extends W{};Ln.InputItems=Ui;var qi=class extends _{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,wt({body:t,...r}))}};var Fn=class extends _{constructor(){super(...arguments),this.parts=new qi(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}};Fn.Parts=qi;var jv=async n=>{let e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(let s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let s of e)s.status==="fulfilled"&&r.push(s.value);return r};var Dn=class extends _{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,s){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},r){return U(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Un,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){let s={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let a=await this.retrieve(e,t,{...r,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let l=a.response.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await Zr(o);break;case"failed":case"completed":return i}}}async upload(e,t,r){let s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){let s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}content(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Hi,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},Un=class extends W{},Hi=class extends wr{};Dn.VectorStoreFilesPage=Un;Dn.FileContentResponsesPage=Hi;var Vi=class extends _{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return U(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Un,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async poll(e,t,r){let s={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:a,response:i}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let l=i.headers.get("openai-poll-after-ms");if(l){let c=parseInt(l);isNaN(c)||(o=c)}}await Zr(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let a=s?.maxConcurrency??5,i=Math.min(a,t.length),o=this._client,l=t.values(),c=[...r];async function u(p){for(let f of p){let h=await o.files.create({file:f,purpose:"assistants"},s);c.push(h.id)}}let d=Array(i).fill(l).map(u);return await jv(d),await this.createAndPoll(e,{file_ids:c})}};var Tt=class extends _{constructor(){super(...arguments),this.files=new Dn(this._client),this.fileBatches=new Vi(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return U(e)?this.list({},e):this._client.getAPIList("/vector_stores",ra,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/search`,na,{body:t,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},ra=class extends W{},na=class extends wr{};Tt.VectorStoresPage=ra;Tt.VectorStoreSearchResponsesPage=na;Tt.Files=Dn;Tt.VectorStoreFilesPage=Un;Tt.FileContentResponsesPage=Hi;Tt.FileBatches=Vi;var Lv,D=class extends $u{constructor({baseURL:e=rl("OPENAI_BASE_URL"),apiKey:t=rl("OPENAI_API_KEY"),organization:r=rl("OPENAI_ORG_ID")??null,project:s=rl("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new R("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let i={apiKey:t,organization:r,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&mv())throw new R(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Hs(this),this.chat=new Qr(this),this.embeddings=new Gs(this),this.files=new Rn(this),this.images=new Qs(this),this.audio=new _r(this),this.moderations=new ta(this),this.models=new $n(this),this.fineTuning=new Ot(this),this.graders=new Nn(this),this.vectorStores=new Tt(this),this.beta=new nr(this),this.batches=new In(this),this.uploads=new Fn(this),this.responses=new Ln(this),this.evals=new Ir(this),this.containers=new Er(this),this._options=i,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return ch(e,{arrayFormat:"brackets"})}};Lv=D;D.OpenAI=Lv;D.DEFAULT_TIMEOUT=6e5;D.OpenAIError=R;D.APIError=Ae;D.APIConnectionError=Jr;D.APIConnectionTimeoutError=er;D.APIUserAbortError=pe;D.NotFoundError=ai;D.ConflictError=ii;D.RateLimitError=li;D.BadRequestError=ri;D.AuthenticationError=ni;D.InternalServerError=ci;D.PermissionDeniedError=si;D.UnprocessableEntityError=oi;D.toFile=xh;D.fileFromPath=Tu;D.Completions=Hs;D.Chat=Qr;D.ChatCompletionsPage=En;D.Embeddings=Gs;D.Files=Rn;D.FileObjectsPage=Js;D.Images=Qs;D.Audio=_r;D.Moderations=ta;D.Models=$n;D.ModelsPage=ea;D.FineTuning=Ot;D.Graders=Nn;D.VectorStores=Tt;D.VectorStoresPage=ra;D.VectorStoreSearchResponsesPage=na;D.Beta=nr;D.Batches=In;D.BatchesPage=Ls;D.Uploads=Fn;D.Responses=Ln;D.Evals=Ir;D.EvalListResponsesPage=Ws;D.Containers=Er;D.ContainerListResponsesPage=Vs;$r();function Bn(n){let{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:a,azureADTokenProvider:i}=n;if((r||i)&&s&&e)return`${s}/${e}`;if(r||i){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return a}$r();function Gi(n){let e;return n.constructor.name===er.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===pe.name?(e=new Error(n.message),e.name="AbortError"):e=n,e}function tR(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function Fv(n){let e=["namespace functions {",""];for(let t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(Dv(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function Dv(n,e){let t=[];for(let[r,s]of Object.entries(n.properties??{}))s.description&&e<2&&t.push(`// ${s.description}`),n.required?.includes(r)?t.push(`${r}: ${Qu(s,e)},`):t.push(`${r}?: ${Qu(s,e)},`);return t.map(r=>" ".repeat(e)+r).join(`
`)}function Qu(n,e){if(tR(n))return n.anyOf.map(t=>Qu(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",Dv(n,e+2),"}"].join(`
`);case"array":return n.items?`${Qu(n.items,e)}[]`:"any[]";default:return""}}function rR(n){return n.role!=="system"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function zv(n){let e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!De.isInstance(n))throw new Error("Invalid generic chat message");return rR(n)}default:throw new Error(`Unknown message type: ${e}`)}}function nR(n){let e=n.tool_calls;switch(n.role){case"assistant":{let t=[],r=[];for(let s of e??[])try{t.push(Qo(s,{returnId:!0}))}catch(a){r.push(xu(s,a.message))}return new ce({content:n.content||"",tool_calls:t,invalid_tool_calls:r,additional_kwargs:{function_call:n.function_call,tool_calls:e}})}default:return new De(n.content||"",n.role??"unknown")}}function sR(n,e){let t=n.role??e,r=n.content??"",s;if(n.function_call?s={function_call:n.function_call}:n.tool_calls?s={tool_calls:n.tool_calls}:s={},t==="user")return new Lr({content:r});if(t==="assistant"){let a=[];if(Array.isArray(n.tool_calls))for(let i of n.tool_calls)a.push({name:i.function?.name,args:i.function?.arguments,id:i.id,index:i.index});return new he({content:r,tool_call_chunks:a,additional_kwargs:s})}else return t==="system"?new Fr({content:r}):t==="function"?new ls({content:r,additional_kwargs:s,name:n.name}):t==="tool"?new ba({content:r,additional_kwargs:s,tool_call_id:n.tool_call_id}):new jr({content:r,role:t})}function Uv(n){return n.map(e=>{let t={role:zv(e),content:e.content};return e.name!=null&&(t.name=e.name),e.additional_kwargs.function_call!=null&&(t.function_call=e.additional_kwargs.function_call),is(e)&&e.tool_calls?.length?t.tool_calls=e.tool_calls.map(vu):(e.additional_kwargs.tool_calls!=null&&(t.tool_calls=e.additional_kwargs.tool_calls),e.tool_call_id!=null&&(t.tool_call_id=e.tool_call_id)),t})}var zn=class extends Vr{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??ne("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=e?.azureOpenAIApiKey??ne("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=e?.azureADTokenProvider??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??ne("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??ne("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??ne("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??ne("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??ne("OPENAI_ORGANIZATION"),this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){return this.bind({tools:e.map(Va),...t})}invocationParams(e){function t(s){return s!==void 0&&s.every(a=>Array.isArray(a.lc_namespace))}return{model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:t(e?.tools)?e?.tools.map(Va):e?.tools,tool_choice:e?.tool_choice,response_format:e?.response_format,seed:e?.seed,...e?.stream_options!==void 0?{stream_options:e.stream_options}:{},parallel_tool_calls:e?.parallel_tool_calls,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){let s=Uv(e),a={...this.invocationParams(t),messages:s,stream:!0},i,o=await this.completionWithRetry(a,t),l;for await(let c of o){let u=c?.choices[0];if(c.usage&&(l=c.usage),!u)continue;let{delta:d}=u;if(!d)continue;let p=sR(d,i);i=d.role??i;let f={prompt:t.promptIndex??0,completion:u.index??0};if(typeof p.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let h={...f};u.finish_reason!==void 0&&(h.finish_reason=u.finish_reason),this.logprobs&&(h.logprobs=u.logprobs);let m=new Ne({message:p,text:p.content,generationInfo:h});yield m,r?.handleLLMNewToken(m.text??"",f,void 0,void 0,void 0,{chunk:m})}if(l&&(yield new Ne({message:new he({content:"",usage_metadata:{input_tokens:l.prompt_tokens,output_tokens:l.completion_tokens,total_tokens:l.total_tokens}}),text:""})),t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){let s={},a=this.invocationParams(t),i=Uv(e);if(a.stream){let o=this._streamResponseChunks(e,t,r),l={};for await(let h of o){h.message.response_metadata={...h.generationInfo,...h.message.response_metadata};let m=h.generationInfo?.completion??0;l[m]===void 0?l[m]=h:l[m]=l[m].concat(h)}let c=Object.entries(l).sort(([h],[m])=>parseInt(h,10)-parseInt(m,10)).map(([h,m])=>m),{functions:u,function_call:d}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,u,d),f=await this.getNumTokensFromGenerations(c);return s.promptTokens=p,s.completionTokens=f,s.totalTokens=p+f,{generations:c,llmOutput:{estimatedTokenUsage:s}}}else{let o=await this.completionWithRetry({...a,stream:!1,messages:i},{signal:t?.signal,...t?.options}),{completion_tokens:l,prompt_tokens:c,total_tokens:u}=o?.usage??{};l&&(s.completionTokens=(s.completionTokens??0)+l),c&&(s.promptTokens=(s.promptTokens??0)+c),u&&(s.totalTokens=(s.totalTokens??0)+u);let d=[];for(let p of o?.choices??[]){let h={text:p.message?.content??"",message:nR(p.message??{role:"assistant"})};h.generationInfo={...p.finish_reason?{finish_reason:p.finish_reason}:{},...p.logprobs?{logprobs:p.logprobs}:{}},is(h.message)&&(h.message.usage_metadata={input_tokens:s.promptTokens??0,output_tokens:s.completionTokens??0,total_tokens:s.totalTokens??0}),d.push(h)}return{generations:d,llmOutput:{tokenUsage:s}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){let a=Fv(t);s+=await this.getNumTokens(a),s+=9}return t&&e.find(a=>a._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>r.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let t=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);let a=await Promise.all(e.map(async i=>{let o=await this.getNumTokens(i.content),l=await this.getNumTokens(zv(i)),c=i.name!==void 0?s+await this.getNumTokens(i.name):0,u=o+r+l+c,d=i;if(d._getType()==="function"&&(u-=2),d.additional_kwargs?.function_call&&(u+=3),d?.additional_kwargs.function_call?.name&&(u+=await this.getNumTokens(d.additional_kwargs.function_call?.name)),d.additional_kwargs.function_call?.arguments)try{u+=await this.getNumTokens(JSON.stringify(JSON.parse(d.additional_kwargs.function_call?.arguments)))}catch(p){console.error("Error parsing function arguments",p,JSON.stringify(d.additional_kwargs.function_call)),u+=await this.getNumTokens(d.additional_kwargs.function_call?.arguments)}return t+=u,u}));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){let r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw Gi(s)}})}_getClientOptions(e){if(!this.client){let r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},s=Bn(r),a={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new D(a)}let t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let r,s,a,i;aR(e)?(r=e.schema,s=e.name,a=e.method,i=e.includeRaw):(r=e,s=t?.name,a=t?.method,i=t?.includeRaw);let o,l;if(a==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Bv(r)?l=La.fromZodSchema(r):l=new Fa;else{let p=s??"extract";if(Bv(r)){let f=We(r);o=this.bind({tools:[{type:"function",function:{name:p,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:p}}}),l=new xn({returnSingle:!0,keyName:p,zodSchema:r})}else{let f;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(f=r,p=r.name):(p=r.title??p,f={name:p,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:p}}}),l=new xn({returnSingle:!0,keyName:p})}}if(!i)return o.pipe(l);let c=qe.assign({parsed:(p,f)=>l.invoke(p.raw,f)}),u=qe.assign({parsed:()=>null}),d=c.withFallbacks({fallbacks:[u]});return xt.from([{raw:o},d])}};function Bv(n){return typeof n?.parse=="function"}function aR(n){return n!==void 0&&typeof n.schema=="object"}_s();ka();Sa();Bc();Lc();ur();as();Sa();ws();wa();Ra();ql();var Kh=class extends No{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat}async invoke(e,t){let r,s;va(e)?(r=e.id,s=e.args):s=e;let a=Q(t);return this.call(s,{...a,configurable:{...a.configurable,tool_call_id:r}})}async call(e,t,r){let s;try{s=await this.schema.parseAsync(e)}catch(f){let h="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(h=`${h}
Details: ${f.message}`),new _a(h,JSON.stringify(e))}let a=Pw(t),o=await(await ze.configure(a.callbacks,this.callbacks,a.tags||r,this.tags,a.metadata,this.metadata,{verbose:this.verbose}))?.handleToolStart(this.toJSON(),typeof s=="string"?s:JSON.stringify(s),a.runId,void 0,void 0,void 0,a.runName);delete a.runId;let l;try{l=await this._call(s,o,a)}catch(f){throw await o?.handleToolError(f),f}let c,u;if(this.responseFormat==="content_and_artifact")if(Array.isArray(l)&&l.length===2)[c,u]=l;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(l)}`);else c=l;let d;a&&"configurable"in a&&(d=a.configurable.tool_call_id);let p=iR({content:c,artifact:u,toolCallId:d,name:this.name});return await o?.handleToolEnd(p),p}},ed=class extends Kh{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:ut.object({input:ut.string().optional()}).transform(t=>t.input)})}call(e,t){return super.call(typeof e=="string"||!e?{input:e}:e,t)}};function iR(n){let{content:e,artifact:t,toolCallId:r}=n;return r?typeof e=="string"||Array.isArray(e)&&e.every(s=>typeof s=="object")?new Mr({content:e,artifact:t,tool_call_id:r,name:n.name}):new Mr({content:oR(e),artifact:t,tool_call_id:r,name:n.name}):e}function oR(n){try{return JSON.stringify(n,null,2)}catch{return`${n}`}}var Wh=class extends ed{static lc_name(){return"DallEAPIWrapper"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=e?.apiKey??e?.openAIApiKey??ne("OPENAI_API_KEY"),r=e?.organization??ne("OPENAI_ORGANIZATION"),s={apiKey:t,organization:r,dangerouslyAllowBrowser:!0};this.client=new D(s),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.responseFormat=e?.responseFormat??this.responseFormat,this.user=e?.user}async _call(e){let t=await this.client.images.generate({model:this.model,prompt:e,n:this.n,size:this.size,response_format:this.responseFormat,style:this.style,quality:this.quality,user:this.user}),r="";return this.responseFormat==="url"?[r]=t.data.map(s=>s.url).filter(s=>s!=="undefined"):[r]=t.data.map(s=>s.b64_json).filter(s=>s!=="undefined"),r}};Object.defineProperty(Wh,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});var yl=Ct(Kv());var td,pR=new Uint8Array(16);function Jh(){if(!td&&(td=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!td))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return td(pR)}var Ve=[];for(let n=0;n<256;++n)Ve.push((n+256).toString(16).slice(1));function Wv(n,e=0){return Ve[n[e+0]]+Ve[n[e+1]]+Ve[n[e+2]]+Ve[n[e+3]]+"-"+Ve[n[e+4]]+Ve[n[e+5]]+"-"+Ve[n[e+6]]+Ve[n[e+7]]+"-"+Ve[n[e+8]]+Ve[n[e+9]]+"-"+Ve[n[e+10]]+Ve[n[e+11]]+Ve[n[e+12]]+Ve[n[e+13]]+Ve[n[e+14]]+Ve[n[e+15]]}var fR=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Yh={randomUUID:fR};function hR(n,e,t){if(Yh.randomUUID&&!e&&!n)return Yh.randomUUID();n=n||{};let r=n.random||(n.rng||Jh)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return Wv(r)}var Ki=hR;var rd=class{constructor(e){this.secret=e}_encode(e){return new TextEncoder().encode(e)}_decode(e){return new TextDecoder().decode(e)}async _importKey(e){let t=await crypto.subtle.importKey("raw",this._encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:this._encode("salt"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async _encrypt(e){try{let t=await this._importKey(this.secret),r=crypto.getRandomValues(new Uint8Array(12)),s=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,this._encode(e));return{iv:r,encrypted:s}}catch(t){throw new Error(`Encryption failed: ${t.message}`)}}async _decrypt(e,t){try{let r=await this._importKey(this.secret),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},r,e);return this._decode(s)}catch(r){throw new Error(`Decryption failed: ${r.message}`)}}async saveAPIKey(e,t){try{let{iv:r,encrypted:s}=await this._encrypt(t),a={iv:Array.from(r),encrypted:Array.from(new Uint8Array(s))};localStorage.setItem(e,JSON.stringify(a))}catch(r){throw new Error(`Failed to save API key for ${e}: ${r.message}`)}}async getAPIKey(e){try{let t=localStorage.getItem(e);if(!t)return null;let{iv:r,encrypted:s}=JSON.parse(t);return await this._decrypt(new Uint8Array(s),new Uint8Array(r))}catch(t){throw new Error(`Failed to retrieve API key for ${e}: ${t.message}`)}}deleteAPIKey(e){localStorage.removeItem(e)}apiKeyExists(e){return localStorage.getItem(e)!==null}};var ye=["OpenAI","Google","Ollama","Groq","OpenRouter","Qwen","OpenAI-Like"],Se="OpenAI-Like";var Jv='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14L21 3m0 0l-6.5 18a.55.55 0 0 1-1 0L10 14l-7-3.5a.55.55 0 0 1 0-1L21 3"/></svg>',gl='<svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M15 37.95q-1.25 0-2.125-.875T12 34.95v-28q0-1.25.875-2.125T15 3.95h22q1.25 0 2.125.875T40 6.95v28q0 1.25-.875 2.125T37 37.95Zm0-3h22v-28H15v28Zm-6 9q-1.25 0-2.125-.875T6 40.95V12.3q0-.65.425-1.075Q6.85 10.8 7.5 10.8q.65 0 1.075.425Q9 11.65 9 12.3v28.65h22.2q.65 0 1.075.425.425.425.425 1.075 0 .65-.425 1.075-.425.425-1.075.425Zm6-37v28-28Z"/></svg>',Yv='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-stop"><circle cx="12" cy="12" r="10"/><rect width="6" height="6" x="9" y="9"/></svg>';var Ge=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},ot={searchParams:"URLSearchParams"in Ge,iterable:"Symbol"in Ge&&"iterator"in Symbol,blob:"FileReader"in Ge&&"Blob"in Ge&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in Ge,arrayBuffer:"ArrayBuffer"in Ge};function mR(n){return n&&DataView.prototype.isPrototypeOf(n)}ot.arrayBuffer&&(Zv=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Qv=ArrayBuffer.isView||function(n){return n&&Zv.indexOf(Object.prototype.toString.call(n))>-1});var Zv,Qv;function Wi(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function Xh(n){return typeof n!="string"&&(n=String(n)),n}function Qh(n){var e={next:function(){var t=n.shift();return{done:t===void 0,value:t}}};return ot.iterable&&(e[Symbol.iterator]=function(){return e}),e}function Re(n){this.map={},n instanceof Re?n.forEach(function(e,t){this.append(t,e)},this):Array.isArray(n)?n.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(e){this.append(e,n[e])},this)}Re.prototype.append=function(n,e){n=Wi(n),e=Xh(e);var t=this.map[n];this.map[n]=t?t+", "+e:e};Re.prototype.delete=function(n){delete this.map[Wi(n)]};Re.prototype.get=function(n){return n=Wi(n),this.has(n)?this.map[n]:null};Re.prototype.has=function(n){return this.map.hasOwnProperty(Wi(n))};Re.prototype.set=function(n,e){this.map[Wi(n)]=Xh(e)};Re.prototype.forEach=function(n,e){for(var t in this.map)this.map.hasOwnProperty(t)&&n.call(e,this.map[t],t,this)};Re.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),Qh(n)};Re.prototype.values=function(){var n=[];return this.forEach(function(e){n.push(e)}),Qh(n)};Re.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),Qh(n)};ot.iterable&&(Re.prototype[Symbol.iterator]=Re.prototype.entries);function Zh(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function e0(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function gR(n){var e=new FileReader,t=e0(e);return e.readAsArrayBuffer(n),t}function yR(n){var e=new FileReader,t=e0(e),r=/charset=([A-Za-z0-9_-]+)/.exec(n.type),s=r?r[1]:"utf-8";return e.readAsText(n,s),t}function bR(n){for(var e=new Uint8Array(n),t=new Array(e.length),r=0;r<e.length;r++)t[r]=String.fromCharCode(e[r]);return t.join("")}function Xv(n){if(n.slice)return n.slice(0);var e=new Uint8Array(n.byteLength);return e.set(new Uint8Array(n)),e.buffer}function t0(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:ot.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:ot.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:ot.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():ot.arrayBuffer&&ot.blob&&mR(n)?(this._bodyArrayBuffer=Xv(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):ot.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||Qv(n))?this._bodyArrayBuffer=Xv(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):ot.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},ot.blob&&(this.blob=function(){var n=Zh(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=Zh(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(ot.blob)return this.blob().then(gR);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=Zh(this);if(n)return n;if(this._bodyBlob)return yR(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(bR(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},ot.formData&&(this.formData=function(){return this.text().then(vR)}),this.json=function(){return this.text().then(JSON.parse)},this}var wR=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function _R(n){var e=n.toUpperCase();return wR.indexOf(e)>-1?e:n}function aa(n,e){if(!(this instanceof aa))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var t=e.body;if(n instanceof aa){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,e.headers||(this.headers=new Re(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!t&&n._bodyInit!=null&&(t=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new Re(e.headers)),this.method=_R(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in Ge){var a=new AbortController;return a.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&t)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(t),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}aa.prototype.clone=function(){return new aa(this,{body:this._bodyInit})};function vR(n){var e=new FormData;return n.trim().split("&").forEach(function(t){if(t){var r=t.split("="),s=r.shift().replace(/\+/g," "),a=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(s),decodeURIComponent(a))}}),e}function xR(n){var e=new Re,t=n.replace(/\r?\n[\t ]+/g," ");return t.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var s=r.split(":"),a=s.shift().trim();if(a){var i=s.join(":").trim();try{e.append(a,i)}catch(o){console.warn("Response "+o.message)}}}),e}t0.call(aa.prototype);function Tr(n,e){if(!(this instanceof Tr))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new Re(e.headers),this.url=e.url||"",this._initBody(n)}t0.call(Tr.prototype);Tr.prototype.clone=function(){return new Tr(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Re(this.headers),url:this.url})};Tr.error=function(){var n=new Tr(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var AR=[301,302,303,307,308];Tr.redirect=function(n,e){if(AR.indexOf(e)===-1)throw new RangeError("Invalid status code");return new Tr(null,{status:e,headers:{location:n}})};var sa=Ge.DOMException;try{new sa}catch{sa=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},sa.prototype=Object.create(Error.prototype),sa.prototype.constructor=sa}function r0(n,e){return new Promise(function(t,r){var s=new aa(n,e);if(s.signal&&s.signal.aborted)return r(new sa("Aborted","AbortError"));var a=new XMLHttpRequest;function i(){a.abort()}a.onload=function(){var c={statusText:a.statusText,headers:xR(a.getAllResponseHeaders()||"")};s.url.indexOf("file://")===0&&(a.status<200||a.status>599)?c.status=200:c.status=a.status,c.url="responseURL"in a?a.responseURL:c.headers.get("X-Request-URL");var u="response"in a?a.response:a.responseText;setTimeout(function(){t(new Tr(u,c))},0)},a.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},a.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},a.onabort=function(){setTimeout(function(){r(new sa("Aborted","AbortError"))},0)};function o(c){try{return c===""&&Ge.location.href?Ge.location.href:c}catch{return c}}if(a.open(s.method,o(s.url),!0),s.credentials==="include"?a.withCredentials=!0:s.credentials==="omit"&&(a.withCredentials=!1),"responseType"in a&&(ot.blob?a.responseType="blob":ot.arrayBuffer&&(a.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof Re||Ge.Headers&&e.headers instanceof Ge.Headers)){var l=[];Object.getOwnPropertyNames(e.headers).forEach(function(c){l.push(Wi(c)),a.setRequestHeader(c,Xh(e.headers[c]))}),s.headers.forEach(function(c,u){l.indexOf(u)===-1&&a.setRequestHeader(u,c)})}else s.headers.forEach(function(c,u){a.setRequestHeader(u,c)});s.signal&&(s.signal.addEventListener("abort",i),a.onreadystatechange=function(){a.readyState===4&&s.signal.removeEventListener("abort",i)}),a.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}r0.polyfill=!0;Ge.fetch||(Ge.fetch=r0,Ge.Headers=Re,Ge.Request=aa,Ge.Response=Tr);var s0="11434",a0=`http://127.0.0.1:${s0}`,ER="0.5.17",IR=Object.defineProperty,OR=(n,e,t)=>e in n?IR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,em=(n,e,t)=>(OR(n,typeof e!="symbol"?e+"":e,t),t),rm=class n extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,n)}},nm=class{constructor(e,t,r){em(this,"abortController"),em(this,"itr"),em(this,"doneCallback"),this.abortController=e,this.itr=t,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(let e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||e.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}},sm=async n=>{if(n.ok)return;let e=`Error ${n.status}: ${n.statusText}`,t=null;if(n.headers.get("content-type")?.includes("application/json"))try{t=await n.json(),e=t.error||e}catch{console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await n.text()||e}catch{console.log("Failed to get text from error response")}throw new rm(e,n.status)};function TR(){if(typeof window<"u"&&window.navigator){let n=navigator;return"userAgentData"in n&&n.userAgentData?.platform?`${n.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`:navigator.platform?`${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:`unknown Browser/${navigator.userAgent};`}else if(typeof process<"u")return`${process.arch} ${process.platform} Node.js/${process.version}`;return""}function CR(n){if(n instanceof Headers){let e={};return n.forEach((t,r)=>{e[r]=t}),e}else return Array.isArray(n)?Object.fromEntries(n):n||{}}var am=async(n,e,t={})=>{let r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${ER} (${TR()})`};t.headers=CR(t.headers);let s=Object.fromEntries(Object.entries(t.headers).filter(([a])=>!Object.keys(r).some(i=>i.toLowerCase()===a.toLowerCase())));return t.headers={...r,...s},n(e,t)},n0=async(n,e,t)=>{let r=await am(n,e,{headers:t?.headers});return await sm(r),r},Ji=async(n,e,t,r)=>{let a=(o=>o!==null&&typeof o=="object"&&!Array.isArray(o))(t)?JSON.stringify(t):t,i=await am(n,e,{method:"POST",body:a,signal:r?.signal,headers:r?.headers});return await sm(i),i},PR=async(n,e,t,r)=>{let s=await am(n,e,{method:"DELETE",body:JSON.stringify(t),headers:r?.headers});return await sm(s),s},SR=async function*(n){let e=new TextDecoder("utf-8"),t="",r=n.getReader();for(;;){let{done:s,value:a}=await r.read();if(s)break;t+=e.decode(a);let i=t.split(`
`);t=i.pop()??"";for(let o of i)try{yield JSON.parse(o)}catch{console.warn("invalid json: ",o)}}for(let s of t.split(`
`).filter(a=>a!==""))try{yield JSON.parse(s)}catch{console.warn("invalid json: ",s)}},RR=n=>{if(!n)return a0;let e=n.includes("://");n.startsWith(":")&&(n=`http://127.0.0.1${n}`,e=!0),e||(n=`http://${n}`);let t=new URL(n),r=t.port;r||(e?r=t.protocol==="https:"?"443":"80":r=s0);let s="";t.username&&(s=t.username,t.password&&(s+=`:${t.password}`),s+="@");let a=`${t.protocol}//${s}${t.hostname}:${r}${t.pathname}`;return a.endsWith("/")&&(a=a.slice(0,-1)),a},kR=Object.defineProperty,NR=(n,e,t)=>e in n?kR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,tm=(n,e,t)=>(NR(n,typeof e!="symbol"?e+"":e,t),t),im=class{constructor(e){tm(this,"config"),tm(this,"fetch"),tm(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e?.headers},e?.proxy||(this.config.host=RR(e?.host??a0)),this.fetch=e?.fetch??fetch}abort(){for(let e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){t.stream=t.stream??!1;let r=`${this.config.host}/api/${e}`;if(t.stream){let a=new AbortController,i=await Ji(this.fetch,r,t,{signal:a.signal,headers:this.config.headers});if(!i.body)throw new Error("Missing body");let o=SR(i.body),l=new nm(a,o,()=>{let c=this.ongoingStreamedRequests.indexOf(l);c>-1&&this.ongoingStreamedRequests.splice(c,1)});return this.ongoingStreamedRequests.push(l),l}return await(await Ji(this.fetch,r,t,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){let t=new Uint8Array(e),r="",s=t.byteLength;for(let a=0;a<s;a++)r+=String.fromCharCode(t[a]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(let t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await PR(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await Ji(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await n0(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await Ji(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await Ji(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await Ji(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await n0(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}},yK=new im;async function ia(n,e){let t;try{switch(n){case ye[0]:let r=await fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!r.ok)throw acode.alert("AI Assistant",`Error fetching OpenAI models: ${r.statusText}`),new Error(`Error fetching OpenAI models: ${r.statusText}`);t=(await r.json()).data.filter(h=>/gpt/i.test(h.id)).map(h=>h.id);break;case ye[1]:let a=await fetch(`https://generativelanguage.googleapis.com/v1/models?key=${e}`,{headers:{"Content-Type":"application/json"}});if(!a.ok)throw acode.alert("AI Assistant",`Error fetching Google AI models: ${a.statusText}`),new Error(`Error fetching Google AI models: ${a.statusText}`);t=(await a.json()).models.filter(h=>/gemini/i.test(h.name)).map(h=>h.name.replace(/^models\//,""));break;case ye[2]:let o=window.localStorage.getItem("Ollama-Host")?window.localStorage.getItem("Ollama-Host"):"http://localhost:11434";t=(await new im({host:o}).list()).models.map(h=>h.model);break;case ye[3]:let u=await fetch("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!u.ok)throw acode.alert("AI Assistant",`Error fetching Groq AI models: ${u.statusText}`),new Error(`Error fetching Groq AI models: ${u.statusText}`);t=(await u.json()).data.map(h=>h.id);break;case ye[4]:let p=await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!p.ok)throw acode.alert("AI Assistant",`Error fetching OpenRouter models: ${p.statusText}`),new Error(`Error fetching OpenRouter models: ${p.statusText}`);t=(await p.json()).data.map(h=>h.id);break;case ye[5]:t=["qwen-turbo","qwen-plus","qwen-max","qwen-max-longcontext","qwen-7b-chat","qwen-14b-chat","qwen-72b-chat","qwen2.5-coder-32b-instruct"];break;case Se:return[];default:throw new Error(`Unsupported provider: ${n}`)}}catch(r){return console.error(r.message),[]}return t}var nd=acode.require("multiPrompt"),j=acode.require("fs"),ue=acode.require("select"),be=acode.require("prompt"),$R=acode.require("dialogBox"),MR=acode.require("helpers"),ie=acode.require("loader"),qK=acode.require("sidebarApps"),HK=acode.require("toInternalUrl"),jR=acode.require("contextMenu"),LR=acode.require("selectionMenu"),Le=acode.require("terminal"),{editor:A}=editorManager,sd=window.DATA_STORAGE+"cli",Cr=null,om=class{constructor(){this.baseUrl=window.DATA_STORAGE+wl.id+"/",this.responseCache=new Map,this.cacheTimeout=30*60*1e3,this.fileCache=new Map,this.projectStructure=null,this.lastStructureScan=null,this.realTimeEnabled=!1,this.realTimeDebounceTimer=null,this.realTimeDelay=5e3,this.lastAnalyzedContent="",this.currentSuggestions=[],this.suggestionWidget=null,this.errorMarkers=[],this.realTimeAnalysisCache=new Map,this.tokenUsage={total:0,today:0,session:0,lastReset:new Date().toDateString()},this.loadTokenUsage(),this.updateTokenDisplay=this.updateTokenDisplay.bind(this)}async init(e){this.$githubDarkFile=tag("link",{rel:"stylesheet",href:this.baseUrl+"assets/github-dark.css"}),this.$higlightJsFile=tag("script",{src:this.baseUrl+"assets/highlight.min.js"}),this.$markdownItFile=tag("script",{src:this.baseUrl+"assets/markdown-it.min.js"}),this.$style=tag("style",{textContent:lm}),document.head.append(this.$githubDarkFile,this.$higlightJsFile,this.$markdownItFile,this.$style),A.commands.addCommand({name:"ai_assistant",description:"Renz Ai",exec:this.run.bind(this)}),LR.add(async()=>{let d=await ue("AI Actions",["Explain Code","Rewrite","Generate Code","Run Current File","Optimize Function","Add Comments","Generate Docs","Edit with AI"]);if(d)if(d==="Run Current File")await this.runCurrentFile();else{let p=A.getSelectedText();p?await this.handleSelectionAction(d,p):window.toast("Please select some code first",3e3)}},"\u2728","all"),e.id="acode-ai-assistant",e.settitle("Renz Ai"),this.$page=e;let t=tag("span",{className:"icon more_vert",dataset:{action:"toggle-menu"}}),r=tag("span",{className:"icon historyrestore",dataset:{action:"history"}}),s=tag("span",{className:"icon add",dataset:{action:"new-chat"}}),a=tag("span",{className:"icon insert_invitationevent",dataset:{action:"insert-context"}});a.onclick=async()=>{let d=editorManager.activeFile;if(d){let p=A.getValue(),f=`Current file: ${d&&d.name?d.name:"Unknown"}

Content:
\`\`\`
${p||""}
\`\`\`

How can I help you with this code?`;this.$page.isVisible||await this.run(),this.$chatTextarea.value=f,this.$chatTextarea.focus()}else window.toast("No active file to insert context",3e3)};let i=this.createTokenDisplay(),o=tag("span",{className:"icon",textContent:"\u{1F50D}",title:"Search in chat"});o.onclick=()=>this.searchInChat(),this.$page.header.append(i,o,s,a,r,t),r.onclick=this.myHistory.bind(this),s.onclick=this.newChat.bind(this),A.commands.addCommand({name:"ai_edit_current_file",description:"Edit Current File with AI",bindKey:{win:"Ctrl-Shift-E",mac:"Cmd-Shift-E"},exec:()=>this.showAiEditPopup()}),A.commands.addCommand({name:"ai_explain_code",description:"Explain Selected Code",bindKey:{win:"Ctrl-E",mac:"Cmd-E"},exec:()=>{let d=A.getSelectedText();if(d)this.explainCodeWithChat(d,editorManager.activeFile);else{let p=editorManager.activeFile;if(p){let f=A.getValue();this.explainCodeWithChat(f,p)}else window.toast("No code to explain",3e3)}}}),A.commands.addCommand({name:"ai_generate_code",description:"Generate Code with AI",bindKey:{win:"Ctrl-Shift-G",mac:"Cmd-Shift-G"},exec:()=>this.showGenerateCodePopup()}),A.commands.addCommand({name:"ai_run_file",description:"Run Current File",bindKey:{win:"Ctrl-Shift-R",mac:"Cmd-Shift-R"},exec:()=>this.runCurrentFile()}),A.commands.addCommand({name:"ai_optimize_function",description:"Optimize Selected Function",bindKey:{win:"Ctrl-Shift-O",mac:"Cmd-Shift-O"},exec:()=>{let d=A.getSelectedText();d?this.optimizeFunctionWithChat(d):window.toast("Please select function to optimize",3e3)}}),A.commands.addCommand({name:"ai_add_comments",description:"Add Comments to Code",bindKey:{win:"Ctrl-Shift-C",mac:"Cmd-Shift-C"},exec:()=>{let d=A.getSelectedText();d?this.addCommentsWithChat(d):window.toast("Please select code to add comments",3e3)}}),A.commands.addCommand({name:"ai_generate_docs",description:"Generate Documentation",bindKey:{win:"Ctrl-Shift-D",mac:"Cmd-Shift-D"},exec:()=>{let d=A.getSelectedText(),p=editorManager.activeFile;d?this.generateDocsWithChat(d):p?this.generateDocsWithChat(null):window.toast("No code to document",3e3)}}),A.commands.addCommand({name:"ai_rewrite_code",description:"Rewrite Selected Code",bindKey:{win:"Ctrl-Shift-R",mac:"Cmd-Shift-R"},exec:()=>{let d=A.getSelectedText();d?this.rewriteCodeWithChat(d):window.toast("Please select code to rewrite",3e3)}});let c=jR({innerHTML:()=>`
      <li action="model-provider" provider="">Provider: ${window.localStorage.getItem("ai-assistant-provider")}</li>
      <li action="model" modelNme="">Model: ${window.localStorage.getItem("ai-assistant-model-name")}</li>
      <li action="clear-cache">Clear Cache</li>
      <li action="clear-chat">Clear Chat History</li>
      <li action="export-chat">Export Conversation</li>
      <li action="copy-all">Copy All Messages</li>
      <li action="create-file-ai">Create File with AI</li>
      <li action="organize-project">Organize Project</li>
      <li action="bulk-operations">Bulk Operations</li>
      <li action="settings">Settings</li>
      `,...{top:"35px",right:"10px",toggler:t,transformOrigin:"top right"}});c.onclick=async d=>{switch(c.hide(),d.target.getAttribute("action")){case"model-provider":let f=window.localStorage.getItem("ai-assistant-provider"),h=await ue("Select AI Provider",ye,{default:f||""});if(f!=h)if(h===Se){let w=await be("API Key","","text",{required:!0});if(!w)return;let b=await be("API Base URL","https://api.openai.com/v1","text",{required:!0}),E=await be("Model","","text",{required:!0});if(!E)return;window.localStorage.setItem("ai-assistant-provider",Se),window.localStorage.setItem("ai-assistant-model-name",E),window.localStorage.setItem("openai-like-baseurl",b),await this.apiKeyManager.saveAPIKey(Se,w),this.initiateModel(Se,w,E),this.newChat()}else if(window.localStorage.getItem(h)===null){let w=h==ye[2]?"No Need Of API Key":await be("API key of selected provider","","text",{required:!0});if(!w)return;ie.showTitleLoader(),window.toast("Fetching available models from your account",2e3);let b=await ia(h,w);ie.removeTitleLoader();let E=await ue("Select AI Model",b);window.localStorage.setItem("ai-assistant-provider",h),window.localStorage.setItem("ai-assistant-model-name",E),await this.apiKeyManager.saveAPIKey(h,w),this.initiateModel(h,w,E),this.newChat()}else{let w=await this.apiKeyManager.getAPIKey(h);this.initiateModel(h,w,window.localStorage.getItem("ai-assistant-model-name")),this.newChat()}break;case"clear-cache":this.clearCache();break;case"create-file-ai":await this.createFileWithAI();break;case"organize-project":await this.organizeProjectStructure();break;case"bulk-operations":await this.bulkFileOperations();break;case"clear-chat":await this.clearChatHistory();break;case"export-chat":await this.exportConversation();break;case"copy-all":await this.copyAllMessages();break;case"settings":await this.showSettings();break;case"toggle-realtime":this.toggleRealTimeAI();break;case"model":let m=window.localStorage.getItem("ai-assistant-provider"),g=await this.apiKeyManager.getAPIKey(m);if(m===Se){let w=window.localStorage.getItem("ai-assistant-model-name")||"",b=await be("Enter Model",w,"text",{required:!0});b&&(window.localStorage.setItem("ai-assistant-model-name",b),this.initiateModel(Se,g,b))}else{ie.showTitleLoader(),window.toast("Fetching available models from your account",2e3);let w=await ia(m,g);ie.removeTitleLoader();let b=await ue("Select AI Model",w,{default:window.localStorage.getItem("ai-assistant-model-name")||""});window.localStorage.getItem("ai-assistant-model-name")!=b&&(window.localStorage.setItem("ai-assistant-model-name",b),this.initiateModel(m,g,b))}break}};let u=tag("div",{className:"mainApp"});this.$chatBox=tag("div",{className:"chatBox"}),this.$inputBox=tag("div",{className:"inputBox"}),this.$chatTextarea=tag("textarea",{className:"chatTextarea",placeholder:"Type your query..."}),this.$sendBtn=tag("button",{className:"sendBtn"}),this.$sendBtn.innerHTML=Jv,this.$stopGenerationBtn=tag("button",{className:"stopGenerationBtn hide"}),this.$stopGenerationBtn.innerHTML=Yv,this.$stopGenerationBtn.onclick=this.stopGenerating.bind(this),this.$inputBox.append(this.$chatTextarea,this.$sendBtn,this.$stopGenerationBtn),u.append(this.$inputBox,this.$chatBox),this.$page.append(u),this.setupRealTimeAI(),this.setupCommandPaletteIntegration(),this.setupTerminalCommands(),this.messageHistories={},this.messageSessionConfig={configurable:{sessionId:Ki()}}}setupCommandPaletteIntegration(){A.commands.addCommand({name:"ai_command_palette",description:"AI Command Palette Control",exec:()=>this.showAiCommandPalette()}),A.commands.addCommand({name:"ai_chat_command",description:"Execute Command via AI Chat",exec:()=>this.executeCommandViaChat()})}async showAiCommandPalette(){try{let e=this.getAvailableCommands(),t=await be("Ask AI to run a command (e.g., 'format code', 'toggle sidebar', 'open file')","","text",{required:!0});if(!t)return;let r=`Match "${t}" to command:
${e.slice(0,30).map(i=>`${i.name}`).join(", ")}
Return exact name or "UNKNOWN":`,a=(await this.appendGptResponse(r)).trim().replace(/[^a-zA-Z0-9_-]/g,"");if(a&&a!=="UNKNOWN"){let i=A.commands.commands[a];i?(i.exec(),window.toast(`\u2705 Executed: ${a}`,3e3)):window.toast(`\u274C Command not found: ${a}`,3e3)}else window.toast("\u274C Could not determine command from request",3e3)}catch{window.toast("\u274C Error with command palette",3e3)}}getAvailableCommands(){let e=A.commands.commands;return Object.keys(e).map(t=>({name:t,description:e[t].description||""}))}setupTerminalCommands(){A.commands.addCommand({name:"ai_terminal_execute",description:"AI Terminal Command Execution",bindKey:{win:"Ctrl-Alt-T",mac:"Cmd-Alt-T"},exec:()=>this.showAiTerminal()})}async showAiTerminal(){try{let e=await be("Enter terminal command or describe what you want to do:","","text",{required:!0});if(!e)return;if(e.includes(" ")&&!e.startsWith("/")&&!e.includes("&&")&&!e.startsWith("ls")&&!e.startsWith("cd")&&!e.startsWith("pwd"))try{let t=`Convert "${e}" to safe terminal command.
Rules: No rm/delete. Dev tasks only.
Examples: "list files"\u2192"ls -la", "show dir"\u2192"pwd"
Reply with only the command, no explanation:`,s=(await this.getAIResponse(t)).trim().replace(/[;&|`$()]/g,"").split(`
`)[0];s&&!s.includes("rm ")&&!s.includes("delete")?this.executeTerminalCommand(s):window.toast("\u274C Command not safe or unclear",3e3)}catch{window.toast("\u274C AI conversion failed, executing directly",3e3),this.executeTerminalCommand(e)}else this.executeTerminalCommand(e)}catch{window.toast("\u274C Error with terminal execution",3e3)}}async executeTerminalCommand(e){try{if(await be(`Execute: ${e}?`,"","text",{required:!1})!==null){let r=editorManager.activeFile,s=r?.uri?r.uri.split("/").slice(0,-1).join("/"):"/",a=await Le.create({name:"AI Terminal",serverMode:!0});a&&a.id?(Le.write(a.id,e+`\r
`),window.toast(`\u{1F680} Executing: ${e}`,3e3),this.appendSystemMessage(`Terminal: ${e}`)):window.toast("\u274C Cannot create terminal",3e3)}}catch{window.toast("\u274C Terminal execution failed",3e3)}}async executeCommandViaChat(){try{(!this.$page||!this.$page.isVisible)&&await this.run();let t=this.getAvailableCommands().slice(0,20).map(r=>`\u2022 ${r.name}`).join(`
`);this.appendSystemMessage(`Available Commands:
${t}

Type: "run command [name]" or describe what you want to do`),this.$chatTextarea&&this.$chatTextarea.focus()}catch{window.toast("\u274C Error opening AI chat",3e3)}}async executeCommandFromChat(e){try{let t=this.getAvailableCommands(),r=`Find command for "${e}":
${t.slice(0,25).map(i=>i.name).join(", ")}
Exact name:`;this.appendSystemMessage(`\u{1F504} Processing command: "${e}"`);let a=(await this.appendGptResponse(r)).trim().replace(/[^a-zA-Z0-9_-]/g,"");if(a&&a!=="UNKNOWN"){let i=A.commands.commands[a];i?(i.exec(),this.appendSystemMessage(`\u2705 Executed command: ${a}`)):this.appendSystemMessage(`\u274C Command not found: ${a}`)}else this.appendSystemMessage(`\u274C Could not determine command from request: "${e}"`)}catch(t){this.appendSystemMessage(`\u274C Error processing command: ${t.message}`)}}appendSystemMessage(e){if(this.$chatBox){let t=tag("div",{className:"system_message",style:`
          background: var(--galaxy-void);
          color: var(--galaxy-star-green);
          padding: 8px 16px;
          margin: 8px 0;
          border-left: 3px solid var(--galaxy-star-green);
          border-radius: 8px;
          font-family: monospace;
          font-size: 14px;
          white-space: pre-line;
        `,textContent:e});this.$chatBox.appendChild(t),this.scrollToBottom()}}async run(){try{let e;if(await j(window.DATA_STORAGE+"secret.key").exists())e=await j(window.DATA_STORAGE+"secret.key").readFile("utf-8");else{let a=await be("Enter a secret pass phrase to save the API key","","text",{required:!0});if(!a)return;e=a}this.apiKeyManager=new rd(e);let t,r=window.localStorage.getItem("ai-assistant-provider");if(r)t=await this.apiKeyManager.getAPIKey(r);else{let a=await ue("Select AI Provider",ye);if(a===Se){let i=await be("API Key","","password",{required:!0});if(!i)return;let o=await be("API Base URL","https://api.openai.com/v1","text",{required:!0}),l=await be("Model","","text",{required:!0});if(!l)return;window.localStorage.setItem("ai-assistant-provider",Se),window.localStorage.setItem("ai-assistant-model-name",l),window.localStorage.setItem("openai-like-baseurl",o),t=i,r=Se,await j(window.DATA_STORAGE).createFile("secret.key",e),await this.apiKeyManager.saveAPIKey(Se,t),window.toast("Configuration saved \u{1F444}",3e3)}else{let i=a==ye[2]?"No Need Of API Key":await be("API key of selected provider","","password",{required:!0});if(!i)return;ie.showTitleLoader(),window.toast("Fetching available models from your account",2e3);let o=await ia(a,i);ie.removeTitleLoader();let l=await ue("Select AI Model",o);if(!l)return;window.localStorage.setItem("ai-assistant-provider",a),window.localStorage.setItem("ai-assistant-model-name",l),r=a,t=i,await j(window.DATA_STORAGE).createFile("secret.key",e),await this.apiKeyManager.saveAPIKey(r,t),window.toast("Configuration saved\u{1F444}",3e3)}}let s=window.localStorage.getItem("ai-assistant-model-name");this.initiateModel(r,t,s),this.initializeMarkdown(),this.sendHandlerAttached||(this.sendHandler=this.sendQuery.bind(this),this.$sendBtn.addEventListener("click",this.sendHandler),this.sendHandlerAttached=!0),this.keydownHandlerAttached||(this.keydownHandler=a=>{a.key==="Enter"&&(a.ctrlKey||a.metaKey)&&(a.preventDefault(),this.sendQuery())},this.$chatTextarea.addEventListener("keydown",this.keydownHandler),this.keydownHandlerAttached=!0),this.$page.show(),setTimeout(()=>{this.$chatTextarea.focus()},300)}catch(e){window.toast("Error in run method",3e3),window.toast("Error initializing Renz Ai: "+e.message,5e3)}}initiateModel(e,t,r){switch(e){case ye[0]:this.modelInstance=new zn({apiKey:t,model:r});break;case ye[1]:this.modelInstance=new pu({model:r,apiKey:t,safetySettings:[{category:_l.HARM_CATEGORY_HARASSMENT,threshold:vl.BLOCK_LOW_AND_ABOVE}]});break;case ye[2]:let s=window.localStorage.getItem("Ollama-Host")?window.localStorage.getItem("Ollama-Host"):"http://localhost:11434";this.modelInstance=new nu({baseUrl:s,model:r});break;case ye[3]:this.modelInstance=new Au({apiKey:t,model:r});break;case ye[4]:this.modelInstance=new zn({apiKey:t,model:r,configuration:{baseURL:"https://openrouter.ai/api/v1",defaultHeaders:{"HTTP-Referer":"https://acode.foxdebug.com","X-Title":"Renz Ai Cli"}}});break;case ye[5]:this.modelInstance=new zn({apiKey:t,model:r,configuration:{baseURL:"https://dashscope.aliyuncs.com/compatible-mode/v1"}});break;case Se:let a=window.localStorage.getItem("openai-like-baseurl")||"https://api.openai.com/v1";this.modelInstance=new zn({apiKey:t,model:r,configuration:{baseURL:a}});break;default:throw new Error("Unknown provider")}}_sanitizeFileName(e){if(!e||typeof e!="string")return"untitled_file";let s=e.replace(/[^\w\s.-]/gi,"").replace(/\.\.+/g,".").replace(/^\.|\.$/,"").trim().replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_|_$/,"");return s.length>0?s:"untitled_file"}transformMessages(e){return e.map((r,s)=>s%2===0&&s+1<e.length?{prompt:e[s].content,result:e[s+1].content}:null).filter(r=>r!=null)}async saveHistory(){try{let e=this.messageSessionConfig.configurable.sessionId;if(!this.messageHistories[e].messages.length)return;if(Cr==null)try{let r=`${this._sanitizeFileName(this.messageHistories[e].messages[0].content.substring(0,30))}__${e}.json`;await j(sd).exists()||await j(window.DATA_STORAGE).createDirectory("cli");let s=await this.messageHistories[e].getMessages(),a=this.transformMessages(s);Cr=await j(sd).createFile(r,a)}catch(t){alert(t.message)}else try{if(!await j(Cr).exists()){this.newChat(),window.toast("Some error occurred or file you trying to open has been deleted");return}let t=await this.messageHistories[e].getMessages();Cr=await j(Cr).writeFile(this.transformMessages(t))}catch(t){alert(t.message)}}catch(e){window.alert(e.message)}}newChat(){this.$chatBox.innerHTML="",window.toast("New session",3e3),this.messageHistories={},this.messageSessionConfig={configurable:{sessionId:Ki()}},Cr=null}async getHistoryItems(){if(await j(sd).exists()){let e=await j(sd).lsDir(),t="";for(let r=0;r<e.length;r++)t+=`<li class="dialog-item" style="background: var(--secondary-color);color: var(--secondary-text-color);padding: 5px;margin-bottom: 5px;border-radius: 8px;font-size:15px;display:flex;flex-direction:row;justify-content:space-between;gap:5px;" data-path="${JSON.parse(JSON.stringify(e[r])).url}">
                  <p class="history-item">${e[r].name.split("__")[0].substring(0,25)}...</p><div><button class="delete-history-btn" style="height:25px;width:25px;border:none;padding:5px;outline:none;border-radius:50%;background:var(--error-text-color);text-align:center;">\u2717</button></div>
                </li>`;return t}else{let e="";return e='<li style="background: var(--secondary-color);color: var(--secondary-text-color);padding: 10px;border-radius: 8px;" data-path="#not-available">Not Available</li>',e}}extractUUID(e){let t=/([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})/,r=e.match(t);return r?r[0]:null}async displayHistory(e,t){this.$chatBox.innerHTML="";let r=e.slice(1,e.length-1),s=this.extractUUID(r);if(!s){this.newChat(),window.toast("Some error occurred");return}if(!await j(r).exists()){this.newChat(),window.toast("Some error occurred or file you trying to open has been deleted");return}Cr=r;try{t.hide(),ie.create("Wait","Fetching chat history....");let a=await j(r).readFile(),i=JSON.parse(await MR.decodeText(a));this.messageHistories={},this.messageHistories[s]=new Mo;let o=i.flatMap(l=>[new Ie({content:l.prompt}),new ce({content:l.result})]);await this.messageHistories[s].addMessages(o),this.messageSessionConfig={configurable:{sessionId:s}},i.forEach(l=>{this.appendUserQuery(l.prompt),this.appendGptResponse(l.result)}),ie.destroy()}catch{ie.destroy(),window.toast("Error loading chat history",3e3)}}async myHistory(){try{let t=`<ul>${await this.getHistoryItems()}</ul>`,r=$R("Conversation History",t,"Cancel");r.onclick(async s=>{let a=s.target.closest(".dialog-item"),i=a.querySelector(".delete-history-btn"),o=a.querySelector(".history-item");if(a.getAttribute("data-path")!="#not-available"&&a.getAttribute("data-path")){if(s.target===a||s.target===o){let l=JSON.stringify(a.getAttribute("data-path"));this.displayHistory(l,r)}else if(s.target===i){let l=JSON.stringify(a.getAttribute("data-path")),c=l.slice(1,l.length-1);if(await j(a.getAttribute("data-path")).delete(),Cr==c){let u=document.querySelector(".chatBox");u.innerHTML="",this.messageHistories={},this.messageSessionConfig={configurable:{sessionId:Ki()}}}a.remove(),window.toast("Deleted",3e3),Cr=null}}})}catch(e){window.alert(e.message)}}async sendQuery(){let e=this.$chatTextarea;if(e.value!=""){this.$sendBtn.classList.add("hide"),this.$stopGenerationBtn.classList.remove("hide"),this.appendUserQuery(e.value),this.scrollToBottom(),this.appendGptResponse(""),this.loader(),this.currentQuery=e.value;try{await this.getCliResponse(e.value)}catch(t){this.showError(t),this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide"),clearInterval(this.$loadInterval)}e.value=""}}async appendUserQuery(e){try{let t=this.baseUrl+"assets/user_avatar.png",r=tag("div",{className:"wrapper"}),s=tag("div",{className:"chat"}),a=tag("div",{className:"profile",child:tag("img",{src:t,alt:"user"})}),i=tag("div",{className:"message user_message"});if(this.$mdIt&&typeof this.$mdIt.render=="function")try{let o=this.$mdIt.render(e);i.innerHTML=o,i.querySelectorAll("pre code").forEach(l=>{window.hljs&&window.hljs.highlightElement&&window.hljs.highlightElement(l)})}catch{i.textContent=e}else i.textContent=e;s.append(a,i),r.append(s),this.$chatBox.appendChild(r)}catch{window.toast("Error displaying user message",3e3)}}async appendGptResponse(e){try{let t=Math.ceil(e.length/4);this.updateTokenUsage(t),!this.$mdIt&&window.markdownit&&(this.$mdIt=window.markdownit({html:!1,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0,quotes:`""''`,highlight:function(l,c){let u=document.createElement("button");u.classList.add("copy-button"),u.innerHTML=gl,u.setAttribute("data-str",l);let d=`<pre class="hljs codesArea"><code>${window.hljs?window.hljs.highlightAuto(l).value:l}</code></pre>`;return`<div class="codeBlock">${u.outerHTML}${d}</div>`}}));let r=this.baseUrl+"assets/ai_assistant.svg",s=tag("div",{className:"ai_wrapper"}),a=tag("div",{className:"ai_chat"}),i=tag("div",{className:"ai_profile",child:tag("img",{src:r,alt:"ai"})}),o=tag("div",{className:"ai_message"});if(this.$mdIt&&typeof this.$mdIt.render=="function")try{let l=e,c=this.$mdIt.render(l);o.innerHTML=c,o.querySelectorAll("pre code").forEach(u=>{window.hljs&&window.hljs.highlightElement&&window.hljs.highlightElement(u)}),o.style.cssText=`  
          line-height: 1.6;  
          font-size: 14px;  
          color: var(--primary-text-color);  
          padding: 8px 12px;  
          word-wrap: break-word;  
          white-space: pre-wrap;  
        `,setTimeout(()=>{let u=o.querySelectorAll(".copy-button");if(u&&u.length>0)for(let d of u)d.addEventListener("click",function(){try{(0,yl.default)(this.dataset.str),this.innerHTML="\u2713",window.toast("Code copied to clipboard!",2e3),setTimeout(()=>{this.innerHTML=gl},1500)}catch{window.toast("Failed to copy",2e3)}})},100)}catch{window.toast("Markdown render error",3e3),o.textContent=e,o.style.cssText=`  
          line-height: 1.6;  
          font-size: 14px;  
          color: var(--primary-text-color);  
          padding: 8px 12px;  
          word-wrap: break-word;  
          white-space: pre-wrap;  
        `}else o.textContent=e,o.style.cssText=`  
        line-height: 1.6;  
        font-size: 14px;  
        color: var(--primary-text-color);  
        padding: 8px 12px;  
        word-wrap: break-word;  
        white-space: pre-wrap;  
      `,window.toast("Markdown renderer not available",2e3);a.append(i,o),s.append(a),this.$chatBox.appendChild(s)}catch{window.toast("Error displaying AI response",3e3)}}showError(e){let t=Array.from(document.querySelectorAll(".ai_message"));if(t.length>0){let r=t[t.length-1],s="\u274C Error occurred";e&&e.message&&(e.message.includes("429")?s="\u274C API Rate limit exceeded. Please wait and try again.":e.message.includes("401")?s="\u274C Invalid API key. Please check your API key settings.":e.message.includes("network")||e.message.includes("fetch")?s="\u274C Network error. Please check your internet connection.":e.message.includes("timeout")?s="\u274C Request timeout. Please try again.":s=`\u274C Error: ${e.message}`),r.innerHTML=`<div style="color: #ff6b6b; padding: 12px; background: rgba(255,107,107,0.1); border-radius: 8px; border-left: 3px solid #ff6b6b;">${s}</div>`}window.toast(errorMessage,4e3)}async stopGenerating(){this.abortController&&this.abortController.abort(),this.$loadInterval&&clearInterval(this.$loadInterval),this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide");let e=Array.from(document.querySelectorAll(".ai_message"));if(e.length>0){let t=e[e.length-1];(t.textContent.trim()===""||t.innerHTML.includes("\u{1F616}"))&&(t.innerHTML='<em style="color: #ff6b6b;">Response stopped by user</em>')}window.toast("\u23F9\uFE0F Generation stopped",2e3)}async getCliResponse(e){try{let t=Array.from(document.querySelectorAll(".ai_message"));if(t.length===0){window.toast("No response box found",3e3),this.appendGptResponse(""),setTimeout(()=>this.getCliResponse(e),100);return}let r=t[t.length-1];if(!r){window.toast("Target element not found",3e3);return}let s=this.getCachedResponse(e);if(s){clearInterval(this.$loadInterval),this.$sendBtn.classList.add("hide"),this.$stopGenerationBtn.classList.remove("hide"),r.innerHTML="";let q=0,Y=()=>{if(q<s.length)r.textContent+=s[q],q++,this.scrollToBottom(),setTimeout(Y,10);else{if(this.$mdIt&&typeof this.$mdIt.render=="function"){let ae=this.$mdIt.render(s);r.innerHTML=ae,r.querySelectorAll("pre code").forEach(de=>{window.hljs&&window.hljs.highlightElement&&window.hljs.highlightElement(de)}),setTimeout(()=>{let de=r.querySelectorAll(".copy-button");if(de&&de.length>0)for(let Pr of de)Pr.addEventListener("click",function(){(0,yl.default)(this.dataset.str),this.style.background="linear-gradient(45deg, #4CAF50, #45a049)",this.textContent="\u2713 Copied!",setTimeout(()=>{this.style.background="",this.textContent="Copy"},2e3),window.toast("\u{1F4CB} Copied to clipboard",3e3)})},100)}else r.textContent=s;this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide"),window.toast("Response from cache",1500)}};Y();return}this.abortController=new AbortController;let{signal:a}=this.abortController,i=editorManager&&editorManager.activeFile,o=i?i.name:"No file open",l=i?i.uri||i.filename||o:"No active file",c=i&&i.location?i.location:l?l.split("/").slice(0,-1).join("/"):"/sdcard",u=o!=="No file open"?o.split(".").pop():"unknown",d=c.split("/").pop()||"Unknown Project",p=i&&A?A.getValue():"",f=A?A.getCursorPosition():{row:0,column:0},h=`AI assistant for Acode editor. Current: ${o} (${u}) at line ${f.row+1}. Can edit/create/delete files, run terminal commands. Use context in responses.`,m=Is.fromMessages([["system",h],["placeholder","{chat_history}"],["human","{input}"]]),g=new Do,w=m.pipe(this.modelInstance).pipe(g),E=await new jo({runnable:w,getMessageHistory:async q=>{if(!this.messageHistories[q])this.messageHistories[q]=new Mo;else{let Y=await this.messageHistories[q].getMessages();this.messageHistories[q].addMessages(Y.slice(-6))}return this.messageHistories[q]},inputMessagesKey:"input",historyMessagesKey:"chat_history"}).stream({input:e},this.messageSessionConfig,a);clearInterval(this.$loadInterval),this.$sendBtn.classList.add("hide"),this.$stopGenerationBtn.classList.remove("hide"),r.innerHTML="";let O="",S="",J=0,te=50;r.style.cssText=`
      line-height: 1.6;
      font-size: 14px;
      color: var(--primary-text-color);
      padding: 8px 12px;
      word-wrap: break-word;
      white-space: pre-wrap;
      min-height: 20px;
      border-left: 3px solid var(--accent-color);
      background: rgba(var(--accent-color-rgb), 0.05);
      border-radius: 0 8px 8px 0;
      animation: pulse 2s infinite;
    `;let G=tag("span",{textContent:"\u258A",className:"streaming-cursor",style:`
        color: var(--accent-color);
        animation: blink 1s infinite;
        margin-left: 2px;
      `});r.appendChild(G);for await(let q of E){O+=q,S+=q;let Y=Date.now();if(Y-J>te||q.includes(`
`)){G.parentNode&&G.remove();let ae=S.split(`
`);r.innerHTML=ae.map((de,Pr)=>de.trim()?`<div class="response-line">${de}</div>`:"<br>").join(""),r.appendChild(G),S="",J=Y,this.scrollToBottom()}}if(G&&G.parentNode&&G.remove(),r.style.animation="",r.style.border="",r.style.background="",this.setCachedResponse(e,O),this.$mdIt&&typeof this.$mdIt.render=="function")try{let q=this.$mdIt.render(O);r.style.opacity="0",r.innerHTML=q,r.style.cssText=`
          line-height: 1.6;
          font-size: 14px;
          color: var(--primary-text-color);
          padding: 12px 16px;
          word-wrap: break-word;
          white-space: pre-wrap;
          border-radius: 8px;
          background: linear-gradient(145deg, rgba(var(--primary-color-rgb), 0.5), rgba(var(--primary-color-rgb), 0.8));
          box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          opacity: 0;
          transition: opacity 0.5s ease-in;
        `,setTimeout(()=>{r.style.opacity="1"},100),setTimeout(()=>{r.querySelectorAll("pre code").forEach(de=>{de.parentElement.style.cssText=`
              background: #1e1e1e;
              border-radius: 6px;
              margin: 8px 0;
              border: 1px solid rgba(255,255,255,0.1);
            `}),r.querySelectorAll(".inline-code").forEach(de=>{de.style.cssText=`
              background: rgba(var(--accent-color-rgb), 0.2);
              padding: 2px 6px;
              border-radius: 3px;
              font-family: monospace;
              font-size: 13px;
            `})},150),setTimeout(()=>{let Y=r.querySelectorAll(".copy-button");if(Y&&Y.length>0)for(let ae of Y)ae.addEventListener("click",function(){let de=this.dataset.str;(0,yl.default)(de),this.innerHTML="\u2705",this.style.background="#4CAF50",window.toast("\u2705 Code copied to clipboard!",2e3),setTimeout(()=>{this.innerHTML=gl,this.style.background=""},1500),(e.toLowerCase().includes("create")||e.toLowerCase().includes("generate")||e.toLowerCase().includes("make a file"))&&setTimeout(()=>{if(confirm("Would you like to create a file with this code?")){let oa=m("Enter filename:","","text");oa&&j(oa).writeFile(de).then(()=>{window.toast(`File created: ${oa}`,3e3),editorManager.openFile(oa)}).catch(bl=>{window.toast(`Error creating file: ${bl.message}`,3e3)})}},500)})},100)}catch{window.toast("Error rendering markdown",3e3),r.textContent=O}else r.textContent=O;if(this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide"),(e.toLowerCase().includes("create")||e.toLowerCase().includes("generate")||e.toLowerCase().includes("make a file"))&&O.includes("```")){let q=O.match(/```(?:\w+)?\s*([\s\S]*?)\s*```/g);if(q&&q.length>0){let Y=q[0].replace(/```(?:\w+)?\s*([\s\S]*?)\s*```/g,"$1").trim();setTimeout(()=>{if(confirm("Would you like to create a file with the generated code?")){let de=m("Enter filename:","","text");de&&j(de).writeFile(Y).then(()=>{window.toast(`File created: ${de}`,3e3),editorManager.openFile(de)}).catch(Pr=>{window.toast(`Error creating file: ${Pr.message}`,3e3)})}},1e3)}}await this.saveHistory()}catch(t){window.toast("Error in getCliResponse",3e3);let r=Array.from(document.querySelectorAll(".ai_message"));if(this.$loadInterval&&(clearInterval(this.$loadInterval),this.$loadInterval=null),this.$stopGenerationBtn&&this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn&&this.$sendBtn.classList.remove("hide"),r.length>0){let s=r[r.length-1];if(s){s.innerHTML="",s.style.cssText=`
          padding: 12px 16px;
          border-radius: 8px;
          background: linear-gradient(145deg, #ff4444, #cc3333);
          color: white;
          margin: 8px 0;
        `;let a=tag("div",{className:"error-box",style:`
            display: flex;
            align-items: center;
            gap: 8px;
          `}),i=tag("span",{textContent:"\u26A0\uFE0F",style:"font-size: 18px;"}),o=tag("div");t.response?o.innerHTML=`<strong>API Error (${t.response.status}):</strong><br>${t.response.data?.error?.message||JSON.stringify(t.response.data)}`:t.name==="AbortError"?o.innerHTML="<strong>Request Cancelled:</strong><br>Generation was stopped by user":o.innerHTML=`<strong>Error:</strong><br>${t.message||"Unknown error occurred"}`,a.append(i,o),s.appendChild(a),this.scrollToBottom(),window.toast("\u274C AI request failed. Check your connection and API key.",4e3)}}this.$stopGenerationBtn.classList.add("hide"),this.$sendBtn.classList.remove("hide")}}async scrollToBottom(){this.$chatBox.scrollTop=this.$chatBox.scrollHeight}async loader(){let e=Array.from(document.querySelectorAll(".ai_message"));if(e.length!=0){let t=0,r=e[e.length-1],s=["",".","..","...",""];this.$loadInterval=setInterval(()=>{r.innerHTML=`<div style="color: var(--galaxy-star-blue); font-size: 14px; padding: 10px;">
          <span>\u2728 AI is thinking${s[t]}</span>
        </div>`,t++,t>=s.length&&(t=0)},400)}}async getAIResponse(e){try{if(!this.modelInstance)throw new Error("AI model not initialized");let r=Is.fromMessages([["system","You are a helpful AI assistant. Provide direct, concise answers."],["human","{input}"]]),s=new Do;return await r.pipe(this.modelInstance).pipe(s).invoke({input:e})}catch(t){throw console.error("AI Response Error:",t),t}}async createFileWithAI(e=""){try{let t=await be("Describe the file you want to create:","","text",{required:!0});if(!t)return;ie.showTitleLoader();let r=editorManager.activeFile,s=r&&(r.location||r.uri?.split("/").slice(0,-1).join("/"))||"/",a=s!=="/"?s:"/sdcard",i=`Create file: "${t}". Return JSON: {"filename": "name.ext", "content": "code"}.`,o=await this.getAIResponse(i);ie.removeTitleLoader();try{let l=o.trim(),c=[/```(?:json)?\s*(\{[\s\S]*?\})\s*```/,/```[\s\S]*?(\{[\s\S]*?\})[\s\S]*?```/,/(\{[\s\S]*?\})/],u=null;for(let f of c){let h=l.match(f);if(h&&h[1]){u=h[1];break}}u||(u=l);let d=JSON.parse(u);if(!d.filename||!d.content)throw new Error("AI response missing required fields (filename or content)");let p=await nd("Create AI-Generated File",[{id:"filename",placeholder:"Filename",value:d.filename,type:"text",required:!0},{id:"targetPath",placeholder:"Target Directory",value:d.suggested_path||a,type:"text"},{id:"content",placeholder:"File Content",value:d.content,type:"textarea"}]);if(p){let f=p.filename,h=p.content,m=p.targetPath||a;try{(!m||m.trim()==="")&&(m=a);let g=m;if(m===a)try{let S=await acode.require("fileBrowser")("folder",`Create ${f} in folder:`);S&&S.url&&(g=S.url)}catch{}let b=await(await j(g)).createFile(f,h),E=b.replace(/^.*\//,"");window.toast(`\u2705 File created successfully!
\u{1F4C1} ${g}/${E}`,4e3),this.$page&&this.$page.isVisible&&this.$page.hide();try{await editorManager.openFile(b)}catch{let S=acode.require("editorFile");new S(f,{text:h,render:!0})}}catch(g){let w=g&&g.message?g.message:"Unknown error occurred";window.toast(`\u274C Error creating file: ${w}`,4e3)}}}catch{let c=o.match(/```(?:\w+)?\s*([\s\S]*?)\s*```/),u=c?c[1]:o,d=await be("Enter filename for the generated content:","","text",{required:!0});if(d){let p=e?`${e}/${d}`:d;await j(p).writeFile(u),window.toast(`File created: ${d}`,3e3),this.$page&&this.$page.isVisible&&this.$page.hide(),await editorManager.openFile(p)||editorManager.addNewFile(d,{text:u})}}}catch(t){window.toast(`Failed to create file with AI: ${t.message}`,4e3)}}async renameFileIntelligently(e){try{if(!await j(e).exists())throw new Error("File not found");let t=await j(e).readFile("utf8"),r=e.split("/").pop(),s=`Analyze this file content and suggest a better filename:

      Current name: ${r}
      Content:
      \`\`\`
      ${t.substring(0,1e3)}
      \`\`\`

      Suggest 3 alternative filenames that better describe the file's purpose. Consider:
      1. File content and functionality
      2. Naming conventions
      3. Descriptive but concise names

      Respond with just the filenames, one per line.`,i=(await this.appendGptResponse(s)).split(`
`).filter(l=>l.trim()),o=await ue("Choose new filename:",[r,...i]);if(o&&o!==r){let l=e.replace(r,o);await j(e).moveTo(l),window.toast(`File renamed to: ${o}`,3e3);let c=editorManager.getFile(e);c&&(c.filename=o,c.name=o)}}catch(t){window.toast(`Error renaming file: ${t.message}`,3e3)}}async organizeProjectStructure(){try{ie.showTitleLoader(),window.toast("Scanning project structure...",2e3);let e=await this.scanProjectStructure();if(!e||e.length===0){ie.removeTitleLoader(),window.toast("No project files found to organize",3e3);return}let t=`Project structure analysis for organization:

Files found: ${e.length}
${e.slice(0,20).map(s=>`- ${s.name} (${s.type})`).join(`
`)}

Suggest improvements:
1. Better folder organization
2. Files to move/group
3. New directories needed
4. Cleanup recommendations

Response format: Clear actionable steps.`,r=await this.getAIResponse(t);ie.removeTitleLoader(),this.$page.isVisible||await this.run(),this.appendUserQuery("\u{1F4C1} Analyze and suggest project structure improvements"),this.appendGptResponse(`\u{1F4CB} **Project Organization Analysis**

${r}

\u2728 *Use bulk operations to implement these suggestions*`)}catch(e){ie.removeTitleLoader(),window.toast(`\u274C Error analyzing project: ${e.message}`,3e3)}}async scanProjectStructure(){if(this.projectStructure&&this.lastStructureScan&&Date.now()-this.lastStructureScan<3e5)return this.projectStructure;try{let e={},t=async(r,s=0)=>{if(!(s>3))try{let a=j(r);if(a&&await a.exists()){let i=await a.lsDir();e[r]={files:[],folders:[]};for(let o of i)o.isDirectory&&!o.name.startsWith(".")?(e[r].folders.push(o.name),await t(`${r}/${o.name}`,s+1)):o.isFile&&e[r].files.push({name:o.name,size:o.length||0,extension:o.name.split(".").pop()||"unknown"})}}catch{window.toast("Error scanning directory",3e3)}};return await t(window.PLUGIN_DIR||"/sdcard"),this.projectStructure=e,this.lastStructureScan=Date.now(),e}catch{return window.toast("Error scanning project structure",3e3),{}}}async bulkFileOperations(){try{switch(await ue("Bulk Operation",["Rename multiple files","Move files to folders","Delete unused files","Add headers to files","Convert file formats"])){case"Rename multiple files":await this.bulkRenameFiles();break;case"Move files to folders":await this.bulkMoveFiles();break;case"Delete unused files":await this.deleteUnusedFiles();break;case"Add headers to files":await this.addHeadersToFiles();break;case"Convert file formats":await this.convertFileFormats();break}}catch(e){window.toast(`Bulk operation error: ${e.message}`,3e3)}}async bulkRenameFiles(){try{let e=await this.selectMultipleFiles();if(!e.length){window.toast("No files selected",3e3);return}let t=await be("Enter naming pattern (use {index} for numbers):","file_{index}.js","text");if(!t)return;if(await ue(`Rename ${e.length} files using pattern: ${t}?`,["Yes","No"])==="Yes"){ie.showTitleLoader();let s=0;for(let a=0;a<e.length;a++)try{let i=await j(e[a]);if(await i.exists()){let o=e[a].split("/").pop(),l=o.includes(".")?"."+o.split(".").pop():"",c=t.replace("{index}",a+1).replace(/\.[^.]*$/,"")+l;await i.renameTo(c),s++}}catch(i){window.toast(`Error renaming file: ${i.message}`,3e3)}ie.removeTitleLoader(),window.toast(`\u2705 Renamed ${s} files`,4e3)}}catch(e){ie.removeTitleLoader(),window.toast(`\u274C Bulk rename error: ${e.message}`,3e3)}}async bulkMoveFiles(){try{let e=await this.selectMultipleFiles();if(!e.length){window.toast("No files selected",3e3);return}let r=await acode.require("fileBrowser")("folder","Select target folder for files");if(!r){window.toast("No target folder selected",3e3);return}let s=r.url;try{if(!await j(s).exists()){window.toast("Target folder not accessible",3e3);return}}catch{window.toast("Cannot access target folder",3e3);return}if(await ue(`Move ${e.length} files to ${r.name}?`,["Yes","No"])==="Yes"){ie.showTitleLoader();let i=0;for(let o of e)try{let l=j(o);if(await l.exists()){let c=o.split("/").pop(),u=`${s}/${c}`;await l.moveTo(u),i++}}catch{window.toast("Error moving file",3e3)}ie.removeTitleLoader(),window.toast(`\u2705 Moved ${i} files to ${r.name}`,4e3)}}catch(e){ie.removeTitleLoader(),window.toast(`\u274C Bulk move error: ${e.message}`,3e3)}}async deleteUnusedFiles(){try{let e=await nd("Select file types to analyze",[{id:"extensions",placeholder:"Extensions (e.g., .log,.tmp,.bak)",value:".log,.tmp,.bak,.backup",type:"text",required:!0}]);if(!e)return;let t=e.extensions.split(",").map(i=>i.trim()),r=await this.getAllProjectFiles(t);if(!r.length){window.toast("No unused files found",3e3);return}let s=r.map(i=>i.split("/").pop()).join(`
`);if(await ue(`Delete ${r.length} unused files?

${s.substring(0,200)}${s.length>200?"...":""}`,["Yes","No"])==="Yes"){let i=0;for(let o of r)try{let l=j(o);l&&await l.exists()&&(await l.delete(),i++)}catch{window.toast("Error deleting file",3e3)}window.toast(`Deleted ${i} unused files`,3e3)}}catch(e){window.toast(`Delete unused files error: ${e.message}`,3e3)}}async addHeadersToFiles(){try{let e=await nd("File Header Configuration",[{id:"header",placeholder:"Header template (use {filename}, {date}, {author})",value:`/*
 * File: {filename}
 * Created: {date}
 * Author: {author}
 */
`,type:"textarea",required:!0},{id:"author",placeholder:"Author name",value:"Developer",type:"text"},{id:"extensions",placeholder:"File extensions (e.g., .js,.css,.html)",value:".js,.css,.html",type:"text",required:!0}]);if(!e)return;let t=e.extensions.split(",").map(a=>a.trim()),r=await this.getAllProjectFiles(t);if(!r.length){window.toast("No matching files found",3e3);return}if(await ue(`Add headers to ${r.length} files?`,["Yes","No"])==="Yes"){let a=0;for(let i of r)try{let o=j(i);if(o&&await o.exists()){let l=await o.readFile("utf8"),c=i.split("/").pop(),u=new Date().toLocaleDateString(),d=e.header.replace("{filename}",c).replace("{date}",u).replace("{author}",e.author);if(!l.startsWith(d.trim())){let p=d+l;await o.writeFile(p),a++}}}catch{window.toast("Error adding header",3e3)}window.toast(`Added headers to ${a} files`,3e3)}}catch(e){window.toast(`Add headers error: ${e.message}`,3e3)}}async convertFileFormats(){try{let e=await nd("File Format Conversion",[{id:"fromExt",placeholder:"From extension (e.g., .txt)",value:".txt",type:"text",required:!0},{id:"toExt",placeholder:"To extension (e.g., .md)",value:".md",type:"text",required:!0}]);if(!e)return;let t=await this.getAllProjectFiles([e.fromExt]);if(!t.length){window.toast(`No ${e.fromExt} files found`,3e3);return}if(await ue(`Convert ${t.length} files from ${e.fromExt} to ${e.toExt}?`,["Yes","No"])==="Yes"){let s=0;for(let a of t)try{let i=j(a);if(i&&await i.exists()){let o=await i.readFile("utf8"),c=a.replace(e.fromExt,"")+e.toExt,u=a.substring(0,a.lastIndexOf("/")),d=j(u),p=c.split("/").pop();d&&(await d.createFile(p,o),await i.delete(),s++)}}catch{window.toast("Error converting file",3e3)}window.toast(`Converted ${s} files`,3e3)}}catch(e){window.toast(`Convert file formats error: ${e.message}`,3e3)}}async selectMultipleFiles(){try{let e=acode.require("fileBrowser"),t=acode.require("fileList"),r=[],s=await t();if(s.length===0)return window.toast("Please open a folder first",3e3),[];let a=!0,i=0;for(;a&&i<10;)try{let o=await e("file",`Select files (${i} selected)`,!1,s);if(o&&o.url&&!r.includes(o.url)){r.push(o.url),i++;let l=await ue(`Added ${o.name}. Continue selecting?`,["Yes","Done"]);(l==="Done"||l===null)&&(a=!1)}else a=!1}catch{a=!1}return r}catch(e){return window.toast("Error in selectMultipleFiles",3e3),window.toast(`Error selecting files: ${e.message}`,3e3),[]}}async readFileContent(e){try{return await j(e).exists()?{success:!0,content:await j(e).readFile("utf8"),path:e}:{success:!1,error:`File not found: ${e}`}}catch(t){return{success:!1,error:t.message}}}async editFileContent(e,t){try{let r=await j(e);if(await r.exists()){let s=await r.readFile("utf8"),a=e+".backup."+Date.now(),i=e.substring(0,e.lastIndexOf("/")),o=await j(i),l=a.split("/").pop();await o.createFile(l,s),this.storeUndoInfo(e,s),await r.writeFile(t);let c=editorManager.activeFile;c&&(c.uri===e||c.location+"/"+c.filename===e)&&(c.session.setValue(t),c.isUnsaved=!1)}else{let s=e.substring(0,e.lastIndexOf("/")),a=e.split("/").pop();await(await j(s)).createFile(a,t)}return{success:!0,message:`File edited successfully: ${e.split("/").pop()}`}}catch(r){return window.toast("Error editing file content",3e3),{success:!1,error:r.message}}}async deleteFileFromProject(e){try{if(await j(e).exists()){let t=await j(e).readFile("utf8"),r=window.DATA_STORAGE+"deleted_files/"+Date.now()+"_"+e.split("/").pop();return await j(r).writeFile(t),await j(e).delete(),{success:!0,message:`File deleted successfully: ${e}`}}else return{success:!1,error:`File not found: ${e}`}}catch(t){return{success:!1,error:t.message}}}async showFileDiff(e,t,r){try{let s=e.split(`
`),a=t.split(`
`),i=`
        <div class="diff-container">
          <div class="diff-header">
            <h4>Changes in ${r}</h4>
            <div class="diff-stats">
              <span class="diff-summary">Showing changes from ${s.length} to ${a.length} lines</span>
            </div>
          </div>
          <div class="diff-content">
      `,o=0,l=[],c=3,u=()=>{if(o<=c*2)l.forEach(f=>{i+=f});else{for(let f=0;f<c;f++)i+=l[f];i+=`<div class="diff-collapse">... ${o-c*2} more unchanged lines ...</div>`;for(let f=l.length-c;f<l.length;f++)i+=l[f]}o=0,l=[]},d=Math.max(s.length,a.length),p=!1;for(let f=0;f<d;f++){let h=s[f]||"",m=a[f]||"",g=E=>E,w=h,b=m;h!==m?(o>0&&u(),p=!0,h&&m?i+=`<div class="diff-line modified">
              <span class="line-num">${f+1}</span>
              <span class="old-line">- ${w}</span>
              <span class="new-line">+ ${b}</span>
            </div>`:h&&!m?i+=`<div class="diff-line deleted">
              <span class="line-num">${f+1}</span>
              <span class="old-line">- ${w}</span>
            </div>`:!h&&m&&(i+=`<div class="diff-line added">
              <span class="line-num">${f+1}</span>
              <span class="new-line">+ ${b}</span>
            </div>`)):(o++,l.push(`<div class="diff-line unchanged">
            <span class="line-num">${f+1}</span>
            <span class="unchanged-line">${w}</span>
          </div>`))}return o>0&&u(),p||(i+='<div class="diff-no-changes">No changes detected</div>'),i+=`
          </div>
        </div>
      `,i}catch(s){return window.toast("Error generating diff",3e3),`<div class="error">Error showing diff: ${s.message}</div>`}}async searchAndReplaceInProject(e,t,r=[".js",".json",".html",".css",".md"]){try{let s=[],a=await this.getAllProjectFiles(r);for(let i of a)if(await j(i).exists()){let o=await j(i).readFile("utf8");if(o.includes(e)){let l=o.replace(new RegExp(e,"g"),t);await this.editFileContent(i,l),s.push({file:i,occurrences:(o.match(new RegExp(e,"g"))||[]).length})}}return{success:!0,results:s,message:`Replaced "${e}" with "${t}" in ${s.length} files`}}catch(s){return{success:!1,error:s.message}}}async getAllProjectFiles(e){try{let t=[],r=async i=>{if(await j(i).exists()){let o=await j(i).lsDir();for(let l of o){let c=`${i}/${l.name}`;l.isDirectory&&!l.name.startsWith(".")?await r(c):l.isFile&&e.some(d=>l.name.endsWith(d))&&t.push(c)}}},a=await acode.require("fileList")();if(a.length>0)for(let i of a)await r(i.url);else{let i=["/sdcard","/storage/emulated/0",window.DATA_STORAGE];for(let o of i)try{await r(o);break}catch{continue}}return t}catch{return window.toast("Error scanning project files",3e3),[]}}storeUndoInfo(e,t){this.undoStack||(this.undoStack=[]),this.undoStack.push({filePath:e,content:t,timestamp:Date.now()}),this.undoStack.length>10&&this.undoStack.shift()}async undoLastOperation(){try{if(!this.undoStack||this.undoStack.length===0)return{success:!1,error:"No operations to undo"};let e=this.undoStack.pop();await(await j(e.filePath)).writeFile(e.content);let r=editorManager.activeFile;return r&&(r.uri===e.filePath||r.location+"/"+r.filename===e.filePath)&&(r.session.setValue(e.content),r.isUnsaved=!1),{success:!0,message:`Undone changes to ${e.filePath.split("/").pop()}`}}catch(e){return window.toast("Error in undoLastOperation",3e3),{success:!1,error:e.message}}}async readRelatedFiles(e){try{if(!await j(e).exists())return{success:!1,error:"Current file not found"};let t=await j(e).readFile("utf8"),r=[],s=/(?:import.*from\s+['"]([^'"]+)['"]|require\(['"]([^'"]+)['"]\))/g,a;for(;(a=s.exec(t))!==null;){let l=a[1]||a[2];l&&!l.startsWith("http")&&!l.includes("node_modules")&&r.push(l)}let i=[],o=e.substring(0,e.lastIndexOf("/"));for(let l of r){let c;if(l.startsWith("./"))c=`${o}/${l.substring(2)}`;else if(l.startsWith("../")){let p=(l.match(/\.\.\//g)||[]).length,f=o;for(let m=0;m<p;m++){let g=f.lastIndexOf("/");g>0&&(f=f.substring(0,g))}let h=l.replace(/\.\.\//g,"");c=`${f}/${h}`}else l.startsWith("/")?c=l:c=`${o}/${l}`;let u=["",".js",".json",".ts",".jsx",".tsx",".vue",".css",".scss"],d=!1;for(let p of u){let f=c+p;try{if(await j(f).exists()){let h=await j(f).readFile("utf8");i.push({path:f,content:h}),d=!0;break}}catch{continue}}}return{success:!0,files:i,imports:r}}catch(t){return window.toast("Error reading related files",3e3),{success:!1,error:t.message}}}createProviderDropdown(){let e=tag("div",{className:"provider-dropdown"}),t=tag("select",{className:"provider-select",id:"ai-provider-select"});ye.forEach(s=>{let a=tag("option",{value:s,textContent:s});t.appendChild(a)});let r=window.localStorage.getItem("ai-assistant-provider");return r&&(t.value=r),t.addEventListener("change",async s=>{await this.switchProvider(s.target.value)}),e.appendChild(t),e}createTokenDisplay(){let e=tag("div",{className:"token-display",id:"token-usage-display"}),t=tag("span",{className:"token-icon",textContent:"\u{1FA99}"});return this.$tokenText=tag("span",{className:"token-text",textContent:"0"}),e.appendChild(t),e.appendChild(this.$tokenText),e.onclick=()=>this.showTokenUsageDetails(),this.updateTokenDisplay(),e}loadTokenUsage(){try{let e=localStorage.getItem("ai-assistant-token-usage");if(e){let t=JSON.parse(e),r=new Date().toDateString();t.lastReset!==r&&(t.today=0,t.lastReset=r),this.tokenUsage={...this.tokenUsage,...t}}}catch{window.toast("Error loading token usage",3e3)}}saveTokenUsage(){try{localStorage.setItem("ai-assistant-token-usage",JSON.stringify(this.tokenUsage))}catch{window.toast("Error saving token usage",3e3)}}updateTokenUsage(e){this.tokenUsage.total+=e,this.tokenUsage.today+=e,this.tokenUsage.session+=e,this.saveTokenUsage(),this.updateTokenDisplay()}updateTokenDisplay(){if(this.$tokenText){let{session:e,today:t}=this.tokenUsage;this.$tokenText.textContent=`${e}`,this.$tokenText.title=`Session: ${e} | Today: ${t}`}}async showTokenUsageDetails(){let{total:e,today:t,session:r}=this.tokenUsage,s=localStorage.getItem("ai-assistant-provider")||"None",a=`\u{1F4CA} Token Usage Statistics
    
\u{1F539} Current Session: ${r.toLocaleString()} tokens
\u{1F539} Today: ${t.toLocaleString()} tokens  
\u{1F539} Total: ${e.toLocaleString()} tokens
\u{1F539} Provider: ${s}

\u{1F4A1} Tip: Use shorter prompts and enable caching to reduce token usage.`;await acode.alert("Token Usage",a)}async searchInChat(){try{let e=await be("Search in chat:","","text");if(!e)return;let t=this.$chatBox.querySelectorAll(".message, .ai_message"),r=0;if(t.forEach(s=>{let a=s.textContent.toLowerCase();s.style.backgroundColor="",s.style.border="",a.includes(e.toLowerCase())&&(s.style.backgroundColor="rgba(0, 212, 255, 0.2)",s.style.border="2px solid var(--galaxy-star-blue)",r++)}),r>0){window.toast(`Found ${r} messages containing "${e}"`,4e3);let s=this.$chatBox.querySelector('[style*="border: 2px solid"]');s&&s.scrollIntoView({behavior:"smooth",block:"center"})}else window.toast(`No messages found containing "${e}"`,3e3)}catch{window.toast("Error searching chat",3e3)}}async clearChatHistory(){try{await ue("Clear all chat history?",["Yes","No"])==="Yes"&&(this.$chatBox.innerHTML="",this.messageHistories={},this.messageSessionConfig={configurable:{sessionId:Ki()}},Cr=null,window.toast("\u2705 Chat history cleared",3e3))}catch{window.toast("\u274C Error clearing chat",3e3)}}async exportConversation(){try{let e=this.$chatBox.querySelectorAll(".wrapper, .ai_wrapper");if(e.length===0){window.toast("No conversation to export",3e3);return}let r=`ai-chat-conversation-${new Date().toISOString().slice(0,19).replace(/:/g,"-")}.md`,s=`# AI Chat Conversation
`;s+=`**Exported:** ${new Date().toLocaleString()}
`,s+=`**Provider:** ${localStorage.getItem("ai-assistant-provider")||"Unknown"}
`,s+=`**Model:** ${localStorage.getItem("ai-assistant-model-name")||"Unknown"}

`,s+=`---

`,e.forEach((a,i)=>{let o=a.classList.contains("wrapper"),l=a.querySelector(".message, .ai_message"),c=l?l.textContent.trim():"";c&&(s+=`${o?"\u{1F464} **User**":"\u{1F916} **AI Assistant**"}

${c}

---

`)}),s+=`

*Exported from Acode AI Assistant Plugin at ${new Date().toLocaleString()}*`;try{let i=await acode.require("fileBrowser")("folder","Select folder to save conversation");if(i&&i.url)await j(i.url).createFile(r,s),window.toast(`\u{1F4BE} Conversation exported to ${i.name}/${r}`,4e3);else{let o=window.DATA_STORAGE||"/sdcard";await j(o).createFile(r,s),window.toast(`\u{1F4BE} Conversation exported to ${o}/${r}`,4e3)}}catch{let i=new Blob([s],{type:"text/markdown"}),o=URL.createObjectURL(i),l=document.createElement("a");l.href=o,l.download=r,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o),window.toast("\u{1F4C1} Conversation downloaded to browser downloads",3e3)}}catch(e){console.error("Export error:",e),window.toast(`\u274C Export failed: ${e.message}`,3e3)}}async copyAllMessages(){try{let e=this.$chatBox.querySelectorAll(".wrapper, .ai_wrapper");if(e.length===0){window.toast("No messages to copy",3e3);return}let t="";e.forEach((r,s)=>{let a=r.classList.contains("wrapper"),i=r.querySelector(".message, .ai_message"),o=i?i.textContent.trim():"";o&&(t+=`${a?"User":"AI"}: ${o}

`)}),(0,yl.default)(t)?window.toast("\u{1F4CB} All messages copied to clipboard",3e3):window.toast("\u274C Failed to copy messages",3e3)}catch{window.toast("\u274C Copy failed",3e3)}}async showSettings(){try{let e=localStorage.getItem("ai-assistant-provider")||"None",t=localStorage.getItem("ai-assistant-model-name")||"None",{total:r,today:s,session:a}=this.tokenUsage;switch(await ue("Settings",["Change Provider","Change Model","Toggle Real-time Analysis","Clear Token Usage","Reset All Settings","Back"])){case"Change Provider":let o=await ue("Select Provider",ye);o&&await this.switchProvider(o);break;case"Change Model":let l=localStorage.getItem("ai-assistant-provider");if(l){let d=await this.apiKeyManager.getAPIKey(l),p=await ia(l,d),f=await ue("Select Model",p);f&&(localStorage.setItem("ai-assistant-model-name",f),this.initiateModel(l,d,f),window.toast(`Switched to ${f}`,3e3))}break;case"Toggle Real-time Analysis":this.toggleRealTimeAI();break;case"Clear Token Usage":await ue("Clear token usage statistics?",["Yes","No"])==="Yes"&&(this.tokenUsage={total:0,today:0,session:0,lastReset:new Date().toDateString()},this.saveTokenUsage(),this.updateTokenDisplay(),window.toast("Token usage cleared",3e3));break;case"Reset All Settings":await ue("Reset all plugin settings?",["Yes","No"])==="Yes"&&(localStorage.removeItem("ai-assistant-provider"),localStorage.removeItem("ai-assistant-model-name"),localStorage.removeItem("ai-assistant-token-usage"),this.tokenUsage={total:0,today:0,session:0,lastReset:new Date().toDateString()},this.updateTokenDisplay(),window.toast("All settings reset",3e3));break}}catch{window.toast("Error in settings",3e3),window.toast("\u274C Settings error",3e3)}}async switchProvider(e){try{if(!ye.includes(e)&&e!==Se)throw new Error("Invalid provider selected");let t=window.localStorage.getItem("ai-assistant-provider");if(t===e)return;if(e==="Ollama"){window.localStorage.setItem("ai-assistant-provider",e);try{ie.showTitleLoader(),window.toast("Fetching available models...",2e3);let r=await ia(e,"No Need Of API Key");ie.removeTitleLoader();let s=await ue("Select AI Model",r);s&&(window.localStorage.setItem("ai-assistant-model-name",s),await this.apiKeyManager.saveAPIKey(e,"No Need Of API Key"),this.initiateModel(e,"No Need Of API Key",s),window.toast(`Switched to ${e}`,3e3))}catch(r){throw t&&window.localStorage.setItem("ai-assistant-provider",t),r}}else if(e===Se){let r=await be("API Key","","password",{required:!0});if(!r)return;let s=await be("API Base URL","https://api.openai.com/v1","text",{required:!0}),a=await be("Model","","text",{required:!0});if(!a)return;window.localStorage.setItem("ai-assistant-provider",Se),window.localStorage.setItem("ai-assistant-model-name",a),window.localStorage.setItem("openai-like-baseurl",s),await this.apiKeyManager.saveAPIKey(Se,r),this.initiateModel(Se,r,a),window.toast(`Switched to ${e}`,3e3)}else{let r=await be(`Enter API key for ${e}:`,"","password",{required:!0});if(!r)return;try{ie.showTitleLoader(),window.toast("Fetching available models...",2e3);let s=await ia(e,r);ie.removeTitleLoader();let a=await ue("Select AI Model",s);a&&(window.localStorage.setItem("ai-assistant-provider",e),window.localStorage.setItem("ai-assistant-model-name",a),this.apiKeyManager&&await this.apiKeyManager.saveAPIKey(e,r),this.initiateModel(e,r,a),window.toast(`Switched to ${e}`,3e3))}catch(s){throw t&&window.localStorage.setItem("ai-assistant-provider",t),s}}}catch(t){window.toast("Error switching provider",3e3),window.toast(`Error switching provider: ${t.message}`,3e3)}}showAiEditPopup(e=""){let t=tag("div",{className:"ai-edit-backdrop"}),r=tag("div",{className:"ai-edit-popup"}),s=tag("div",{className:"ai-edit-popup-header"}),a=tag("div",{className:"ai-edit-popup-title",textContent:"Edit with AI"}),i=tag("button",{className:"ai-edit-popup-close",innerHTML:"&times;"});s.append(a,i);let o=tag("div",{className:"ai-edit-popup-body"}),l=tag("textarea",{className:"ai-edit-prompt",placeholder:`Describe what you want to do with the code...
Example: 'Add error handling to this function' or 'Optimize this loop for better performance'`,value:e}),c=tag("div",{className:"ai-edit-actions"}),u=tag("button",{className:"ai-edit-btn secondary",textContent:"Cancel"}),d=tag("button",{className:"ai-edit-btn primary",textContent:"Edit Code"});c.append(u,d),o.append(l,c),r.append(s,o);let p=()=>{document.body.contains(t)&&document.body.removeChild(t)};i.onclick=u.onclick=p,t.onclick=h=>{h.target===t&&p()},d.onclick=async()=>{let h=l.value.trim();h?(p(),await this.processAiEdit(h)):(window.toast("Please enter editing instructions",3e3),l.focus())};let f=h=>{h.key==="Escape"?(p(),document.removeEventListener("keydown",f)):h.key==="Enter"&&(h.ctrlKey||h.metaKey)&&(h.preventDefault(),d.click())};document.addEventListener("keydown",f),t.appendChild(r),document.body.appendChild(t),setTimeout(()=>{l.focus(),e&&l.setSelectionRange(e.length,e.length)},100)}async processAiEdit(e){if(!e||e.trim().length===0){window.toast("Please provide editing instructions",3e3);return}let t=window.toast("AI is processing your request...",0);try{let r=editorManager.activeFile;if(!r)throw new Error("No active file to edit");let s=A.getValue(),a=A.getSelectedText(),i=r.name.split(".").pop(),o=r.uri||r.filename||r.name,l=r.location||(o?o.split("/").slice(0,-1).join("/"):""),c=A.getCursorPosition(),u;a?u=`EDIT SELECTED CODE REQUEST

**FILE CONTEXT:**
\u2022 File: ${r.name}
\u2022 Path: ${o}
\u2022 Directory: ${l}
\u2022 Language: ${i}
\u2022 Selection: Lines around ${c.row+1}

**SELECTED CODE TO EDIT:**
\`\`\`${i}
${a}
\`\`\`

**USER EDIT REQUEST:** "${e}"

**EDITING REQUIREMENTS:**
- Focus ONLY on the selected code block
- Maintain existing functionality unless specifically requested to change
- Follow ${i} best practices and conventions
- Make minimal but effective changes
- Preserve variable names and structure unless requested otherwise
- Return ONLY the edited code block (no explanations)

**OUTPUT:** Provide the improved code block ready to replace the selection:`:u=`EDIT ENTIRE FILE REQUEST

**FILE CONTEXT:**
\u2022 File: ${r.name}
\u2022 Path: ${o}
\u2022 Directory: ${l}
\u2022 Language: ${i}
\u2022 File Size: ${s.length} characters
\u2022 Current Cursor: Line ${c.row+1}, Column ${c.column+1}

**CURRENT FILE CONTENT:**
\`\`\`${i}
${s}
\`\`\`

**USER EDIT REQUEST:** "${e}"

**EDITING REQUIREMENTS:**
- Apply changes throughout the file as needed
- Maintain overall file structure and organization
- Follow ${i} best practices and conventions
- Ensure all existing functionality remains intact
- Make improvements that align with the request
- Preserve imports, exports, and dependencies
- Return the complete improved file (no explanations)

**OUTPUT:** Provide the complete edited file ready to replace current content:`;let d=await this.appendGptResponse(u);if(d!=null&&typeof d=="string"&&d.trim().length>0){let f=d.trim(),h=[/```[\w]*\s*([\s\S]*?)\s*```/g,/~~~[\w]*\s*([\s\S]*?)\s*~~~/g,/<code>([\s\S]*?)<\/code>/g,/`([^`\n]+)`/g],m=null;for(let w of h){let b=[...d.matchAll(w)];if(b.length>0&&b[0][1]){m=b.reduce((E,O)=>O[1].length>E[1].length?O:E);break}}if(m&&m[1])f=m[1].trim();else{let b=d.split(`
`).filter(E=>{let O=E.trim();return O&&!O.startsWith("#")&&!O.startsWith(">")&&!O.match(/^[0-9]+\.\s/)&&!O.match(/^\*\s/)&&!O.match(/^-\s/)&&!O.match(/^Here'?s?\s/i)&&!O.match(/^The\s+code\s+/i)&&!O.match(/^This\s+code\s+/i)&&!O.match(/^I['']?ve?\s+/i)});b.length>0&&(f=b.join(`
`).trim())}if(await this.showEditDiff(a||s,f,r.name)){if(a){let w=A.getCursorPosition();A.session.replace(A.selection.getRange(),f),A.moveCursorToPosition(w)}else{let w=A.getCursorPosition(),b=A.session.getScrollTop();A.setValue(f,-1),A.moveCursorToPosition(w),A.session.setScrollTop(b)}if(r&&r.uri)try{try{r.markModified&&r.markModified()}catch{}let w=!1;try{r.save&&(await r.save(),w=!0)}catch{}w||await j(r.uri).writeFile(A.getValue()),window.toast("\u2705 File updated and saved successfully!",3e3);try{let b=window.editorManager;b&&b.onUpdate&&b.onUpdate()}catch{}}catch(w){window.toast("Error saving file",3e3),window.toast(`\u26A0\uFE0F Code updated but couldn't save: ${w.message}`,4e3),setTimeout(()=>{window.toast("\u{1F4A1} Try Ctrl+S to save manually",3e3)},1e3)}else r?window.toast("\u2705 Code updated! Save file to persist changes.",3e3):window.toast("\u26A0\uFE0F No active file found",2e3)}}else throw new Error("No response from AI")}catch(r){window.toast("Error in processAiEdit",3e3),window.toast(`Error: ${r.message}`,3e3)}finally{try{t&&t.hide&&t.hide()}catch{}}}async showEditDiff(e,t,r){let s=await this.showFileDiff(e,t,r),a=tag("div",{className:"ai-edit-popup",style:`
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 800px;
        max-height: 80vh;
        background: var(--primary-color);
        color: var(--primary-text-color);
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      `}),i=tag("div",{style:`
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
      `}),o=tag("div",{className:"ai-edit-popup-header",style:`
        padding: 15px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
      `}),l=tag("div",{className:"ai-edit-popup-title",textContent:`Review Changes: ${r}`,style:`
        font-size: 18px;
        font-weight: bold;
      `}),c=tag("button",{innerHTML:"X",style:`
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--primary-text-color);
      `});o.append(l,c);let u=tag("div",{className:"ai-edit-popup-body",innerHTML:s,style:`
        padding: 15px;
        overflow-y: auto;
        flex: 1;
      `}),d=tag("style",{textContent:`
        .diff-container {
          font-family: monospace;
          white-space: pre-wrap;
          word-break: break-all;
        }
        .diff-line {
          padding: 2px 5px;
          margin: 2px 0;
          border-radius: 3px;
          position: relative;
        }
        .diff-line.added {
          background-color: rgba(0, 255, 0, 0.1);
          border-left: 3px solid #4CAF50;
        }
        .diff-line.deleted {
          background-color: rgba(255, 0, 0, 0.1);
          border-left: 3px solid #F44336;
        }
        .diff-line.modified {
          background-color: rgba(255, 165, 0, 0.1);
          border-left: 3px solid #FF9800;
        }
        .line-num {
          display: inline-block;
          width: 40px;
          color: #888;
          user-select: none;
        }
        .old-line {
          display: block;
          color: #F44336;
          text-decoration: line-through;
          margin-bottom: 5px;
        }
        .new-line {
          display: block;
          color: #4CAF50;
        }
      `});document.head.appendChild(d);let p=tag("div",{className:"ai-edit-actions",style:`
        padding: 15px;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      `}),f=tag("button",{className:"ai-edit-btn secondary",textContent:"Cancel",style:`
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background: var(--secondary-color);
        color: var(--secondary-text-color);
      `}),h=tag("button",{className:"ai-edit-btn primary",textContent:"Apply Changes",style:`
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background: var(--accent-color);
        color: var(--accent-text-color);
        font-weight: bold;
      `});p.append(f,h),a.append(o,u,p),document.body.append(i,a);let m=g=>{g.key==="Escape"?(document.body.removeChild(a),document.body.removeChild(i),document.removeEventListener("keydown",m),resolve(!1)):g.key==="Enter"&&(g.ctrlKey||g.metaKey)&&(document.body.removeChild(a),document.body.removeChild(i),document.removeEventListener("keydown",m),resolve(!0))};return document.addEventListener("keydown",m),new Promise(g=>{c.onclick=f.onclick=()=>{document.body.removeChild(a),document.body.removeChild(i),document.removeEventListener("keydown",m),g(!1)},h.onclick=()=>{document.body.removeChild(a),document.body.removeChild(i),document.removeEventListener("keydown",m),g(!0)},i.onclick=()=>{document.body.removeChild(a),document.body.removeChild(i),document.removeEventListener("keydown",m),g(!1)}})}async handleSelectionAction(e,t){let r=editorManager.activeFile;switch(e){case"Explain Code":await this.explainCodeWithChat(t,r);break;case"Rewrite":await this.rewriteCodeWithChat(t);break;case"Generate Code":await this.showGenerateCodePopup();break;case"Optimize Function":await this.optimizeFunctionWithChat(t);break;case"Add Comments":await this.addCommentsWithChat(t);break;case"Generate Docs":await this.generateDocsWithChat(t);break;case"Edit with AI":this.showAiEditPopup();break}}async explainCodeWithChat(e,t){try{if((!this.$page||!this.$page.isVisible)&&await this.run(),!editorManager){window.toast("\u26A0\uFE0F Editor not available",3e3);return}let r=t&&t.name?t.name:"Unknown",s=r!=="Unknown"&&r.split(".").pop()||"txt",a="You are a professional code explainer. Focus on the selected code provided and explain it clearly and comprehensively.",i=t&&t.uri?t.uri:r,o=t&&t.location?t.location:i?i.split("/").slice(0,-1).join("/"):"Unknown",l=o!=="Unknown"?o.split("/").pop():"Current Project",c=`CODE EXPLANATION REQUEST

**FILE CONTEXT:**
\u2022 File: ${r}
\u2022 Path: ${i}
\u2022 Directory: ${o}
\u2022 Project: ${l}
\u2022 Language: ${s}

**SELECTED CODE BLOCK:**
\`\`\`${s}
${e}
\`\`\`

**EXPLANATION REQUESTED:**
Please provide a comprehensive explanation covering:

1. **FUNCTIONALITY**: What this code does (main purpose and behavior)
2. **HOW IT WORKS**: Step-by-step breakdown of the logic
3. **TECHNICAL DETAILS**: Key concepts, patterns, and algorithms used
4. **DEPENDENCIES**: Required imports, libraries, or external resources
5. **CONTEXT**: How this fits within the larger file/project structure
6. **OPTIMIZATION**: Potential improvements and best practices
7. **USE CASES**: Common scenarios where this code would be useful
8. **RELATED CODE**: What other parts of the project might interact with this

Focus specifically on the selected code while considering its context within the file.`;this.appendUserQuery(c),this.scrollToBottom(),this.appendGptResponse(""),this.loader(),await this.getCliResponse(a+`

`+c)}catch(r){window.toast("Error in explainCodeWithChat",3e3),window.toast(`Error explaining code: ${r.message}`,3e3)}}async showGenerateCodePopup(){let e=tag("div",{className:"ai-edit-popup"}),t=tag("div",{className:"ai-edit-popup-header"}),r=tag("div",{className:"ai-edit-popup-title",textContent:"Generate Code"}),s=tag("button",{className:"ai-edit-popup-close",innerHTML:"X"});t.append(r,s);let a=tag("div",{className:"ai-edit-popup-body"}),i=tag("textarea",{className:"ai-edit-prompt",placeholder:`Describe what code you want to generate...
Example: 'Create a function to validate email addresses'`}),o=tag("div",{className:"ai-edit-actions"}),l=tag("button",{className:"ai-edit-btn secondary",textContent:"Cancel"}),c=tag("button",{className:"ai-edit-btn primary",textContent:"Generate Code"});o.append(l,c),a.append(i,o),e.append(t,a),s.onclick=l.onclick=()=>{document.body.contains(e)&&document.body.removeChild(e)},c.onclick=async()=>{let u=i.value.trim();u?(document.body.contains(e)&&document.body.removeChild(e),await this.processCodeGeneration(u)):window.toast("Please enter a description",3e3)},i.addEventListener("keydown",u=>{u.key==="Enter"&&(u.ctrlKey||u.metaKey)&&c.click()}),document.body.appendChild(e),i.focus()}async processCodeGeneration(e){if(!e||e.trim().length===0){window.toast("Please provide a description for code generation",3e3);return}if(e.length>1e3){window.toast("Description too long. Please keep it under 1000 characters",3e3);return}let t=editorManager.activeFile,r="",s="js";t&&(r=A.getValue(),s=t.name.split(".").pop()||"js"),ie.showTitleLoader(),window.toast("Generating code...",3e3);try{let i=`${`You are a professional code generator. Generate clean, efficient, and well-documented code based on user requirements.

**Instructions:**
1. Generate ONLY the requested code - no explanations
2. Use proper syntax for ${s} files
3. Include necessary imports/dependencies
4. Follow best practices and conventions
5. Make code production-ready with error handling`}

**File Type:** ${s}
**User Request:** ${e}

Generate the ${s} code:`,o;try{o=await this.appendGptResponse(i)}catch{window.toast("Primary AI service failed",4e3);try{o=await this.sendAiQuery(i)}catch{window.toast("Fallback AI service also failed",4e3),o=null}}let l=o.match(/```[\w]*\n([\s\S]*?)\n```/),c=l?l[1].trim():o.trim();if(c=c.replace(/^Here'?s the code:?\s*/i,"").replace(/^The code is:?\s*/i,"").replace(/^```[\w]*\n?/g,"").replace(/\n?```$/g,"").trim(),!c)throw new Error("No valid code generated");let u=A.getCursorPosition();if(A.session.insert(u,c+`
`),t&&t.uri)try{await t.save(),window.toast("Code generated and saved successfully!",3e3)}catch{window.toast("Code generated! Please save manually.",3e3)}else window.toast("Code generated successfully!",3e3);setTimeout(async()=>{await ue("Run the generated code?",["Yes","No","Cancel"])==="Yes"&&this.runCurrentFile()},1e3)}catch(a){window.toast(`Code generation failed: ${a.message}`,4e3),setTimeout(async()=>{let i=await ue("Code generation failed. Try:",["Retry","Chat Mode","Cancel"]);i==="Retry"?this.processCodeGeneration(e):i==="Chat Mode"&&(this.$page.isVisible||await this.run(),this.appendUserQuery(`Generate code: ${e}`),this.sendAiQuery(e))},500)}finally{ie.removeTitleLoader()}}async runCurrentFile(){try{let e=editorManager.activeFile;if(!e||!e.uri){window.toast("No file to run",3e3);return}let t=e.name,r=t.split(".").pop().toLowerCase(),s=e.uri;switch(e.isUnsaved&&await e.save(),r){case"html":case"htm":await this.runHtmlFile(e);break;case"py":await this.runPythonFile(s,t);break;case"js":await this.runJavaScriptFile(s,t);break;case"cpp":case"c":await this.runCppFile(s,t,r);break;case"java":await this.runJavaFile(s,t);break;case"go":await this.runGoFile(s,t);break;case"rs":await this.runRustFile(s,t);break;case"php":await this.runPhpFile(s,t);break;case"rb":await this.runRubyFile(s,t);break;default:window.toast(`Running ${r} files is not supported yet`,3e3);break}}catch(e){window.toast("Error running file",3e3),window.toast(`Error running file: ${e.message}`,3e3)}}async runHtmlFile(e){try{if(await e.canRun())e.run(),window.toast("Running HTML file in browser...",3e3);else{window.toast("Press F5 to run HTML file in preview",3e3);let t=new KeyboardEvent("keydown",{key:"F5",code:"F5",keyCode:116,which:116,bubbles:!0,cancelable:!0});document.dispatchEvent(t)}}catch{window.toast("Error running HTML file",3e3),window.toast("Please press F5 to run HTML file",3e3)}}async runPythonFile(e,t){try{let r=await Le.create({name:`Python - ${t}`,theme:"dark"}),a=[`cd "${e.substring(0,e.lastIndexOf("/"))}"`,`python3 "${t}" || python "${t}"`];for(let i of a)Le.write(r.id,i+`\r
`),await new Promise(o=>setTimeout(o,500));window.toast(`Running ${t} in terminal...`,3e3)}catch(r){window.toast("Error running Python file",3e3),window.toast(`Error running Python: ${r.message}`,3e3)}}async runJavaScriptFile(e,t){try{let r=await Le.create({name:`Node - ${t}`,theme:"dark"}),a=[`cd "${e.substring(0,e.lastIndexOf("/"))}"`,`node "${t}"`];for(let i of a)Le.write(r.id,i+`\r
`),await new Promise(o=>setTimeout(o,500));window.toast(`Running ${t} with Node.js...`,3e3)}catch(r){window.toast("Error running JavaScript file",3e3),window.toast(`Error running JavaScript: ${r.message}`,3e3)}}async runCppFile(e,t,r){try{let s=await Le.create({name:`C++ - ${t}`,theme:"dark"}),a=e.substring(0,e.lastIndexOf("/")),i=t.replace(`.${r}`,""),o=r==="cpp"?"g++":"gcc",l=[`cd "${a}"`,`${o} "${t}" -o "${i}" && ./"${i}"`];for(let c of l)Le.write(s.id,c+`\r
`),await new Promise(u=>setTimeout(u,800));window.toast(`Compiling and running ${t}...`,3e3)}catch(s){window.toast("Error running C++ file",3e3),window.toast(`Error running C++: ${s.message}`,3e3)}}async runJavaFile(e,t){try{let r=await Le.create({name:`Java - ${t}`,theme:"dark"}),s=e.substring(0,e.lastIndexOf("/")),a=t.replace(".java",""),i=[`cd "${s}"`,`javac "${t}" && java "${a}"`];for(let o of i)Le.write(r.id,o+`\r
`),await new Promise(l=>setTimeout(l,800));window.toast(`Compiling and running ${t}...`,3e3)}catch(r){window.toast("Error running Java file",3e3),window.toast(`Error running Java: ${r.message}`,3e3)}}async runGoFile(e,t){try{let r=await Le.create({name:`Go - ${t}`,theme:"dark"}),a=[`cd "${e.substring(0,e.lastIndexOf("/"))}"`,`go run "${t}"`];for(let i of a)Le.write(r.id,i+`\r
`),await new Promise(o=>setTimeout(o,500));window.toast(`Running ${t} with Go...`,3e3)}catch(r){window.toast("Error running Go file",3e3),window.toast(`Error running Go: ${r.message}`,3e3)}}async runRustFile(e,t){try{let r=await Le.create({name:`Rust - ${t}`,theme:"dark"}),s=e.substring(0,e.lastIndexOf("/")),a=t.replace(".rs",""),i=[`cd "${s}"`,`rustc "${t}" -o "${a}" && ./"${a}"`];for(let o of i)Le.write(r.id,o+`\r
`),await new Promise(l=>setTimeout(l,800));window.toast(`Compiling and running ${t}...`,3e3)}catch(r){window.toast("Error running Rust file",3e3),window.toast(`Error running Rust: ${r.message}`,3e3)}}async runPhpFile(e,t){try{let r=await Le.create({name:`PHP - ${t}`,theme:"dark"}),a=[`cd "${e.substring(0,e.lastIndexOf("/"))}"`,`php "${t}"`];for(let i of a)Le.write(r.id,i+`\r
`),await new Promise(o=>setTimeout(o,500));window.toast(`Running ${t} with PHP...`,3e3)}catch(r){window.toast("Error running PHP file",3e3),window.toast(`Error running PHP: ${r.message}`,3e3)}}async runRubyFile(e,t){try{let r=await Le.create({name:`Ruby - ${t}`,theme:"dark"}),a=[`cd "${e.substring(0,e.lastIndexOf("/"))}"`,`ruby "${t}"`];for(let i of a)Le.write(r.id,i+`\r
`),await new Promise(o=>setTimeout(o,500));window.toast(`Running ${t} with Ruby...`,3e3)}catch(r){window.toast("Error running Ruby file",3e3),window.toast(`Error running Ruby: ${r.message}`,3e3)}}async generateCode(e){let t=`Generate code based on this description: ${e}`;await this.sendAiQuery(t)}async optimizeFunctionWithChat(e){try{(!this.$page||!this.$page.isVisible)&&await this.run();let t=editorManager.activeFile,r=t?t.name.split(".").pop():"code",s="You are a code optimization expert. Focus on the selected code and provide optimizations for better performance, readability, and maintainability.",a=`Please optimize this ${r} code:

**Selected Code:**
\`\`\`${r}
${e}
\`\`\`

Optimization requirements:
- Improve performance and efficiency
- Enhance readability and maintainability
- Follow ${r} best practices
- Maintain existing functionality
- Provide clear explanations for each optimization

Provide the optimized code with detailed explanations:`;this.appendUserQuery(a),this.scrollToBottom(),this.appendGptResponse(""),this.loader(),await this.getCliResponse(s+`

`+a)}catch(t){window.toast("Error in optimizeFunctionWithChat",3e3),window.toast(`Error optimizing function: ${t.message}`,3e3)}}async addCommentsWithChat(e){try{(!this.$page||!this.$page.isVisible)&&await this.run();let t=editorManager.activeFile,r=t?t.name.split(".").pop():"code",s="You are a documentation expert. Add comprehensive, professional comments to the selected code only.",a=`Please add detailed comments to this ${r} code:

**Selected Code:**
\`\`\`${r}
${e}
\`\`\`

Comment requirements:
1. Explain what each section/function does
2. Document parameters and their types
3. Describe return values
4. Clarify complex logic or algorithms
5. Add JSDoc/appropriate format for ${r}
6. Keep comments concise but informative

Return the code with appropriate comments added:`;this.appendUserQuery(a),this.scrollToBottom(),this.appendGptResponse(""),this.loader(),await this.getCliResponse(s+`

`+a)}catch(t){window.toast("Error in addCommentsWithChat",3e3),window.toast(`Error adding comments: ${t.message}`,3e3)}}async generateDocsWithChat(e){this.$page.isVisible||await this.run();let t=editorManager.activeFile,s=(t?t.name:"Unknown").split(".").pop();if(e){let a="Generate docs for selected code only.",i=`Document ${s} code:
\`\`\`
${e}
\`\`\`
Include: JSDoc, params, returns, examples.`;this.appendUserQuery(i),this.appendGptResponse(""),this.loader(),await this.getCliResponse(a+`

`+i)}else window.toast("Please select code to generate documentation",3e3)}async sendAiQuery(e){this.$page.isVisible||await this.run(),this.appendUserQuery(e),this.appendGptResponse(""),this.loader(),await this.getCliResponse(e)}initializeMarkdown(){return!this.$mdIt&&window.markdownit&&(this.$mdIt=window.markdownit({html:!1,xhtmlOut:!1,breaks:!0,linkify:!0,typographer:!0,quotes:`""''`,highlight:function(e,t){let r=document.createElement("button");r.classList.add("copy-button"),r.innerHTML=gl,r.setAttribute("data-str",e);let s=`<pre class="hljs codesArea"><code>${window.hljs?window.hljs.highlightAuto(e).value:e}</code></pre>`;return`<div class="codeBlock">${r.outerHTML}${s}</div>`}})),this.$mdIt}async rewriteCodeWithChat(e){this.$page.isVisible||await this.run();let t=editorManager.activeFile,r=t?t.name.split(".").pop():"code",s="Rewrite code: cleaner, efficient, same functionality.",a=`Rewrite ${r} code:
\`\`\`
${e}
\`\`\`
Make cleaner, more efficient. Same functionality.`;this.appendUserQuery(a),this.appendGptResponse(""),this.loader(),await this.getCliResponse(s+`

`+a)}safeBase64Encode(e){try{return btoa(unescape(encodeURIComponent(e)))}catch{let r=0;for(let s=0;s<e.length;s++){let a=e.charCodeAt(s);r=(r<<5)-r+a,r=r&r}return Math.abs(r).toString(36)}}getCacheKey(e,t,r){return`${t}_${r}_${this.safeBase64Encode(e).substring(0,50)}`}getCachedResponse(e){let t=window.localStorage.getItem("ai-assistant-provider"),r=window.localStorage.getItem("ai-assistant-model-name"),s=this.getCacheKey(e,t,r),a=this.responseCache.get(s);return a&&Date.now()-a.timestamp<this.cacheTimeout?a.response:(a&&this.responseCache.delete(s),null)}setCachedResponse(e,t){let r=window.localStorage.getItem("ai-assistant-provider"),s=window.localStorage.getItem("ai-assistant-model-name"),a=this.getCacheKey(e,r,s);if(this.responseCache.set(a,{response:t,timestamp:Date.now()}),this.responseCache.size>100){let i=this.responseCache.keys().next().value;this.responseCache.delete(i)}}clearCache(){this.responseCache.clear(),this.fileCache.clear(),this.projectStructure=null,this.lastStructureScan=null,window.toast("Cache cleared",2e3)}getContentDifference(e,t){if(!t)return 1/0;if(e===t)return 0;let r=0,s=Math.max(e.length,t.length);for(let a=0;a<s;a++)e[a]!==t[a]&&r++;return r}getRealTimeCacheKey(e,t){return`realtime_${this.safeBase64Encode(e.substring(0,500)).substring(0,20)}_${t.row}_${Math.floor(t.column/10)}`}setupRealTimeAI(){A.commands.addCommand({name:"toggle_realtime_ai",description:"Toggle Real-time Renz Ai",bindKey:{win:"Ctrl-Alt-A",mac:"Cmd-Alt-A"},exec:()=>this.toggleRealTimeAI()}),A.on("change",e=>{this.realTimeEnabled&&this.handleEditorChange(e)}),A.on("changeSelection",e=>{this.realTimeEnabled&&this.handleCursorChange(e)}),this.createSuggestionWidget()}toggleRealTimeAI(){this.realTimeEnabled=!this.realTimeEnabled,this.realTimeEnabled?(window.toast("Real-time Renz Ai enabled \xE2\u0153\xA8",3e3),this.showRealTimeStatus(!0),this.analyzeCurrentFile()):(window.toast("Real-time Renz Ai disabled",2e3),this.showRealTimeStatus(!1),this.clearSuggestions(),this.clearErrorMarkers())}showRealTimeStatus(e){let t=document.querySelector(".realtime-ai-status")||tag("div",{className:"realtime-ai-status"});t.textContent=e?"\u{1F60D}AI Active":"",t.style.cssText=`
  position: fixed;
  top: 10px;
  right: 110px;
  background: ${e?"rgba(76, 175, 80, 0.7)":"rgba(0,0,0,0.3)"};
  color: white;
  padding: 3px 6px; /* lebih kecil */
  border-radius: 10px;
  font-size: 10px; /* lebih kecil */
  opacity: 0.7; /* transparan */
  z-index: 1000;
  transition: all 0.3s ease;
`,e&&!document.body.contains(t)?document.body.appendChild(t):!e&&document.body.contains(t)&&document.body.removeChild(t)}handleEditorChange(e){this.realTimeDebounceTimer&&clearTimeout(this.realTimeDebounceTimer),this.realTimeDebounceTimer=setTimeout(()=>{this.analyzeCurrentCode()},this.realTimeDelay)}handleCursorChange(e){this.realTimeEnabled&&this.showContextualSuggestions()}async analyzeCurrentCode(){try{let e=editorManager.activeFile;if(!e)return;let t=A.getValue(),r=A.getCursorPosition(),s=A.session.getLine(r.row),a=this.getContentDifference(t,this.lastAnalyzedContent);if(t===this.lastAnalyzedContent||a<10)return;this.lastAnalyzedContent=t;let i=this.getRealTimeCacheKey(t,r),o=this.realTimeAnalysisCache.get(i);if(o&&Date.now()-o.timestamp<3e5){this.applySuggestions(o.suggestions);return}let l=await this.performRealTimeAnalysis(t,s,r,e);this.realTimeAnalysisCache.set(i,{suggestions:l,timestamp:Date.now()}),this.applySuggestions(l)}catch{window.toast("Real-time analysis error",3e3)}}async performRealTimeAnalysis(e,t,r,s){let a=s.name.split(".").pop(),i=s.uri||s.name,o=s.location||(s.uri?s.uri.split("/").slice(0,-1).join("/"):""),l=e.split(`
`),c=Math.max(0,r.row-5),u=Math.min(l.length,r.row+5),d=l.slice(c,u).join(`
`),p=`CODE ANALYSIS ${a} L${r.row+1}

CONTEXT:
\`\`\`
${d}
\`\`\`

RESPONSE JSON:
{
  "errors": [{"line": <num>, "msg": "<short>", "severity": "error|warning"}],
  "suggestions": [{"line": <num>, "text": "<short>", "type": "optimization|bug|style"}],
  "completions": ["<option1>", "<option2>"]
}

Focus cursor area only.`;try{let h=(await this.appendGptResponse(p)).trim(),m=h.match(/```(?:json)?\s*(\{[\s\S]*?\})\s*```/);return m?h=m[1]:h.startsWith("```")&&(h=h.replace(/^```[\w]*\n?/,"").replace(/\n?```$/,"")),JSON.parse(h)}catch{return{syntax_errors:[],missing_imports:[],code_suggestions:[],auto_complete:[],quick_fixes:[]}}}applySuggestions(e){this.clearSuggestions(),this.clearErrorMarkers(),e.syntax_errors&&e.syntax_errors.length>0&&this.showSyntaxErrors(e.syntax_errors),e.missing_imports&&e.missing_imports.length>0&&this.showMissingImports(e.missing_imports),e.code_suggestions&&e.code_suggestions.length>0&&this.showCodeSuggestions(e.code_suggestions),e.auto_complete&&e.auto_complete.length>0&&this.showAutoComplete(e.auto_complete),e.quick_fixes&&e.quick_fixes.length>0&&this.showQuickFixes(e.quick_fixes)}showSyntaxErrors(e){e.forEach(t=>{let r=A.session.addMarker(new ace.Range(t.line-1,0,t.line-1,1),t.severity==="error"?"ace_error-marker":"ace_warning-marker","fullLine");this.errorMarkers.push(r),A.session.setAnnotations([{row:t.line-1,column:0,text:t.message,type:t.severity}])})}showMissingImports(e){if(e.length===0)return;let t=tag("div",{className:"ai-import-suggestion",style:`
      position: fixed;
      top: 50px;
      right: 10px;
      background: #2196F3;
      color: white;
      padding: 10px;
      border-radius: 8px;
      max-width: 300px;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    `}),r=tag("div",{textContent:"Missing Imports:",style:"font-weight: bold; margin-bottom: 5px;"}),s=tag("div");e.forEach(i=>{let o=tag("div",{textContent:i,style:"cursor: pointer; padding: 2px 0; border-bottom: 1px solid rgba(255,255,255,0.3);"});o.onclick=()=>{this.addImportToFile(i),document.body.removeChild(t)},s.appendChild(o)});let a=tag("button",{textContent:"X",style:`
      position: absolute;
      top: 5px;
      right: 5px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 16px;
    `});a.onclick=()=>{document.body.contains(t)&&document.body.removeChild(t)},t.append(r,s,a),document.body.appendChild(t),setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},1e4)}addImportToFile(e){let r=A.getValue().split(`
`),s=0;for(let a=0;a<r.length;a++)if(r[a].trim().startsWith("import ")||r[a].trim().startsWith("const ")||r[a].trim().startsWith("require("))s=a+1;else{if(r[a].trim()==="")continue;break}A.session.insert({row:s,column:0},e+`
`),window.toast(`Added import: ${e}`,2e3)}showContextualSuggestions(){let e=A.getCursorPosition(),t=A.renderer.textToScreenCoordinates(e.row,e.column);this.currentSuggestions.length>0&&(this.suggestionWidget.innerHTML="",this.currentSuggestions.forEach(r=>{let s=tag("div",{textContent:r.text||r,style:`
          padding: 4px 8px;
          cursor: pointer;
          border-radius: 2px;
          margin: 2px 0;
        `,className:"suggestion-item"});s.onmouseenter=()=>{s.style.background="#333"},s.onmouseleave=()=>{s.style.background="transparent"},s.onclick=()=>{this.applySuggestion(r),this.hideSuggestionWidget()},this.suggestionWidget.appendChild(s)}),this.suggestionWidget.style.left=t.pageX+"px",this.suggestionWidget.style.top=t.pageY+20+"px",this.suggestionWidget.style.display="block",setTimeout(()=>{this.hideSuggestionWidget()},5e3))}hideSuggestionWidget(){this.suggestionWidget&&(this.suggestionWidget.style.display="none")}clearSuggestions(){this.currentSuggestions=[],this.hideSuggestionWidget()}clearErrorMarkers(){this.errorMarkers.forEach(e=>{A.session.removeMarker(e)}),this.errorMarkers=[],A.session.clearAnnotations()}createSuggestionWidget(){return this.suggestionWidget&&this.suggestionWidget.remove(),this.suggestionWidget=tag("div",{className:"ai-suggestion-widget"}),document.body.appendChild(this.suggestionWidget),this.suggestionWidget}showCodeSuggestions(e){try{if(!e||e.length===0){this.suggestionWidget&&(this.suggestionWidget.style.display="none");return}this.suggestionWidget||this.createSuggestionWidget(),this.suggestionWidget.innerHTML="";let t=tag("div",{className:"suggestion-header",textContent:"\u{1F4A1} AI Suggestions"});this.suggestionWidget.appendChild(t),e.forEach((r,s)=>{let a=tag("div",{className:"suggestion-item"}),i=tag("div",{className:"suggestion-title",textContent:r.title||`Suggestion ${s+1}`}),o=tag("div",{className:"suggestion-description",textContent:r.description||r.text});a.append(i,o),a.addEventListener("click",()=>{this.applySuggestion(r),this.suggestionWidget.style.display="none"}),this.suggestionWidget.appendChild(a)}),this.positionSuggestionWidget(),this.suggestionWidget.style.display="block"}catch{window.toast("Error showing code suggestions",3e3)}}showAutoComplete(e){try{if(!e||e.length===0){this.suggestionWidget&&(this.suggestionWidget.style.display="none");return}this.suggestionWidget||this.createSuggestionWidget(),this.suggestionWidget.innerHTML="";let t=tag("div",{className:"autocomplete-header",textContent:"\u{1F50D} Auto Complete"});this.suggestionWidget.appendChild(t),e.forEach((r,s)=>{let a=tag("div",{className:"completion-item"}),i=tag("span",{className:"completion-icon",textContent:this.getCompletionIcon(r.type||"text")}),o=tag("div",{className:"completion-content"}),l=tag("div",{className:"completion-label",textContent:r.label||r.text}),c=tag("div",{className:"completion-detail",textContent:r.detail||r.description||""});o.append(l,c),a.append(i,o),a.addEventListener("click",()=>{this.applyCompletion(r),this.suggestionWidget.style.display="none"}),this.suggestionWidget.appendChild(a)}),this.positionSuggestionWidget(),this.suggestionWidget.style.display="block"}catch{window.toast("Error showing auto complete",3e3)}}showQuickFixes(e){try{if(!e||e.length===0){this.suggestionWidget&&(this.suggestionWidget.style.display="none");return}this.suggestionWidget||this.createSuggestionWidget(),this.suggestionWidget.innerHTML="";let t=tag("div",{className:"quickfix-header",textContent:"\u{1F527} Quick Fixes"});this.suggestionWidget.appendChild(t),e.forEach((r,s)=>{let a=tag("div",{className:"quickfix-item"}),i=tag("div",{className:"quickfix-item-header"}),o=tag("span",{className:"fix-severity",textContent:this.getSeverityIcon(r.severity||"error")}),l=tag("span",{className:"fix-title",textContent:r.title||`Fix ${s+1}`});i.append(o,l);let c=tag("div",{className:"fix-description",textContent:r.description||r.message}),u=tag("div",{className:"fix-action",textContent:r.action||"Apply Fix"});a.append(i,c,u),a.addEventListener("click",()=>{this.applyQuickFix(r),this.suggestionWidget.style.display="none"}),this.suggestionWidget.appendChild(a)}),this.positionSuggestionWidget(),this.suggestionWidget.style.display="block"}catch{window.toast("Error showing quick fixes",3e3)}}positionSuggestionWidget(){if(!(!this.suggestionWidget||!A))try{let e=A.getCursorPosition(),r=A.renderer.textToScreenCoordinates(e.row,e.column),a=A.container.getBoundingClientRect(),i=r.pageX,o=r.pageY+20,l=window.innerWidth,c=window.innerHeight,u=400,d=300,p=i,f=o;i+u>l&&(p=l-u-10),o+d>c&&(f=r.pageY-d-10),this.suggestionWidget.style.left=`${Math.max(10,p)}px`,this.suggestionWidget.style.top=`${Math.max(10,f)}px`}catch{window.toast("Error positioning suggestion widget",3e3),this.suggestionWidget.style.left="50px",this.suggestionWidget.style.top="100px"}}getCompletionIcon(e){return{function:"\u{1F527}",variable:"\u{1F4E6}",class:"\u{1F3D7}\uFE0F",method:"\u2699\uFE0F",property:"\u{1F517}",keyword:"\u{1F511}",snippet:"\u{1F4DD}",text:"\u{1F4C4}",module:"\u{1F4DA}",file:"\u{1F4C1}"}[e]||"\u{1F4C4}"}getSeverityIcon(e){return{error:"\u274C",warning:"\u26A0\uFE0F",info:"\u2139\uFE0F",hint:"\u{1F4A1}"}[e]||"\u274C"}applySuggestion(e){try{if(!A||!e)return;let t=A.getCursorPosition();if(e.insertText)A.session.insert(t,e.insertText);else if(e.replaceRange&&e.newText){let r=new A.Range(e.replaceRange.start.row,e.replaceRange.start.column,e.replaceRange.end.row,e.replaceRange.end.column);A.session.replace(r,e.newText)}e.command&&A.execCommand(e.command),window.toast("Suggestion applied",2e3)}catch{window.toast("Error applying suggestion",3e3),window.toast("Error applying suggestion",3e3)}}applyCompletion(e){try{if(!A||!e)return;let t=A.getCursorPosition(),r=A.session,s=r.getLine(t.row),a=e.insertText||e.label||e.text;if(e.range){let i=new A.Range(e.range.start.row,e.range.start.column,e.range.end.row,e.range.end.column);r.replace(i,a)}else r.insert(t,a);if(e.cursorOffset){let i={row:t.row,column:t.column+e.cursorOffset};A.moveCursorToPosition(i)}window.toast("Completion applied",2e3)}catch(t){window.toast(`Error applying completion: ${t.message}`,3e3)}}applyQuickFix(e){try{if(!A||!e)return;e.edits&&Array.isArray(e.edits)&&e.edits.sort((r,s)=>r.range.start.row!==s.range.start.row?s.range.start.row-r.range.start.row:s.range.start.column-r.range.start.column).forEach(r=>{let s=new A.Range(r.range.start.row,r.range.start.column,r.range.end.row,r.range.end.column);A.session.replace(s,r.newText||"")}),e.command&&(typeof e.command=="string"?A.execCommand(e.command):e.command.id&&A.execCommand(e.command.id,e.command.arguments)),window.toast(e.successMessage||"Quick fix applied",2e3),e.resolvesMarkers&&this.errorMarkers&&e.resolvesMarkers.forEach(t=>{let r=this.errorMarkers.findIndex(s=>s.id===t);r!==-1&&(A.session.removeMarker(this.errorMarkers[r].aceMarkerId),this.errorMarkers.splice(r,1))})}catch(t){window.toast(`Error applying quick fix: ${t.message}`,3e3)}}async analyzeCurrentFile(){if(!this.realTimeEnabled)return;let e=editorManager.activeFile;if(!e)return;let t=A.getValue();if(t.trim().length!==0)try{let r=await this.performRealTimeAnalysis(t,A.session.getLine(A.getCursorPosition().row),A.getCursorPosition(),e);this.applySuggestions(r)}catch{window.toast("File analysis error",3e3)}}async destroy(){try{this.$loadInterval&&(clearInterval(this.$loadInterval),this.$loadInterval=null),this.realTimeInterval&&(clearInterval(this.realTimeInterval),this.realTimeInterval=null),this.contextUpdateInterval&&(clearInterval(this.contextUpdateInterval),this.contextUpdateInterval=null);try{this.abortController&&(this.abortController.abort(),this.abortController=null)}catch{}if(this.realTimeAbortController&&(this.realTimeAbortController.abort(),this.realTimeAbortController=null),this.websocket)try{this.websocket.close(),this.websocket=null}catch{}if(this.eventSource)try{this.eventSource.close(),this.eventSource=null}catch{}this.messageHistories={},this.messageSessionConfig=null,this.realTimeContext={},this.contextHistory=[],this.realTimeEnabled=!1,this.cache&&this.cache.clear(),this.realTimeCache&&this.realTimeCache.clear();try{if(this.editorChangeListener&&typeof A<"u"&&A&&A.off)try{A.off("change",this.editorChangeListener)}catch{}finally{this.editorChangeListener=null}}catch{}if(this.cursorChangeListener)try{A.off("changeSelection",this.cursorChangeListener),this.cursorChangeListener=null}catch{}typeof A<"u"&&A&&A.commands&&A.commands.removeCommand&&["ai_assistant","ai_edit_current_file","ai_explain_code","ai_generate_code","ai_optimize_function","ai_add_comments","ai_generate_docs","ai_rewrite_code","ai_toggle_realtime","ai_realtime_suggest","ai_clear_realtime_context"].forEach(s=>{try{A.commands.removeCommand(s)}catch{}}),["ai-assistant-provider","ai-assistant-model-name","openai-like-baseurl","Ollama-Host","ai-realtime-enabled","ai-realtime-interval","ai-context-update-interval","ai-realtime-cache-size"].forEach(r=>{window.localStorage.removeItem(r)});try{if(window.DATA_STORAGE&&typeof j<"u"){let r=window.DATA_STORAGE+"secret.key";await j(r).exists()&&await j(r).delete()}}catch{}try{let r=window.DATA_STORAGE+"realtime-context.json";await j(r).exists()&&await j(r).delete()}catch{}[this.$githubDarkFile,this.$higlightJsFile,this.$markdownItFile,this.$style,this.$realTimeIndicator,this.$contextPanel].forEach(r=>{try{r&&r.parentNode&&r.remove()}catch{}}),this.modelInstance=null,this.apiKeyManager=null,this.$page=null,this.realTimeManager=null,this.contextManager=null,this.debounceTimeout&&(clearTimeout(this.debounceTimeout),this.debounceTimeout=null),this.contextSaveTimeout&&(clearTimeout(this.contextSaveTimeout),this.contextSaveTimeout=null)}catch{window.toast("Error during plugin destruction",3e3)}}};if(window.acode){let n=new om;acode.setPluginInit(wl.id,(e,t,{cacheFileUrl:r,cacheFile:s})=>{e.endsWith("/")||(e+="/"),n.baseUrl=e,n.init(t,s,r)}),acode.setPluginUnmount(wl.id,()=>{n.destroy()})}})();
/*! Bundled license information:

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)

mustache/mustache.mjs:
  (*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@langchain/core/dist/utils/js-sha1/hash.js:
  (*
   * [js-sha1]{@link https://github.com/emn178/js-sha1}
   *
   * @version 0.6.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
