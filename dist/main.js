(()=>{var u_=Object.create;var Cl=Object.defineProperty;var l_=Object.getOwnPropertyDescriptor;var c_=Object.getOwnPropertyNames;var d_=Object.getPrototypeOf,p_=Object.prototype.hasOwnProperty;var g=(n,e)=>()=>(n&&(e=n(n=0)),e);var S=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),ro=(n,e)=>{for(var t in e)Cl(n,t,{get:e[t],enumerable:!0})},f_=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of c_(e))!p_.call(n,a)&&a!==t&&Cl(n,a,{get:()=>e[a],enumerable:!(r=l_(e,a))||r.enumerable});return n};var nt=(n,e,t)=>(t=n!=null?u_(d_(n)):{},f_(e||!n||!n.__esModule?Cl(t,"default",{value:n,enumerable:!0}):t,n));var H,Rl,E,Lt,Bs=g(()=>{(function(n){n.assertEqual=a=>{};function e(a){}n.assertIs=e;function t(a){throw new Error}n.assertNever=t,n.arrayToEnum=a=>{let s={};for(let i of a)s[i]=i;return s},n.getValidEnumValues=a=>{let s=n.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),i={};for(let o of s)i[o]=a[o];return n.objectValues(i)},n.objectValues=a=>n.objectKeys(a).map(function(s){return a[s]}),n.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let s=[];for(let i in a)Object.prototype.hasOwnProperty.call(a,i)&&s.push(i);return s},n.find=(a,s)=>{for(let i of a)if(s(i))return i},n.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,s=" | "){return a.map(i=>typeof i=="string"?`'${i}'`:i).join(s)}n.joinValues=r,n.jsonStringifyReplacer=(a,s)=>typeof s=="bigint"?s.toString():s})(H||(H={}));(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(Rl||(Rl={}));E=H.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Lt=n=>{switch(typeof n){case"undefined":return E.undefined;case"string":return E.string;case"number":return Number.isNaN(n)?E.nan:E.number;case"boolean":return E.boolean;case"function":return E.function;case"bigint":return E.bigint;case"symbol":return E.symbol;case"object":return Array.isArray(n)?E.array:n===null?E.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?E.promise:typeof Map<"u"&&n instanceof Map?E.map:typeof Set<"u"&&n instanceof Set?E.set:typeof Date<"u"&&n instanceof Date?E.date:E.object;default:return E.unknown}}});var _,m_,Ue,no=g(()=>{Bs();_=H.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),m_=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:"),Ue=class n extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(s){return s.message},r={_errors:[]},a=s=>{for(let i of s.issues)if(i.code==="invalid_union")i.unionErrors.map(a);else if(i.code==="invalid_return_type")a(i.returnTypeError);else if(i.code==="invalid_arguments")a(i.argumentsError);else if(i.path.length===0)r._errors.push(t(i));else{let o=r,u=0;for(;u<i.path.length;){let l=i.path[u];u===i.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(i))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return a(this),r}static assert(e){if(!(e instanceof n))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,H.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},r=[];for(let a of this.issues)if(a.path.length>0){let s=a.path[0];t[s]=t[s]||[],t[s].push(e(a))}else r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};Ue.create=n=>new Ue(n)});var g_,rr,Nl=g(()=>{no();Bs();g_=(n,e)=>{let t;switch(n.code){case _.invalid_type:n.received===E.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case _.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,H.jsonStringifyReplacer)}`;break;case _.unrecognized_keys:t=`Unrecognized key(s) in object: ${H.joinValues(n.keys,", ")}`;break;case _.invalid_union:t="Invalid input";break;case _.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${H.joinValues(n.options)}`;break;case _.invalid_enum_value:t=`Invalid enum value. Expected ${H.joinValues(n.options)}, received '${n.received}'`;break;case _.invalid_arguments:t="Invalid function arguments";break;case _.invalid_return_type:t="Invalid function return type";break;case _.invalid_date:t="Invalid date";break;case _.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:H.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case _.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="bigint"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case _.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case _.custom:t="Invalid input";break;case _.invalid_intersection_types:t="Intersection results could not be merged";break;case _.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case _.not_finite:t="Number must be finite";break;default:t=e.defaultError,H.assertNever(n)}return{message:t}},rr=g_});function y_(n){uf=n}function ga(){return uf}var uf,ao=g(()=>{Nl();uf=rr});function A(n,e){let t=ga(),r=qs({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===rr?void 0:rr].filter(a=>!!a)});n.common.issues.push(r)}var qs,b_,we,$,un,Ie,so,io,Tr,ya,$l=g(()=>{ao();Nl();qs=n=>{let{data:e,path:t,errorMaps:r,issueData:a}=n,s=[...t,...a.path||[]],i={...a,path:s};if(a.message!==void 0)return{...a,path:s,message:a.message};let o="",u=r.filter(l=>!!l).slice().reverse();for(let l of u)o=l(i,{data:e,defaultError:o}).message;return{...a,path:s,message:o}},b_=[];we=class n{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if(a.status==="aborted")return $;a.status==="dirty"&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let a of t){let s=await a.key,i=await a.value;r.push({key:s,value:i})}return n.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:s,value:i}=a;if(s.status==="aborted"||i.status==="aborted")return $;s.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof i.value<"u"||a.alwaysSet)&&(r[s.value]=i.value)}return{status:e.value,value:r}}},$=Object.freeze({status:"aborted"}),un=n=>({status:"dirty",value:n}),Ie=n=>({status:"valid",value:n}),so=n=>n.status==="aborted",io=n=>n.status==="dirty",Tr=n=>n.status==="valid",ya=n=>typeof Promise<"u"&&n instanceof Promise});var lf=g(()=>{});var C,cf=g(()=>{(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e?.message})(C||(C={}))});function U(n){if(!n)return{};let{errorMap:e,invalid_type_error:t,required_error:r,description:a}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(i,o)=>{let{message:u}=n;return i.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??r??o.defaultError}:i.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:a}}function hf(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);let t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function j_(n){return new RegExp(`^${hf(n)}$`)}function mf(n){let e=`${ff}T${hf(n)}`,t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function M_(n,e){return!!((e==="v4"||!e)&&T_.test(n)||(e==="v6"||!e)&&C_.test(n))}function L_(n,e){if(!E_.test(n))return!1;try{let[t]=n.split(".");if(!t)return!1;let r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&a?.typ!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function D_(n,e){return!!((e==="v4"||!e)&&S_.test(n)||(e==="v6"||!e)&&k_.test(n))}function F_(n,e){let t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,a=t>r?t:r,s=Number.parseInt(n.toFixed(a).replace(".","")),i=Number.parseInt(e.toFixed(a).replace(".",""));return s%i/10**a}function ba(n){if(n instanceof ze){let e={};for(let t in n.shape){let r=n.shape[t];e[t]=at.create(ba(r))}return new ze({...n._def,shape:()=>e})}else return n instanceof sr?new sr({...n._def,type:ba(n.element)}):n instanceof at?at.create(ba(n.unwrap())):n instanceof Ft?Ft.create(ba(n.unwrap())):n instanceof Dt?Dt.create(n.items.map(e=>ba(e))):n}function Ml(n,e){let t=Lt(n),r=Lt(e);if(n===e)return{valid:!0,data:n};if(t===E.object&&r===E.object){let a=H.objectKeys(e),s=H.objectKeys(n).filter(o=>a.indexOf(o)!==-1),i={...n,...e};for(let o of s){let u=Ml(n[o],e[o]);if(!u.valid)return{valid:!1};i[o]=u.data}return{valid:!0,data:i}}else if(t===E.array&&r===E.array){if(n.length!==e.length)return{valid:!1};let a=[];for(let s=0;s<n.length;s++){let i=n[s],o=e[s],u=Ml(i,o);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return t===E.date&&r===E.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}function gf(n,e){return new _n({values:n,typeName:w.ZodEnum,...U(e)})}function pf(n,e){let t=typeof n=="function"?n(e):typeof n=="string"?{message:n}:n;return typeof t=="string"?{message:t}:t}function yf(n,e={},t){return n?Cr.create().superRefine((r,a)=>{let s=n(r);if(s instanceof Promise)return s.then(i=>{if(!i){let o=pf(e,r),u=o.fatal??t??!0;a.addIssue({code:"custom",...o,fatal:u})}});if(!s){let i=pf(e,r),o=i.fatal??t??!0;a.addIssue({code:"custom",...i,fatal:o})}}):Cr.create()}var st,df,z,__,w_,v_,x_,A_,E_,O_,I_,P_,jl,T_,S_,C_,k_,R_,N_,ff,$_,Sr,ln,cn,dn,pn,_a,fn,hn,Cr,ar,wt,wa,sr,ze,mn,nr,oo,gn,Dt,uo,va,xa,lo,yn,bn,_n,wn,kr,it,at,Ft,vn,xn,Aa,U_,Vs,Hs,An,z_,w,B_,bf,_f,q_,V_,wf,H_,K_,G_,J_,W_,Z_,X_,Y_,Q_,ew,tw,rw,nw,aw,sw,iw,ow,uw,lw,cw,dw,pw,fw,hw,mw,gw,yw,bw,_w,ww,vw,xw,Aw,Ew,vf=g(()=>{no();ao();cf();$l();Bs();st=class{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},df=(n,e)=>{if(Tr(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Ue(n.common.issues);return this._error=t,this._error}}};z=class{get description(){return this._def.description}_getType(e){return Lt(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Lt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new we,ctx:{common:e.parent.common,data:e.data,parsedType:Lt(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(ya(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Lt(e)},a=this._parseSync({data:e,path:r.path,parent:r});return df(r,a)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Lt(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return Tr(r)?{value:r.value}:{issues:t.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(r=>Tr(r)?{value:r.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Lt(e)},a=this._parse({data:e,path:r.path,parent:r}),s=await(ya(a)?a:Promise.resolve(a));return df(r,s)}refine(e,t){let r=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,s)=>{let i=e(a),o=()=>s.addIssue({code:_.custom,...r(a)});return typeof Promise<"u"&&i instanceof Promise?i.then(u=>u?!0:(o(),!1)):i?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,a)=>e(r)?!0:(a.addIssue(typeof t=="function"?t(r,a):t),!1))}_refinement(e){return new it({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return at.create(this,this._def)}nullable(){return Ft.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return sr.create(this)}promise(){return kr.create(this,this._def)}or(e){return mn.create([this,e],this._def)}and(e){return gn.create(this,e,this._def)}transform(e){return new it({...U(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new vn({...U(this._def),innerType:this,defaultValue:t,typeName:w.ZodDefault})}brand(){return new Vs({typeName:w.ZodBranded,type:this,...U(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new xn({...U(this._def),innerType:this,catchValue:t,typeName:w.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Hs.create(this,e)}readonly(){return An.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},__=/^c[^\s-]{8,}$/i,w_=/^[0-9a-z]+$/,v_=/^[0-9A-HJKMNP-TV-Z]{26}$/i,x_=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,A_=/^[a-z0-9_-]{21}$/i,E_=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,O_=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,I_=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,P_="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",T_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,S_=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,C_=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,k_=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,R_=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,N_=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ff="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",$_=new RegExp(`^${ff}$`);Sr=class n extends z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==E.string){let s=this._getOrReturnCtx(e);return A(s,{code:_.invalid_type,expected:E.string,received:s.parsedType}),$}let r=new we,a;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(a=this._getOrReturnCtx(e,a),A(a,{code:_.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(a=this._getOrReturnCtx(e,a),A(a,{code:_.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){let i=e.data.length>s.value,o=e.data.length<s.value;(i||o)&&(a=this._getOrReturnCtx(e,a),i?A(a,{code:_.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&A(a,{code:_.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")I_.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"email",code:_.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")jl||(jl=new RegExp(P_,"u")),jl.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"emoji",code:_.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")x_.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"uuid",code:_.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")A_.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"nanoid",code:_.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")__.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"cuid",code:_.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")w_.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"cuid2",code:_.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")v_.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"ulid",code:_.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),A(a,{validation:"url",code:_.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"regex",code:_.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(a=this._getOrReturnCtx(e,a),A(a,{code:_.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(a=this._getOrReturnCtx(e,a),A(a,{code:_.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(a=this._getOrReturnCtx(e,a),A(a,{code:_.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?mf(s).test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{code:_.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?$_.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{code:_.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?j_(s).test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{code:_.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?O_.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"duration",code:_.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?M_(e.data,s.version)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"ip",code:_.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?L_(e.data,s.alg)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"jwt",code:_.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?D_(e.data,s.version)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"cidr",code:_.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?R_.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"base64",code:_.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?N_.test(e.data)||(a=this._getOrReturnCtx(e,a),A(a,{validation:"base64url",code:_.invalid_string,message:s.message}),r.dirty()):H.assertNever(s);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(a=>e.test(a),{validation:t,code:_.invalid_string,...C.errToObj(r)})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...C.errToObj(e)})}url(e){return this._addCheck({kind:"url",...C.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...C.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...C.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...C.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...C.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...C.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...C.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...C.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...C.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...C.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...C.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...C.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...C.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...C.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...C.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...C.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...C.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...C.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...C.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...C.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...C.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...C.errToObj(t)})}nonempty(e){return this.min(1,C.errToObj(e))}trim(){return new n({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new n({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Sr.create=n=>new Sr({checks:[],typeName:w.ZodString,coerce:n?.coerce??!1,...U(n)});ln=class n extends z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==E.number){let s=this._getOrReturnCtx(e);return A(s,{code:_.invalid_type,expected:E.number,received:s.parsedType}),$}let r,a=new we;for(let s of this._def.checks)s.kind==="int"?H.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),A(r,{code:_.invalid_type,expected:"integer",received:"float",message:s.message}),a.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:_.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:_.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),a.dirty()):s.kind==="multipleOf"?F_(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),A(r,{code:_.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),A(r,{code:_.not_finite,message:s.message}),a.dirty()):H.assertNever(s);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,C.toString(t))}gt(e,t){return this.setLimit("min",e,!1,C.toString(t))}lte(e,t){return this.setLimit("max",e,!0,C.toString(t))}lt(e,t){return this.setLimit("max",e,!1,C.toString(t))}setLimit(e,t,r,a){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:C.toString(a)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:C.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:C.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:C.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:C.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:C.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&H.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};ln.create=n=>new ln({checks:[],typeName:w.ZodNumber,coerce:n?.coerce||!1,...U(n)});cn=class n extends z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==E.bigint)return this._getInvalidInput(e);let r,a=new we;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:_.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),A(r,{code:_.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),a.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),A(r,{code:_.not_multiple_of,multipleOf:s.value,message:s.message}),a.dirty()):H.assertNever(s);return{status:a.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return A(t,{code:_.invalid_type,expected:E.bigint,received:t.parsedType}),$}gte(e,t){return this.setLimit("min",e,!0,C.toString(t))}gt(e,t){return this.setLimit("min",e,!1,C.toString(t))}lte(e,t){return this.setLimit("max",e,!0,C.toString(t))}lt(e,t){return this.setLimit("max",e,!1,C.toString(t))}setLimit(e,t,r,a){return new n({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:C.toString(a)}]})}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:C.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:C.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:C.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:C.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:C.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};cn.create=n=>new cn({checks:[],typeName:w.ZodBigInt,coerce:n?.coerce??!1,...U(n)});dn=class extends z{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==E.boolean){let r=this._getOrReturnCtx(e);return A(r,{code:_.invalid_type,expected:E.boolean,received:r.parsedType}),$}return Ie(e.data)}};dn.create=n=>new dn({typeName:w.ZodBoolean,coerce:n?.coerce||!1,...U(n)});pn=class n extends z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==E.date){let s=this._getOrReturnCtx(e);return A(s,{code:_.invalid_type,expected:E.date,received:s.parsedType}),$}if(Number.isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return A(s,{code:_.invalid_date}),$}let r=new we,a;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(a=this._getOrReturnCtx(e,a),A(a,{code:_.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(a=this._getOrReturnCtx(e,a),A(a,{code:_.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):H.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new n({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:C.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:C.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};pn.create=n=>new pn({checks:[],coerce:n?.coerce||!1,typeName:w.ZodDate,...U(n)});_a=class extends z{_parse(e){if(this._getType(e)!==E.symbol){let r=this._getOrReturnCtx(e);return A(r,{code:_.invalid_type,expected:E.symbol,received:r.parsedType}),$}return Ie(e.data)}};_a.create=n=>new _a({typeName:w.ZodSymbol,...U(n)});fn=class extends z{_parse(e){if(this._getType(e)!==E.undefined){let r=this._getOrReturnCtx(e);return A(r,{code:_.invalid_type,expected:E.undefined,received:r.parsedType}),$}return Ie(e.data)}};fn.create=n=>new fn({typeName:w.ZodUndefined,...U(n)});hn=class extends z{_parse(e){if(this._getType(e)!==E.null){let r=this._getOrReturnCtx(e);return A(r,{code:_.invalid_type,expected:E.null,received:r.parsedType}),$}return Ie(e.data)}};hn.create=n=>new hn({typeName:w.ZodNull,...U(n)});Cr=class extends z{constructor(){super(...arguments),this._any=!0}_parse(e){return Ie(e.data)}};Cr.create=n=>new Cr({typeName:w.ZodAny,...U(n)});ar=class extends z{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ie(e.data)}};ar.create=n=>new ar({typeName:w.ZodUnknown,...U(n)});wt=class extends z{_parse(e){let t=this._getOrReturnCtx(e);return A(t,{code:_.invalid_type,expected:E.never,received:t.parsedType}),$}};wt.create=n=>new wt({typeName:w.ZodNever,...U(n)});wa=class extends z{_parse(e){if(this._getType(e)!==E.undefined){let r=this._getOrReturnCtx(e);return A(r,{code:_.invalid_type,expected:E.void,received:r.parsedType}),$}return Ie(e.data)}};wa.create=n=>new wa({typeName:w.ZodVoid,...U(n)});sr=class n extends z{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==E.array)return A(t,{code:_.invalid_type,expected:E.array,received:t.parsedType}),$;if(a.exactLength!==null){let i=t.data.length>a.exactLength.value,o=t.data.length<a.exactLength.value;(i||o)&&(A(t,{code:i?_.too_big:_.too_small,minimum:o?a.exactLength.value:void 0,maximum:i?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(A(t,{code:_.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(A(t,{code:_.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((i,o)=>a.type._parseAsync(new st(t,i,t.path,o)))).then(i=>we.mergeArray(r,i));let s=[...t.data].map((i,o)=>a.type._parseSync(new st(t,i,t.path,o)));return we.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new n({...this._def,minLength:{value:e,message:C.toString(t)}})}max(e,t){return new n({...this._def,maxLength:{value:e,message:C.toString(t)}})}length(e,t){return new n({...this._def,exactLength:{value:e,message:C.toString(t)}})}nonempty(e){return this.min(1,e)}};sr.create=(n,e)=>new sr({type:n,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...U(e)});ze=class n extends z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=H.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==E.object){let l=this._getOrReturnCtx(e);return A(l,{code:_.invalid_type,expected:E.object,received:l.parsedType}),$}let{status:r,ctx:a}=this._processInputParams(e),{shape:s,keys:i}=this._getCached(),o=[];if(!(this._def.catchall instanceof wt&&this._def.unknownKeys==="strip"))for(let l in a.data)i.includes(l)||o.push(l);let u=[];for(let l of i){let c=s[l],d=a.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new st(a,d,a.path,l)),alwaysSet:l in a.data})}if(this._def.catchall instanceof wt){let l=this._def.unknownKeys;if(l==="passthrough")for(let c of o)u.push({key:{status:"valid",value:c},value:{status:"valid",value:a.data[c]}});else if(l==="strict")o.length>0&&(A(a,{code:_.unrecognized_keys,keys:o}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let c of o){let d=a.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new st(a,d,a.path,c)),alwaysSet:c in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let l=[];for(let c of u){let d=await c.key,p=await c.value;l.push({key:d,value:p,alwaysSet:c.alwaysSet})}return l}).then(l=>we.mergeObjectSync(r,l)):we.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return C.errToObj,new n({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{let a=this._def.errorMap?.(t,r).message??r.defaultError;return t.code==="unrecognized_keys"?{message:C.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new n({...this._def,unknownKeys:"strip"})}passthrough(){return new n({...this._def,unknownKeys:"passthrough"})}extend(e){return new n({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new n({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new n({...this._def,catchall:e})}pick(e){let t={};for(let r of H.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new n({...this._def,shape:()=>t})}omit(e){let t={};for(let r of H.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new n({...this._def,shape:()=>t})}deepPartial(){return ba(this)}partial(e){let t={};for(let r of H.objectKeys(this.shape)){let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}return new n({...this._def,shape:()=>t})}required(e){let t={};for(let r of H.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof at;)s=s._def.innerType;t[r]=s}return new n({...this._def,shape:()=>t})}keyof(){return gf(H.objectKeys(this.shape))}};ze.create=(n,e)=>new ze({shape:()=>n,unknownKeys:"strip",catchall:wt.create(),typeName:w.ZodObject,...U(e)});ze.strictCreate=(n,e)=>new ze({shape:()=>n,unknownKeys:"strict",catchall:wt.create(),typeName:w.ZodObject,...U(e)});ze.lazycreate=(n,e)=>new ze({shape:n,unknownKeys:"strip",catchall:wt.create(),typeName:w.ZodObject,...U(e)});mn=class extends z{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;function a(s){for(let o of s)if(o.result.status==="valid")return o.result;for(let o of s)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let i=s.map(o=>new Ue(o.ctx.common.issues));return A(t,{code:_.invalid_union,unionErrors:i}),$}if(t.common.async)return Promise.all(r.map(async s=>{let i={...t,common:{...t.common,issues:[]},parent:null};return{result:await s._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(a);{let s,i=[];for(let u of r){let l={...t,common:{...t.common,issues:[]},parent:null},c=u._parseSync({data:t.data,path:t.path,parent:l});if(c.status==="valid")return c;c.status==="dirty"&&!s&&(s={result:c,ctx:l}),l.common.issues.length&&i.push(l.common.issues)}if(s)return t.common.issues.push(...s.ctx.common.issues),s.result;let o=i.map(u=>new Ue(u));return A(t,{code:_.invalid_union,unionErrors:o}),$}}get options(){return this._def.options}};mn.create=(n,e)=>new mn({options:n,typeName:w.ZodUnion,...U(e)});nr=n=>n instanceof yn?nr(n.schema):n instanceof it?nr(n.innerType()):n instanceof bn?[n.value]:n instanceof _n?n.options:n instanceof wn?H.objectValues(n.enum):n instanceof vn?nr(n._def.innerType):n instanceof fn?[void 0]:n instanceof hn?[null]:n instanceof at?[void 0,...nr(n.unwrap())]:n instanceof Ft?[null,...nr(n.unwrap())]:n instanceof Vs||n instanceof An?nr(n.unwrap()):n instanceof xn?nr(n._def.innerType):[],oo=class n extends z{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==E.object)return A(t,{code:_.invalid_type,expected:E.object,received:t.parsedType}),$;let r=this.discriminator,a=t.data[r],s=this.optionsMap.get(a);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(A(t,{code:_.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),$)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let s of t){let i=nr(s.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(a.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);a.set(o,s)}}return new n({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...U(r)})}};gn=class extends z{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(s,i)=>{if(so(s)||so(i))return $;let o=Ml(s.value,i.value);return o.valid?((io(s)||io(i))&&t.dirty(),{status:t.value,value:o.data}):(A(r,{code:_.invalid_intersection_types}),$)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,i])=>a(s,i)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};gn.create=(n,e,t)=>new gn({left:n,right:e,typeName:w.ZodIntersection,...U(t)});Dt=class n extends z{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==E.array)return A(r,{code:_.invalid_type,expected:E.array,received:r.parsedType}),$;if(r.data.length<this._def.items.length)return A(r,{code:_.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),$;!this._def.rest&&r.data.length>this._def.items.length&&(A(r,{code:_.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let s=[...r.data].map((i,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new st(r,i,r.path,o)):null}).filter(i=>!!i);return r.common.async?Promise.all(s).then(i=>we.mergeArray(t,i)):we.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new n({...this._def,rest:e})}};Dt.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Dt({items:n,typeName:w.ZodTuple,rest:null,...U(e)})};uo=class n extends z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==E.object)return A(r,{code:_.invalid_type,expected:E.object,received:r.parsedType}),$;let a=[],s=this._def.keyType,i=this._def.valueType;for(let o in r.data)a.push({key:s._parse(new st(r,o,r.path,o)),value:i._parse(new st(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?we.mergeObjectAsync(t,a):we.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof z?new n({keyType:e,valueType:t,typeName:w.ZodRecord,...U(r)}):new n({keyType:Sr.create(),valueType:e,typeName:w.ZodRecord,...U(t)})}},va=class extends z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==E.map)return A(r,{code:_.invalid_type,expected:E.map,received:r.parsedType}),$;let a=this._def.keyType,s=this._def.valueType,i=[...r.data.entries()].map(([o,u],l)=>({key:a._parse(new st(r,o,r.path,[l,"key"])),value:s._parse(new st(r,u,r.path,[l,"value"]))}));if(r.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of i){let l=await u.key,c=await u.value;if(l.status==="aborted"||c.status==="aborted")return $;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(l.value,c.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of i){let l=u.key,c=u.value;if(l.status==="aborted"||c.status==="aborted")return $;(l.status==="dirty"||c.status==="dirty")&&t.dirty(),o.set(l.value,c.value)}return{status:t.value,value:o}}}};va.create=(n,e,t)=>new va({valueType:e,keyType:n,typeName:w.ZodMap,...U(t)});xa=class n extends z{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==E.set)return A(r,{code:_.invalid_type,expected:E.set,received:r.parsedType}),$;let a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(A(r,{code:_.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(A(r,{code:_.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let s=this._def.valueType;function i(u){let l=new Set;for(let c of u){if(c.status==="aborted")return $;c.status==="dirty"&&t.dirty(),l.add(c.value)}return{status:t.value,value:l}}let o=[...r.data.values()].map((u,l)=>s._parse(new st(r,u,r.path,l)));return r.common.async?Promise.all(o).then(u=>i(u)):i(o)}min(e,t){return new n({...this._def,minSize:{value:e,message:C.toString(t)}})}max(e,t){return new n({...this._def,maxSize:{value:e,message:C.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};xa.create=(n,e)=>new xa({valueType:n,minSize:null,maxSize:null,typeName:w.ZodSet,...U(e)});lo=class n extends z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==E.function)return A(t,{code:_.invalid_type,expected:E.function,received:t.parsedType}),$;function r(o,u){return qs({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ga(),rr].filter(l=>!!l),issueData:{code:_.invalid_arguments,argumentsError:u}})}function a(o,u){return qs({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ga(),rr].filter(l=>!!l),issueData:{code:_.invalid_return_type,returnTypeError:u}})}let s={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof kr){let o=this;return Ie(async function(...u){let l=new Ue([]),c=await o._def.args.parseAsync(u,s).catch(f=>{throw l.addIssue(r(u,f)),l}),d=await Reflect.apply(i,this,c);return await o._def.returns._def.type.parseAsync(d,s).catch(f=>{throw l.addIssue(a(d,f)),l})})}else{let o=this;return Ie(function(...u){let l=o._def.args.safeParse(u,s);if(!l.success)throw new Ue([r(u,l.error)]);let c=Reflect.apply(i,this,l.data),d=o._def.returns.safeParse(c,s);if(!d.success)throw new Ue([a(c,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new n({...this._def,args:Dt.create(e).rest(ar.create())})}returns(e){return new n({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new n({args:e||Dt.create([]).rest(ar.create()),returns:t||ar.create(),typeName:w.ZodFunction,...U(r)})}},yn=class extends z{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};yn.create=(n,e)=>new yn({getter:n,typeName:w.ZodLazy,...U(e)});bn=class extends z{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return A(t,{received:t.data,code:_.invalid_literal,expected:this._def.value}),$}return{status:"valid",value:e.data}}get value(){return this._def.value}};bn.create=(n,e)=>new bn({value:n,typeName:w.ZodLiteral,...U(e)});_n=class n extends z{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),r=this._def.values;return A(t,{expected:H.joinValues(r),received:t.parsedType,code:_.invalid_type}),$}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return A(t,{received:t.data,code:_.invalid_enum_value,options:r}),$}return Ie(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return n.create(e,{...this._def,...t})}exclude(e,t=this._def){return n.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}};_n.create=gf;wn=class extends z{_parse(e){let t=H.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==E.string&&r.parsedType!==E.number){let a=H.objectValues(t);return A(r,{expected:H.joinValues(a),received:r.parsedType,code:_.invalid_type}),$}if(this._cache||(this._cache=new Set(H.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let a=H.objectValues(t);return A(r,{received:r.data,code:_.invalid_enum_value,options:a}),$}return Ie(e.data)}get enum(){return this._def.values}};wn.create=(n,e)=>new wn({values:n,typeName:w.ZodNativeEnum,...U(e)});kr=class extends z{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==E.promise&&t.common.async===!1)return A(t,{code:_.invalid_type,expected:E.promise,received:t.parsedType}),$;let r=t.parsedType===E.promise?t.data:Promise.resolve(t.data);return Ie(r.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}};kr.create=(n,e)=>new kr({type:n,typeName:w.ZodPromise,...U(e)});it=class extends z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:i=>{A(r,i),i.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),a.type==="preprocess"){let i=a.transform(r.data,s);if(r.common.async)return Promise.resolve(i).then(async o=>{if(t.value==="aborted")return $;let u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?$:u.status==="dirty"?un(u.value):t.value==="dirty"?un(u.value):u});{if(t.value==="aborted")return $;let o=this._def.schema._parseSync({data:i,path:r.path,parent:r});return o.status==="aborted"?$:o.status==="dirty"?un(o.value):t.value==="dirty"?un(o.value):o}}if(a.type==="refinement"){let i=o=>{let u=a.refinement(o,s);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){let o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?$:(o.status==="dirty"&&t.dirty(),i(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?$:(o.status==="dirty"&&t.dirty(),i(o.value).then(()=>({status:t.value,value:o.value}))))}if(a.type==="transform")if(r.common.async===!1){let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Tr(i))return $;let o=a.transform(i.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>Tr(i)?Promise.resolve(a.transform(i.value,s)).then(o=>({status:t.value,value:o})):$);H.assertNever(a)}};it.create=(n,e,t)=>new it({schema:n,typeName:w.ZodEffects,effect:e,...U(t)});it.createWithPreprocess=(n,e,t)=>new it({schema:e,effect:{type:"preprocess",transform:n},typeName:w.ZodEffects,...U(t)});at=class extends z{_parse(e){return this._getType(e)===E.undefined?Ie(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};at.create=(n,e)=>new at({innerType:n,typeName:w.ZodOptional,...U(e)});Ft=class extends z{_parse(e){return this._getType(e)===E.null?Ie(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ft.create=(n,e)=>new Ft({innerType:n,typeName:w.ZodNullable,...U(e)});vn=class extends z{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===E.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};vn.create=(n,e)=>new vn({innerType:n,typeName:w.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...U(e)});xn=class extends z{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ya(a)?a.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ue(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ue(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};xn.create=(n,e)=>new xn({innerType:n,typeName:w.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...U(e)});Aa=class extends z{_parse(e){if(this._getType(e)!==E.nan){let r=this._getOrReturnCtx(e);return A(r,{code:_.invalid_type,expected:E.nan,received:r.parsedType}),$}return{status:"valid",value:e.data}}};Aa.create=n=>new Aa({typeName:w.ZodNaN,...U(n)});U_=Symbol("zod_brand"),Vs=class extends z{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},Hs=class n extends z{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?$:s.status==="dirty"?(t.dirty(),un(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?$:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(e,t){return new n({in:e,out:t,typeName:w.ZodPipeline})}},An=class extends z{_parse(e){let t=this._def.innerType._parse(e),r=a=>(Tr(a)&&(a.value=Object.freeze(a.value)),a);return ya(t)?t.then(a=>r(a)):r(t)}unwrap(){return this._def.innerType}};An.create=(n,e)=>new An({innerType:n,typeName:w.ZodReadonly,...U(e)});z_={object:ze.lazycreate};(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(w||(w={}));B_=(n,e={message:`Input not instance of ${n.name}`})=>yf(t=>t instanceof n,e),bf=Sr.create,_f=ln.create,q_=Aa.create,V_=cn.create,wf=dn.create,H_=pn.create,K_=_a.create,G_=fn.create,J_=hn.create,W_=Cr.create,Z_=ar.create,X_=wt.create,Y_=wa.create,Q_=sr.create,ew=ze.create,tw=ze.strictCreate,rw=mn.create,nw=oo.create,aw=gn.create,sw=Dt.create,iw=uo.create,ow=va.create,uw=xa.create,lw=lo.create,cw=yn.create,dw=bn.create,pw=_n.create,fw=wn.create,hw=kr.create,mw=it.create,gw=at.create,yw=Ft.create,bw=it.createWithPreprocess,_w=Hs.create,ww=()=>bf().optional(),vw=()=>_f().optional(),xw=()=>wf().optional(),Aw={string:n=>Sr.create({...n,coerce:!0}),number:n=>ln.create({...n,coerce:!0}),boolean:n=>dn.create({...n,coerce:!0}),bigint:n=>cn.create({...n,coerce:!0}),date:n=>pn.create({...n,coerce:!0})},Ew=$});var Be={};ro(Be,{BRAND:()=>U_,DIRTY:()=>un,EMPTY_PATH:()=>b_,INVALID:()=>$,NEVER:()=>Ew,OK:()=>Ie,ParseStatus:()=>we,Schema:()=>z,ZodAny:()=>Cr,ZodArray:()=>sr,ZodBigInt:()=>cn,ZodBoolean:()=>dn,ZodBranded:()=>Vs,ZodCatch:()=>xn,ZodDate:()=>pn,ZodDefault:()=>vn,ZodDiscriminatedUnion:()=>oo,ZodEffects:()=>it,ZodEnum:()=>_n,ZodError:()=>Ue,ZodFirstPartyTypeKind:()=>w,ZodFunction:()=>lo,ZodIntersection:()=>gn,ZodIssueCode:()=>_,ZodLazy:()=>yn,ZodLiteral:()=>bn,ZodMap:()=>va,ZodNaN:()=>Aa,ZodNativeEnum:()=>wn,ZodNever:()=>wt,ZodNull:()=>hn,ZodNullable:()=>Ft,ZodNumber:()=>ln,ZodObject:()=>ze,ZodOptional:()=>at,ZodParsedType:()=>E,ZodPipeline:()=>Hs,ZodPromise:()=>kr,ZodReadonly:()=>An,ZodRecord:()=>uo,ZodSchema:()=>z,ZodSet:()=>xa,ZodString:()=>Sr,ZodSymbol:()=>_a,ZodTransformer:()=>it,ZodTuple:()=>Dt,ZodType:()=>z,ZodUndefined:()=>fn,ZodUnion:()=>mn,ZodUnknown:()=>ar,ZodVoid:()=>wa,addIssueToContext:()=>A,any:()=>W_,array:()=>Q_,bigint:()=>V_,boolean:()=>wf,coerce:()=>Aw,custom:()=>yf,date:()=>H_,datetimeRegex:()=>mf,defaultErrorMap:()=>rr,discriminatedUnion:()=>nw,effect:()=>mw,enum:()=>pw,function:()=>lw,getErrorMap:()=>ga,getParsedType:()=>Lt,instanceof:()=>B_,intersection:()=>aw,isAborted:()=>so,isAsync:()=>ya,isDirty:()=>io,isValid:()=>Tr,late:()=>z_,lazy:()=>cw,literal:()=>dw,makeIssue:()=>qs,map:()=>ow,nan:()=>q_,nativeEnum:()=>fw,never:()=>X_,null:()=>J_,nullable:()=>yw,number:()=>_f,object:()=>ew,objectUtil:()=>Rl,oboolean:()=>xw,onumber:()=>vw,optional:()=>gw,ostring:()=>ww,pipeline:()=>_w,preprocess:()=>bw,promise:()=>hw,quotelessJson:()=>m_,record:()=>iw,set:()=>uw,setErrorMap:()=>y_,strictObject:()=>tw,string:()=>bf,symbol:()=>K_,transformer:()=>mw,tuple:()=>sw,undefined:()=>G_,union:()=>rw,unknown:()=>Z_,util:()=>H,void:()=>Y_});var co=g(()=>{ao();$l();lf();Bs();vf();no()});var po=g(()=>{co();co()});var Af=S((UP,xf)=>{function ot(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}xf.exports=ot;ot.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};ot.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};ot.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};ot.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};ot.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};ot.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};ot.prototype.start=ot.prototype.try;ot.prototype.errors=function(){return this._errors};ot.prototype.attempts=function(){return this._attempts};ot.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var a=this._errors[r],s=a.message,i=(n[s]||0)+1;n[s]=i,i>=t&&(e=a,t=i)}return e}});var Ef=S(En=>{var Ow=Af();En.operation=function(n){var e=En.timeouts(n);return new Ow(e,{forever:n&&(n.forever||n.retries===1/0),unref:n&&n.unref,maxRetryTime:n&&n.maxRetryTime})};En.timeouts=function(n){if(n instanceof Array)return[].concat(n);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in n)e[t]=n[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],a=0;a<e.retries;a++)r.push(this.createTimeout(a,e));return n&&n.forever&&!r.length&&r.push(this.createTimeout(a,e)),r.sort(function(s,i){return s-i}),r};En.createTimeout=function(n,e){var t=e.randomize?Math.random()+1:1,r=Math.round(t*Math.max(e.minTimeout,1)*Math.pow(e.factor,n));return r=Math.min(r,e.maxTimeout),r};En.wrap=function(n,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var r in n)typeof n[r]=="function"&&t.push(r)}for(var a=0;a<t.length;a++){var s=t[a],i=n[s];n[s]=function(u){var l=En.operation(e),c=Array.prototype.slice.call(arguments,1),d=c.pop();c.push(function(p){l.retry(p)||(p&&(arguments[0]=l.mainError()),d.apply(this,arguments))}),l.attempt(function(){u.apply(n,c)})}.bind(n,i),n[s].options=e}}});var If=S((BP,Of)=>{Of.exports=Ef()});var mo=S((qP,ho)=>{"use strict";var Iw=If(),Pw=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],fo=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}},Tw=(n,e,t)=>{let r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},Sw=n=>Pw.includes(n),Pf=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};let a=Iw.operation(e);a.attempt(async s=>{try{t(await n(s))}catch(i){if(!(i instanceof Error)){r(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof fo)a.stop(),r(i.originalError);else if(i instanceof TypeError&&!Sw(i.message))a.stop(),r(i);else{Tw(i,s,e);try{await e.onFailedAttempt(i)}catch(o){r(o);return}a.retry(i)||r(a.mainError())}}})});ho.exports=Pf;ho.exports.default=Pf;ho.exports.AbortError=fo});var Tf,Sf=g(()=>{Tf=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});function Cw(n){return typeof n=="string"&&Tf.test(n)}var Ks,Cf=g(()=>{Sf();Ks=Cw});function kf(n,e=0){return(ve[n[e+0]]+ve[n[e+1]]+ve[n[e+2]]+ve[n[e+3]]+"-"+ve[n[e+4]]+ve[n[e+5]]+"-"+ve[n[e+6]]+ve[n[e+7]]+"-"+ve[n[e+8]]+ve[n[e+9]]+"-"+ve[n[e+10]]+ve[n[e+11]]+ve[n[e+12]]+ve[n[e+13]]+ve[n[e+14]]+ve[n[e+15]]).toLowerCase()}var ve,go,Rf=g(()=>{ve=[];for(go=0;go<256;++go)ve.push((go+256).toString(16).slice(1))});function Ll(){if(!yo&&(yo=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!yo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return yo(kw)}var yo,kw,Nf=g(()=>{kw=new Uint8Array(16)});var Rw,Dl,$f=g(()=>{Rw=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Dl={randomUUID:Rw}});function Nw(n,e,t){if(Dl.randomUUID&&!e&&!n)return Dl.randomUUID();n=n||{};var r=n.random||(n.rng||Ll)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var a=0;a<16;++a)e[t+a]=r[a];return e}return kf(r)}var qe,jf=g(()=>{$f();Nf();Rf();qe=Nw});var Gs=g(()=>{jf();Cf()});var Mf,Lf=g(()=>{Mf=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});function jw(n){return typeof n=="string"&&Mf.test(n)}var Fl,Df=g(()=>{Lf();Fl=jw});function Ff(n,e=0){return(xe[n[e+0]]+xe[n[e+1]]+xe[n[e+2]]+xe[n[e+3]]+"-"+xe[n[e+4]]+xe[n[e+5]]+"-"+xe[n[e+6]]+xe[n[e+7]]+"-"+xe[n[e+8]]+xe[n[e+9]]+"-"+xe[n[e+10]]+xe[n[e+11]]+xe[n[e+12]]+xe[n[e+13]]+xe[n[e+14]]+xe[n[e+15]]).toLowerCase()}var xe,bo,Uf=g(()=>{xe=[];for(bo=0;bo<256;++bo)xe.push((bo+256).toString(16).slice(1))});function Ul(){if(!_o&&(_o=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_o))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _o(Mw)}var _o,Mw,zf=g(()=>{Mw=new Uint8Array(16)});var Lw,zl,Bf=g(()=>{Lw=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),zl={randomUUID:Lw}});function Dw(n,e,t){if(zl.randomUUID&&!e&&!n)return zl.randomUUID();n=n||{};var r=n.random||(n.rng||Ul)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var a=0;a<16;++a)e[t+a]=r[a];return e}return Ff(r)}var On,qf=g(()=>{Bf();zf();Uf();On=Dw});var wo=g(()=>{qf();Df()});var Hf=S((hT,ql)=>{"use strict";var Fw=Object.prototype.hasOwnProperty,$e="~";function Js(){}Object.create&&(Js.prototype=Object.create(null),new Js().__proto__||($e=!1));function Uw(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function Vf(n,e,t,r,a){if(typeof t!="function")throw new TypeError("The listener must be a function");var s=new Uw(t,r||n,a),i=$e?$e+e:e;return n._events[i]?n._events[i].fn?n._events[i]=[n._events[i],s]:n._events[i].push(s):(n._events[i]=s,n._eventsCount++),n}function vo(n,e){--n._eventsCount===0?n._events=new Js:delete n._events[e]}function Pe(){this._events=new Js,this._eventsCount=0}Pe.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)Fw.call(t,r)&&e.push($e?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Pe.prototype.listeners=function(e){var t=$e?$e+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var a=0,s=r.length,i=new Array(s);a<s;a++)i[a]=r[a].fn;return i};Pe.prototype.listenerCount=function(e){var t=$e?$e+e:e,r=this._events[t];return r?r.fn?1:r.length:0};Pe.prototype.emit=function(e,t,r,a,s,i){var o=$e?$e+e:e;if(!this._events[o])return!1;var u=this._events[o],l=arguments.length,c,d;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,a),!0;case 5:return u.fn.call(u.context,t,r,a,s),!0;case 6:return u.fn.call(u.context,t,r,a,s,i),!0}for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u.fn.apply(u.context,c)}else{var p=u.length,f;for(d=0;d<p;d++)switch(u[d].once&&this.removeListener(e,u[d].fn,void 0,!0),l){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,t);break;case 3:u[d].fn.call(u[d].context,t,r);break;case 4:u[d].fn.call(u[d].context,t,r,a);break;default:if(!c)for(f=1,c=new Array(l-1);f<l;f++)c[f-1]=arguments[f];u[d].fn.apply(u[d].context,c)}}return!0};Pe.prototype.on=function(e,t,r){return Vf(this,e,t,r,!1)};Pe.prototype.once=function(e,t,r){return Vf(this,e,t,r,!0)};Pe.prototype.removeListener=function(e,t,r,a){var s=$e?$e+e:e;if(!this._events[s])return this;if(!t)return vo(this,s),this;var i=this._events[s];if(i.fn)i.fn===t&&(!a||i.once)&&(!r||i.context===r)&&vo(this,s);else{for(var o=0,u=[],l=i.length;o<l;o++)(i[o].fn!==t||a&&!i[o].once||r&&i[o].context!==r)&&u.push(i[o]);u.length?this._events[s]=u.length===1?u[0]:u:vo(this,s)}return this};Pe.prototype.removeAllListeners=function(e){var t;return e?(t=$e?$e+e:e,this._events[t]&&vo(this,t)):(this._events=new Js,this._eventsCount=0),this};Pe.prototype.off=Pe.prototype.removeListener;Pe.prototype.addListener=Pe.prototype.on;Pe.prefixed=$e;Pe.EventEmitter=Pe;typeof ql<"u"&&(ql.exports=Pe)});var Gf=S((mT,Kf)=>{"use strict";Kf.exports=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))});var Wf=S((gT,Ao)=>{"use strict";var zw=Gf(),xo=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},Jf=(n,e,t)=>new Promise((r,a)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}let s=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(u){a(u)}return}let i=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new xo(i);typeof n.cancel=="function"&&n.cancel(),a(o)},e);zw(n.then(r,a),()=>{clearTimeout(s)})});Ao.exports=Jf;Ao.exports.default=Jf;Ao.exports.TimeoutError=xo});var Zf=S(Vl=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});function Bw(n,e,t){let r=0,a=n.length;for(;a>0;){let s=a/2|0,i=r+s;t(n[i],e)<=0?(r=++i,a-=s+1):a=s}return r}Vl.default=Bw});var Xf=S(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});var qw=Zf(),Hl=class{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let a=qw.default(this._queue,r,(s,i)=>i.priority-s.priority);this._queue.splice(a,0,r)}dequeue(){let e=this._queue.shift();return e?.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}};Kl.default=Hl});var Oo=S(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});var Vw=Hf(),Yf=Wf(),Hw=Xf(),Eo=()=>{},Kw=new Yf.TimeoutError,Gl=class extends Vw{constructor(e){var t,r,a,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Eo,this._resolveIdle=Eo,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Hw.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(a=e.interval)===null||a===void 0?void 0:a.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Eo,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Eo,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(this._intervalId===void 0){let t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{let s=async()=>{this._pendingCount++,this._intervalCount++;try{let i=this._timeout===void 0&&t.timeout===void 0?e():Yf.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&a(Kw)});r(await i)}catch(i){a(i)}this._next()};this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};Jl.default=Gl});var Gw,Jw,R,Io=g(()=>{Gw=(...n)=>fetch(...n),Jw=Symbol.for("ls:fetch_implementation"),R=()=>globalThis[Jw]??Gw});var Qf,Po,Ww,Zw,Ws,eh=g(()=>{Qf=nt(mo(),1),Po=nt(Oo(),1);Io();Ww=[400,401,403,404,405,406,407,408],Zw=[409],Ws=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Po.default?this.queue=new Po.default.default({concurrency:this.maxConcurrency}):this.queue=new Po.default({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>(0,Qf.default)(()=>e(...t).catch(a=>{throw a instanceof Error?a:new Error(a)}),{async onFailedAttempt(a){if(a.message.startsWith("Cancel")||a.message.startsWith("TimeoutError")||a.message.startsWith("AbortError")||a?.code==="ECONNABORTED")throw a;let s=a?.response,i=s?.status;if(i){if(Ww.includes(+i))throw a;if(Zw.includes(+i))return;r&&await r(s)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>R()(...e).then(t=>t.ok?t:Promise.reject(t)))}}});function Wl(n){return typeof n?._getType=="function"}function Zl(n){let e={type:n._getType(),data:{content:n.content}};return n?.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}var th=g(()=>{});function K(n,e){if(!Fl(n)){let t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}var rh=g(()=>{wo()});function To(n){nh[n]||(console.warn(n),nh[n]=!0)}var nh,Xl=g(()=>{nh={}});var Zs=S((IT,ah)=>{"use strict";var Xw="2.0.0",Yw=Number.MAX_SAFE_INTEGER||9007199254740991,Qw=16,ev=250,tv=["major","premajor","minor","preminor","patch","prepatch","prerelease"];ah.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Qw,MAX_SAFE_BUILD_LENGTH:ev,MAX_SAFE_INTEGER:Yw,RELEASE_TYPES:tv,SEMVER_SPEC_VERSION:Xw,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Xs=S((PT,sh)=>{"use strict";var rv=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};sh.exports=rv});var Ea=S((Ut,ih)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Yl,MAX_SAFE_BUILD_LENGTH:nv,MAX_LENGTH:av}=Zs(),sv=Xs();Ut=ih.exports={};var iv=Ut.re=[],ov=Ut.safeRe=[],O=Ut.src=[],uv=Ut.safeSrc=[],I=Ut.t={},lv=0,Ql="[a-zA-Z0-9-]",cv=[["\\s",1],["\\d",av],[Ql,nv]],dv=n=>{for(let[e,t]of cv)n=n.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return n},F=(n,e,t)=>{let r=dv(e),a=lv++;sv(n,a,e),I[n]=a,O[a]=e,uv[a]=r,iv[a]=new RegExp(e,t?"g":void 0),ov[a]=new RegExp(r,t?"g":void 0)};F("NUMERICIDENTIFIER","0|[1-9]\\d*");F("NUMERICIDENTIFIERLOOSE","\\d+");F("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Ql}*`);F("MAINVERSION",`(${O[I.NUMERICIDENTIFIER]})\\.(${O[I.NUMERICIDENTIFIER]})\\.(${O[I.NUMERICIDENTIFIER]})`);F("MAINVERSIONLOOSE",`(${O[I.NUMERICIDENTIFIERLOOSE]})\\.(${O[I.NUMERICIDENTIFIERLOOSE]})\\.(${O[I.NUMERICIDENTIFIERLOOSE]})`);F("PRERELEASEIDENTIFIER",`(?:${O[I.NONNUMERICIDENTIFIER]}|${O[I.NUMERICIDENTIFIER]})`);F("PRERELEASEIDENTIFIERLOOSE",`(?:${O[I.NONNUMERICIDENTIFIER]}|${O[I.NUMERICIDENTIFIERLOOSE]})`);F("PRERELEASE",`(?:-(${O[I.PRERELEASEIDENTIFIER]}(?:\\.${O[I.PRERELEASEIDENTIFIER]})*))`);F("PRERELEASELOOSE",`(?:-?(${O[I.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${O[I.PRERELEASEIDENTIFIERLOOSE]})*))`);F("BUILDIDENTIFIER",`${Ql}+`);F("BUILD",`(?:\\+(${O[I.BUILDIDENTIFIER]}(?:\\.${O[I.BUILDIDENTIFIER]})*))`);F("FULLPLAIN",`v?${O[I.MAINVERSION]}${O[I.PRERELEASE]}?${O[I.BUILD]}?`);F("FULL",`^${O[I.FULLPLAIN]}$`);F("LOOSEPLAIN",`[v=\\s]*${O[I.MAINVERSIONLOOSE]}${O[I.PRERELEASELOOSE]}?${O[I.BUILD]}?`);F("LOOSE",`^${O[I.LOOSEPLAIN]}$`);F("GTLT","((?:<|>)?=?)");F("XRANGEIDENTIFIERLOOSE",`${O[I.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);F("XRANGEIDENTIFIER",`${O[I.NUMERICIDENTIFIER]}|x|X|\\*`);F("XRANGEPLAIN",`[v=\\s]*(${O[I.XRANGEIDENTIFIER]})(?:\\.(${O[I.XRANGEIDENTIFIER]})(?:\\.(${O[I.XRANGEIDENTIFIER]})(?:${O[I.PRERELEASE]})?${O[I.BUILD]}?)?)?`);F("XRANGEPLAINLOOSE",`[v=\\s]*(${O[I.XRANGEIDENTIFIERLOOSE]})(?:\\.(${O[I.XRANGEIDENTIFIERLOOSE]})(?:\\.(${O[I.XRANGEIDENTIFIERLOOSE]})(?:${O[I.PRERELEASELOOSE]})?${O[I.BUILD]}?)?)?`);F("XRANGE",`^${O[I.GTLT]}\\s*${O[I.XRANGEPLAIN]}$`);F("XRANGELOOSE",`^${O[I.GTLT]}\\s*${O[I.XRANGEPLAINLOOSE]}$`);F("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Yl}})(?:\\.(\\d{1,${Yl}}))?(?:\\.(\\d{1,${Yl}}))?`);F("COERCE",`${O[I.COERCEPLAIN]}(?:$|[^\\d])`);F("COERCEFULL",O[I.COERCEPLAIN]+`(?:${O[I.PRERELEASE]})?(?:${O[I.BUILD]})?(?:$|[^\\d])`);F("COERCERTL",O[I.COERCE],!0);F("COERCERTLFULL",O[I.COERCEFULL],!0);F("LONETILDE","(?:~>?)");F("TILDETRIM",`(\\s*)${O[I.LONETILDE]}\\s+`,!0);Ut.tildeTrimReplace="$1~";F("TILDE",`^${O[I.LONETILDE]}${O[I.XRANGEPLAIN]}$`);F("TILDELOOSE",`^${O[I.LONETILDE]}${O[I.XRANGEPLAINLOOSE]}$`);F("LONECARET","(?:\\^)");F("CARETTRIM",`(\\s*)${O[I.LONECARET]}\\s+`,!0);Ut.caretTrimReplace="$1^";F("CARET",`^${O[I.LONECARET]}${O[I.XRANGEPLAIN]}$`);F("CARETLOOSE",`^${O[I.LONECARET]}${O[I.XRANGEPLAINLOOSE]}$`);F("COMPARATORLOOSE",`^${O[I.GTLT]}\\s*(${O[I.LOOSEPLAIN]})$|^$`);F("COMPARATOR",`^${O[I.GTLT]}\\s*(${O[I.FULLPLAIN]})$|^$`);F("COMPARATORTRIM",`(\\s*)${O[I.GTLT]}\\s*(${O[I.LOOSEPLAIN]}|${O[I.XRANGEPLAIN]})`,!0);Ut.comparatorTrimReplace="$1$2$3";F("HYPHENRANGE",`^\\s*(${O[I.XRANGEPLAIN]})\\s+-\\s+(${O[I.XRANGEPLAIN]})\\s*$`);F("HYPHENRANGELOOSE",`^\\s*(${O[I.XRANGEPLAINLOOSE]})\\s+-\\s+(${O[I.XRANGEPLAINLOOSE]})\\s*$`);F("STAR","(<|>)?=?\\s*\\*");F("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");F("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var So=S((TT,oh)=>{"use strict";var pv=Object.freeze({loose:!0}),fv=Object.freeze({}),hv=n=>n?typeof n!="object"?pv:n:fv;oh.exports=hv});var ec=S((ST,ch)=>{"use strict";var uh=/^[0-9]+$/,lh=(n,e)=>{if(typeof n=="number"&&typeof e=="number")return n===e?0:n<e?-1:1;let t=uh.test(n),r=uh.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},mv=(n,e)=>lh(e,n);ch.exports={compareIdentifiers:lh,rcompareIdentifiers:mv}});var Te=S((CT,ph)=>{"use strict";var Co=Xs(),{MAX_LENGTH:dh,MAX_SAFE_INTEGER:ko}=Zs(),{safeRe:Ro,t:No}=Ea(),gv=So(),{compareIdentifiers:tc}=ec(),rc=class n{constructor(e,t){if(t=gv(t),e instanceof n){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>dh)throw new TypeError(`version is longer than ${dh} characters`);Co("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let r=e.trim().match(t.loose?Ro[No.LOOSE]:Ro[No.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>ko||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ko||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ko||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(a=>{if(/^[0-9]+$/.test(a)){let s=+a;if(s>=0&&s<ko)return s}return a}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Co("SemVer.compare",this.version,this.options,e),!(e instanceof n)){if(typeof e=="string"&&e===this.version)return 0;e=new n(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof n||(e=new n(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof n||(e=new n(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let r=this.prerelease[t],a=e.prerelease[t];if(Co("prerelease compare",t,r,a),r===void 0&&a===void 0)return 0;if(a===void 0)return 1;if(r===void 0)return-1;if(r===a)continue;return tc(r,a)}while(++t)}compareBuild(e){e instanceof n||(e=new n(e,this.options));let t=0;do{let r=this.build[t],a=e.build[t];if(Co("build compare",t,r,a),r===void 0&&a===void 0)return 0;if(a===void 0)return 1;if(r===void 0)return-1;if(r===a)continue;return tc(r,a)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let a=`-${t}`.match(this.options.loose?Ro[No.PRERELEASELOOSE]:Ro[No.PRERELEASE]);if(!a||a[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let a=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[a];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(a)}}if(t){let s=[t,a];r===!1&&(s=[t]),tc(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};ph.exports=rc});var In=S((kT,hh)=>{"use strict";var fh=Te(),yv=(n,e,t=!1)=>{if(n instanceof fh)return n;try{return new fh(n,e)}catch(r){if(!t)return null;throw r}};hh.exports=yv});var gh=S((RT,mh)=>{"use strict";var bv=In(),_v=(n,e)=>{let t=bv(n,e);return t?t.version:null};mh.exports=_v});var bh=S((NT,yh)=>{"use strict";var wv=In(),vv=(n,e)=>{let t=wv(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null};yh.exports=vv});var vh=S(($T,wh)=>{"use strict";var _h=Te(),xv=(n,e,t,r,a)=>{typeof t=="string"&&(a=r,r=t,t=void 0);try{return new _h(n instanceof _h?n.version:n,t).inc(e,r,a).version}catch{return null}};wh.exports=xv});var Eh=S((jT,Ah)=>{"use strict";var xh=In(),Av=(n,e)=>{let t=xh(n,null,!0),r=xh(e,null,!0),a=t.compare(r);if(a===0)return null;let s=a>0,i=s?t:r,o=s?r:t,u=!!i.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(i)===0)return o.minor&&!o.patch?"minor":"patch"}let c=u?"pre":"";return t.major!==r.major?c+"major":t.minor!==r.minor?c+"minor":t.patch!==r.patch?c+"patch":"prerelease"};Ah.exports=Av});var Ih=S((MT,Oh)=>{"use strict";var Ev=Te(),Ov=(n,e)=>new Ev(n,e).major;Oh.exports=Ov});var Th=S((LT,Ph)=>{"use strict";var Iv=Te(),Pv=(n,e)=>new Iv(n,e).minor;Ph.exports=Pv});var Ch=S((DT,Sh)=>{"use strict";var Tv=Te(),Sv=(n,e)=>new Tv(n,e).patch;Sh.exports=Sv});var Rh=S((FT,kh)=>{"use strict";var Cv=In(),kv=(n,e)=>{let t=Cv(n,e);return t&&t.prerelease.length?t.prerelease:null};kh.exports=kv});var ut=S((UT,$h)=>{"use strict";var Nh=Te(),Rv=(n,e,t)=>new Nh(n,t).compare(new Nh(e,t));$h.exports=Rv});var Mh=S((zT,jh)=>{"use strict";var Nv=ut(),$v=(n,e,t)=>Nv(e,n,t);jh.exports=$v});var Dh=S((BT,Lh)=>{"use strict";var jv=ut(),Mv=(n,e)=>jv(n,e,!0);Lh.exports=Mv});var $o=S((qT,Uh)=>{"use strict";var Fh=Te(),Lv=(n,e,t)=>{let r=new Fh(n,t),a=new Fh(e,t);return r.compare(a)||r.compareBuild(a)};Uh.exports=Lv});var Bh=S((VT,zh)=>{"use strict";var Dv=$o(),Fv=(n,e)=>n.sort((t,r)=>Dv(t,r,e));zh.exports=Fv});var Vh=S((HT,qh)=>{"use strict";var Uv=$o(),zv=(n,e)=>n.sort((t,r)=>Uv(r,t,e));qh.exports=zv});var Ys=S((KT,Hh)=>{"use strict";var Bv=ut(),qv=(n,e,t)=>Bv(n,e,t)>0;Hh.exports=qv});var jo=S((GT,Kh)=>{"use strict";var Vv=ut(),Hv=(n,e,t)=>Vv(n,e,t)<0;Kh.exports=Hv});var nc=S((JT,Gh)=>{"use strict";var Kv=ut(),Gv=(n,e,t)=>Kv(n,e,t)===0;Gh.exports=Gv});var ac=S((WT,Jh)=>{"use strict";var Jv=ut(),Wv=(n,e,t)=>Jv(n,e,t)!==0;Jh.exports=Wv});var Mo=S((ZT,Wh)=>{"use strict";var Zv=ut(),Xv=(n,e,t)=>Zv(n,e,t)>=0;Wh.exports=Xv});var Lo=S((XT,Zh)=>{"use strict";var Yv=ut(),Qv=(n,e,t)=>Yv(n,e,t)<=0;Zh.exports=Qv});var sc=S((YT,Xh)=>{"use strict";var ex=nc(),tx=ac(),rx=Ys(),nx=Mo(),ax=jo(),sx=Lo(),ix=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return ex(n,t,r);case"!=":return tx(n,t,r);case">":return rx(n,t,r);case">=":return nx(n,t,r);case"<":return ax(n,t,r);case"<=":return sx(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};Xh.exports=ix});var Qh=S((QT,Yh)=>{"use strict";var ox=Te(),ux=In(),{safeRe:Do,t:Fo}=Ea(),lx=(n,e)=>{if(n instanceof ox)return n;if(typeof n=="number"&&(n=String(n)),typeof n!="string")return null;e=e||{};let t=null;if(!e.rtl)t=n.match(e.includePrerelease?Do[Fo.COERCEFULL]:Do[Fo.COERCE]);else{let u=e.includePrerelease?Do[Fo.COERCERTLFULL]:Do[Fo.COERCERTL],l;for(;(l=u.exec(n))&&(!t||t.index+t[0].length!==n.length);)(!t||l.index+l[0].length!==t.index+t[0].length)&&(t=l),u.lastIndex=l.index+l[1].length+l[2].length;u.lastIndex=-1}if(t===null)return null;let r=t[2],a=t[3]||"0",s=t[4]||"0",i=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return ux(`${r}.${a}.${s}${i}${o}`,e)};Yh.exports=lx});var tm=S((eS,em)=>{"use strict";var ic=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let a=this.map.keys().next().value;this.delete(a)}this.map.set(e,t)}return this}};em.exports=ic});var lt=S((tS,sm)=>{"use strict";var cx=/\s+/g,oc=class n{constructor(e,t){if(t=px(t),e instanceof n)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new n(e.raw,t);if(e instanceof uc)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(cx," "),this.set=this.raw.split("||").map(r=>this.parseRange(r.trim())).filter(r=>r.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let r=this.set[0];if(this.set=this.set.filter(a=>!nm(a[0])),this.set.length===0)this.set=[r];else if(this.set.length>1){for(let a of this.set)if(a.length===1&&_x(a[0])){this.set=[a];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let r=0;r<t.length;r++)r>0&&(this.formatted+=" "),this.formatted+=t[r].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let r=((this.options.includePrerelease&&yx)|(this.options.loose&&bx))+":"+e,a=rm.get(r);if(a)return a;let s=this.options.loose,i=s?je[Se.HYPHENRANGELOOSE]:je[Se.HYPHENRANGE];e=e.replace(i,Sx(this.options.includePrerelease)),ee("hyphen replace",e),e=e.replace(je[Se.COMPARATORTRIM],hx),ee("comparator trim",e),e=e.replace(je[Se.TILDETRIM],mx),ee("tilde trim",e),e=e.replace(je[Se.CARETTRIM],gx),ee("caret trim",e);let o=e.split(" ").map(d=>wx(d,this.options)).join(" ").split(/\s+/).map(d=>Tx(d,this.options));s&&(o=o.filter(d=>(ee("loose invalid filter",d,this.options),!!d.match(je[Se.COMPARATORLOOSE])))),ee("range list",o);let u=new Map,l=o.map(d=>new uc(d,this.options));for(let d of l){if(nm(d))return[d];u.set(d.value,d)}u.size>1&&u.has("")&&u.delete("");let c=[...u.values()];return rm.set(r,c),c}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Range is required");return this.set.some(r=>am(r,t)&&e.set.some(a=>am(a,t)&&r.every(s=>a.every(i=>s.intersects(i,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new fx(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(Cx(this.set[t],e,this.options))return!0;return!1}};sm.exports=oc;var dx=tm(),rm=new dx,px=So(),uc=Qs(),ee=Xs(),fx=Te(),{safeRe:je,t:Se,comparatorTrimReplace:hx,tildeTrimReplace:mx,caretTrimReplace:gx}=Ea(),{FLAG_INCLUDE_PRERELEASE:yx,FLAG_LOOSE:bx}=Zs(),nm=n=>n.value==="<0.0.0-0",_x=n=>n.value==="",am=(n,e)=>{let t=!0,r=n.slice(),a=r.pop();for(;t&&r.length;)t=r.every(s=>a.intersects(s,e)),a=r.pop();return t},wx=(n,e)=>(n=n.replace(je[Se.BUILD],""),ee("comp",n,e),n=Ax(n,e),ee("caret",n),n=vx(n,e),ee("tildes",n),n=Ox(n,e),ee("xrange",n),n=Px(n,e),ee("stars",n),n),Me=n=>!n||n.toLowerCase()==="x"||n==="*",vx=(n,e)=>n.trim().split(/\s+/).map(t=>xx(t,e)).join(" "),xx=(n,e)=>{let t=e.loose?je[Se.TILDELOOSE]:je[Se.TILDE];return n.replace(t,(r,a,s,i,o)=>{ee("tilde",n,r,a,s,i,o);let u;return Me(a)?u="":Me(s)?u=`>=${a}.0.0 <${+a+1}.0.0-0`:Me(i)?u=`>=${a}.${s}.0 <${a}.${+s+1}.0-0`:o?(ee("replaceTilde pr",o),u=`>=${a}.${s}.${i}-${o} <${a}.${+s+1}.0-0`):u=`>=${a}.${s}.${i} <${a}.${+s+1}.0-0`,ee("tilde return",u),u})},Ax=(n,e)=>n.trim().split(/\s+/).map(t=>Ex(t,e)).join(" "),Ex=(n,e)=>{ee("caret",n,e);let t=e.loose?je[Se.CARETLOOSE]:je[Se.CARET],r=e.includePrerelease?"-0":"";return n.replace(t,(a,s,i,o,u)=>{ee("caret",n,a,s,i,o,u);let l;return Me(s)?l="":Me(i)?l=`>=${s}.0.0${r} <${+s+1}.0.0-0`:Me(o)?s==="0"?l=`>=${s}.${i}.0${r} <${s}.${+i+1}.0-0`:l=`>=${s}.${i}.0${r} <${+s+1}.0.0-0`:u?(ee("replaceCaret pr",u),s==="0"?i==="0"?l=`>=${s}.${i}.${o}-${u} <${s}.${i}.${+o+1}-0`:l=`>=${s}.${i}.${o}-${u} <${s}.${+i+1}.0-0`:l=`>=${s}.${i}.${o}-${u} <${+s+1}.0.0-0`):(ee("no pr"),s==="0"?i==="0"?l=`>=${s}.${i}.${o}${r} <${s}.${i}.${+o+1}-0`:l=`>=${s}.${i}.${o}${r} <${s}.${+i+1}.0-0`:l=`>=${s}.${i}.${o} <${+s+1}.0.0-0`),ee("caret return",l),l})},Ox=(n,e)=>(ee("replaceXRanges",n,e),n.split(/\s+/).map(t=>Ix(t,e)).join(" ")),Ix=(n,e)=>{n=n.trim();let t=e.loose?je[Se.XRANGELOOSE]:je[Se.XRANGE];return n.replace(t,(r,a,s,i,o,u)=>{ee("xRange",n,r,a,s,i,o,u);let l=Me(s),c=l||Me(i),d=c||Me(o),p=d;return a==="="&&p&&(a=""),u=e.includePrerelease?"-0":"",l?a===">"||a==="<"?r="<0.0.0-0":r="*":a&&p?(c&&(i=0),o=0,a===">"?(a=">=",c?(s=+s+1,i=0,o=0):(i=+i+1,o=0)):a==="<="&&(a="<",c?s=+s+1:i=+i+1),a==="<"&&(u="-0"),r=`${a+s}.${i}.${o}${u}`):c?r=`>=${s}.0.0${u} <${+s+1}.0.0-0`:d&&(r=`>=${s}.${i}.0${u} <${s}.${+i+1}.0-0`),ee("xRange return",r),r})},Px=(n,e)=>(ee("replaceStars",n,e),n.trim().replace(je[Se.STAR],"")),Tx=(n,e)=>(ee("replaceGTE0",n,e),n.trim().replace(je[e.includePrerelease?Se.GTE0PRE:Se.GTE0],"")),Sx=n=>(e,t,r,a,s,i,o,u,l,c,d,p)=>(Me(r)?t="":Me(a)?t=`>=${r}.0.0${n?"-0":""}`:Me(s)?t=`>=${r}.${a}.0${n?"-0":""}`:i?t=`>=${t}`:t=`>=${t}${n?"-0":""}`,Me(l)?u="":Me(c)?u=`<${+l+1}.0.0-0`:Me(d)?u=`<${l}.${+c+1}.0-0`:p?u=`<=${l}.${c}.${d}-${p}`:n?u=`<${l}.${c}.${+d+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),Cx=(n,e,t)=>{for(let r=0;r<n.length;r++)if(!n[r].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let r=0;r<n.length;r++)if(ee(n[r].semver),n[r].semver!==uc.ANY&&n[r].semver.prerelease.length>0){let a=n[r].semver;if(a.major===e.major&&a.minor===e.minor&&a.patch===e.patch)return!0}return!1}return!0}});var Qs=S((rS,dm)=>{"use strict";var ei=Symbol("SemVer ANY"),dc=class n{static get ANY(){return ei}constructor(e,t){if(t=im(t),e instanceof n){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),cc("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ei?this.value="":this.value=this.operator+this.semver.version,cc("comp",this)}parse(e){let t=this.options.loose?om[um.COMPARATORLOOSE]:om[um.COMPARATOR],r=e.match(t);if(!r)throw new TypeError(`Invalid comparator: ${e}`);this.operator=r[1]!==void 0?r[1]:"",this.operator==="="&&(this.operator=""),r[2]?this.semver=new lm(r[2],this.options.loose):this.semver=ei}toString(){return this.value}test(e){if(cc("Comparator.test",e,this.options.loose),this.semver===ei||e===ei)return!0;if(typeof e=="string")try{e=new lm(e,this.options)}catch{return!1}return lc(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof n))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new cm(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new cm(this.value,t).test(e.semver):(t=im(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||lc(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||lc(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};dm.exports=dc;var im=So(),{safeRe:om,t:um}=Ea(),lc=sc(),cc=Xs(),lm=Te(),cm=lt()});var ti=S((nS,pm)=>{"use strict";var kx=lt(),Rx=(n,e,t)=>{try{e=new kx(e,t)}catch{return!1}return e.test(n)};pm.exports=Rx});var hm=S((aS,fm)=>{"use strict";var Nx=lt(),$x=(n,e)=>new Nx(n,e).set.map(t=>t.map(r=>r.value).join(" ").trim().split(" "));fm.exports=$x});var gm=S((sS,mm)=>{"use strict";var jx=Te(),Mx=lt(),Lx=(n,e,t)=>{let r=null,a=null,s=null;try{s=new Mx(e,t)}catch{return null}return n.forEach(i=>{s.test(i)&&(!r||a.compare(i)===-1)&&(r=i,a=new jx(r,t))}),r};mm.exports=Lx});var bm=S((iS,ym)=>{"use strict";var Dx=Te(),Fx=lt(),Ux=(n,e,t)=>{let r=null,a=null,s=null;try{s=new Fx(e,t)}catch{return null}return n.forEach(i=>{s.test(i)&&(!r||a.compare(i)===1)&&(r=i,a=new Dx(r,t))}),r};ym.exports=Ux});var vm=S((oS,wm)=>{"use strict";var pc=Te(),zx=lt(),_m=Ys(),Bx=(n,e)=>{n=new zx(n,e);let t=new pc("0.0.0");if(n.test(t)||(t=new pc("0.0.0-0"),n.test(t)))return t;t=null;for(let r=0;r<n.set.length;++r){let a=n.set[r],s=null;a.forEach(i=>{let o=new pc(i.semver.version);switch(i.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!s||_m(o,s))&&(s=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${i.operator}`)}}),s&&(!t||_m(t,s))&&(t=s)}return t&&n.test(t)?t:null};wm.exports=Bx});var Am=S((uS,xm)=>{"use strict";var qx=lt(),Vx=(n,e)=>{try{return new qx(n,e).range||"*"}catch{return null}};xm.exports=Vx});var Uo=S((lS,Pm)=>{"use strict";var Hx=Te(),Im=Qs(),{ANY:Kx}=Im,Gx=lt(),Jx=ti(),Em=Ys(),Om=jo(),Wx=Lo(),Zx=Mo(),Xx=(n,e,t,r)=>{n=new Hx(n,r),e=new Gx(e,r);let a,s,i,o,u;switch(t){case">":a=Em,s=Wx,i=Om,o=">",u=">=";break;case"<":a=Om,s=Zx,i=Em,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Jx(n,e,r))return!1;for(let l=0;l<e.set.length;++l){let c=e.set[l],d=null,p=null;if(c.forEach(f=>{f.semver===Kx&&(f=new Im(">=0.0.0")),d=d||f,p=p||f,a(f.semver,d.semver,r)?d=f:i(f.semver,p.semver,r)&&(p=f)}),d.operator===o||d.operator===u||(!p.operator||p.operator===o)&&s(n,p.semver))return!1;if(p.operator===u&&i(n,p.semver))return!1}return!0};Pm.exports=Xx});var Sm=S((cS,Tm)=>{"use strict";var Yx=Uo(),Qx=(n,e,t)=>Yx(n,e,">",t);Tm.exports=Qx});var km=S((dS,Cm)=>{"use strict";var e0=Uo(),t0=(n,e,t)=>e0(n,e,"<",t);Cm.exports=t0});var $m=S((pS,Nm)=>{"use strict";var Rm=lt(),r0=(n,e,t)=>(n=new Rm(n,t),e=new Rm(e,t),n.intersects(e,t));Nm.exports=r0});var Mm=S((fS,jm)=>{"use strict";var n0=ti(),a0=ut();jm.exports=(n,e,t)=>{let r=[],a=null,s=null,i=n.sort((c,d)=>a0(c,d,t));for(let c of i)n0(c,e,t)?(s=c,a||(a=c)):(s&&r.push([a,s]),s=null,a=null);a&&r.push([a,null]);let o=[];for(let[c,d]of r)c===d?o.push(c):!d&&c===i[0]?o.push("*"):d?c===i[0]?o.push(`<=${d}`):o.push(`${c} - ${d}`):o.push(`>=${c}`);let u=o.join(" || "),l=typeof e.raw=="string"?e.raw:String(e);return u.length<l.length?u:e}});var Bm=S((hS,zm)=>{"use strict";var Lm=lt(),hc=Qs(),{ANY:fc}=hc,ri=ti(),mc=ut(),s0=(n,e,t={})=>{if(n===e)return!0;n=new Lm(n,t),e=new Lm(e,t);let r=!1;e:for(let a of n.set){for(let s of e.set){let i=o0(a,s,t);if(r=r||i!==null,i)continue e}if(r)return!1}return!0},i0=[new hc(">=0.0.0-0")],Dm=[new hc(">=0.0.0")],o0=(n,e,t)=>{if(n===e)return!0;if(n.length===1&&n[0].semver===fc){if(e.length===1&&e[0].semver===fc)return!0;t.includePrerelease?n=i0:n=Dm}if(e.length===1&&e[0].semver===fc){if(t.includePrerelease)return!0;e=Dm}let r=new Set,a,s;for(let f of n)f.operator===">"||f.operator===">="?a=Fm(a,f,t):f.operator==="<"||f.operator==="<="?s=Um(s,f,t):r.add(f.semver);if(r.size>1)return null;let i;if(a&&s){if(i=mc(a.semver,s.semver,t),i>0)return null;if(i===0&&(a.operator!==">="||s.operator!=="<="))return null}for(let f of r){if(a&&!ri(f,String(a),t)||s&&!ri(f,String(s),t))return null;for(let h of e)if(!ri(f,String(h),t))return!1;return!0}let o,u,l,c,d=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1,p=a&&!t.includePrerelease&&a.semver.prerelease.length?a.semver:!1;d&&d.prerelease.length===1&&s.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let f of e){if(c=c||f.operator===">"||f.operator===">=",l=l||f.operator==="<"||f.operator==="<=",a){if(p&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===p.major&&f.semver.minor===p.minor&&f.semver.patch===p.patch&&(p=!1),f.operator===">"||f.operator===">="){if(o=Fm(a,f,t),o===f&&o!==a)return!1}else if(a.operator===">="&&!ri(a.semver,String(f),t))return!1}if(s){if(d&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===d.major&&f.semver.minor===d.minor&&f.semver.patch===d.patch&&(d=!1),f.operator==="<"||f.operator==="<="){if(u=Um(s,f,t),u===f&&u!==s)return!1}else if(s.operator==="<="&&!ri(s.semver,String(f),t))return!1}if(!f.operator&&(s||a)&&i!==0)return!1}return!(a&&l&&!s&&i!==0||s&&c&&!a&&i!==0||p||d)},Fm=(n,e,t)=>{if(!n)return e;let r=mc(n.semver,e.semver,t);return r>0?n:r<0||e.operator===">"&&n.operator===">="?e:n},Um=(n,e,t)=>{if(!n)return e;let r=mc(n.semver,e.semver,t);return r<0?n:r>0||e.operator==="<"&&n.operator==="<="?e:n};zm.exports=s0});var Km=S((mS,Hm)=>{"use strict";var gc=Ea(),qm=Zs(),u0=Te(),Vm=ec(),l0=In(),c0=gh(),d0=bh(),p0=vh(),f0=Eh(),h0=Ih(),m0=Th(),g0=Ch(),y0=Rh(),b0=ut(),_0=Mh(),w0=Dh(),v0=$o(),x0=Bh(),A0=Vh(),E0=Ys(),O0=jo(),I0=nc(),P0=ac(),T0=Mo(),S0=Lo(),C0=sc(),k0=Qh(),R0=Qs(),N0=lt(),$0=ti(),j0=hm(),M0=gm(),L0=bm(),D0=vm(),F0=Am(),U0=Uo(),z0=Sm(),B0=km(),q0=$m(),V0=Mm(),H0=Bm();Hm.exports={parse:l0,valid:c0,clean:d0,inc:p0,diff:f0,major:h0,minor:m0,patch:g0,prerelease:y0,compare:b0,rcompare:_0,compareLoose:w0,compareBuild:v0,sort:x0,rsort:A0,gt:E0,lt:O0,eq:I0,neq:P0,gte:T0,lte:S0,cmp:C0,coerce:k0,Comparator:R0,Range:N0,satisfies:$0,toComparators:j0,maxSatisfying:M0,minSatisfying:L0,minVersion:D0,validRange:F0,outside:U0,gtr:z0,ltr:B0,intersects:q0,simplifyRange:V0,subset:H0,SemVer:u0,re:gc.re,src:gc.src,tokens:gc.t,SEMVER_SPEC_VERSION:qm.SEMVER_SPEC_VERSION,RELEASE_TYPES:qm.RELEASE_TYPES,compareIdentifiers:Vm.compareIdentifiers,rcompareIdentifiers:Vm.rcompareIdentifiers}});function Gm(n,e){let t=(0,yc.parse)(n),r=(0,yc.parse)(e);if(!t||!r)throw new Error("Invalid version format.");return t.compare(r)>=0}function ir(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);let[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){let[a,s]=e.split("/",2);if(!a||!s)throw new Error(`Invalid identifier format: ${n}`);return[a,s,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}var yc,Jm=g(()=>{yc=nt(Km(),1)});async function q(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();let a=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new bc(a):new Error(a)}var bc,Wm=g(()=>{bc=class extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}});function G0(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Pn(n,e,t,r){try{return JSON.stringify(n,e,t)}catch(i){if(!i.message?.includes("Converting circular structure to JSON"))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=G0()),wc(n,"",0,[],void 0,0,r);var a;try{Oa.length===0?a=JSON.stringify(n,e,t):a=JSON.stringify(n,J0(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;zo.length!==0;){var s=zo.pop();s.length===4?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return a}}function _c(n,e,t,r){var a=Object.getOwnPropertyDescriptor(r,t);a.get!==void 0?a.configurable?(Object.defineProperty(r,t,{value:n}),zo.push([r,t,e,a])):Oa.push([e,t,n]):(r[t]=n,zo.push([r,t,e]))}function wc(n,e,t,r,a,s,i){s+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){_c(K0,n,e,a);return}if(typeof i.depthLimit<"u"&&s>i.depthLimit){_c(Zm,n,e,a);return}if(typeof i.edgesLimit<"u"&&t+1>i.edgesLimit){_c(Zm,n,e,a);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)wc(n[o],o,o,r,n,s,i);else{var u=Object.keys(n);for(o=0;o<u.length;o++){var l=u[o];wc(n[l],l,o,r,n,s,i)}}r.pop()}}function J0(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Oa.length>0)for(var r=0;r<Oa.length;r++){var a=Oa[r];if(a[1]===e&&a[0]===t){t=a[2],Oa.splice(r,1);break}}return n.call(this,e,t)}}var Zm,K0,zo,Oa,Xm=g(()=>{Zm="[...]",K0={result:"[Circular]"},zo=[],Oa=[]});function Ym(n){let e=Vo(),t=Qm(),r=n.extra??{},a=r.metadata;return n.extra={...r,runtime:{...e,...r?.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...a}},n}async function X0(n){let e=[];for await(let t of n)e.push(t);return e}function vc(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}var W0,Z0,Y0,xc,Q0,eA,Tn,Ac=g(()=>{wo();eh();th();Ho();qo();rh();Xl();Jm();Wm();Io();Xm();W0=()=>{let n=or("TRACING_SAMPLING_RATE");if(n===void 0)return;let e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},Z0=n=>{let t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};Y0=async n=>{if(n?.status===429){let e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1},xc=class{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t,r=new Promise(s=>{t=s}),a=Pn(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:a}),this.sizeBytes+=a,r}pop(e){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");let t=[],r=0;for(;r+(this.peek()?.size??0)<e&&this.items.length>0;){let a=this.items.shift();a&&(t.push(a),r+=a.size,this.sizeBytes-=a.size)}if(t.length===0&&this.items.length>0){let a=this.items.shift();t.push(a),r+=a.size,this.sizeBytes-=a.size}return[t.map(a=>({action:a.action,item:a.payload})),()=>t.forEach(a=>a.itemPromiseResolve())]}},Q0=20971520,eA=1e3,Tn=class n{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new xc}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=n.getDefaultClientConfig();this.tracingSampleRate=W0(),this.apiUrl=vc(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=vc(e.apiKey??t.apiKey),this.webUrl=vc(e.webUrl??t.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??12e3,this.caller=new Ws(e.callerOptions??{}),this.batchIngestCaller=new Ws({...e.callerOptions??{},onFailedResponseHook:Y0}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){let e=or("API_KEY"),t=or("ENDPOINT")??"https://api.smith.langchain.com",r=or("HIDE_INPUTS")==="true",a=or("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:Z0(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){let e={"User-Agent":`langsmith-js/${Bo}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`,s=await this.caller.call(R(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(s,`Failed to fetch ${e}`),s}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let a=Number(t.get("offset"))||0,s=Number(t.get("limit"))||100;for(;;){t.set("offset",String(a)),t.set("limit",String(s));let i=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(R(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(o,`Failed to fetch ${e}`);let u=r?r(await o.json()):await o.json();if(u.length===0||(yield u,u.length<s))break;a+=u.length}}async*_getCursorPaginatedList(e,t=null,r="POST",a="runs"){let s=t?{...t}:{};for(;;){let o=await(await this.caller.call(R(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(s)})).json();if(!o||!o[a])break;yield o[a];let u=o.cursors;if(!u||!u.next)break;s.cursor=u.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){let r=[];for(let a of e)this.filteredPostUuids.has(a.id)?this.filteredPostUuids.delete(a.id):r.push(a);return r}else{let r=[];for(let a of e)a.id!==a.trace_id&&!this.filteredPostUuids.has(a.trace_id)||Math.random()<this.tracingSampleRate?r.push(a):this.filteredPostUuids.add(a.id);return r}}async _getBatchSizeLimitBytes(){let e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??Q0}async drainAutoBatchQueue(){for(;this.autoBatchQueue.items.length>=0;){let[e,t]=this.autoBatchQueue.pop(await this._getBatchSizeLimitBytes());if(!e.length){t();return}try{let r={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)};(await this._ensureServerInfo())?.batch_ingest_config?.use_multipart_endpoint?await this.multipartIngestRuns(r):await this.batchIngestRuns(r)}finally{t()}}}async processRunOperation(e,t){let r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Ym(e.item));let a=this.autoBatchQueue.push(e),s=await this._getBatchSizeLimitBytes();return(t||this.autoBatchQueue.sizeBytes>s)&&await this.drainAutoBatchQueue().catch(console.error),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),a}async _getServerInfo(){let e=await R()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(eA),...this.fetchOptions});return await q(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to single calls and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async createRun(e){if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let a=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){this.processRunOperation({action:"create",item:a}).catch(console.error);return}let s=Ym(a),i=await this.caller.call(R(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:Pn(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(i,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=e?.map(u=>this.prepareRunCreateOrUpdateInputs(u))??[],a=t?.map(u=>this.prepareRunCreateOrUpdateInputs(u))??[];if(r.length>0&&a.length>0){let u=r.reduce((c,d)=>(d.id&&(c[d.id]=d),c),{}),l=[];for(let c of a)c.id!==void 0&&u[c.id]?u[c.id]={...u[c.id],...c}:l.push(c);r=Object.values(u),a=l}let s={post:this._filterForSampling(r),patch:this._filterForSampling(a,!0)};if(!s.post.length&&!s.patch.length)return;if((await this._ensureServerInfo()).version===void 0){this.autoBatchTracing=!1;for(let u of s.post)await this.createRun(u);for(let u of s.patch)u.id!==void 0&&await this.updateRun(u.id,u);return}let o={post:[],patch:[]};for(let u of["post","patch"]){let l=u,c=s[l].reverse(),d=c.pop();for(;d!==void 0;)o[l].push(d),d=c.pop()}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(Pn(o))}async _postBatchIngestRuns(e){let t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(R(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r={},a=[];for(let c of e??[]){let d=this.prepareRunCreateOrUpdateInputs(c);d.id!==void 0&&d.attachments!==void 0&&(r[d.id]=d.attachments),delete d.attachments,a.push(d)}let s=[];for(let c of t??[])s.push(this.prepareRunCreateOrUpdateInputs(c));if(a.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(s.find(c=>c.trace_id===void 0||c.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&s.length>0){let c=a.reduce((p,f)=>(f.id&&(p[f.id]=f),p),{}),d=[];for(let p of s)p.id!==void 0&&c[p.id]?c[p.id]={...c[p.id],...p}:d.push(p);a=Object.values(c),s=d}if(a.length===0&&s.length===0)return;let u=[],l=[];for(let[c,d]of[["post",a],["patch",s]])for(let p of d){let{inputs:f,outputs:h,events:m,...y}=p,x={inputs:f,outputs:h,events:m},v=Pn(y);l.push({name:`${c}.${y.id}`,payload:new Blob([v],{type:`application/json; length=${v.length}`})});for(let[P,j]of Object.entries(x)){if(j===void 0)continue;let N=Pn(j);l.push({name:`${c}.${y.id}.${P}`,payload:new Blob([N],{type:`application/json; length=${N.length}`})})}if(y.id!==void 0){let P=r[y.id];if(P){delete r[y.id];for(let[j,[N,W]]of Object.entries(P))l.push({name:`attachment.${y.id}.${j}`,payload:new Blob([W],{type:`${N}; length=${W.length}`})})}}u.push(`trace=${y.trace_id},id=${y.id}`)}await this._sendMultipartRequest(l,u.join("; "))}async _sendMultipartRequest(e,t){try{let r=new FormData;for(let a of e)r.append(a.name,a.payload);await this.batchIngestCaller.call(R(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers},body:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})}catch(r){let a="Failed to multipart ingest runs";r instanceof Error?a+=`: ${r.stack||r.message}`:a+=`: ${String(r)}`,console.warn(`${a.trim()}

Context: ${t}`)}}async updateRun(e,t){K(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization){await this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}let a={...this.headers,"Content-Type":"application/json"},s=await this.caller.call(R(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:Pn(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(s,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){K(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let a;t.session_id?a=t.session_id:r?.projectName?a=(await this.readProject({projectName:r?.projectName})).id:r?.projectId?a=r?.projectId:a=(await this.readProject({projectName:or("PROJECT")||"default"})).id;let s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${a}/r/${t.id}?poll=true`}else if(e!==void 0){let a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await X0(this.listRuns({id:e.child_run_ids})),r={},a={};t.sort((s,i)=>(s?.dotted_order??"").localeCompare(i?.dotted_order??""));for(let s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);s.parent_run_id in r||(r[s.parent_run_id]=[]),r[s.parent_run_id].push(s),a[s.id]=s}e.child_runs=r[e.id]||[];for(let s in r)s!==e.id&&(a[s].child_runs=r[s]);return e}async*listRuns(e){let{projectId:t,projectName:r,parentRunId:a,traceId:s,referenceExampleId:i,startTime:o,executionOrder:u,isRoot:l,runType:c,error:d,id:p,query:f,filter:h,traceFilter:m,treeFilter:y,limit:x,select:v}=e,P=[];if(t&&(P=Array.isArray(t)?t:[t]),r){let Y=Array.isArray(r)?r:[r],Z=await Promise.all(Y.map(ue=>this.readProject({projectName:ue}).then(se=>se.id)));P.push(...Z)}let j=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],N={session:P.length?P:null,run_type:c,reference_example:i,query:f,filter:h,trace_filter:m,tree_filter:y,execution_order:u,parent_run:a,start_time:o?o.toISOString():null,error:d,id:p,limit:x,trace:s,select:v||j,is_root:l},W=0;for await(let Y of this._getCursorPaginatedList("/runs/query",N))if(x){if(W>=x)break;if(Y.length+W>x){yield*Y.slice(0,x-W);break}W+=Y.length,yield*Y}else yield*Y}async getRunStats({id:e,trace:t,parentRun:r,runType:a,projectNames:s,projectIds:i,referenceExampleIds:o,startTime:u,endTime:l,error:c,query:d,filter:p,traceFilter:f,treeFilter:h,isRoot:m,dataSourceType:y}){let x=i||[];s&&(x=[...i||[],...await Promise.all(s.map(W=>this.readProject({projectName:W}).then(Y=>Y.id)))]);let P=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:a,session:x,reference_example:o,start_time:u,end_time:l,error:c,query:d,filter:p,trace_filter:f,tree_filter:h,is_root:m,data_source_type:y}).filter(([W,Y])=>Y!==void 0));return await(await this.caller.call(R(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(P),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||On()};K(e);let s=await(await this.caller.call(R(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(s===null||!("share_token"in s))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${s.share_token}/r`}async unshareRun(e){K(e);let t=await this.caller.call(R(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(t,"unshare run",!0)}async readRunSharedLink(e){K(e);let r=await(await this.caller.call(R(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(t!==void 0)for(let i of t)r.append("id",i);return K(e),await(await this.caller.call(R(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),K(e);let a=await(await this.caller.call(R(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);let r={dataset_id:e};K(e);let s=await(await this.caller.call(R(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async unshareDataset(e){K(e);let t=await this.caller.call(R(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(t,"unshare dataset",!0)}async readSharedDataset(e){return K(e),await(await this.caller.call(R(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){let r={};t?.exampleIds&&(r.id=t.exampleIds);let a=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(l=>a.append(o,l)):a.append(o,u)});let s=await this.caller.call(R(),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),i=await s.json();if(!s.ok)throw"detail"in i?new Error(`Failed to list shared examples.
Status: ${s.status}
Message: ${i.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${s.status} ${s.statusText}`);return i.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:s=null,referenceDatasetId:i=null}){let o=a?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,l=s||{};r&&(l.metadata=r);let c={name:e,extra:l,description:t};i!==null&&(c.reference_dataset_id=i);let d=await this.caller.call(R(),u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:s=null,endTime:i=null}){let o=`${this.apiUrl}/sessions/${e}`,u=s;a&&(u={...u||{},metadata:a});let l={name:t,extra:u,description:r,end_time:i?new Date(i).toISOString():null},c=await this.caller.call(R(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(c,"update project"),await c.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions",a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)K(e),r+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");let s=await this.caller.call(R(),`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let i=await s.json();return s.ok?Array.isArray(i)?i.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let a="/sessions",s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)K(e),a+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&s.append("include_stats",r.toString());let i=await this._get(a,s),o;if(Array.isArray(i)){if(i.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=i[0]}else o=i;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");let r=await this.readProject({projectId:e,projectName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");let r=await this.readDataset({datasetId:e,datasetName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:s,referenceFree:i,metadata:o}={}){let u=new URLSearchParams;if(e!==void 0)for(let l of e)u.append("id",l);if(t!==void 0&&u.append("name",t),r!==void 0&&u.append("name_contains",r),a!==void 0)u.append("reference_dataset",a);else if(s!==void 0){let l=await this.readDataset({datasetName:s});u.append("reference_dataset",l.id)}i!==void 0&&u.append("reference_free",i.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));for await(let l of this._getPaginated("/sessions",u))yield*l}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,K(r);let a=await this.caller.call(R(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(a,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:s,dataType:i,name:o}){let u=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(p=>{l.append("input_keys",p)}),a.forEach(p=>{l.append("output_keys",p)}),s&&l.append("description",s),i&&l.append("data_type",i),o&&l.append("name",o);let c=await this.caller.call(R(),u,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(c,"upload CSV"),await c.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:a,outputsSchema:s,metadata:i}={}){let o={name:e,description:t,extra:i?{metadata:i}:void 0};r&&(o.data_type=r),a&&(o.inputs_schema_definition=a),s&&(o.outputs_schema_definition=s);let u=await this.caller.call(R(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(u,"create dataset"),await u.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets",a=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)K(e),r+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide datasetName or datasetId");let s=await this._get(r,a),i;if(Array.isArray(s)){if(s.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);i=s[0]}else i=s;return i}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:a}){let s=e;if(s===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:t})).id);let i=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof a=="string"?a:a.toISOString()});return await this._get(`/datasets/${s}/versions/diff`,i)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){let r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:s,metadata:i}={}){let o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(let l of r)u.append("id",l);a!==void 0&&u.append("name",a),s!==void 0&&u.append("name_contains",s),i!==void 0&&u.append("metadata",JSON.stringify(i));for await(let l of this._getPaginated(o,u))yield*l}async updateDataset(e){let{datasetId:t,datasetName:r,...a}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");let s=t??(await this.readDataset({datasetName:r})).id;K(s);let i=await this.caller.call(R(),`${this.apiUrl}/datasets/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"update dataset"),await i.json()}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(a=(await this.readDataset({datasetName:t})).id),a!==void 0)K(a),r+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");let s=await this.caller.call(R(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(s,`delete ${r}`),await s.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let a=e;if(!a&&!t)throw new Error("Must provide either datasetName or datasetId");if(a&&t)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:t})).id),K(a);let s={tag:r},i=await this.caller.call(R(),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(i,"index dataset"),await i.json()}async similarExamples(e,t,r,{filter:a}={}){let s={limit:r,inputs:e};a!==void 0&&(s.filter=a),K(t);let i=await this.caller.call(R(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"fetch similar examples"),(await i.json()).examples}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:s,exampleId:i,metadata:o,split:u,sourceRunId:l}){let c=r;if(c===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(c!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");c===void 0&&(c=(await this.readDataset({datasetName:a})).id);let p={dataset_id:c,inputs:e,outputs:t,created_at:(s||new Date)?.toISOString(),id:i,metadata:o,split:u,source_run_id:l},f=await this.caller.call(R(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(p),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(f,"create example"),await f.json()}async createExamples(e){let{inputs:t,outputs:r,metadata:a,sourceRunIds:s,exampleIds:i,datasetId:o,datasetName:u}=e,l=o;if(l===void 0&&u===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&u!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(await this.readDataset({datasetName:u})).id);let c=t.map((f,h)=>({dataset_id:l,inputs:f,outputs:r?r[h]:void 0,metadata:a?a[h]:void 0,split:e.splits?e.splits[h]:void 0,id:i?i[h]:void 0,source_run_id:s?s[h]:void 0})),d=await this.caller.call(R(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(d,"create examples"),await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let a=e.map(i=>Wl(i)?Zl(i):i),s=Wl(t)?Zl(t):t;return this.createExample({input:a},{output:s},r)}async readExample(e){K(e);let t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:a,splits:s,inlineS3Urls:i,metadata:o,limit:u,offset:l,filter:c}={}){let d;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(t!==void 0)d=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");let p=new URLSearchParams({dataset:d}),f=a?typeof a=="string"?a:a?.toISOString():void 0;f&&p.append("as_of",f);let h=i??!0;if(p.append("inline_s3_urls",h.toString()),r!==void 0)for(let y of r)p.append("id",y);if(s!==void 0)for(let y of s)p.append("splits",y);if(o!==void 0){let y=JSON.stringify(o);p.append("metadata",y)}u!==void 0&&p.append("limit",u.toString()),l!==void 0&&p.append("offset",l.toString()),c!==void 0&&p.append("filter",c);let m=0;for await(let y of this._getPaginated("/examples",p)){for(let x of y)yield x,m++;if(u!==void 0&&m>=u)break}}async deleteExample(e){K(e);let t=`/examples/${e}`,r=await this.caller.call(R(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(r,`delete ${t}`),await r.json()}async updateExample(e,t){K(e);let r=await this.caller.call(R(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(r,"update example"),await r.json()}async updateExamples(e){let t=await this.caller.call(R(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(t,"update examples"),await t.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,K(a);let s=new URLSearchParams,i=r?typeof r=="string"?r:r?.toISOString():void 0;return i&&s.append("as_of",i),await this._get(`/datasets/${a}/splits`,s)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:a,remove:s=!1}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,K(i);let o={split_name:r,examples:a.map(l=>(K(l),l)),remove:s},u=await this.caller.call(R(),`${this.apiUrl}/datasets/${i}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(u,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:s}={loadChildRuns:!1}){To("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let i;if(typeof e=="string")i=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)i=e;else throw new Error(`Invalid run type: ${typeof e}`);i.reference_example_id!==null&&i.reference_example_id!==void 0&&(s=await this.readExample(i.reference_example_id));let o=await t.evaluateRun(i,s),[u,l]=await this._logEvaluationFeedback(o,i,r);return l[0]}async createFeedback(e,t,{score:r,value:a,correction:s,comment:i,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:l,feedbackId:c,feedbackConfig:d,projectId:p,comparativeExperimentId:f}){if(!e&&!p)throw new Error("One of runId or projectId must be provided");if(e&&p)throw new Error("Only one of runId or projectId can be provided");let h={type:u??"api",metadata:o??{}};l!==void 0&&h?.metadata!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:l}),h?.metadata!==void 0&&h.metadata.__run?.run_id!==void 0&&K(h.metadata.__run.run_id);let m={id:c??On(),run_id:e,key:t,score:r,value:a,correction:s,comment:i,feedback_source:h,comparative_experiment_id:f,feedbackConfig:d,session_id:p},y=`${this.apiUrl}/feedback`,x=await this.caller.call(R(),y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(x,"create feedback",!0),m}async updateFeedback(e,{score:t,value:r,correction:a,comment:s}){let i={};t!=null&&(i.score=t),r!=null&&(i.value=r),a!=null&&(i.correction=a),s!=null&&(i.comment=s),K(e);let o=await this.caller.call(R(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(o,"update feedback",!0)}async readFeedback(e){K(e);let t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){K(e);let t=`/feedback/${e}`,r=await this.caller.call(R(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(let s of t)a.append("key",s);if(r)for(let s of r)a.append("source",s);for await(let s of this._getPaginated("/feedback",a))yield*s}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:a}={}){let s={run_id:e,feedback_key:t,feedback_config:a};return r?typeof r=="string"?s.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(s.expires_in=r):s.expires_in={hours:3},await(await this.caller.call(R(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:a,description:s,metadata:i,id:o}){if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");let u={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:s,created_at:(a??new Date)?.toISOString(),extra:{}};return i&&(u.extra.metadata=i),await(await this.caller.call(R(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){K(e);let t=new URLSearchParams({run_id:e});for await(let r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,r){let a=this._selectEvalResults(e),s=[];for(let i of a){let o=r||{};i.evaluatorInfo&&(o={...i.evaluatorInfo,...o});let u=null;i.targetRunId?u=i.targetRunId:t&&(u=t.id),s.push(await this.createFeedback(u,i.key,{score:i.score,value:i.value,comment:i.comment,correction:i.correction,sourceInfo:o,sourceRunId:i.sourceRunId,feedbackConfig:i.feedbackConfig,feedbackSourceType:"model"}))}return[a,s]}async logEvaluationFeedback(e,t,r){let[a]=await this._logEvaluationFeedback(e,t,r);return a}async*listAnnotationQueues(e={}){let{queueIds:t,name:r,nameContains:a,limit:s}=e,i=new URLSearchParams;t&&t.forEach((u,l)=>{K(u,`queueIds[${l}]`),i.append("ids",u)}),r&&i.append("name",r),a&&i.append("name_contains",a),i.append("limit",(s!==void 0?Math.min(s,100):100).toString());let o=0;for await(let u of this._getPaginated("/annotation-queues",i))if(yield*u,o++,s!==void 0&&o>=s)break}async createAnnotationQueue(e){let{name:t,description:r,queueId:a}=e,s={name:t,description:r,id:a||On()},i=await this.caller.call(R(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(s).filter(([u,l])=>l!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"create annotation queue"),await i.json()}async readAnnotationQueue(e){let t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){let{name:r,description:a}=t,s=await this.caller.call(R(),`${this.apiUrl}/annotation-queues/${K(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(s,"update annotation queue")}async deleteAnnotationQueue(e){let t=await this.caller.call(R(),`${this.apiUrl}/annotation-queues/${K(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){let r=await this.caller.call(R(),`${this.apiUrl}/annotation-queues/${K(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((a,s)=>K(a,`runIds[${s}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){let r=`/annotation-queues/${K(e,"queueId")}/run`,a=await this.caller.call(R(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(a,"get run from annotation queue"),await a.json()}async _currentTenantIsOwner(e){let t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){let r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){let t=await this.caller.call(R(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){let a=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),s=new Error(`Error ${t.status}: ${t.statusText}
${a}`);throw s.statusCode=t.status,s}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){let[r,a,s]=ir(e),i=await this.caller.call(R(),`${this.apiUrl}/likes/${r}/${a}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,`${t?"like":"unlike"} prompt`),await i.json()}async _getPromptUrl(e){let[t,r,a]=ir(e);if(await this._currentTenantIsOwner(t)){let s=await this._getSettings();return a!=="latest"?`${this.getHostUrl()}/prompts/${r}/${a.substring(0,8)}?organizationId=${s.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${s.id}`}else return a!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(let t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){let t=new URLSearchParams;t.append("sort_field",e?.sortField??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&t.append("is_public",e.isPublic.toString()),e?.query&&t.append("query",e.query);for await(let r of this._getPaginated("/repos",t,a=>a.repos))yield*r}async getPrompt(e){let[t,r,a]=ir(e),s=await this.caller.call(R(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(s.status===404)return null;await q(s,"get prompt");let i=await s.json();return i.repo?i.repo:null}async createPrompt(e,t){let r=await this._getSettings();if(t?.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);let[a,s,i]=ir(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);let o={repo_handle:s,...t?.description&&{description:t.description},...t?.readme&&{readme:t.readme},...t?.tags&&{tags:t.tags},is_public:!!t?.isPublic},u=await this.caller.call(R(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(u,"create prompt");let{repo:l}=await u.json();return l}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[a,s,i]=ir(e),o=r?.parentCommitHash==="latest"||!r?.parentCommitHash?await this._getLatestCommitHash(`${a}/${s}`):r?.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},l=await this.caller.call(R(),`${this.apiUrl}/commits/${a}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(l,"create commit");let c=await l.json();return this._getPromptUrl(`${a}/${s}${c.commit_hash?`:${c.commit_hash}`:""}`)}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[r,a]=ir(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);let s={};if(t?.description!==void 0&&(s.description=t.description),t?.readme!==void 0&&(s.readme=t.readme),t?.tags!==void 0&&(s.tags=t.tags),t?.isPublic!==void 0&&(s.is_public=t.isPublic),t?.isArchived!==void 0&&(s.is_archived=t.isArchived),Object.keys(s).length===0)throw new Error("No valid update options provided");let i=await this.caller.call(R(),`${this.apiUrl}/repos/${r}/${a}`,{method:"PATCH",body:JSON.stringify(s),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await q(i,"update prompt"),i.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");let[t,r,a]=ir(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(R(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){let[r,a,s]=ir(e),i=await this._getServerInfo(),o=Gm(i.version,"0.5.23"),u=s;if(!o&&s==="latest"){let d=await this._getLatestCommitHash(`${r}/${a}`);if(d)u=d;else throw new Error("No commits found")}let l=await this.caller.call(R(),`${this.apiUrl}/commits/${r}/${a}/${u}${t?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await q(l,"pull prompt commit");let c=await l.json();return{owner:r,repo:a,commit_hash:c.commit_hash,manifest:c.manifest,examples:c.examples}}async _pullPrompt(e,t){let r=await this.pullPromptCommit(e,{includeModel:t?.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(a=>a!=="object")&&await this.updatePrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}):await this.createPrompt(e,{description:t?.description,readme:t?.readme,tags:t?.tags,isPublic:t?.isPublic}),t?.object?await this.createCommit(e,t?.object,{parentCommitHash:t?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){let{sourceApiUrl:r=this.apiUrl,datasetName:a}=t,[s,i]=this.parseTokenOrUrl(e,r),o=new n({apiUrl:s,apiKey:"placeholder"}),u=await o.readSharedDataset(i),l=a||u.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch{}let c=await o.listSharedExamples(i),d=await this.createDataset(l,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(p=>p.inputs),outputs:c.flatMap(p=>p.outputs?[p.outputs]:[]),datasetId:d.id})}catch(p){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),p}}parseTokenOrUrl(e,t,r=2,a="dataset"){try{return K(e),[t,e]}catch{}try{let i=new URL(e).pathname.split("/").filter(o=>o!=="");if(i.length>=r){let o=i[i.length-r];return[t,o]}else throw new Error(`Invalid public ${a} URL: ${e}`)}catch{throw new Error(`Invalid public ${a} URL or token: ${e}`)}}awaitPendingTraceBatches(){return Promise.all(this.autoBatchQueue.items.map(({itemPromise:e})=>e))}}});var Bo,qo=g(()=>{Ac();Ko();Io();Bo="0.1.68"});function Vo(){if(Ec===void 0){let n=sA(),e=oA();Ec={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:Bo,...e}}return Ec}function Qm(){let n=iA()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[r,a]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof a=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[r]=a);return e}function iA(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function Nr(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}function or(n){return Nr(`LANGSMITH_${n}`)||Nr(`LANGCHAIN_${n}`)}function oA(){if(Oc!==void 0)return Oc;let n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(let t of n){let r=Nr(t);r!==void 0&&(e[t]=r)}return Oc=e,e}var ur,tA,rA,nA,eg,aA,sA,Ec,Oc,Ho=g(()=>{qo();tA=()=>typeof window<"u"&&typeof window.document<"u",rA=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",nA=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),eg=()=>typeof Deno<"u",aA=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!eg(),sA=()=>ur||(tA()?ur="browser":aA()?ur="node":rA()?ur="webworker":nA()?ur="jsdom":eg()?ur="deno":ur="other",ur)});var tg,rg=g(()=>{Ho();tg=n=>n!==void 0?n:!!["TRACING_V2","TRACING"].find(t=>or(t)==="true")});var Go,ng=g(()=>{Go=Symbol.for("lc:context_variables")});function uA(n){return n.replace(/[-:.]/g,"")}function lA(n,e,t=1){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return uA(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Ic(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function sg(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function ag(n){return Array.isArray(n)&&n.some(e=>sg(e))}function cA(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function dA(n){return n!==void 0&&typeof n.callbacks=="object"&&(ag(n.callbacks?.handlers)||ag(n.callbacks))}var Jo,Rr,Ko=g(()=>{wo();Ho();Ac();rg();Xl();ng();Jo=class n{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){let t=e.split(","),r={},a=[];for(let s of t){let[i,o]=s.split("="),u=decodeURIComponent(o);i==="langsmith-metadata"?r=JSON.parse(u):i==="langsmith-tags"&&(a=u.split(","))}return new n(r,a)}toHeader(){let e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}},Rr=class n{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Ic(e)){Object.assign(this,{...e});return}let t=n.getDefaultConfig(),{metadata:r,...a}=e,s=a.client??n.getSharedClient(),i={...r,...a?.extra?.metadata};if(a.extra={...a.extra,metadata:i},Object.assign(this,{...t,...a,client:s}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){let o=lA(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+o:this.dotted_order=o}}static getDefaultConfig(){return{id:On(),run_type:"chain",project_name:Nr("LANGCHAIN_PROJECT")??Nr("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:Nr("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Nr("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return n.sharedClient||(n.sharedClient=new Tn),n.sharedClient}createChild(e){let t=this.child_execution_order+1,r=new n({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});Go in this&&(r[Go]=this[Go]);let a=Symbol.for("lc:child_config"),s=e.extra?.[a]??this.extra[a];if(dA(s)){let u={...s},l=cA(u.callbacks)?u.callbacks.copy?.():void 0;l&&(Object.assign(l,{_parentRunId:r.id}),l.handlers?.find(sg)?.updateFromRunTree?.(r),u.callbacks=l),r.extra[a]=u}let i=new Set,o=this;for(;o!=null&&!i.has(o.id);)i.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),a){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,t,r=!0){let a=e.extra??{};if(a.runtime||(a.runtime={}),t)for(let[u,l]of Object.entries(t))a.runtime[u]||(a.runtime[u]=l);let s,i;return r?(i=e.parent_run?.id,s=[]):(s=e.child_runs.map(u=>this._convertToCreate(u,t,r)),i=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:s,parent_run_id:i,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){try{let t=Vo(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){To("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(let a of this.child_runs)await a.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){try{let e={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:this.parent_run?.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,e)}catch(e){console.error(`Error in patchRun for run ${this.id}`,e)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){let r=e?.callbacks,a,s,i,o=tg();if(r){let l=r?.getParentRunId?.()??"",c=r?.handlers?.find(d=>d?.name=="langchain_tracer");a=c?.getRun?.(l),s=c?.projectName,i=c?.client,o=o||!!c}return a?new n({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:i,tracingEnabled:o,project_name:s,tags:[...new Set((a?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...a?.extra?.metadata,...e?.metadata}}}).createChild(t):new n({...t,client:i,tracingEnabled:o,project_name:s})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){let r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=r["langsmith-trace"];if(!a||typeof a!="string")return;let s=a.trim(),i=s.split(".").map(l=>{let[c,d]=l.split("Z");return{strTime:c,time:Date.parse(c+"Z"),uuid:d}}),o=i[0].uuid,u={...t,name:t?.name??"parent",run_type:t?.run_type??"chain",start_time:t?.start_time??Date.now(),id:i.at(-1)?.uuid,trace_id:o,dotted_order:s};if(r.baggage&&typeof r.baggage=="string"){let l=Jo.fromHeader(r.baggage);u.metadata=l.metadata,u.tags=l.tags}return new n(u)}toHeaders(e){let t={"langsmith-trace":this.dotted_order,baggage:new Jo(this.extra?.metadata,this.tags).toHeader()};if(e)for(let[r,a]of Object.entries(t))e.set(r,a);return t}};Object.defineProperty(Rr,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null})});function Wo(n){return typeof n=="function"&&"langsmith:traceable"in n}var Tc,Pc,pA,Sc,fA,ig,GS,og=g(()=>{Ko();Tc=class{getStore(){}run(e,t){return t()}},Pc=Symbol.for("ls:tracing_async_local_storage"),pA=new Tc,Sc=class{getInstance(){return globalThis[Pc]??pA}initializeGlobalInstance(e){globalThis[Pc]===void 0&&(globalThis[Pc]=e)}},fA=new Sc,ig=()=>{let n=fA.getInstance().getStore();if(!Ic(n))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return n},GS=Symbol.for("langsmith:traceable:root")});var Cc=g(()=>{og()});function Xo(n,e){return hA.call(n,e)}function Yo(n){if(Array.isArray(n)){let t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)Xo(n,t)&&e.push(t);return e}function Ce(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function Qo(n){let e=0,t=n.length,r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function zt(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function ni(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function Zo(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Zo(n[t]))return!0}else if(typeof n=="object"){let t=Yo(n),r=t.length;for(var e=0;e<r;e++)if(Zo(n[t[e]]))return!0}}return!1}function ug(n,e){let t=[n];for(let r in e){let a=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof a<"u"&&t.push(`${r}: ${a}`)}return t.join(`
`)}var hA,Sn,ai=g(()=>{hA=Object.prototype.hasOwnProperty;Sn=class extends Error{constructor(e,t,r,a,s){super(ug(e,{name:t,index:r,operation:a,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=ug(e,{name:t,index:r,operation:a,tree:s})}}});var kc={};ro(kc,{JsonPatchError:()=>ie,_areEquals:()=>si,applyOperation:()=>Cn,applyPatch:()=>$r,applyReducer:()=>yA,deepClone:()=>mA,getValueByPointer:()=>eu,validate:()=>lg,validator:()=>tu});function eu(n,e){if(e=="")return n;var t={op:"_get",path:e};return Cn(n,t),t.value}function Cn(n,e,t=!1,r=!0,a=!0,s=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):tu(e,0)),e.path===""){let i={newDocument:n};if(e.op==="add")return i.newDocument=e.value,i;if(e.op==="replace")return i.newDocument=e.value,i.removed=n,i;if(e.op==="move"||e.op==="copy")return i.newDocument=eu(n,e.from),e.op==="move"&&(i.removed=n),i;if(e.op==="test"){if(i.test=si(n,e.value),i.test===!1)throw new ie("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return i.newDocument=n,i}else{if(e.op==="remove")return i.removed=n,i.newDocument=null,i;if(e.op==="_get")return e.value=n,i;if(t)throw new ie("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,n);return i}}else{r||(n=Ce(n));let o=(e.path||"").split("/"),u=n,l=1,c=o.length,d,p,f;for(typeof t=="function"?f=t:f=tu;;){if(p=o[l],p&&p.indexOf("~")!=-1&&(p=ni(p)),a&&(p=="__proto__"||p=="prototype"&&l>0&&o[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(u[p]===void 0?d=o.slice(0,l).join("/"):l==c-1&&(d=e.path),d!==void 0&&f(e,0,n,d)),l++,Array.isArray(u)){if(p==="-")p=u.length;else{if(t&&!Qo(p))throw new ie("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,n);Qo(p)&&(p=~~p)}if(l>=c){if(t&&e.op==="add"&&p>u.length)throw new ie("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,n);let h=gA[e.op].call(e,u,p,n);if(h.test===!1)throw new ie("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return h}}else if(l>=c){let h=Ia[e.op].call(e,u,p,n);if(h.test===!1)throw new ie("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return h}if(u=u[p],t&&l<c&&(!u||typeof u!="object"))throw new ie("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,n)}}}function $r(n,e,t,r=!0,a=!0){if(t&&!Array.isArray(e))throw new ie("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=Ce(n));let s=new Array(e.length);for(let i=0,o=e.length;i<o;i++)s[i]=Cn(n,e[i],t,!0,a,i),n=s[i].newDocument;return s.newDocument=n,s}function yA(n,e,t){let r=Cn(n,e);if(r.test===!1)throw new ie("Test operation failed","TEST_OPERATION_FAILED",t,e,n);return r.newDocument}function tu(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new ie("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Ia[n.op]){if(typeof n.path!="string")throw new ie("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new ie('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new ie("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new ie("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&Zo(n.value))throw new ie("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var a=n.path.split("/").length,s=r.split("/").length;if(a!==s+1&&a!==s)throw new ie("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new ie("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var i={op:"_get",path:n.from,value:void 0},o=lg([i],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new ie("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new ie("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function lg(n,e,t){try{if(!Array.isArray(n))throw new ie("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)$r(Ce(e),Ce(n),t||!0);else{t=t||tu;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(a){if(a instanceof ie)return a;throw a}}function si(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),a,s,i;if(t&&r){if(s=n.length,s!=e.length)return!1;for(a=s;a--!==0;)if(!si(n[a],e[a]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(s=o.length,s!==Object.keys(e).length)return!1;for(a=s;a--!==0;)if(!e.hasOwnProperty(o[a]))return!1;for(a=s;a--!==0;)if(i=o[a],!si(n[i],e[i]))return!1;return!0}return n!==n&&e!==e}var ie,mA,Ia,gA,ru=g(()=>{ai();ie=Sn,mA=Ce,Ia={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=eu(t,this.path);r&&(r=Ce(r));let a=Cn(t,{op:"remove",path:this.from}).removed;return Cn(t,{op:"add",path:this.path,value:a}),{newDocument:t,removed:r}},copy:function(n,e,t){let r=eu(t,this.from);return Cn(t,{op:"add",path:this.path,value:Ce(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:si(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}},gA={add:function(n,e,t){return Qo(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Ia.move,copy:Ia.copy,test:Ia.test,_get:Ia._get}});function cg(n,e,t,r,a){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=Yo(e),i=Yo(n),o=!1,u=!1,l=i.length-1;l>=0;l--){var c=i[l],d=n[c];if(Xo(e,c)&&!(e[c]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var p=e[c];typeof d=="object"&&d!=null&&typeof p=="object"&&p!=null&&Array.isArray(d)===Array.isArray(p)?cg(d,p,t,r+"/"+zt(c),a):d!==p&&(o=!0,a&&t.push({op:"test",path:r+"/"+zt(c),value:Ce(d)}),t.push({op:"replace",path:r+"/"+zt(c),value:Ce(p)}))}else Array.isArray(n)===Array.isArray(e)?(a&&t.push({op:"test",path:r+"/"+zt(c),value:Ce(d)}),t.push({op:"remove",path:r+"/"+zt(c)}),u=!0):(a&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}),o=!0)}if(!(!u&&s.length==i.length))for(var l=0;l<s.length;l++){var c=s[l];!Xo(n,c)&&e[c]!==void 0&&t.push({op:"add",path:r+"/"+zt(c),value:Ce(e[c])})}}}function nu(n,e,t=!1){var r=[];return cg(n,e,r,"",t),r}var dg=g(()=>{ai();ru();});var nC,Rc=g(()=>{ru();dg();ai();ru();ai();nC={...kc,JsonPatchError:Sn,deepClone:Ce,escapePathComponent:zt,unescapePathComponent:ni}});var fg=S((uC,pg)=>{"use strict";pg.exports=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}});var wg=S((lC,Nc)=>{"use strict";var bA=/[\p{Lu}]/u,_A=/[\p{Ll}]/u,hg=/^[\p{Lu}](?![\p{Lu}])/gu,yg=/([\p{Alpha}\p{N}_]|$)/u,bg=/[_.\- ]+/,wA=new RegExp("^"+bg.source),mg=new RegExp(bg.source+yg.source,"gu"),gg=new RegExp("\\d+"+yg.source,"gu"),vA=(n,e,t)=>{let r=!1,a=!1,s=!1;for(let i=0;i<n.length;i++){let o=n[i];r&&bA.test(o)?(n=n.slice(0,i)+"-"+n.slice(i),r=!1,s=a,a=!0,i++):a&&s&&_A.test(o)?(n=n.slice(0,i-1)+"-"+n.slice(i-1),s=a,a=!1,r=!0):(r=e(o)===o&&t(o)!==o,s=a,a=t(o)===o&&e(o)!==o)}return n},xA=(n,e)=>(hg.lastIndex=0,n.replace(hg,t=>e(t))),AA=(n,e)=>(mg.lastIndex=0,gg.lastIndex=0,n.replace(mg,(t,r)=>e(r)).replace(gg,t=>e(t))),_g=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(s=>s.trim()).filter(s=>s.length).join("-"):n=n.trim(),n.length===0)return"";let t=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),r=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=vA(n,t,r)),n=n.replace(wA,""),e.preserveConsecutiveUppercase?n=xA(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),AA(n,r))};Nc.exports=_g;Nc.exports.default=_g});function xg(n,e){return e?.[n]||(0,vg.default)(n)}function Ag(n,e,t){let r={};for(let a in n)Object.hasOwn(n,a)&&(r[e(a,t)]=n[a]);return r}var vg,EA,Eg=g(()=>{vg=nt(fg(),1),EA=nt(wg(),1)});function Og(n){return Array.isArray(n)?[...n]:{...n}}function OA(n,e){let t=Og(n);for(let[r,a]of Object.entries(e)){let[s,...i]=r.split(".").reverse(),o=t;for(let u of i.reverse()){if(o[u]===void 0)break;o[u]=Og(o[u]),o=o[u]}o[s]!==void 0&&(o[s]={lc:1,type:"secret",id:[a]})}return t}function $c(n){let e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}var vt,ii=g(()=>{Eg();vt=class n{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,$c(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof n||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((a,s)=>(a[s]=s in this?this[s]:this.lc_kwargs[s],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(a=>{let s=this,i=r,[o,...u]=a.split(".").reverse();for(let l of u.reverse()){if(!(l in s)||s[l]===void 0)return;(!(l in i)||i[l]===void 0)&&(typeof s[l]=="object"&&s[l]!=null?i[l]={}:Array.isArray(s[l])&&(i[l]=[])),s=s[l],i=i[l]}o in s&&s[o]!==void 0&&(i[o]=i[o]||s[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:Ag(Object.keys(t).length?OA(r,t):r,xg,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}});async function Pg(){return jc===void 0&&(jc={library:"langchain-js",runtime:CA()}),jc}function te(n){try{return typeof process<"u"?process.env?.[n]:void 0}catch{return}}var IA,PA,TA,Ig,SA,CA,jc,Pa=g(()=>{IA=()=>typeof window<"u"&&typeof window.document<"u",PA=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",TA=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Ig=()=>typeof Deno<"u",SA=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Ig(),CA=()=>{let n;return IA()?n="browser":SA()?n="node":PA()?n="webworker":TA()?n="jsdom":Ig()?n="deno":n="other",n}});var Mc,kn,Lc=g(()=>{Gs();ii();Pa();Mc=class{},kn=class n extends Mc{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,$c(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:te("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return vt.prototype.toJSON.call(this)}toJSONNotImplemented(){return vt.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends n{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:qe()}),Object.assign(this,e)}}return new t}}});function Dc(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function kA(n){return n.replace(/[-:.]/g,"")}function RA(n,e,t){let r=t.toFixed(0).slice(0,3).padStart(3,"0");return kA(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Ta(n){return typeof n._addRunToRunMap=="function"}var ct,Rn=g(()=>{Lc();ct=class extends kn{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){let t=RA(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){let a=this.runMap.get(r.parent_run_id);a&&(this._addChildRun(a,r),a.child_execution_order=Math.max(a.child_execution_order,r.child_execution_order),r.trace_id=a.trace_id,a.dotted_order!==void 0&&(r.dotted_order=[a.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){let t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,a,s,i,o,u){let l=this._getExecutionOrder(a),c=Date.now(),d=o?{...s,metadata:o}:s,p={id:r,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(p)}async handleLLMStart(e,t,r,a,s,i,o,u){let l=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,a,s,i,o,u);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}_createRunForChatModelStart(e,t,r,a,s,i,o,u){let l=this._getExecutionOrder(a),c=Date.now(),d=o?{...s,metadata:o}:s,p={id:r,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:i||[]};return this._addRunToRunMap(p)}async handleChatModelStart(e,t,r,a,s,i,o,u){let l=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,a,s,i,o,u);return await this.onRunCreate?.(l),await this.onLLMStart?.(l),l}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onLLMEnd?.(r),await this._endTrace(r),r}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onLLMError?.(r),await this._endTrace(r),r}_createRunForChainStart(e,t,r,a,s,i,o,u){let l=this._getExecutionOrder(a),c=Date.now(),d={id:r,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:o??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,r,a,s,i,o,u){let l=this.runMap.get(r)??this._createRunForChainStart(e,t,r,a,s,i,o,u);return await this.onRunCreate?.(l),await this.onChainStart?.(l),l}async handleChainEnd(e,t,r,a,s){let i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=Dc(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),s?.inputs!==void 0&&(i.inputs=Dc(s.inputs,"input")),await this.onChainEnd?.(i),await this._endTrace(i),i}async handleChainError(e,t,r,a,s){let i=this.runMap.get(t);if(!i)throw new Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),s?.inputs!==void 0&&(i.inputs=Dc(s.inputs,"input")),await this.onChainError?.(i),await this._endTrace(i),i}_createRunForToolStart(e,t,r,a,s,i,o){let u=this._getExecutionOrder(a),l=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};return this._addRunToRunMap(c)}async handleToolStart(e,t,r,a,s,i,o){let u=this.runMap.get(r)??this._createRunForToolStart(e,t,r,a,s,i,o);return await this.onRunCreate?.(u),await this.onToolStart?.(u),u}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="chain")return;let a=r;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r)}async handleAgentEnd(e,t){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,t,r,a,s,i,o){let u=this._getExecutionOrder(a),l=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:s||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,t,r,a,s,i,o){let u=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,a,s,i,o);return await this.onRunCreate?.(u),await this.onRetrieverStart?.(u),u}async handleRetrieverEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.runMap.get(t);!r||r?.run_type!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,a,s,i){let o=this.runMap.get(r);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await this.onLLMNewToken?.(o,e,{chunk:i?.chunk}),o}}});var Fc=g(()=>{qo()});var kg=S((vC,Cg)=>{"use strict";var Tg=(n=0)=>e=>`\x1B[${38+n};5;${e}m`,Sg=(n=0)=>(e,t,r)=>`\x1B[${38+n};2;${e};${t};${r}m`;function NA(){let n=new Map,e={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};e.color.gray=e.color.blackBright,e.bgColor.bgGray=e.bgColor.bgBlackBright,e.color.grey=e.color.blackBright,e.bgColor.bgGrey=e.bgColor.bgBlackBright;for(let[t,r]of Object.entries(e)){for(let[a,s]of Object.entries(r))e[a]={open:`\x1B[${s[0]}m`,close:`\x1B[${s[1]}m`},r[a]=e[a],n.set(s[0],s[1]);Object.defineProperty(e,t,{value:r,enumerable:!1})}return Object.defineProperty(e,"codes",{value:n,enumerable:!1}),e.color.close="\x1B[39m",e.bgColor.close="\x1B[49m",e.color.ansi256=Tg(),e.color.ansi16m=Sg(),e.bgColor.ansi256=Tg(10),e.bgColor.ansi16m=Sg(10),Object.defineProperties(e,{rgbToAnsi256:{value:(t,r,a)=>t===r&&r===a?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(r/255*5)+Math.round(a/255*5),enumerable:!1},hexToRgb:{value:t=>{let r=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(t.toString(16));if(!r)return[0,0,0];let{colorString:a}=r.groups;a.length===3&&(a=a.split("").map(i=>i+i).join(""));let s=Number.parseInt(a,16);return[s>>16&255,s>>8&255,s&255]},enumerable:!1},hexToAnsi256:{value:t=>e.rgbToAnsi256(...e.hexToRgb(t)),enumerable:!1}}),e}Object.defineProperty(Cg,"exports",{enumerable:!0,get:NA})});function Le(n,e){return`${n.open}${e}${n.close}`}function dt(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function Rg(n){return typeof n=="string"?n.trim():n==null?n:dt(n,n.toString())}function jr(n){if(!n.end_time)return"";let e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}var Uc,Ve,oi,Ng=g(()=>{Uc=nt(kg(),1);Rn();({color:Ve}=Uc.default),oi=class extends ct{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let a=this.runMap.get(r.parent_run_id);if(a)t.push(a),r=a;else break}return t}getBreadcrumbs(e){let r=[...this.getParents(e).reverse(),e].map((a,s,i)=>{let o=`${a.execution_order}:${a.run_type}:${a.name}`;return s===i.length-1?Le(Uc.default.bold,o):o}).join(" > ");return Le(Ve.grey,r)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.green,"[chain/start]")} [${t}] Entering Chain run with input: ${dt(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.cyan,"[chain/end]")} [${t}] [${jr(e)}] Exiting Chain run with output: ${dt(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.red,"[chain/error]")} [${t}] [${jr(e)}] Chain run errored with error: ${dt(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${Le(Ve.green,"[llm/start]")} [${t}] Entering LLM run with input: ${dt(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.cyan,"[llm/end]")} [${t}] [${jr(e)}] Exiting LLM run with output: ${dt(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.red,"[llm/error]")} [${t}] [${jr(e)}] LLM run errored with error: ${dt(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Rg(e.inputs.input)}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.cyan,"[tool/end]")} [${t}] [${jr(e)}] Exiting Tool run with output: "${Rg(e.outputs?.output)}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.red,"[tool/error]")} [${t}] [${jr(e)}] Tool run errored with error: ${dt(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${dt(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.cyan,"[retriever/end]")} [${t}] [${jr(e)}] Exiting Retriever run with output: ${dt(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${Le(Ve.red,"[retriever/error]")} [${t}] [${jr(e)}] Retriever run errored with error: ${dt(e.error,"[error]")}`)}onAgentAction(e){let t=e,r=this.getBreadcrumbs(e);console.log(`${Le(Ve.blue,"[agent/action]")} [${r}] Agent selected action: ${dt(t.actions[t.actions.length-1],"[action]")}`)}}});function Ca(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}var Sa,au=g(()=>{Sa=class extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}});function zc(n,e=ka){n=n.trim();let t=/```(json)?(.*)```/s.exec(n);return e(t?t[2]:n)}function ka(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="",t=[],r=!1,a=!1;for(let s of n){if(r)s==='"'&&!a?r=!1:s===`
`&&!a?s="\\n":s==="\\"?a=!a:a=!1;else if(s==='"')r=!0,a=!1;else if(s==="{")t.push("}");else if(s==="[")t.push("]");else if(s==="}"||s==="]")if(t&&t[t.length-1]===s)t.pop();else return null;e+=s}r&&(e+='"');for(let s=t.length-1;s>=0;s-=1)e+=t[s];try{return JSON.parse(e)}catch{return null}}var Bc=g(()=>{});function pt(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?ui(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function $g(n,e){return n==="error"||e==="error"?"error":"success"}function $A(n,e){function t(r,a){if(typeof r!="object"||r===null||r===void 0)return r;if(a>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(i=>t(i,a+1));let s={};for(let i of Object.keys(r))s[i]=t(r[i],a+1);return s}return JSON.stringify(t(n,0),null,2)}function oe(n,e){let t={...n};for(let[r,a]of Object.entries(e))if(t[r]==null)t[r]=a;else{if(a==null)continue;if(typeof t[r]!=typeof a||Array.isArray(t[r])!==Array.isArray(a))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=a}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=oe(t[r],a);else if(Array.isArray(t[r]))t[r]=ui(t[r],a);else{if(t[r]===a)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function ui(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{let t=[...n];for(let r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){let a=t.findIndex(s=>s.index===r.index);a!==-1?t[a]=oe(t[a],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}function jg(n,e){if(!n&&!e)throw new Error("Cannot merge two undefined objects.");if(!n||!e)return n||e;if(typeof n!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof n}
Right ${typeof e}`);if(typeof n=="string"&&typeof e=="string")return n+e;if(Array.isArray(n)&&Array.isArray(e))return ui(n,e);if(typeof n=="object"&&typeof e=="object")return oe(n,e);if(n===e)return n;throw new Error(`Can not merge objects of different types.
Left ${n}
Right ${e}`)}function Mg(n){return typeof n.role=="string"}function Mr(n){return typeof n?._getType=="function"}function Lg(n){return Mr(n)&&typeof n.concat=="function"}var he,He,xt=g(()=>{ii();he=class extends vt{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;let t=$A(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}};He=class extends he{}});function Dg(n){let e=[],t=[];for(let r of n)if(r.function){let a=r.function.name;try{let s=JSON.parse(r.function.arguments),i={name:a||"",args:s||{},id:r.id};e.push(i)}catch{t.push({name:a,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}var lr,Ra,Na=g(()=>{xt();lr=class extends he{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},Ra=class n extends He{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new n({content:pt(this.content,e.content),additional_kwargs:oe(this.additional_kwargs,e.additional_kwargs),response_metadata:oe(this.response_metadata,e.response_metadata),artifact:jg(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:$g(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}});function li(n){return n._getType()==="ai"}var Xe,ft,Nn=g(()=>{Bc();xt();Na();Xe=class extends he{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;let a=r.additional_kwargs?.tool_calls,s=r.tool_calls;a!=null&&a.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&s===void 0){let[i,o]=Dg(a);r.tool_calls=i??[],r.invalid_tool_calls=o??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}};ft=class n extends He{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]};else{let r=[],a=[];for(let s of e.tool_call_chunks){let i={};try{if(i=ka(s.args||"{}"),i===null||typeof i!="object"||Array.isArray(i))throw new Error("Malformed tool call chunk args.");r.push({name:s.name??"",args:i,id:s.id,type:"tool_call"})}catch{a.push({name:s.name,args:s.args,id:s.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:a}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){let t={content:pt(this.content,e.content),additional_kwargs:oe(this.additional_kwargs,e.additional_kwargs),response_metadata:oe(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){let r=ui(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){let r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s={input_tokens:r.input_tokens+a.input_tokens,output_tokens:r.output_tokens+a.output_tokens,total_tokens:r.total_tokens+a.total_tokens};t.usage_metadata=s}return new n(t)}}});var At,$n,su=g(()=>{xt();At=class n extends he{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return n}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},$n=class n extends He{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new n({content:pt(this.content,e.content),additional_kwargs:oe(this.additional_kwargs,e.additional_kwargs),response_metadata:oe(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}});var jn,iu=g(()=>{xt();jn=class n extends He{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new n({content:pt(this.content,e.content),additional_kwargs:oe(this.additional_kwargs,e.additional_kwargs),response_metadata:oe(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}});var Ke,Mn,ci=g(()=>{xt();Ke=class extends he{static lc_name(){return"HumanMessage"}_getType(){return"human"}},Mn=class n extends He{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new n({content:pt(this.content,e.content),additional_kwargs:oe(this.additional_kwargs,e.additional_kwargs),response_metadata:oe(this.response_metadata,e.response_metadata),id:this.id??e.id})}}});var Ln,Dn,ou=g(()=>{xt();Ln=class extends he{static lc_name(){return"SystemMessage"}_getType(){return"system"}},Dn=class n extends He{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new n({content:pt(this.content,e.content),additional_kwargs:oe(this.additional_kwargs,e.additional_kwargs),response_metadata:oe(this.response_metadata,e.response_metadata),id:this.id??e.id})}}});function MA(n){return Ca(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function qc(n){let{type:e,...t}=n;if(e==="human"||e==="user")return new Ke(t);if(e==="ai"||e==="assistant"){let{tool_calls:r,...a}=t;if(!Array.isArray(r))return new Xe(t);let s=r.map(MA);return new Xe({...a,tool_calls:s})}else{if(e==="system")return new Ln(t);if(e==="tool"&&"tool_call_id"in t)return new lr({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw new Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}}function Et(n){if(typeof n=="string")return new Ke(n);if(Mr(n))return n;if(Array.isArray(n)){let[e,t]=n;return qc({type:e,content:t})}else if(Mg(n)){let{role:e,...t}=n;return qc({...t,type:e})}else return qc(n)}function di(n,e="Human",t="AI"){let r=[];for(let a of n){let s;if(a._getType()==="human")s=e;else if(a._getType()==="ai")s=t;else if(a._getType()==="system")s="System";else if(a._getType()==="function")s="Function";else if(a._getType()==="tool")s="Tool";else if(a._getType()==="generic")s=a.role;else throw new Error(`Got unsupported message type: ${a._getType()}`);let i=a.name?`${a.name}, `:"",o=typeof a.content=="string"?a.content:JSON.stringify(a.content,null,2);r.push(`${s}: ${i}${o}`)}return r.join(`
`)}function Vc(n){let e=n._getType();if(e==="human")return new Mn({...n});if(e==="ai"){let t={...n};return"tool_calls"in t&&(t={...t,tool_call_chunks:t.tool_calls?.map(r=>({...r,type:"tool_call_chunk",index:void 0,args:JSON.stringify(r.args)}))}),new ft({...t})}else{if(e==="system")return new Dn({...n});if(e==="function")return new jn({...n});if(At.isInstance(n))return new $n({...n});throw new Error("Unknown message type.")}}var Lr=g(()=>{au();Nn();xt();su();iu();ci();ou();Na()});var Fg=g(()=>{Ko()});var $a,Ug=g(()=>{Fc();Fg();Cc();Pa();Rn();$a=class n extends ct{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:a}=e;this.projectName=r??te("LANGCHAIN_PROJECT")??te("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??new Tn({});let s=n.getTraceableRunTree();s&&this.updateFromRunTree(s)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await Pg()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e,r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();let a=[t];for(;a.length>0;){let s=a.shift();!s||r.has(s.id)||(r.add(s.id),this.runMap.set(s.id,s),s.child_runs&&a.push(...s.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){let t={},r=[];for(let[a,s]of this.runMap){let i=new Rr({...s,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[a]=i,r.push([a,s.dotted_order])}r.sort((a,s)=>!a[1]||!s[1]?0:a[1].localeCompare(s[1]));for(let[a]of r){let s=this.runMap.get(a),i=t[a];if(!(!s||!i)&&s.parent_run_id){let o=t[s.parent_run_id];o&&(o.child_runs.push(i),i.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return ig()}catch{return}}}});function LA(){let n="default"in uu.default?uu.default.default:uu.default;return new n({autoStart:!0,concurrency:1})}async function le(n,e){e===!0?await n():(typeof Hc>"u"&&(Hc=LA()),Hc.add(n))}var uu,Hc,zg=g(()=>{uu=nt(Oo(),1)});var Kc,Bg=g(()=>{Pa();Kc=n=>n!==void 0?n:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>te(t)==="true")});function qg(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}function pi(n){return"name"in n?n:kn.fromMethods(n)}var Gc,ja,Jc,lu,Wc,Zc,Ae,Ma=g(()=>{Gs();Lc();Ng();Lr();Pa();Ug();zg();Bg();Rn();Kc()&&te("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"&&["[WARN]: You have enabled LangSmith tracing without backgrounding callbacks.","[WARN]: If you are not using a serverless environment where you must wait for tracing calls to finish,",'[WARN]: we suggest setting "process.env.LANGCHAIN_CALLBACKS_BACKGROUND=true" to avoid additional latency.'].join(`
`);Gc=class{setHandler(e){return this.setHandlers([e])}},ja=class{constructor(e,t,r,a,s,i,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>le(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,a,s){await Promise.all(this.handlers.map(i=>le(async()=>{try{await i.handleCustomEvent?.(e,t,this.runId,this.tags,this.metadata)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}},Jc=class extends ja{getChild(e){let t=new Ae(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw r}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${r}`),t.raiseError)throw e}},t.awaitHandlers)))}},lu=class extends ja{async handleLLMNewToken(e,t,r,a,s,i){await Promise.all(this.handlers.map(o=>le(async()=>{if(!o.ignoreLLM)try{await o.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i)}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},Wc=class extends ja{getChild(e){let t=new Ae(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,s){await Promise.all(this.handlers.map(i=>le(async()=>{if(!i.ignoreChain)try{await i.handleChainError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleChainEnd(e,t,r,a,s){await Promise.all(this.handlers.map(i=>le(async()=>{if(!i.ignoreChain)try{await i.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},Zc=class extends ja{getChild(e){let t=new Ae(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>le(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${r}`),t.raiseError)throw r}},t.awaitHandlers)))}},Ae=class n extends Gc{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,a=void 0,s=void 0,i=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(l,c)=>{let d=c===0&&r?r:qe();return await Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return Ta(p)&&p._createRunForLLMStart(e,[l],d,this._parentRunId,s,this.tags,this.metadata,u),le(async()=>{try{await p.handleLLMStart?.(e,[l],d,this._parentRunId,s,this.tags,this.metadata,u)}catch(f){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${f}`),p.raiseError)throw f}},p.awaitHandlers)})),new lu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,a=void 0,s=void 0,i=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(l,c)=>{let d=c===0&&r?r:qe();return await Promise.all(this.handlers.map(p=>{if(!p.ignoreLLM)return Ta(p)&&p._createRunForChatModelStart(e,[l],d,this._parentRunId,s,this.tags,this.metadata,u),le(async()=>{try{if(p.handleChatModelStart)await p.handleChatModelStart?.(e,[l],d,this._parentRunId,s,this.tags,this.metadata,u);else if(p.handleLLMStart){let f=di(l);await p.handleLLMStart?.(e,[f],d,this._parentRunId,s,this.tags,this.metadata,u)}}catch(f){if((p.raiseError?console.error:console.warn)(`Error in handler ${p.constructor.name}, handleLLMStart: ${f}`),p.raiseError)throw f}},p.awaitHandlers)})),new lu(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=qe(),a=void 0,s=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return Ta(u)&&u._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,a,o),le(async()=>{try{await u.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a,o)}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new Wc(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=qe(),a=void 0,s=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Ta(u)&&u._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),le(async()=>{try{await u.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new Zc(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=qe(),a=void 0,s=void 0,i=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Ta(u)&&u._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),le(async()=>{try{await u.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,o)}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new Jc(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,a,s){await Promise.all(this.handlers.map(i=>le(async()=>{if(!i.ignoreCustomEvent)try{await i.handleCustomEvent?.(e,t,r,this.tags,this.metadata)}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(let r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new n(this._parentRunId);for(let a of this.handlers){let s=this.inheritableHandlers.includes(a);r.addHandler(a,s)}for(let a of this.tags){let s=this.inheritableTags.includes(a);r.addTags([a],s)}for(let a of Object.keys(this.metadata)){let s=Object.keys(this.inheritableMetadata).includes(a);r.addMetadata({[a]:this.metadata[a]},s)}for(let a of e)r.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends kn{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:qe()}),Object.assign(this,e)}}let r=new this;return r.addHandler(new t),r}static async configure(e,t,r,a,s,i,o){return this._configureSync(e,t,r,a,s,i,o)}static _configureSync(e,t,r,a,s,i,o){let u;(e||t)&&(Array.isArray(e)||!e?(u=new n,u.setHandlers(e?.map(pi)??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(pi):t?.handlers,!1));let l=te("LANGCHAIN_VERBOSE")==="true"||o?.verbose,c=$a.getTraceableRunTree()?.tracingEnabled||Kc(),d=c||(te("LANGCHAIN_TRACING")??!1);if(l||d){if(u||(u=new n),l&&!u.handlers.some(p=>p.name===oi.prototype.name)){let p=new oi;u.addHandler(p,!0)}if(d&&!u.handlers.some(p=>p.name==="langchain_tracer")&&c){let p=new $a;u.addHandler(p,!0),u._parentRunId=$a.getTraceableRunTree()?.id??u._parentRunId}}return(r||a)&&u&&(u.addTags(r??[]),u.addTags(a??[],!1)),(s||i)&&u&&(u.addMetadata(s??{}),u.addMetadata(i??{},!1)),u}}});var Yc,DA,Xc,Vg,Qc,ht,La=g(()=>{Fc();Ma();Yc=class{getStore(){}run(e,t){return t()}},DA=new Yc,Xc=Symbol.for("ls:tracing_async_local_storage"),Vg=Symbol.for("lc:child_config"),Qc=class{getInstance(){return globalThis[Xc]??DA}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[Vg]}runWithConfig(e,t,r){let a=Ae._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),s=this.getInstance(),i=a?.getParentRunId(),o=a?.handlers?.find(l=>l?.name==="langchain_tracer"),u;return o&&i?u=o.convertToRunTree(i):r||(u=new Rr({name:"<runnable_lambda>",tracingEnabled:!1})),u&&(u.extra={...u.extra,[Vg]:e}),s.run(u,t)}initializeGlobalInstance(e){globalThis[Xc]===void 0&&(globalThis[Xc]=e)}},ht=new Qc});async function Bt(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!e?.aborted)throw r}),new Promise((r,a)=>{t=()=>{a(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&a(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}var ed=g(()=>{});function td(n,e=2){let t=Array.from({length:e},()=>[]);return t.map(async function*(a){for(;;)if(a.length===0){let s=await n.next();for(let i of t)i.push(s)}else{if(a[0].done)return;yield a.shift().value}})}function Re(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){let t={...n};for(let[r,a]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=Re(t[r],a):t[r]=a;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}async function Hg(n,e,t,r,...a){let s=new cr({generator:e,startSetup:t,signal:r}),i=await s.setup;return{output:n(s,i,...a),setup:i}}var ke,cr,dr=g(()=>{La();ed();ke=class n extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){let t=e.getReader();return new n({start(r){return a();function a(){return t.read().then(({done:s,value:i})=>{if(s){r.close();return}return r.enqueue(i),a()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new n({async pull(t){let{value:r,done:a}=await e.next();a&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}};cr=class{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((t,r)=>{ht.runWithConfig(e.config,async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(t,r):this.firstResult.then(a=>t(void 0),r)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?ht.runWithConfig(this.config,this.signal?async()=>Bt(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}});async function Kg(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&t?.input===""))return t.input}async function Gg(n,e){let{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&t?.output!==void 0?t.output:t}function FA(n){return n!==void 0&&n.message!==void 0}var Ot,fi,mi,hi,cu=g(()=>{Rc();Rn();dr();Nn();Ot=class{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=$r({},t);return new fi({ops:t,state:r[r.length-1].newDocument})}},fi=class n extends Ot{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=$r(this.state,e.ops);return new n({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=$r({},e.ops);return new n({ops:e.ops,state:t[t.length-1].newDocument})}},mi=n=>n.name==="log_stream_tracer";hi=class extends ct{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ke.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(a=>this.includeTags?.includes(a))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(a=>!this.excludeTags?.includes(a))),r}async*tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let a=this.keyMapByRunId[e];a&&await this.writer.write(new Ot({ops:[{op:"add",path:`/logs/${a}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Ot({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await Kg(e,this._schemaFormat)),await this.writer.write(new Ot({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(t===void 0)return;let r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await Kg(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await Gg(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let a=new Ot({ops:r});await this.writer.write(a)}finally{if(e.id===this.rootId){let t=new Ot({ops:[{op:"replace",path:"/final_output",value:await Gg(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let a=this.keyMapByRunId[e.id];if(a===void 0)return;let s=e.inputs.messages!==void 0,i;s?FA(r?.chunk)?i=r?.chunk:i=new ft({id:`run-${e.id}`,content:t}):i=t;let o=new Ot({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${a}/streamed_output/-`,value:i}]});await this.writer.write(o)}}});var du,It,Dr,Da=g(()=>{du="__run",It=class n{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},Dr=class n extends It{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new n({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}});function pu({name:n,serialized:e}){return n!==void 0?n:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}var gi,fu,hu=g(()=>{Rn();dr();Nn();Da();gi=n=>n.name==="event_stream_tracer",fu=class extends ct{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ke.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){let t=e.tags??[],r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(a=>this.includeTags?.includes(a))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(a=>!this.excludeTags?.includes(a))),r}async*tapOutputIterable(e,t){let r=await t.next();if(r.done)return;let a=this.runInfoMap.get(e);if(a===void 0){yield r.value;return}function s(o,u){return o==="llm"&&typeof u=="string"?new It({text:u}):u}let i=this.tappedPromises.get(e);if(i===void 0){let o;i=new Promise(u=>{o=u}),this.tappedPromises.set(e,i);try{let u={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};await this.send({...u,data:{chunk:s(a.runType,r.value)}},a),yield r.value;for await(let l of t)a.runType!=="tool"&&a.runType!=="retriever"&&await this.send({...u,data:{chunk:s(a.runType,l)}},a),yield l}finally{o()}}else{yield r.value;for await(let o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){let r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){let t=pu(e),r=e.inputs.messages!==void 0?"chat_model":"llm",a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,a);let s=`on_${r}_start`;await this.send({event:s,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)}async onLLMNewToken(e,t,r){let a=this.runInfoMap.get(e.id),s,i;if(a===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(a.runType==="chat_model")i="on_chat_model_stream",r?.chunk===void 0?s=new ft({content:t,id:`run-${e.id}`}):s=r.chunk.message;else if(a.runType==="llm")i="on_llm_stream",r?.chunk===void 0?s=new It({text:t}):s=r.chunk;else throw new Error(`Unexpected run type ${a.runType}`);await this.send({event:i,data:{chunk:s},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){let t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);let a=e.outputs?.generations,s;if(t.runType==="chat_model"){for(let i of a??[]){if(s!==void 0)break;s=i[0]?.message}r="on_chat_model_end"}else if(t.runType==="llm")s={generations:a?.map(i=>i.map(o=>({text:o.text,generationInfo:o.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:s,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){let t=pu(e),r=e.run_type??"chain",a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:e.run_type},s={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(s={},a.inputs={}):e.inputs.input!==void 0?(s.input=e.inputs.input,a.inputs=e.inputs.input):(s.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${r}_start`,data:s,name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)}async onChainEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);let r=`on_${e.run_type}_end`,a=e.inputs??t.inputs??{},i={output:e.outputs?.output??e.outputs,input:a};a.input&&Object.keys(a).length===1&&(i.input=a.input,t.inputs=a.input),await this.sendEndEvent({event:r,data:i,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){let t=pu(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);let r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){let t=pu(e),a={tags:e.tags??[],metadata:e.extra?.metadata??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,a),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},a)}async onRetrieverEnd(e){let t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){let a=this.runInfoMap.get(r);if(a===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:a.tags,metadata:a.metadata,data:t},a)}async finish(){let e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}});async function Ge(n){return Ae._configureSync(n?.callbacks,void 0,n?.tags,void 0,n?.metadata)}function gu(...n){let e={};for(let t of n.filter(r=>!!r))for(let r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){let a=e[r]??[];e[r]=[...new Set(a.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){let a=e.callbacks,s=t.callbacks;if(Array.isArray(s))if(!a)e.callbacks=s;else if(Array.isArray(a))e.callbacks=a.concat(s);else{let i=a.copy();for(let o of s)i.addHandler(pi(o),!0);e.callbacks=i}else if(s)if(!a)e.callbacks=s;else if(Array.isArray(a)){let i=s.copy();for(let o of a)i.addHandler(pi(o),!0);e.callbacks=i}else e.callbacks=new Ae(s._parentRunId,{handlers:a.handlers.concat(s.handlers),inheritableHandlers:a.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(s.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(s.inheritableTags))),metadata:{...a.metadata,...s.metadata}})}else{let a=r;e[a]=t[a]??e[a]}return e}function G(n){let e=ht.getRunnableConfig(),t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){let{runId:r,runName:a,...s}=e;t=Object.entries(s).reduce((i,[o,u])=>(u!==void 0&&(i[o]=u),i),t)}if(n&&(t=Object.entries(n).reduce((r,[a,s])=>(s!==void 0&&(r[a]=s),r),t)),t?.configurable)for(let r of Object.keys(t.configurable))UA.has(typeof t.configurable[r])&&!t.metadata?.[r]&&(t.metadata||(t.metadata={}),t.metadata[r]=t.configurable[r]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");let r=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,r])):t.signal=r,delete t.timeout}return t}function ce(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:a,configurable:s,runId:i}={}){let o=G(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),a!==void 0&&(o.runName=a),s!==void 0&&(o.configurable={...o.configurable,...s}),i!==void 0&&delete o.runId,o}var mu,UA,Fn=g(()=>{Ma();La();mu=25;UA=new Set(["string","number","boolean"])});var Jg,yu,zA,BA,pr,yi=g(()=>{Jg=nt(mo(),1),yu=nt(Oo(),1),zA=[400,401,402,403,404,405,406,407,409],BA=n=>{if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||n?.code==="ECONNABORTED")throw n;let e=n?.response?.status??n?.status;if(e&&zA.includes(+e))throw n;if(n?.error?.code==="insufficient_quota"){let t=new Error(n?.message);throw t.name="InsufficientQuotaError",t}},pr=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??BA;let t="default"in yu.default?yu.default.default:yu.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>(0,Jg.default)(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}});var bi,Wg=g(()=>{Rn();bi=class extends ct{constructor({config:e,onStart:t,onEnd:r,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}}});function _i(n){return n?n.lc_runnable:!1}var bu,rd=g(()=>{bu=class{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0,a=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||a.some(s=>this.includeTags?.includes(s))),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&a.every(s=>!this.excludeTags?.includes(s))),r}}});var Xg,Zg,Yg,_u=g(()=>{Xg=Symbol("Let zodToJsonSchema decide on which parser to use"),Zg={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},Yg=n=>typeof n=="string"?{...Zg,name:n}:{...Zg,...n}});var Qg,nd=g(()=>{_u();Qg=n=>{let e=Yg(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}}});function ad(n,e,t,r){r?.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function J(n,e,t,r,a){n[e]=t,ad(n,e,r,a)}var Fr=g(()=>{});var wu,vu=g(()=>{wu=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")}});var xu=g(()=>{co()});function re(n){if(n.target!=="openAi")return{};let e=[...n.basePath,n.definitionPath,n.openAiAnyTypeName];return n.flags.hasReferencedOpenAiAnyType=!0,{$ref:n.$refStrategy==="relative"?wu(e,n.currentPath):e.join("/")}}var mt=g(()=>{vu()});function ey(n,e){let t={type:"array"};return n.type?._def&&n.type?._def?.typeName!==w.ZodAny&&(t.items=M(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&J(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&J(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(J(t,"minItems",n.exactLength.value,n.exactLength.message,e),J(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}var sd=g(()=>{xu();Fr();de()});function ty(n,e){let t={type:"integer",format:"int64"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?J(t,"minimum",r.value,r.message,e):J(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),J(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?J(t,"maximum",r.value,r.message,e):J(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),J(t,"maximum",r.value,r.message,e));break;case"multipleOf":J(t,"multipleOf",r.value,r.message,e);break}return t}var id=g(()=>{Fr()});function ry(){return{type:"boolean"}}var od=g(()=>{});function Au(n,e){return M(n.type._def,e)}var Eu=g(()=>{de()});var ny,ud=g(()=>{de();ny=(n,e)=>M(n.innerType._def,e)});function ld(n,e,t){let r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,s)=>ld(n,e,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return qA(n,e)}}var qA,cd=g(()=>{Fr();qA=(n,e)=>{let t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(let r of n.checks)switch(r.kind){case"min":J(t,"minimum",r.value,r.message,e);break;case"max":J(t,"maximum",r.value,r.message,e);break}return t}});function ay(n,e){return{...M(n.innerType._def,e),default:n.defaultValue()}}var dd=g(()=>{de()});function sy(n,e){return e.effectStrategy==="input"?M(n.schema._def,e):re(e)}var pd=g(()=>{de();mt()});function iy(n){return{type:"string",enum:Array.from(n.values)}}var fd=g(()=>{});function oy(n,e){let t=[M(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),M(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0,a=[];return t.forEach(s=>{if(VA(s))a.push(...s.allOf),s.unevaluatedProperties===void 0&&(r=void 0);else{let i=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:o,...u}=s;i=u}else r=void 0;a.push(i)}}),a.length?{allOf:a,...r}:void 0}var VA,hd=g(()=>{de();VA=n=>"type"in n&&n.type==="string"?!1:"allOf"in n});function uy(n,e){let t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}var md=g(()=>{});function Ou(n,e){let t={type:"string"};if(n.checks)for(let r of n.checks)switch(r.kind){case"min":J(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":J(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Tt(t,"email",r.message,e);break;case"format:idn-email":Tt(t,"idn-email",r.message,e);break;case"pattern:zod":De(t,Pt.email,r.message,e);break}break;case"url":Tt(t,"uri",r.message,e);break;case"uuid":Tt(t,"uuid",r.message,e);break;case"regex":De(t,r.regex,r.message,e);break;case"cuid":De(t,Pt.cuid,r.message,e);break;case"cuid2":De(t,Pt.cuid2,r.message,e);break;case"startsWith":De(t,RegExp(`^${yd(r.value,e)}`),r.message,e);break;case"endsWith":De(t,RegExp(`${yd(r.value,e)}$`),r.message,e);break;case"datetime":Tt(t,"date-time",r.message,e);break;case"date":Tt(t,"date",r.message,e);break;case"time":Tt(t,"time",r.message,e);break;case"duration":Tt(t,"duration",r.message,e);break;case"length":J(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),J(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{De(t,RegExp(yd(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Tt(t,"ipv4",r.message,e),r.version!=="v4"&&Tt(t,"ipv6",r.message,e);break}case"base64url":De(t,Pt.base64url,r.message,e);break;case"jwt":De(t,Pt.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&De(t,Pt.ipv4Cidr,r.message,e),r.version!=="v4"&&De(t,Pt.ipv6Cidr,r.message,e);break}case"emoji":De(t,Pt.emoji(),r.message,e);break;case"ulid":{De(t,Pt.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Tt(t,"binary",r.message,e);break}case"contentEncoding:base64":{J(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{De(t,Pt.base64,r.message,e);break}}break}case"nanoid":De(t,Pt.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return t}function yd(n,e){return e.patternStrategy==="escape"?KA(n):n}function KA(n){let e="";for(let t=0;t<n.length;t++)HA.has(n[t])||(e+="\\"),e+=n[t];return e}function Tt(n,e,t,r){n.format||n.anyOf?.some(a=>a.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):J(n,"format",e,t,r)}function De(n,e,t,r){n.pattern||n.allOf?.some(a=>a.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:ly(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):J(n,"pattern",ly(e,r),t,r)}function ly(n,e){if(!e.applyRegexFlags||!n.flags)return n.source;let t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source,a="",s=!1,i=!1,o=!1;for(let u=0;u<r.length;u++){if(s){a+=r[u],s=!1;continue}if(t.i){if(i){if(r[u].match(/[a-z]/)){o?(a+=r[u],a+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&r[u+2]?.match(/[a-z]/)?(a+=r[u],o=!0):a+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){a+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(t.m){if(r[u]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){a+=`($|(?=[\r
]))`;continue}}if(t.s&&r[u]==="."){a+=i?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}a+=r[u],r[u]==="\\"?s=!0:i&&r[u]==="]"?i=!1:!i&&r[u]==="["&&(i=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return a}var gd,Pt,HA,Iu=g(()=>{Fr();Pt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(gd===void 0&&(gd=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),gd),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};HA=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789")});function Pu(n,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&n.keyType?._def.typeName===w.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((r,a)=>({...r,[a]:M(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",a]})??re(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};let t={type:"object",additionalProperties:M(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(n.keyType?._def.typeName===w.ZodString&&n.keyType._def.checks?.length){let{type:r,...a}=Ou(n.keyType._def,e);return{...t,propertyNames:a}}else{if(n.keyType?._def.typeName===w.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(n.keyType?._def.typeName===w.ZodBranded&&n.keyType._def.type._def.typeName===w.ZodString&&n.keyType._def.type._def.checks?.length){let{type:r,...a}=Au(n.keyType._def,e);return{...t,propertyNames:a}}}return t}var Tu=g(()=>{xu();de();Iu();Eu();mt()});function cy(n,e){if(e.mapStrategy==="record")return Pu(n,e);let t=M(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||re(e),r=M(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||re(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}var bd=g(()=>{de();Tu();mt()});function dy(n){let e=n.values,r=Object.keys(n.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),a=Array.from(new Set(r.map(s=>typeof s)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}var _d=g(()=>{});function py(n){return n.target==="openAi"?void 0:{not:re({...n,currentPath:[...n.currentPath,"not"]})}}var wd=g(()=>{mt()});function fy(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}var vd=g(()=>{});function my(n,e){if(e.target==="openApi3")return hy(n,e);let t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in wi&&(!r._def.checks||!r._def.checks.length))){let r=t.reduce((a,s)=>{let i=wi[s._def.typeName];return i&&!a.includes(i)?[...a,i]:a},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=t.reduce((a,s)=>{let i=typeof s._def.value;switch(i){case"string":case"number":case"boolean":return[...a,i];case"bigint":return[...a,"integer"];case"object":if(s._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===t.length){let a=r.filter((s,i,o)=>o.indexOf(s)===i);return{type:a.length>1?a:a[0],enum:t.reduce((s,i)=>s.includes(i._def.value)?s:[...s,i._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,a)=>[...r,...a._def.values.filter(s=>!r.includes(s))],[])};return hy(n,e)}var wi,hy,Su=g(()=>{de();wi={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};hy=(n,e)=>{let t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,a)=>M(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0}});function gy(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:wi[n.innerType._def.typeName],nullable:!0}:{type:[wi[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){let r=M(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let t=M(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}var xd=g(()=>{de();Su()});function yy(n,e){let t={type:"number"};if(!n.checks)return t;for(let r of n.checks)switch(r.kind){case"int":t.type="integer",ad(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?J(t,"minimum",r.value,r.message,e):J(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),J(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?J(t,"maximum",r.value,r.message,e):J(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),J(t,"maximum",r.value,r.message,e));break;case"multipleOf":J(t,"multipleOf",r.value,r.message,e);break}return t}var Ad=g(()=>{Fr()});function by(n,e){let t=e.target==="openAi",r={type:"object",properties:{}},a=[],s=n.shape();for(let o in s){let u=s[o];if(u===void 0||u._def===void 0)continue;let l=JA(u);l&&t&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);let c=M(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(r.properties[o]=c,l||a.push(o))}a.length&&(r.required=a);let i=GA(n,e);return i!==void 0&&(r.additionalProperties=i),r}function GA(n,e){if(n.catchall._def.typeName!=="ZodNever")return M(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function JA(n){try{return n.isOptional()}catch{return!0}}var Ed=g(()=>{de()});var _y,Od=g(()=>{de();mt();_y=(n,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return M(n.innerType._def,e);let t=M(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:re(e)},t]}:re(e)}});var wy,Id=g(()=>{de();wy=(n,e)=>{if(e.pipeStrategy==="input")return M(n.in._def,e);if(e.pipeStrategy==="output")return M(n.out._def,e);let t=M(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=M(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(a=>a!==void 0)}}});function vy(n,e){return M(n.type._def,e)}var Pd=g(()=>{de()});function xy(n,e){let r={type:"array",uniqueItems:!0,items:M(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&J(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&J(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}var Td=g(()=>{Fr();de()});function Ay(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>M(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:M(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>M(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}var Sd=g(()=>{de()});function Ey(n){return{not:re(n)}}var Cd=g(()=>{mt()});function Oy(n){return re(n)}var kd=g(()=>{mt()});var Iy,Rd=g(()=>{de();Iy=(n,e)=>M(n.innerType._def,e)});var Py,Nd=g(()=>{xu();mt();sd();id();od();Eu();ud();cd();dd();pd();fd();hd();md();bd();_d();wd();vd();xd();Ad();Ed();Od();Id();Pd();Tu();Td();Iu();Sd();Cd();Su();kd();Rd();Py=(n,e,t)=>{switch(e){case w.ZodString:return Ou(n,t);case w.ZodNumber:return yy(n,t);case w.ZodObject:return by(n,t);case w.ZodBigInt:return ty(n,t);case w.ZodBoolean:return ry();case w.ZodDate:return ld(n,t);case w.ZodUndefined:return Ey(t);case w.ZodNull:return fy(t);case w.ZodArray:return ey(n,t);case w.ZodUnion:case w.ZodDiscriminatedUnion:return my(n,t);case w.ZodIntersection:return oy(n,t);case w.ZodTuple:return Ay(n,t);case w.ZodRecord:return Pu(n,t);case w.ZodLiteral:return uy(n,t);case w.ZodEnum:return iy(n);case w.ZodNativeEnum:return dy(n);case w.ZodNullable:return gy(n,t);case w.ZodOptional:return _y(n,t);case w.ZodMap:return cy(n,t);case w.ZodSet:return xy(n,t);case w.ZodLazy:return()=>n.getter()._def;case w.ZodPromise:return vy(n,t);case w.ZodNaN:case w.ZodNever:return py(t);case w.ZodEffects:return sy(n,t);case w.ZodAny:return re(t);case w.ZodUnknown:return Oy(t);case w.ZodDefault:return ay(n,t);case w.ZodBranded:return Au(n,t);case w.ZodReadonly:return Iy(n,t);case w.ZodCatch:return ny(n,t);case w.ZodPipeline:return wy(n,t);case w.ZodFunction:case w.ZodVoid:case w.ZodSymbol:return;default:return(r=>{})(e)}}});function M(n,e,t=!1){let r=e.seen.get(n);if(e.override){let o=e.override?.(n,e,r,t);if(o!==Xg)return o}if(r&&!t){let o=WA(r,e);if(o!==void 0)return o}let a={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,a);let s=Py(n,n.typeName,e),i=typeof s=="function"?M(s(),e):s;if(i&&ZA(n,e,i),e.postProcess){let o=e.postProcess(i,n,e);return a.jsonSchema=i,o}return a.jsonSchema=i,i}var WA,ZA,de=g(()=>{_u();Nd();vu();mt();WA=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:wu(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),re(e)):e.$refStrategy==="seen"?re(e):void 0}},ZA=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t)});var Ty=g(()=>{});var gt,$d=g(()=>{de();nd();mt();gt=(n,e)=>{let t=Qg(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((u,[l,c])=>({...u,[l]:M(c._def,{...t,currentPath:[...t.basePath,t.definitionPath,l]},!0)??re(t)}),{}):void 0,a=typeof e=="string"?e:e?.nameStrategy==="title"?void 0:e?.name,s=M(n._def,a===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,a]},!1)??re(t),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i),t.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[t.openAiAnyTypeName]||(r[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));let o=a===void 0?r?{...s,[t.definitionPath]:r}:s:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,a].join("/"),[t.definitionPath]:{...r,[a]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o}});var Un=g(()=>{_u();nd();Fr();vu();de();Ty();mt();sd();id();od();Eu();ud();cd();dd();pd();fd();hd();md();bd();_d();wd();vd();xd();Ad();Ed();Od();Id();Pd();Rd();Tu();Td();Iu();Sd();Cd();Su();kd();Nd();$d();$d()});function jd(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}function XA(n,e){let t=e[n.source]??n.source,r=e[n.target]??n.target;return[t,r]}function YA(n){let e="";for(let[t,r]of Object.entries(n))e+=`	classDef ${t}class fill:${r};
`;return e}function Sy(n,e,t){let{firstNodeLabel:r,lastNodeLabel:a,nodeColors:s,withStyles:i=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{},l=i?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(i){let d="default",p={[d]:"{0}([{1}]):::otherclass"};r!==void 0&&(p[r]="{0}[{0}]:::startclass"),a!==void 0&&(p[a]="{0}[{0}]:::endclass");for(let f of Object.values(n)){let h=p[f]??p[d],m=jd(f),y=f.split(":"),x=y[y.length-1];l+=`	${h.replace(/\{0\}/g,m).replace(/\{1\}/g,x)};
`}}let c="";for(let d of e){let p=d.source.includes(":")?d.source.split(":")[0]:void 0,f=d.target.includes(":")?d.target.split(":")[0]:void 0;c!==""&&(c!==p||c!==f)&&(l+=`	end
`,c=""),c===""&&p!==void 0&&p===f&&(l=`	subgraph ${p}
`,c=p);let[h,m]=XA(d,n),y="";if(d.data!==void 0){let x=d.data,v=x.split(" ");v.length>u&&(x=v.reduce((P,j,N)=>(N%u===0&&P.push(""),P[P.length-1]+=` ${j}`,P),[]).join("<br>")),d.conditional?y=` -. ${x} .-> `:y=` -- ${x} --> `}else d.conditional?y=" -.-> ":y=" --> ";l+=`	${jd(h)}${y}${jd(m)};
`}return c!==""&&(l+=`end
`),i&&s!==void 0&&(l+=YA(s)),l}async function Cy(n,e){let{backgroundColor:t="white"}=e??{},r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));let a=`https://mermaid.ink/img/${r}?bgColor=${t}`,s=await fetch(a);if(!s.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${s.status}`,`Status text: ${s.statusText}`].join(`
`));return await s.blob()}var ky=g(()=>{});function Md(n){if(Ks(n.id))if(_i(n.data))try{let e=n.data.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e.length>Ry&&(e=`${e.substring(0,Ry)}...`),e}catch{return n.data.getName()}else return n.data.name??"UnknownSchema";else return n.id}function QA(n){return _i(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...gt(n.data.schema),title:n.data.name}}}var Ry,vi,Ny=g(()=>{Un();Gs();rd();ky();Ry=42;vi=class{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=Ks(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...QA(t)})),edges:this.edges.map(t=>{let r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);let r=t||qe(),a={id:r,data:e};return this.nodes[r]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,a){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);let s={source:e.id,target:t.id,data:r,conditional:a};return this.edges.push(s),s}firstNode(){let e=new Set(this.edges.map(r=>r.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){let e=new Set(this.edges.map(r=>r.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e,t=""){let r=t;Object.values(e.nodes).map(l=>l.id).every(Ks)&&(r="");let s=l=>r?`${r}:${l}`:l;Object.entries(e.nodes).forEach(([l,c])=>{this.nodes[s(l)]={...c,id:s(l)}});let i=e.edges.map(l=>({...l,source:s(l.source),target:s(l.target)}));this.edges=[...this.edges,...i];let o=e.firstNode(),u=e.lastNode();return[o?{id:s(o.id),data:o.data}:void 0,u?{id:s(u.id),data:u.data}:void 0]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}drawMermaid(e){let{withStyles:t,curveStyle:r,nodeColors:a={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:s}=e??{},i={};for(let d of Object.values(this.nodes))i[d.id]=Md(d);let o=this.firstNode(),u=o?Md(o):void 0,l=this.lastNode(),c=l?Md(l):void 0;return Sy(i,this.edges,{firstNodeLabel:u,lastNodeLabel:c,withStyles:t,curveStyle:r,nodeColors:a,wrapLabelNWords:s})}async drawMermaidPng(e){let t=this.drawMermaid(e);return Cy(t,{backgroundColor:e?.backgroundColor})}}});function $y(n){let e=new TextEncoder,t=new ReadableStream({async start(r){for await(let a of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(a)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return ke.fromReadableStream(t)}var jy=g(()=>{dr()});function Ld(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}function Cu(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*Dd(n,e){for(;;){let{value:t,done:r}=ht.runWithConfig(n,e.next.bind(e),!0);if(r)break;yield t}}async function*Fd(n,e){let t=e[Symbol.asyncIterator]();for(;;){let{value:r,done:a}=await ht.runWithConfig(n,t.next.bind(e),!0);if(a)break;yield r}}var My,Ly=g(()=>{La();My=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function"});function me(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}function eE(n){if(Wo(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}function fr(n){if(typeof n=="function")return new gr({func:n});if(X.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){let e={};for(let[t,r]of Object.entries(n))e[t]=fr(r);return new Ur({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}function tE(n,e){let t=e.name??n.getName(),r=e.description??e.schema?.description;return e.schema.constructor===Be.ZodString?new xi({name:t,description:r,schema:Be.object({input:Be.string()}).transform(a=>a.input),bound:n}):new xi({name:t,description:r,schema:e.schema,bound:n})}var Ud,X,hr,ku,Ru,mr,Ur,zd,gr,Nu,Fa,$u,xi,yt=g(()=>{po();Ud=nt(mo(),1);Gs();Cc();cu();hu();ii();dr();ed();Fn();yi();Wg();rd();La();Ny();jy();Ly();au();X=class extends vt{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new hr({bound:this,kwargs:e,config:{}})}map(){return new ku({bound:this})}withRetry(e){return new Ru({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new hr({bound:this,config:e,kwargs:{}})}withFallbacks(e){let t=Array.isArray(e)?e:e.fallbacks;return new Nu({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(G);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([a])=>a!=="runId"));return Array.from({length:t},(a,s)=>G(s===0?e:r))}return Array.from({length:t},()=>G(e))}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),s=a[0]?.maxConcurrency??r?.maxConcurrency,i=new pr({maxConcurrency:s,onFailedAttempt:u=>{throw u}}),o=e.map((u,l)=>i.call(async()=>{try{return await this.invoke(u,a[l])}catch(c){if(r?.returnExceptions)return c;throw c}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=G(t),a=new cr({generator:this._streamIterator(e,r),config:r});return await a.setup,ke.fromAsyncGenerator(a)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=G(e):t=G({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){let a=G(r),i=await(await Ge(a))?.handleChainStart(this.toJSON(),me(t,"input"),a.runId,a?.runType,void 0,void 0,a?.runName??this.getName());delete a.runId;let o;try{let u=e.call(this,t,a,i);o=await Bt(u,r?.signal)}catch(u){throw await i?.handleChainError(u),u}return await i?.handleChainEnd(me(o,"output")),o}async _batchWithConfig(e,t,r,a){let s=this._getOptionsList(r??{},t.length),i=await Promise.all(s.map(Ge)),o=await Promise.all(i.map(async(l,c)=>{let d=await l?.handleChainStart(this.toJSON(),me(t[c],"input"),s[c].runId,s[c].runType,void 0,void 0,s[c].runName??this.getName());return delete s[c].runId,d})),u;try{let l=e.call(this,t,s,o,a);u=await Bt(l,s?.[0]?.signal)}catch(l){throw await Promise.all(o.map(c=>c?.handleChainError(l))),l}return await Promise.all(o.map(l=>l?.handleChainEnd(me(u,"output")))),u}async*_transformStreamWithConfig(e,t,r){let a,s=!0,i,o=!0,u=G(r),l=await Ge(u);async function*c(){for await(let p of e){if(s)if(a===void 0)a=p;else try{a=Re(a,p)}catch{a=void 0,s=!1}yield p}}let d;try{let p=await Hg(t.bind(this),c(),async()=>l?.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),r?.signal,u);delete u.runId,d=p.setup;let f=d?.handlers.find(gi),h=p.output;f!==void 0&&d!==void 0&&(h=f.tapOutputIterable(d.runId,h));let m=d?.handlers.find(mi);m!==void 0&&d!==void 0&&(h=m.tapOutputIterable(d.runId,h));for await(let y of h)if(yield y,o)if(i===void 0)i=y;else try{i=Re(i,y)}catch{i=void 0,o=!1}}catch(p){throw await d?.handleChainError(p,void 0,void 0,void 0,{inputs:me(a,"input")}),p}await d?.handleChainEnd(i??{},void 0,void 0,void 0,{inputs:me(a,"input")})}getGraph(e){let t=new vi,r=t.addNode({name:`${this.getName()}Input`,schema:Be.any()}),a=t.addNode(this),s=t.addNode({name:`${this.getName()}Output`,schema:Be.any()});return t.addEdge(r,a),t.addEdge(a,s),t}pipe(e){return new mr({first:this,last:fr(e)})}pick(e){return this.pipe(new $u(e))}assign(e){return this.pipe(new Fa(new Ur({steps:e})))}async*transform(e,t){let r;for await(let a of e)r===void 0?r=a:r=Re(r,a);yield*this._streamIterator(r,G(t))}async*streamLog(e,t,r){let a=new hi({...r,autoClose:!1,_schemaFormat:"original"}),s=G(t);yield*this._streamLog(e,a,s)}async*_streamLog(e,t,r){let{callbacks:a}=r;if(a===void 0)r.callbacks=[t];else if(Array.isArray(a))r.callbacks=a.concat([t]);else{let u=a.copy();u.addHandler(t,!0),r.callbacks=u}let s=this.stream(e,r);async function i(){try{let u=await s;for await(let l of u){let c=new Ot({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await t.writer.write(c)}}finally{await t.writer.close()}}let o=i();try{for await(let u of t)yield u}finally{await o}}streamEvents(e,t,r){let a;if(t.version==="v1")a=this._streamEventsV1(e,t,r);else if(t.version==="v2")a=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?$y(a):ke.fromAsyncGenerator(a)}async*_streamEventsV2(e,t,r){let a=new fu({...r,autoClose:!1}),s=G(t),i=s.runId??qe();s.runId=i;let o=s.callbacks;if(o===void 0)s.callbacks=[a];else if(Array.isArray(o))s.callbacks=o.concat(a);else{let f=o.copy();f.addHandler(a,!0),s.callbacks=f}let u=this;async function l(){try{let f=await u.stream(e,s),h=a.tapOutputIterable(i,f);for await(let m of h);}finally{await a.finish()}}let c=l(),d=!1,p;try{for await(let f of a){if(!d){f.data.input=e,d=!0,p=f.run_id,yield f;continue}f.run_id===p&&f.event.endsWith("_end")&&f.data?.input&&delete f.data.input,yield f}}finally{await c}}async*_streamEventsV1(e,t,r){let a,s=!1,i=G(t),o=i.tags??[],u=i.metadata??{},l=i.runName??this.getName(),c=new hi({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new bu({...r}),p=this._streamLog(e,c,i);for await(let h of p){if(a?a=a.concat(h):a=fi.fromRunLogPatch(h),a.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;let v={...a.state},P={run_id:v.id,event:`on_${v.type}_start`,name:l,tags:o,metadata:u,data:{input:e}};d.includeEvent(P,v.type)&&(yield P)}let m=h.ops.filter(v=>v.path.startsWith("/logs/")).map(v=>v.path.split("/")[2]),y=[...new Set(m)];for(let v of y){let P,j={},N=a.state.logs[v];if(N.end_time===void 0?N.streamed_output.length>0?P="stream":P="start":P="end",P==="start")N.inputs!==void 0&&(j.input=N.inputs);else if(P==="end")N.inputs!==void 0&&(j.input=N.inputs),j.output=N.final_output;else if(P==="stream"){let W=N.streamed_output.length;if(W!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${W} instead. Encountered in: "${N.name}"`);j={chunk:N.streamed_output[0]},N.streamed_output=[]}yield{event:`on_${N.type}_${P}`,name:N.name,run_id:N.id,tags:N.tags,metadata:N.metadata,data:j}}let{state:x}=a;if(x.streamed_output.length>0){let v=x.streamed_output.length;if(v!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${v} instead. Encountered in: "${x.name}"`);let P={chunk:x.streamed_output[0]};x.streamed_output=[];let j={event:`on_${x.type}_stream`,run_id:x.id,tags:o,metadata:u,name:l,data:P};d.includeEvent(j,x.type)&&(yield j)}}let f=a?.state;if(f!==void 0){let h={event:`on_${f.type}_end`,name:l,run_id:f.id,tags:o,metadata:u,data:{output:f.final_output}};d.includeEvent(h,f.type)&&(yield h)}}static isRunnable(e){return _i(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new hr({bound:this,config:{},configFactories:[a=>({callbacks:[new bi({config:a,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return tE(this,e)}},hr=class n extends X{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=gu(this.config,...e);return gu(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(G(t),this.kwargs))}async batch(e,t,r){let a=Array.isArray(t)?await Promise.all(t.map(async s=>this._mergeConfig(G(s),this.kwargs))):await this._mergeConfig(G(t),this.kwargs);return this.bound.batch(e,a,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(G(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(G(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(G(t),this.kwargs))}streamEvents(e,t,r){let a=this,s=async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig(G(t),a.kwargs),version:t.version},r)};return ke.fromAsyncGenerator(s())}static isRunnableBinding(e){return e.bound&&X.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new bi({config:a,onStart:e,onEnd:t,onError:r})]})]})}},ku=class n extends X{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new n({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,ce(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new n({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}},Ru=class extends hr{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let a=e>1?`retry:attempt:${e}`:void 0;return ce(t,{callbacks:r?.getChild(a)})}async _invoke(e,t,r){return(0,Ud.default)(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:a=>this.onFailedAttempt(a,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,a){let s={};try{await(0,Ud.default)(async i=>{let o=e.map((p,f)=>f).filter(p=>s[p.toString()]===void 0||s[p.toString()]instanceof Error),u=o.map(p=>e[p]),l=o.map(p=>this._patchConfigForRetry(i,t?.[p],r?.[p])),c=await super.batch(u,l,{...a,returnExceptions:!0}),d;for(let p=0;p<c.length;p+=1){let f=c[p],h=o[p];f instanceof Error&&d===void 0&&(d=f,d.input=u[p]),s[h.toString()]=f}if(d)throw d;return c},{onFailedAttempt:i=>this.onFailedAttempt(i,i.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(i){if(a?.returnExceptions!==!0)throw i}return Object.keys(s).sort((i,o)=>parseInt(i,10)-parseInt(o,10)).map(i=>s[parseInt(i,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}},mr=class n extends X{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r=G(t),s=await(await Ge(r))?.handleChainStart(this.toJSON(),me(e,"input"),r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i=e,o;try{let u=[this.first,...this.middle];for(let l=0;l<u.length;l+=1){let d=u[l].invoke(i,ce(r,{callbacks:s?.getChild(`seq:step:${l+1}`)}));i=await Bt(d,t?.signal)}if(t?.signal?.aborted)throw new Error("Aborted");o=await this.last.invoke(i,ce(r,{callbacks:s?.getChild(`seq:step:${this.steps.length}`)}))}catch(u){throw await s?.handleChainError(u),u}return await s?.handleChainEnd(me(o,"output")),o}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),s=await Promise.all(a.map(Ge)),i=await Promise.all(s.map(async(u,l)=>{let c=await u?.handleChainStart(this.toJSON(),me(e[l],"input"),a[l].runId,void 0,void 0,void 0,a[l].runName);return delete a[l].runId,c})),o=e;try{for(let u=0;u<this.steps.length;u+=1){let c=this.steps[u].batch(o,i.map((d,p)=>{let f=d?.getChild(`seq:step:${u+1}`);return ce(a[p],{callbacks:f})}),r);o=await Bt(c,a[0]?.signal)}}catch(u){throw await Promise.all(i.map(l=>l?.handleChainError(u))),u}return await Promise.all(i.map(u=>u?.handleChainEnd(me(o,"output")))),o}async*_streamIterator(e,t){let r=await Ge(t),{runId:a,...s}=t??{},i=await r?.handleChainStart(this.toJSON(),me(e,"input"),a,void 0,void 0,void 0,s?.runName),o=[this.first,...this.middle,this.last],u=!0,l;async function*c(){yield e}try{let d=o[0].transform(c(),ce(s,{callbacks:i?.getChild("seq:step:1")}));for(let p=1;p<o.length;p+=1)d=await o[p].transform(d,ce(s,{callbacks:i?.getChild(`seq:step:${p+1}`)}));for await(let p of d)if(t?.signal?.throwIfAborted(),yield p,u)if(l===void 0)l=p;else try{l=Re(l,p)}catch{l=void 0,u=!1}}catch(d){throw await i?.handleChainError(d),d}await i?.handleChainEnd(me(l,"output"))}getGraph(e){let t=new vi,r=null;return this.steps.forEach((a,s)=>{let i=a.getGraph(e);s!==0&&i.trimFirstNode(),s!==this.steps.length-1&&i.trimLastNode(),t.extend(i);let o=i.firstNode();if(!o)throw new Error(`Runnable ${a} has no first node`);r&&t.addEdge(r,o),r=i.lastNode()}),t}pipe(e){return n.isRunnableSequence(e)?new n({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new n({first:this.first,middle:[...this.middle,this.last],last:fr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&X.isRunnable(e)}static from([e,...t],r){return new n({first:fr(e),middle:t.slice(0,-1).map(fr),last:fr(t[t.length-1]),name:r})}},Ur=class n extends X{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(let[t,r]of Object.entries(e.steps))this.steps[t]=fr(r)}static from(e){return new n({steps:e})}async invoke(e,t){let r=G(t),s=await(await Ge(r))?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i={};try{let o=Object.entries(this.steps).map(async([u,l])=>{i[u]=await l.invoke(e,ce(r,{callbacks:s?.getChild(`map:key:${u}`)}))});await Bt(Promise.all(o),t?.signal)}catch(o){throw await s?.handleChainError(o),o}return await s?.handleChainEnd(i),i}async*_transform(e,t,r){let a={...this.steps},s=td(e,Object.keys(a).length),i=new Map(Object.entries(a).map(([o,u],l)=>{let c=u.transform(s[l],ce(r,{callbacks:t?.getChild(`map:key:${o}`)}));return[o,c.next().then(d=>({key:o,gen:c,result:d}))]}));for(;i.size;){let o=Promise.race(i.values()),{key:u,result:l,gen:c}=await Bt(o,r?.signal);i.delete(u),l.done||(yield{[u]:l.value},i.set(u,c.next().then(d=>({key:u,gen:c,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=G(t),s=new cr({generator:this.transform(r(),a),config:a});return await s.setup,ke.fromAsyncGenerator(s)}},zd=class n extends X{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Wo(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){let[r]=this._getOptionsList(t??{},1),a=await Ge(r),s=this.func(ce(r,{callbacks:a}),e);return Bt(s,r?.signal)}async*_streamIterator(e,t){let[r]=this._getOptionsList(t??{},1),a=await this.invoke(e,t);if(Cu(a)){for await(let s of a)r?.signal?.throwIfAborted(),yield s;return}if(My(a)){for(;;){r?.signal?.throwIfAborted();let s=a.next();if(s.done)break;yield s.value}return}yield a}static from(e){return new n({func:e})}};gr=class n extends X{static lc_name(){return"RunnableLambda"}constructor(e){if(Wo(e.func))return zd.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),eE(e.func),this.func=e.func}static from(e){return new n({func:e})}async _invoke(e,t,r){return new Promise((a,s)=>{let i=ce(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??mu)-1});ht.runWithConfig(i,async()=>{try{let o=await this.func(e,{...i,config:i});if(o&&X.isRunnable(o)){if(t?.recursionLimit===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...i,recursionLimit:(i.recursionLimit??mu)-1})}else if(Cu(o)){let u;for await(let l of Fd(i,o))if(t?.signal?.throwIfAborted(),u===void 0)u=l;else try{u=Re(u,l)}catch{u=l}o=u}else if(Ld(o)){let u;for(let l of Dd(i,o))if(t?.signal?.throwIfAborted(),u===void 0)u=l;else try{u=Re(u,l)}catch{u=l}o=u}a(o)}catch(o){s(o)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){let a;for await(let o of e)if(a===void 0)a=o;else try{a=Re(a,o)}catch{a=o}let s=ce(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??mu)-1}),i=await new Promise((o,u)=>{ht.runWithConfig(s,async()=>{try{let l=await this.func(a,{...s,config:s});o(l)}catch(l){u(l)}})});if(i&&X.isRunnable(i)){if(r?.recursionLimit===0)throw new Error("Recursion limit reached.");let o=await i.stream(a,s);for await(let u of o)yield u}else if(Cu(i))for await(let o of Fd(s,i))r?.signal?.throwIfAborted(),yield o;else if(Ld(i))for(let o of Dd(s,i))r?.signal?.throwIfAborted(),yield o;else yield i}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=G(t),s=new cr({generator:this.transform(r(),a),config:a});return await s.setup,ke.fromAsyncGenerator(s)}},Nu=class extends X{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(let e of this.fallbacks)yield e}async invoke(e,t){let r=G(t),a=await Ge(t),{runId:s,...i}=r,o=await a?.handleChainStart(this.toJSON(),me(e,"input"),s,void 0,void 0,void 0,i?.runName),u;for(let l of this.runnables()){r?.signal?.throwIfAborted();try{let c=await l.invoke(e,ce(i,{callbacks:o?.getChild()}));return await o?.handleChainEnd(me(c,"output")),c}catch(c){u===void 0&&(u=c)}}throw u===void 0?new Error("No error stored at end of fallback."):(await o?.handleChainError(u),u)}async*_streamIterator(e,t){let r=G(t),a=await Ge(t),{runId:s,...i}=r,o=await a?.handleChainStart(this.toJSON(),me(e,"input"),s,void 0,void 0,void 0,i?.runName),u,l;for(let d of this.runnables()){r?.signal?.throwIfAborted();let p=ce(i,{callbacks:o?.getChild()});try{l=await d.stream(e,p);break}catch(f){u===void 0&&(u=f)}}if(l===void 0){let d=u??new Error("No error stored at end of fallback.");throw await o?.handleChainError(d),d}let c;try{for await(let d of l){yield d;try{c=c===void 0?c:Re(c,d)}catch{c=void 0}}}catch(d){throw await o?.handleChainError(d),d}await o?.handleChainEnd(me(c,"output"))}async batch(e,t,r){if(r?.returnExceptions)throw new Error("Not implemented.");let a=this._getOptionsList(t??{},e.length),s=await Promise.all(a.map(u=>Ge(u))),i=await Promise.all(s.map(async(u,l)=>{let c=await u?.handleChainStart(this.toJSON(),me(e[l],"input"),a[l].runId,void 0,void 0,void 0,a[l].runName);return delete a[l].runId,c})),o;for(let u of this.runnables()){a[0].signal?.throwIfAborted();try{let l=await u.batch(e,i.map((c,d)=>ce(a[d],{callbacks:c?.getChild()})),r);return await Promise.all(i.map((c,d)=>c?.handleChainEnd(me(l[d],"output")))),l}catch(l){o===void 0&&(o=l)}}throw o?(await Promise.all(i.map(u=>u?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};Fa=class extends X{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Ur&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){let a=this.mapper.getStepsKeys(),[s,i]=td(e),o=this.mapper.transform(i,ce(r,{callbacks:t?.getChild()})),u=o.next();for await(let l of s){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);let c=Object.fromEntries(Object.entries(l).filter(([d])=>!a.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await u).value;for await(let l of o)yield l}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=G(t),s=new cr({generator:this.transform(r(),a),config:a});return await s.setup,ke.fromAsyncGenerator(s)}},$u=class extends X{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{let t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(let t of e){let r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}let a=G(t),s=new cr({generator:this.transform(r(),a),config:a});return await s.setup,ke.fromAsyncGenerator(s)}},xi=class extends hr{constructor(e){let t=mr.from([gr.from(async r=>{let a;if(Ca(r))try{a=await this.schema.parseAsync(r.args)}catch{throw new Sa("Received tool input did not match expected schema",JSON.stringify(r.args))}else a=r;return a}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}});var Bd=g(()=>{xt()});var Dy=g(()=>{yt();Nn();su();iu();ci();Bd();ou();Na();Lr()});var Ua=g(()=>{Nn();xt();su();iu();ci();ou();Lr();Dy();Bd();Na()});var Ei,Ba,qa,Du,Oi=g(()=>{ii();ci();Lr();Ei=class extends vt{},Ba=class extends Ei{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Ke(this.value)]}},qa=class extends Ei{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return di(this.messages)}toChatMessages(){return this.messages}},Du=class extends Ei{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new Ke({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}});var yr,Ii=g(()=>{Oi();Va();yr=class extends br{async formatPromptValue(e){let t=await this.format(e);return new Ba(t)}}});function Hd(n){return typeof n=="function"}function $E(n){return Ka(n)?"array":typeof n}function Vd(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function zy(n,e){return n!=null&&typeof n=="object"&&e in n}function jE(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}function LE(n,e){return ME.call(n,e)}function FE(n){return!LE(DE,n)}function zE(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return UE[t]})}function KE(n,e){if(!n)return[];var t=!1,r=[],a=[],s=[],i=!1,o=!1,u="",l=0;function c(){if(i&&!o)for(;s.length;)delete a[s.pop()];else s=[];i=!1,o=!1}var d,p,f;function h(Z){if(typeof Z=="string"&&(Z=Z.split(qE,2)),!Ka(Z)||Z.length!==2)throw new Error("Invalid tags: "+Z);d=new RegExp(Vd(Z[0])+"\\s*"),p=new RegExp("\\s*"+Vd(Z[1])),f=new RegExp("\\s*"+Vd("}"+Z[1]))}h(e||bt.tags);for(var m=new Ti(n),y,x,v,P,j,N;!m.eos();){if(y=m.pos,v=m.scanUntil(d),v)for(var W=0,Y=v.length;W<Y;++W)P=v.charAt(W),FE(P)?(s.push(a.length),u+=P):(o=!0,t=!0,u+=" "),a.push(["text",P,y,y+1]),y+=1,P===`
`&&(c(),u="",l=0,t=!1);if(!m.scan(d))break;if(i=!0,x=m.scan(HE)||"name",m.scan(BE),x==="="?(v=m.scanUntil(By),m.scan(By),m.scanUntil(p)):x==="{"?(v=m.scanUntil(f),m.scan(VE),m.scanUntil(p),x="&"):v=m.scanUntil(p),!m.scan(p))throw new Error("Unclosed tag at "+m.pos);if(x==">"?j=[x,v,y,m.pos,u,l,t]:j=[x,v,y,m.pos],l++,a.push(j),x==="#"||x==="^")r.push(j);else if(x==="/"){if(N=r.pop(),!N)throw new Error('Unopened section "'+v+'" at '+y);if(N[1]!==v)throw new Error('Unclosed section "'+N[1]+'" at '+y)}else x==="name"||x==="{"||x==="&"?o=!0:x==="="&&h(v)}if(c(),N=r.pop(),N)throw new Error('Unclosed section "'+N[1]+'" at '+m.pos);return JE(GE(a))}function GE(n){for(var e=[],t,r,a=0,s=n.length;a<s;++a)t=n[a],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function JE(n){for(var e=[],t=e,r=[],a,s,i=0,o=n.length;i<o;++i)switch(a=n[i],a[0]){case"#":case"^":t.push(a),r.push(a),t=a[4]=[];break;case"/":s=r.pop(),s[5]=a[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(a)}return e}function Ti(n){this.string=n,this.tail=n,this.pos=0}function Ha(n,e){this.view=n,this.cache={".":this.view},this.parent=e}function Fe(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}var NE,Ka,ME,DE,UE,BE,qE,By,VE,HE,bt,Pi,Fu,qy=g(()=>{NE=Object.prototype.toString,Ka=Array.isArray||function(e){return NE.call(e)==="[object Array]"};ME=RegExp.prototype.test;DE=/\S/;UE={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};BE=/\s*/,qE=/\s+/,By=/\s*=/,VE=/\s*\}/,HE=/#|\^|\/|>|\{|&|=|!/;Ti.prototype.eos=function(){return this.tail===""};Ti.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};Ti.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};Ha.prototype.push=function(e){return new Ha(e,this)};Ha.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var a=this,s,i,o,u=!1;a;){if(e.indexOf(".")>0)for(s=a.view,i=e.split("."),o=0;s!=null&&o<i.length;)o===i.length-1&&(u=zy(s,i[o])||jE(s,i[o])),s=s[i[o++]];else s=a.view[e],u=zy(a.view,e);if(u){r=s;break}a=a.parent}t[e]=r}return Hd(r)&&(r=r.call(this.view)),r};Fe.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Fe.prototype.parse=function(e,t){var r=this.templateCache,a=e+":"+(t||bt.tags).join(":"),s=typeof r<"u",i=s?r.get(a):void 0;return i==null&&(i=KE(e,t),s&&r.set(a,i)),i};Fe.prototype.render=function(e,t,r,a){var s=this.getConfigTags(a),i=this.parse(e,s),o=t instanceof Ha?t:new Ha(t,void 0);return this.renderTokens(i,o,r,e,a)};Fe.prototype.renderTokens=function(e,t,r,a,s){for(var i="",o,u,l,c=0,d=e.length;c<d;++c)l=void 0,o=e[c],u=o[0],u==="#"?l=this.renderSection(o,t,r,a,s):u==="^"?l=this.renderInverted(o,t,r,a,s):u===">"?l=this.renderPartial(o,t,r,s):u==="&"?l=this.unescapedValue(o,t):u==="name"?l=this.escapedValue(o,t,s):u==="text"&&(l=this.rawValue(o)),l!==void 0&&(i+=l);return i};Fe.prototype.renderSection=function(e,t,r,a,s){var i=this,o="",u=t.lookup(e[1]);function l(p){return i.render(p,t,r,s)}if(u){if(Ka(u))for(var c=0,d=u.length;c<d;++c)o+=this.renderTokens(e[4],t.push(u[c]),r,a,s);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),r,a,s);else if(Hd(u)){if(typeof a!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,a.slice(e[3],e[5]),l),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,r,a,s);return o}};Fe.prototype.renderInverted=function(e,t,r,a,s){var i=t.lookup(e[1]);if(!i||Ka(i)&&i.length===0)return this.renderTokens(e[4],t,r,a,s)};Fe.prototype.indentPartial=function(e,t,r){for(var a=t.replace(/[^ \t]/g,""),s=e.split(`
`),i=0;i<s.length;i++)s[i].length&&(i>0||!r)&&(s[i]=a+s[i]);return s.join(`
`)};Fe.prototype.renderPartial=function(e,t,r,a){if(r){var s=this.getConfigTags(a),i=Hd(r)?r(e[1]):r[e[1]];if(i!=null){var o=e[6],u=e[5],l=e[4],c=i;u==0&&l&&(c=this.indentPartial(i,l,o));var d=this.parse(c,s);return this.renderTokens(d,t,r,c,a)}}};Fe.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};Fe.prototype.escapedValue=function(e,t,r){var a=this.getConfigEscape(r)||bt.escape,s=t.lookup(e[1]);if(s!=null)return typeof s=="number"&&a===bt.escape?String(s):a(s)};Fe.prototype.rawValue=function(e){return e[1]};Fe.prototype.getConfigTags=function(e){return Ka(e)?e:e&&typeof e=="object"?e.tags:void 0};Fe.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Ka(e))return e.escape};bt={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){Pi.templateCache=n},get templateCache(){return Pi.templateCache}},Pi=new Fe;bt.clearCache=function(){return Pi.clearCache()};bt.parse=function(e,t){return Pi.parse(e,t)};bt.render=function(e,t,r,a){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+$E(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Pi.render(e,t,r,a)};bt.escape=zE;bt.Scanner=Ti;bt.Context=Ha;bt.Writer=Fe;Fu=bt});function Vy(){Fu.escape=n=>n}var Si,WE,Uu,ZE,XE,Kd,YE,St,Hy,qn,Ga=g(()=>{qy();Si=n=>{let e=n.split(""),t=[],r=(s,i)=>{for(let o=i;o<e.length;o+=1)if(s.includes(e[o]))return o;return-1},a=0;for(;a<e.length;)if(e[a]==="{"&&a+1<e.length&&e[a+1]==="{")t.push({type:"literal",text:"{"}),a+=2;else if(e[a]==="}"&&a+1<e.length&&e[a+1]==="}")t.push({type:"literal",text:"}"}),a+=2;else if(e[a]==="{"){let s=r("}",a);if(s<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(a+1,s).join("")}),a=s+1}else{if(e[a]==="}")throw new Error("Single '}' in template.");{let s=r("{}",a),i=(s<0?e.slice(a):e.slice(a,s)).join("");t.push({type:"literal",text:i}),a=s<0?e.length:s}}return t},WE=n=>n.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),Uu=n=>{Vy();let e=Fu.parse(n);return WE(e)},ZE=(n,e)=>Si(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e)return t+e[r.name];throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),XE=(n,e)=>(Vy(),Fu.render(n,e)),Kd={"f-string":ZE,mustache:XE},YE={"f-string":Si,mustache:Uu},St=(n,e,t)=>Kd[e](n,t),Hy=(n,e)=>YE[e](n),qn=(n,e,t)=>{if(!(e in Kd)){let r=Object.keys(Kd);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{let r=t.reduce((a,s)=>(a[s]="foo",a),{});Array.isArray(n)?n.forEach(a=>{if(a.type==="text")St(a.text,e,r);else if(a.type==="image_url")if(typeof a.image_url=="string")St(a.image_url,e,r);else{let s=a.image_url.url;St(s,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(a,null,2)}`)}):St(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}}});var Gd={};ro(Gd,{PromptTemplate:()=>Ct});var Ct,Ja=g(()=>{Ii();Ga();Ct=class n extends yr{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),qn(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return St(this.template,this.templateFormat,t)}static fromExamples(e,t,r,a=`

`,s=""){let i=[s,...e,t].join(a);return new n({inputVariables:r,template:i})}static fromTemplate(e,t){let{templateFormat:r="f-string",...a}=t??{},s=new Set;return Hy(e,r).forEach(i=>{i.type==="variable"&&s.add(i.name)}),new n({inputVariables:[...s],templateFormat:r,template:e,...a})}async partial(e){let t=this.inputVariables.filter(s=>!(s in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new n(a)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new n({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}});var Wa,Jd=g(()=>{Oi();Va();Ga();Wa=class n extends br{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),qn([{type:"image_url",image_url:this.template}],this.templateFormat,t)}}_getPromptType(){return"prompt"}async partial(e){let t=this.inputVariables.filter(s=>!(s in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new n(a)}async format(e){let t={};for(let[i,o]of Object.entries(this.template))typeof o=="string"?t[i]=St(o,this.templateFormat,e):t[i]=o;let r=e.url||t.url,a=e.detail||t.detail;if(!r)throw new Error("Must provide either an image URL.");if(typeof r!="string")throw new Error("url must be a string.");let s={url:r};return a&&(s.detail=a),s}async formatPromptValue(e){let t=await this.format(e);return new Du(t)}}});function QE(n){return typeof n.formatMessages=="function"}function eO(n,e){if(QE(n)||Mr(n))return n;if(Array.isArray(n)&&n[0]==="placeholder"){let a=n[1];if(typeof a!="string"||a[0]!=="{"||a[a.length-1]!=="}")throw new Error(`Invalid placeholder template: "${n[1]}". Expected a variable name surrounded by curly braces.`);let s=a.slice(1,-1);return new Wd({variableName:s,optional:!0})}let t=Et(n),r;if(typeof t.content=="string"?r=t.content:r=t.content.map(a=>"text"in a?{...a,text:a.text}:"image_url"in a?{...a,image_url:a.image_url}:a),t._getType()==="human")return zu.fromTemplate(r,e);if(t._getType()==="ai")return Yd.fromTemplate(r,e);if(t._getType()==="system")return Qd.fromTemplate(r,e);if(At.isInstance(t))return Xd.fromTemplate(t.content,t.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}function tO(n){return n.constructor.lc_name()==="MessagesPlaceholder"}var Ci,Wd,Zd,ki,Xd,Ri,zu,Yd,Qd,Za,Ni=g(()=>{Ua();Oi();yt();Ii();Va();Ja();Jd();Ga();Ci=class extends X{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}},Wd=class extends Ci{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){let t=e[this.variableName];if(this.optional&&!t)return[];if(!t){let a=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw a.name="InputFormatError",a}let r;try{Array.isArray(t)?r=t.map(Et):r=[Et(t)]}catch(a){let s=typeof t=="string"?t:JSON.stringify(t,null,2),i=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${s}`,`Additional message: ${a.message}`].join(`

`));throw i.name="InputFormatError",i}return r}},Zd=class extends Ci{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}},ki=class extends br{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new qa(t)}},Xd=class extends Zd{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new At(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(Ct.fromTemplate(e,{templateFormat:r?.templateFormat}),t)}},Ri=class extends Ci{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let r=[];this.prompt.forEach(a=>{"inputVariables"in a&&(r=r.concat(a.inputVariables))}),this.inputVariables=r}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){let t=this.constructor;if(t._messageClass()){let r=t._messageClass();return new r({content:e})}else if(t.chatMessageClass){let r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if(typeof e=="string")return new this(Ct.fromTemplate(e,t));let r=[];for(let a of e)if(typeof a=="string"||typeof a=="object"&&"text"in a){let s="";typeof a=="string"?s=a:typeof a.text=="string"&&(s=a.text??"");let i={...t,...typeof a!="string"?{additionalContentFields:a}:{}};r.push(Ct.fromTemplate(s,i))}else if(typeof a=="object"&&"image_url"in a){let s=a.image_url??"",i,o=[];if(typeof s=="string"){let u;t?.templateFormat==="mustache"?u=Uu(s):u=Si(s);let l=u.flatMap(c=>c.type==="variable"?[c.name]:[]);if((l?.length??0)>0){if(l.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${l}
From: ${s}`);o=[l[0]]}else o=[];s={url:s},i=new Wa({template:s,inputVariables:o,templateFormat:t?.templateFormat,additionalContentFields:a})}else if(typeof s=="object"){if("url"in s){let u;t?.templateFormat==="mustache"?u=Uu(s.url):u=Si(s.url),o=u.flatMap(l=>l.type==="variable"?[l.name]:[])}else o=[];i=new Wa({template:s,inputVariables:o,templateFormat:t?.templateFormat,additionalContentFields:a})}else throw new Error("Invalid image template");r.push(i)}return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof yr){let t=await this.prompt.format(e);return this.createMessage(t)}else{let t=[];for(let r of this.prompt){let a={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(let s of r.inputVariables)a||(a={[s]:e[s]}),a={...a,[s]:e[s]};if(r instanceof yr){let s=await r.format(a),i;"additionalContentFields"in r&&(i=r.additionalContentFields),t.push({...i,type:"text",text:s})}else if(r instanceof Wa){let s=await r.format(a),i;"additionalContentFields"in r&&(i=r.additionalContentFields),t.push({...i,type:"image_url",image_url:s})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}},zu=class extends Ri{static _messageClass(){return Ke}static lc_name(){return"HumanMessagePromptTemplate"}},Yd=class extends Ri{static _messageClass(){return Xe}static lc_name(){return"AIMessagePromptTemplate"}},Qd=class extends Ri{static _messageClass(){return Ln}static lc_name(){return"SystemMessagePromptTemplate"}};Za=class n extends ki{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){let t=new Set;for(let o of this.promptMessages)if(!(o instanceof he))for(let u of o.inputVariables)t.add(u);let r=this.inputVariables,a=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),s=new Set([...a].filter(o=>!t.has(o)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are not used in any of the prompt messages.`);let i=new Set([...t].filter(o=>!a.has(o)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if(typeof e.content=="string")return e;let r=await Promise.all(e.content.map(async a=>{if(a.type!=="image_url")return a;let s="";typeof a.image_url=="string"?s=a.image_url:s=a.image_url.url;let o=await Ct.fromTemplate(s,{templateFormat:this.templateFormat}).format(t);return typeof a.image_url!="string"&&"url"in a.image_url?a.image_url.url=o:a.image_url=o,a}));return e.content=r,e}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=[];for(let a of this.promptMessages)if(a instanceof he)r.push(await this._parseImagePrompts(a,t));else{let s=a.inputVariables.reduce((o,u)=>{if(!(u in t)&&!(tO(a)&&a.optional))throw new Error(`Missing value for input variable \`${u.toString()}\``);return o[u]=t[u],o},{}),i=await a.formatMessages(s);r=r.concat(i)}return r}async partial(e){let t=this.inputVariables.filter(s=>!(s in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new n(a)}static fromTemplate(e,t){let r=Ct.fromTemplate(e,t),a=new zu({prompt:r});return this.fromMessages([a])}static fromMessages(e,t){let r=e.reduce((i,o)=>i.concat(o instanceof n?o.promptMessages:[eO(o,t)]),[]),a=e.reduce((i,o)=>o instanceof n?Object.assign(i,o.partialVariables):i,Object.create(null)),s=new Set;for(let i of r)if(!(i instanceof he))for(let o of i.inputVariables)o in a||s.add(o);return new this({...t,inputVariables:[...s],promptMessages:r,partialVariables:a,templateFormat:t?.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}});var Ky={};ro(Ky,{FewShotChatMessagePromptTemplate:()=>tp,FewShotPromptTemplate:()=>ep});var ep,tp,rp=g(()=>{Ii();Ga();Ja();Ni();ep=class n extends yr{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),qn(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t=this.inputVariables.filter(s=>!(s in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new n(a)}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=await Promise.all(r.map(i=>this.examplePrompt.format(i))),s=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return St(s,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");let r=await Ct.deserialize(t),a;if(Array.isArray(e.examples))a=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new n({inputVariables:e.input_variables,examplePrompt:r,examples:a,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}},tp=class n extends ki{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??`

`,this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),qn(this.prefix+this.suffix,this.templateFormat,t)}}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t);r=r.map(s=>{let i={};return this.examplePrompt.inputVariables.forEach(o=>{i[o]=s[o]}),i});let a=[];for(let s of r){let i=await this.examplePrompt.formatMessages(s);a.push(...i)}return a}async format(e){let t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),s=(await Promise.all(r.map(o=>this.examplePrompt.formatMessages(o)))).flat().map(o=>o.content),i=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return St(i,this.templateFormat,t)}async partial(e){let t=this.inputVariables.filter(s=>!(s in e)),r={...this.partialVariables??{},...e},a={...this,inputVariables:t,partialVariables:r};return new n(a)}}});var br,Va=g(()=>{yt();br=class extends X{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},r={};for(let[s,i]of Object.entries(t))typeof i=="string"?r[s]=i:r[s]=await i();return{...r,...e}}async invoke(e,t){return this._callWithConfig(r=>this.formatPromptValue(r),e,{...t,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{let{PromptTemplate:t}=await Promise.resolve().then(()=>(Ja(),Gd));return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=await Promise.resolve().then(()=>(Ja(),Gd));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>(rp(),Ky));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}});var zb=S(bl=>{"use strict";bl.byteLength=SI;bl.toByteArray=kI;bl.fromByteArray=$I;var tr=[],_t=[],TI=typeof Uint8Array<"u"?Uint8Array:Array,Kp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(ma=0,Fb=Kp.length;ma<Fb;++ma)tr[ma]=Kp[ma],_t[Kp.charCodeAt(ma)]=ma;var ma,Fb;_t[45]=62;_t[95]=63;function Ub(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function SI(n){var e=Ub(n),t=e[0],r=e[1];return(t+r)*3/4-r}function CI(n,e,t){return(e+t)*3/4-t}function kI(n){var e,t=Ub(n),r=t[0],a=t[1],s=new TI(CI(n,r,a)),i=0,o=a>0?r-4:r,u;for(u=0;u<o;u+=4)e=_t[n.charCodeAt(u)]<<18|_t[n.charCodeAt(u+1)]<<12|_t[n.charCodeAt(u+2)]<<6|_t[n.charCodeAt(u+3)],s[i++]=e>>16&255,s[i++]=e>>8&255,s[i++]=e&255;return a===2&&(e=_t[n.charCodeAt(u)]<<2|_t[n.charCodeAt(u+1)]>>4,s[i++]=e&255),a===1&&(e=_t[n.charCodeAt(u)]<<10|_t[n.charCodeAt(u+1)]<<4|_t[n.charCodeAt(u+2)]>>2,s[i++]=e>>8&255,s[i++]=e&255),s}function RI(n){return tr[n>>18&63]+tr[n>>12&63]+tr[n>>6&63]+tr[n&63]}function NI(n,e,t){for(var r,a=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),a.push(RI(r));return a.join("")}function $I(n){for(var e,t=n.length,r=t%3,a=[],s=16383,i=0,o=t-r;i<o;i+=s)a.push(NI(n,i,i+s>o?o:i+s));return r===1?(e=n[t-1],a.push(tr[e>>2]+tr[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],a.push(tr[e>>10]+tr[e>>4&63]+tr[e<<2&63]+"=")),a.join("")}});var Qb=S((_B,Yb)=>{Yb.exports=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,t=[],r=0;r<n.rangeCount;r++)t.push(n.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||t.forEach(function(a){n.addRange(a)}),e&&e.focus()}}});var r_=S((wB,t_)=>{"use strict";var nP=Qb(),e_={"text/plain":"Text","text/html":"Url",default:"Text"},aP="Copy to clipboard: #{key}, Enter";function sP(n){var e=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return n.replace(/#{\s*key\s*}/g,e)}function iP(n,e){var t,r,a,s,i,o,u=!1;e||(e={}),t=e.debug||!1;try{a=nP(),s=document.createRange(),i=document.getSelection(),o=document.createElement("span"),o.textContent=n,o.ariaHidden="true",o.style.all="unset",o.style.position="fixed",o.style.top=0,o.style.clip="rect(0, 0, 0, 0)",o.style.whiteSpace="pre",o.style.webkitUserSelect="text",o.style.MozUserSelect="text",o.style.msUserSelect="text",o.style.userSelect="text",o.addEventListener("copy",function(c){if(c.stopPropagation(),e.format)if(c.preventDefault(),typeof c.clipboardData>"u"){t&&console.warn("unable to use e.clipboardData"),t&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var d=e_[e.format]||e_.default;window.clipboardData.setData(d,n)}else c.clipboardData.clearData(),c.clipboardData.setData(e.format,n);e.onCopy&&(c.preventDefault(),e.onCopy(c.clipboardData))}),document.body.appendChild(o),s.selectNodeContents(o),i.addRange(s);var l=document.execCommand("copy");if(!l)throw new Error("copy command was unsuccessful");u=!0}catch(c){t&&console.error("unable to copy using execCommand: ",c),t&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(e.format||"text",n),e.onCopy&&e.onCopy(window.clipboardData),u=!0}catch(d){t&&console.error("unable to copy using clipboardData: ",d),t&&console.error("falling back to prompt"),r=sP("message"in e?e.message:aP),window.prompt(r,n)}}finally{i&&(typeof i.removeRange=="function"?i.removeRange(s):i.removeAllRanges()),o&&document.body.removeChild(o),a()}return u}t_.exports=iP});var kl={id:"acode.plugin.chatgpt.sidebar",name:"AI Assistant Sidebar",main:"dist/main.js",version:"2.1.0",readme:"readme.md",icon:"icon.png",minVersionCode:290,files:["assets/ai_assistant.svg","assets/user_avatar.png","assets/insert-context.svg","assets/github-dark.css","assets/highlight.min.js","assets/markdown-it.min.js"],price:0,author:{name:"Raunak",email:"bajrangcoders@gmail.com",github:"bajrangCoder"}};var of=`.ai-assistant-sidebar * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.ai-assistant-sidebar {
  height: 100%;
  display: flex;
  flex-direction: column;
  background: var(--primary-color);
  color: var(--primary-text-color);
  font-family: var(--font-family);
}
.ai-assistant-sidebar .ai-header {
  border-bottom: 1px solid var(--border-color);
  padding: 10px;
  flex-shrink: 0;
}
.ai-assistant-sidebar .ai-header .ai-nav {
  display: flex;
  gap: 5px;
}
.ai-assistant-sidebar .ai-header .ai-nav .ai-nav-btn {
  flex: 1;
  padding: 8px 12px;
  border: none;
  background: transparent;
  color: var(--primary-text-color);
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: all 0.2s ease;
}
.ai-assistant-sidebar .ai-header .ai-nav .ai-nav-btn:hover {
  background: var(--secondary-color);
}
.ai-assistant-sidebar .ai-header .ai-nav .ai-nav-btn.active {
  background: var(--button-background-color);
  color: var(--button-text-color);
}
.ai-assistant-sidebar .ai-content {
  flex: 1;
  overflow: hidden;
  position: relative;
}
.ai-assistant-sidebar .ai-content .ai-chat-area {
  height: 100%;
  padding: 15px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 15px;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-welcome-message {
  text-align: center;
  padding: 20px;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-welcome-message .ai-welcome-content h3 {
  color: var(--primary-text-color);
  margin-bottom: 10px;
  font-size: 1.2rem;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-welcome-message .ai-welcome-content p {
  color: var(--secondary-text-color);
  font-size: 0.9rem;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message {
  display: flex;
  gap: 10px;
  max-width: 100%;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-avatar {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  flex-shrink: 0;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content {
  flex: 1;
  padding: 10px 12px;
  border-radius: 8px;
  font-size: 0.9rem;
  line-height: 1.4;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content pre {
  background: var(--secondary-color);
  border-radius: 4px;
  padding: 10px;
  overflow-x: auto;
  margin: 5px 0;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content pre code {
  font-family: "Courier New", monospace;
  font-size: 0.85rem;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content p {
  margin: 5px 0;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content ul, .ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content ol {
  margin: 5px 0;
  padding-left: 20px;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content h1, .ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content h2, .ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content h3, .ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content h4, .ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content h5, .ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content h6 {
  margin: 10px 0 5px 0;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content a {
  color: var(--button-background-color);
  text-decoration: none;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content a:hover {
  text-decoration: underline;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message.user-message {
  flex-direction: row-reverse;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message.user-message .ai-avatar {
  background: var(--button-background-color);
  color: var(--button-text-color);
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message.user-message .ai-message-content {
  background: var(--button-background-color);
  color: var(--button-text-color);
  border-bottom-right-radius: 4px;
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message.assistant-message .ai-avatar {
  background: var(--secondary-color);
  color: var(--primary-text-color);
}
.ai-assistant-sidebar .ai-content .ai-chat-area .ai-message.assistant-message .ai-message-content {
  background: var(--secondary-color);
  border-bottom-left-radius: 4px;
}
.ai-assistant-sidebar .ai-content .ai-history-area {
  height: 100%;
  padding: 15px;
  overflow-y: auto;
}
.ai-assistant-sidebar .ai-content .ai-history-area h3 {
  margin-bottom: 15px;
  color: var(--primary-text-color);
  font-size: 1.1rem;
}
.ai-assistant-sidebar .ai-content .ai-history-area .ai-history-list .history-session-item {
  padding: 12px;
  margin-bottom: 8px;
  background: var(--secondary-color);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}
.ai-assistant-sidebar .ai-content .ai-history-area .ai-history-list .history-session-item:hover {
  background: var(--hover-color);
  transform: translateX(2px);
}
.ai-assistant-sidebar .ai-content .ai-history-area .ai-history-list .history-session-item .session-title {
  font-weight: 500;
  color: var(--primary-text-color);
  margin-bottom: 4px;
}
.ai-assistant-sidebar .ai-content .ai-history-area .ai-history-list .history-session-item .session-date {
  font-size: 0.8rem;
  color: var(--secondary-text-color);
}
.ai-assistant-sidebar .ai-content .ai-settings-area {
  height: 100%;
  padding: 15px;
  overflow-y: auto;
}
.ai-assistant-sidebar .ai-content .ai-settings-area .ai-settings-form .setting-group {
  margin-bottom: 15px;
}
.ai-assistant-sidebar .ai-content .ai-settings-area .ai-settings-form .setting-group label {
  display: block;
  margin-bottom: 5px;
  color: var(--primary-text-color);
  font-weight: 500;
  font-size: 0.9rem;
}
.ai-assistant-sidebar .ai-content .ai-settings-area .ai-settings-form .setting-group input, .ai-assistant-sidebar .ai-content .ai-settings-area .ai-settings-form .setting-group select {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  background: var(--primary-color);
  color: var(--primary-text-color);
  font-size: 0.9rem;
}
.ai-assistant-sidebar .ai-content .ai-settings-area .ai-settings-form .setting-group input:focus, .ai-assistant-sidebar .ai-content .ai-settings-area .ai-settings-form .setting-group select:focus {
  outline: none;
  border-color: var(--button-background-color);
}
.ai-assistant-sidebar .ai-content .ai-settings-area .ai-settings-form .setting-group input[type=password] {
  font-family: monospace;
}
.ai-assistant-sidebar .ai-content .ai-settings-area .ai-settings-form .save-settings-btn {
  width: 100%;
  padding: 10px;
  background: var(--button-background-color);
  color: var(--button-text-color);
  border: none;
  border-radius: 4px;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}
.ai-assistant-sidebar .ai-content .ai-settings-area .ai-settings-form .save-settings-btn:hover {
  background: var(--button-hover-color);
}
.ai-assistant-sidebar .ai-footer {
  border-top: 1px solid var(--border-color);
  padding: 10px;
  flex-shrink: 0;
}
.ai-assistant-sidebar .ai-footer .ai-input-container {
  display: flex;
  gap: 8px;
  align-items: flex-end;
}
.ai-assistant-sidebar .ai-footer .ai-input-container .ai-input {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid var(--border-color);
  border-radius: 20px;
  background: var(--primary-color);
  color: var(--primary-text-color);
  font-size: 0.9rem;
  resize: none;
  min-height: 36px;
  max-height: 100px;
  font-family: var(--font-family);
}
.ai-assistant-sidebar .ai-footer .ai-input-container .ai-input:focus {
  outline: none;
  border-color: var(--button-background-color);
}
.ai-assistant-sidebar .ai-footer .ai-input-container .ai-send-btn {
  width: 36px;
  height: 36px;
  border: none;
  border-radius: 50%;
  background: var(--button-background-color);
  color: var(--button-text-color);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  flex-shrink: 0;
}
.ai-assistant-sidebar .ai-footer .ai-input-container .ai-send-btn:hover {
  background: var(--button-hover-color);
  transform: scale(1.05);
}
.ai-assistant-sidebar .ai-footer .ai-input-container .ai-send-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
.ai-assistant-sidebar .ai-footer .ai-input-container .ai-send-btn svg {
  width: 16px;
  height: 16px;
}

.scroll {
  max-height: 100%;
  overflow-y: auto;
}

@media (max-width: 768px) {
  .ai-assistant-sidebar .ai-header {
    padding: 8px;
  }
  .ai-assistant-sidebar .ai-header .ai-nav .ai-nav-btn {
    padding: 6px 8px;
    font-size: 0.8rem;
  }
  .ai-assistant-sidebar .ai-content .ai-chat-area {
    padding: 10px;
    gap: 10px;
  }
  .ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-avatar {
    width: 25px;
    height: 25px;
    font-size: 0.7rem;
  }
  .ai-assistant-sidebar .ai-content .ai-chat-area .ai-message .ai-message-content {
    font-size: 0.85rem;
    padding: 8px 10px;
  }
  .ai-assistant-sidebar .ai-content .ai-history-area {
    padding: 10px;
  }
  .ai-assistant-sidebar .ai-content .ai-history-area .history-session-item {
    padding: 10px;
  }
  .ai-assistant-sidebar .ai-content .ai-settings-area {
    padding: 10px;
  }
  .ai-assistant-sidebar .ai-footer {
    padding: 8px;
  }
  .ai-assistant-sidebar .ai-footer .ai-input-container .ai-input {
    font-size: 0.85rem;
    padding: 6px 10px;
    min-height: 32px;
  }
  .ai-assistant-sidebar .ai-footer .ai-input-container .ai-send-btn {
    width: 32px;
    height: 32px;
  }
  .ai-assistant-sidebar .ai-footer .ai-input-container .ai-send-btn svg {
    width: 14px;
    height: 14px;
  }
}`;yt();Fn();dr();yt();Fn();var qt=class extends X{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){let r=G(t);return this.func&&await this.func(e,r),this._callWithConfig(a=>Promise.resolve(a),e,r)}async*transform(e,t){let r=G(t),a,s=!0;for await(let i of this._transformStreamWithConfig(e,o=>o,r))if(yield i,s)if(a===void 0)a=i;else try{a=Re(a,i)}catch{a=void 0,s=!1}this.func&&a!==void 0&&await this.func(a,r)}static assign(e){return new Fa(new Ur({steps:e}))}};yt();Fn();yt();Fn();dr();Ua();yt();var qd=class extends X{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,a)=>this.parseResult([{text:r}],a?.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,a)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],a?.callbacks),e,{...t,runType:"parser"})}},za=class extends qd{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}},zr=class extends Error{constructor(e,t,r,a=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=a,a&&(r===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}};xt();Lr();Da();function Ai(n,e){let t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;let r=n.length;if(r!==e.length)return!1;for(let a=0;a<r;a++)if(!Ai(n[a],e[a]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;let r=Object.keys(n),a=Object.keys(e);if(r.length!==a.length)return!1;for(let i of r)if(!Ai(n[i],e[i]))return!1;return!0}return n===e}var dj=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");var nE=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,aE=[0,31,28,31,30,31,30,31,31,30,31,30,31],sE=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,iE=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,oE=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,uE=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,lE=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,cE=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,dE=/^(?:\/(?:[^~/]|~0|~1)*)*$/,pE=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,fE=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,hE=/^\d\d\d\d-[0-1]\d-[0-3]\d$/,mE=/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,gE=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,yE=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,bE=n=>{if(n[0]==='"')return!1;let[e,t,...r]=n.split("@");return!e||!t||r.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(a=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(a))},_E=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,wE=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,vE=n=>n.length>1&&n.length<80&&(/^P\d+([.,]\d+)?W$/.test(n)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(n)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(n));function Je(n){return n.test.bind(n)}var xE={date:Fy,time:Uy.bind(void 0,!1),"date-time":IE,duration:vE,uri:SE,"uri-reference":Je(oE),"uri-template":Je(uE),url:Je(lE),email:bE,hostname:Je(iE),ipv4:Je(_E),ipv6:Je(wE),regex:kE,uuid:Je(cE),"json-pointer":Je(dE),"json-pointer-uri-fragment":Je(pE),"relative-json-pointer":Je(fE)},AE={...xE,date:Je(hE),time:Je(mE),"date-time":Je(gE),"uri-reference":Je(yE)};function EE(n){return n%4===0&&(n%100!==0||n%400===0)}function Fy(n){let e=n.match(nE);if(!e)return!1;let t=+e[1],r=+e[2],a=+e[3];return r>=1&&r<=12&&a>=1&&a<=(r==2&&EE(t)?29:aE[r])}function Uy(n,e){let t=e.match(sE);if(!t)return!1;let r=+t[1],a=+t[2],s=+t[3],i=!!t[5];return(r<=23&&a<=59&&s<=59||r==23&&a==59&&s==60)&&(!n||i)}var OE=/t|\s/i;function IE(n){let e=n.split(OE);return e.length==2&&Fy(e[0])&&Uy(!0,e[1])}var PE=/\/|:/,TE=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function SE(n){return PE.test(n)&&TE.test(n)}var CE=/[^\\]\\Z/;function kE(n){if(CE.test(n))return!1;try{return new RegExp(n),!0}catch{return!1}}var zn=class extends za{async*_transform(e){for await(let t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}},Bn=class extends zn{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let t,r;for await(let a of e){if(typeof a!="string"&&typeof a.content!="string")throw new Error("Cannot handle non-string output.");let s;if(Lg(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");s=new Dr({message:a,text:a.content})}else if(Mr(a)){if(typeof a.content!="string")throw new Error("Cannot handle non-string message output.");s=new Dr({message:Vc(a),text:a.content})}else s=new It({text:a});r===void 0?r=s:r=r.concat(s);let i=await this.parsePartialResult([r]);i!=null&&!Ai(i,t)&&(this.diff?yield this._diff(t,i):yield i,t=i)}}getFormatInstructions(){return""}};var ju=class extends zn{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((t,r)=>t+this._messageContentComplexToString(r),"")}};po();Un();var Mu=class extends za{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){let t=Be.object(Object.fromEntries(Object.entries(e).map(([r,a])=>[r,Be.string().describe(a)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(gt(this.schema))}
\`\`\`
`}async parse(e){try{let r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(a,s)=>`"${s.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(r))}catch(t){throw new zr(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}};Rc();Bc();var Lu=class extends Bn{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?nu(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return zc(e[0].text)}async parse(e){return zc(e,JSON.parse)}getFormatInstructions(){return""}};Va();Ni();rp();Va();Ni();Ja();Ii();Ga();Jd();Ni();var Bu="RFC3986",qu={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},Gy="RFC1738";var rO=Array.isArray,Vt=(()=>{let n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})();var np=1024,Jy=(n,e,t,r,a)=>{if(n.length===0)return n;let s=n;if(typeof n=="symbol"?s=Symbol.prototype.toString.call(n):typeof n!="string"&&(s=String(n)),t==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<s.length;o+=np){let u=s.length>=np?s.slice(o,o+np):s,l=[];for(let c=0;c<u.length;++c){let d=u.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||a===Gy&&(d===40||d===41)){l[l.length]=u.charAt(c);continue}if(d<128){l[l.length]=Vt[d];continue}if(d<2048){l[l.length]=Vt[192|d>>6]+Vt[128|d&63];continue}if(d<55296||d>=57344){l[l.length]=Vt[224|d>>12]+Vt[128|d>>6&63]+Vt[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|u.charCodeAt(c)&1023),l[l.length]=Vt[240|d>>18]+Vt[128|d>>12&63]+Vt[128|d>>6&63]+Vt[128|d&63]}i+=l.join("")}return i};function Wy(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function ap(n,e){if(rO(n)){let t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}var nO=Object.prototype.hasOwnProperty,Zy={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},Ht=Array.isArray,aO=Array.prototype.push,Xy=function(n,e){aO.apply(n,Ht(e)?e:[e])},sO=Date.prototype.toISOString,ge={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Jy,encodeValuesOnly:!1,format:Bu,formatter:qu[Bu],indices:!1,serializeDate(n){return sO.call(n)},skipNulls:!1,strictNullHandling:!1};function iO(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}var sp={};function Yy(n,e,t,r,a,s,i,o,u,l,c,d,p,f,h,m,y,x){let v=n,P=x,j=0,N=!1;for(;(P=P.get(sp))!==void 0&&!N;){let se=P.get(n);if(j+=1,typeof se<"u"){if(se===j)throw new RangeError("Cyclic object value");N=!0}typeof P.get(sp)>"u"&&(j=0)}if(typeof l=="function"?v=l(e,v):v instanceof Date?v=p?.(v):t==="comma"&&Ht(v)&&(v=ap(v,function(se){return se instanceof Date?p?.(se):se})),v===null){if(s)return u&&!m?u(e,ge.encoder,y,"key",f):e;v=""}if(iO(v)||Wy(v)){if(u){let se=m?e:u(e,ge.encoder,y,"key",f);return[h?.(se)+"="+h?.(u(v,ge.encoder,y,"value",f))]}return[h?.(e)+"="+h?.(String(v))]}let W=[];if(typeof v>"u")return W;let Y;if(t==="comma"&&Ht(v))m&&u&&(v=ap(v,u)),Y=[{value:v.length>0?v.join(",")||null:void 0}];else if(Ht(l))Y=l;else{let se=Object.keys(v);Y=c?se.sort(c):se}let Z=o?String(e).replace(/\./g,"%2E"):String(e),ue=r&&Ht(v)&&v.length===1?Z+"[]":Z;if(a&&Ht(v)&&v.length===0)return ue+"[]";for(let se=0;se<Y.length;++se){let fe=Y[se],af=typeof fe=="object"&&typeof fe.value<"u"?fe.value:v[fe];if(i&&af===null)continue;let Sl=d&&o?fe.replace(/\./g,"%2E"):fe,o_=Ht(v)?typeof t=="function"?t(ue,Sl):ue:ue+(d?"."+Sl:"["+Sl+"]");x.set(n,j);let sf=new WeakMap;sf.set(sp,x),Xy(W,Yy(af,o_,t,r,a,s,i,o,t==="comma"&&m&&Ht(v)?null:u,l,c,d,p,f,h,m,y,sf))}return W}function oO(n=ge){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=n.charset||ge.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Bu;if(typeof n.format<"u"){if(!nO.call(qu,n.format))throw new TypeError("Unknown format option provided.");t=n.format}let r=qu[t],a=ge.filter;(typeof n.filter=="function"||Ht(n.filter))&&(a=n.filter);let s;if(n.arrayFormat&&n.arrayFormat in Zy?s=n.arrayFormat:"indices"in n?s=n.indices?"indices":"repeat":s=ge.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let i=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:ge.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:ge.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:ge.allowEmptyArrays,arrayFormat:s,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:ge.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?ge.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:ge.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:ge.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:ge.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:ge.encodeValuesOnly,filter:a,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:ge.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:ge.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:ge.strictNullHandling}}function ip(n,e={}){let t=n,r=oO(e),a,s;typeof r.filter=="function"?(s=r.filter,t=s("",t)):Ht(r.filter)&&(s=r.filter,a=s);let i=[];if(typeof t!="object"||t===null)return"";let o=Zy[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;a||(a=Object.keys(t)),r.sort&&a.sort(r.sort);let l=new WeakMap;for(let p=0;p<a.length;++p){let f=a[p];r.skipNulls&&t[f]===null||Xy(i,Yy(t[f],f,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let c=i.join(r.delimiter),d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}var Vn="4.104.0";var Qy=!1,Hn,op,lO,cO,dO,up,pO,Vu,lp,cp,dp,Hu,pp;function eb(n,e={auto:!1}){if(Qy)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Hn)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Hn}'\``);Qy=e.auto,Hn=n.kind,op=n.fetch,lO=n.Request,cO=n.Response,dO=n.Headers,up=n.FormData,pO=n.Blob,Vu=n.File,lp=n.ReadableStream,cp=n.getMultipartRequestOptions,dp=n.getDefaultAgent,Hu=n.fileFromPath,pp=n.isFsReadStream}var Ku=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function tb({manuallyImported:n}={}){let e=n?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n",t,r,a,s;try{t=fetch,r=Request,a=Response,s=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:a,Headers:s,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new Ku(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}var fp=()=>{Hn||eb(tb(),{auto:!0})};fp();var T=class extends Error{},pe=class n extends T{constructor(e,t,r,a){super(`${n.makeMessage(e,t,r)}`),this.status=e,this.headers=a,this.request_id=a?.["x-request-id"],this.error=t;let s=t;this.code=s?.code,this.param=s?.param,this.type=s?.type}static makeMessage(e,t,r){let a=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&a?`${e} ${a}`:e?`${e} status code (no body)`:a||"(no status code or body)"}static generate(e,t,r,a){if(!e||!a)return new _r({message:r,cause:Gu(t)});let s=t?.error;return e===400?new Xa(e,s,r,a):e===401?new Ya(e,s,r,a):e===403?new Qa(e,s,r,a):e===404?new es(e,s,r,a):e===409?new ts(e,s,r,a):e===422?new rs(e,s,r,a):e===429?new ns(e,s,r,a):e>=500?new as(e,s,r,a):new n(e,s,r,a)}},ne=class extends pe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},_r=class extends pe{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},kt=class extends _r{constructor({message:e}={}){super({message:e??"Request timed out."})}},Xa=class extends pe{},Ya=class extends pe{},Qa=class extends pe{},es=class extends pe{},ts=class extends pe{},rs=class extends pe{},ns=class extends pe{},as=class extends pe{},ss=class extends T{constructor(){super("Could not parse response content as the length limit was reached")}},is=class extends T{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Ju=function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},Kn=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ye,Gn=class{constructor(){Ye.set(this,void 0),this.buffer=new Uint8Array,Ju(this,Ye,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e,r=new Uint8Array(this.buffer.length+t.length);r.set(this.buffer),r.set(t,this.buffer.length),this.buffer=r;let a=[],s;for(;(s=mO(this.buffer,Kn(this,Ye,"f")))!=null;){if(s.carriage&&Kn(this,Ye,"f")==null){Ju(this,Ye,s.index,"f");continue}if(Kn(this,Ye,"f")!=null&&(s.index!==Kn(this,Ye,"f")+1||s.carriage)){a.push(this.decodeText(this.buffer.slice(0,Kn(this,Ye,"f")-1))),this.buffer=this.buffer.slice(Kn(this,Ye,"f")),Ju(this,Ye,null,"f");continue}let i=Kn(this,Ye,"f")!==null?s.preceding-1:s.preceding,o=this.decodeText(this.buffer.slice(0,i));a.push(o),this.buffer=this.buffer.slice(s.index),Ju(this,Ye,null,"f")}return a}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new T(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new T(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new T("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};Ye=new WeakMap;Gn.NEWLINE_CHARS=new Set([`
`,"\r"]);Gn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function mO(n,e){for(let a=e??0;a<n.length;a++){if(n[a]===10)return{preceding:a,index:a+1,carriage:!1};if(n[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function rb(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}function hp(n){if(n[Symbol.asyncIterator])return n;let e=n.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}var Kt=class n{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*a(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let i of gO(e,t))if(!s){if(i.data.startsWith("[DONE]")){s=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(u){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),u}if(o&&o.error)throw new pe(void 0,o.error,void 0,gp(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(u){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),u}if(i.event=="error")throw new pe(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}s=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{s||t.abort()}}return new n(a,t)}static fromReadableStream(e,t){let r=!1;async function*a(){let i=new Gn,o=hp(e);for await(let u of o)for(let l of i.decode(u))yield l;for(let u of i.flush())yield u}async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(let o of a())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new n(s,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),a=s=>({next:()=>{if(s.length===0){let i=r.next();e.push(i),t.push(i)}return s.shift()}});return[new n(()=>a(e),this.controller),new n(()=>a(t),this.controller)]}toReadableStream(){let e=this,t,r=new TextEncoder;return new lp({async start(){t=e[Symbol.asyncIterator]()},async pull(a){try{let{value:s,done:i}=await t.next();if(i)return a.close();let o=r.encode(JSON.stringify(s)+`
`);a.enqueue(o)}catch(s){a.error(s)}},async cancel(){await t.return?.()}})}};async function*gO(n,e){if(!n.body)throw e.abort(),new T("Attempted to iterate over a response with no body");let t=new mp,r=new Gn,a=hp(n.body);for await(let s of yO(a))for(let i of r.decode(s)){let o=t.decode(i);o&&(yield o)}for(let s of r.flush()){let i=t.decode(s);i&&(yield i)}}async function*yO(n){let e=new Uint8Array;for await(let t of n){if(t==null)continue;let r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t,a=new Uint8Array(e.length+r.length);a.set(e),a.set(r,e.length),e=a;let s;for(;(s=rb(e))!==-1;)yield e.slice(0,s),e=e.slice(s)}e.length>0&&(yield e)}var mp=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,a]=bO(e,":");return a.startsWith(" ")&&(a=a.substring(1)),t==="event"?this.event=a:t==="data"&&this.data.push(a),null}};function bO(n,e){let t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}var nb=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",ab=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&$i(n),$i=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",_O=n=>ab(n)||nb(n)||pp(n);async function _p(n,e,t){if(n=await n,ab(n))return n;if(nb(n)){let a=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");let s=$i(a)?[await a.arrayBuffer()]:[a];return new Vu(s,e,t)}let r=await wO(n);if(e||(e=xO(n)??"unknown_file"),!t?.type){let a=r[0]?.type;typeof a=="string"&&(t={...t,type:a})}return new Vu(r,e,t)}async function wO(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if($i(n))e.push(await n.arrayBuffer());else if(AO(n))for await(let t of n)e.push(t);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${n?.constructor?.name}; props: ${vO(n)}`);return e}function vO(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function xO(n){return yp(n.name)||yp(n.filename)||yp(n.path)?.split(/[\\/]/).pop()}var yp=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},AO=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",wp=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var We=async n=>{let e=await sb(n.body);return cp(e,n)},sb=async n=>{let e=new up;return await Promise.all(Object.entries(n||{}).map(([t,r])=>bp(e,t,r))),e};var bp=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(_O(t)){let r=await _p(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>bp(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,a])=>bp(n,`${e}[${r}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var OO=function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},IO=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Wu;fp();async function db(n){let{response:e}=n;if(n.options.stream)return wr("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Kt.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;let r=e.headers.get("content-type")?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){let i=await e.json();return wr("response",e.status,e.url,e.headers,i),pb(i,e)}let s=await e.text();return wr("response",e.status,e.url,e.headers,s),s}function pb(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Xu=class n extends Promise{constructor(e,t=db){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new n(this.responsePromise,async t=>pb(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Yu=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:a,fetch:s}){this.baseURL=e,this.maxRetries=vp("maxRetries",t),this.timeout=vp("timeout",r),this.httpAgent=a,this.fetch=s??op}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...CO(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${$O()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async a=>{let s=a&&$i(a?.body)?new DataView(await a.body.arrayBuffer()):a?.body instanceof DataView?a.body:a?.body instanceof ArrayBuffer?new DataView(a.body):a&&ArrayBuffer.isView(a?.body)?new DataView(a.body.buffer):a?.body;return{method:e,path:t,...a,body:s}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:a,path:s,query:i,headers:o={}}=r,u=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:wp(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,l=this.calculateContentLength(u),c=this.buildURL(s,i);"timeout"in r&&vp("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let d=r.httpAgent??this.httpAgent??dp(c),p=r.timeout+1e3;typeof d?.options?.timeout=="number"&&p>(d.options.timeout??0)&&(d.options.timeout=p),this.idempotencyHeader&&a!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let f=this.buildHeaders({options:r,headers:o,contentLength:l,retryCount:t});return{req:{method:a,...u&&{body:u},headers:f,...d&&{agent:d},signal:r.signal??null},url:c,timeout:r.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:a}){let s={};r&&(s["content-length"]=r);let i=this.defaultHeaders(e);return lb(s,i),lb(s,t),wp(e.body)&&Hn!=="node"&&delete s["content-type"],Zu(i,"x-stainless-retry-count")===void 0&&Zu(t,"x-stainless-retry-count")===void 0&&(s["x-stainless-retry-count"]=String(a)),Zu(i,"x-stainless-timeout")===void 0&&Zu(t,"x-stainless-timeout")===void 0&&e.timeout&&(s["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(s,t),s}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,a){return pe.generate(e,t,r,a)}request(e,t=null){return new Xu(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e,a=r.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(r);let{req:s,url:i,timeout:o}=this.buildRequest(r,{retryCount:a-t});if(await this.prepareRequest(s,{url:i,options:r}),wr("request",i,r,s.headers),r.signal?.aborted)throw new ne;let u=new AbortController,l=await this.fetchWithTimeout(i,s,o,u).catch(Gu);if(l instanceof Error){if(r.signal?.aborted)throw new ne;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new kt:new _r({cause:l})}let c=gp(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let y=`retrying, ${t} attempts remaining`;return wr(`response (error; ${y})`,l.status,i,c),this.retryRequest(r,t,c)}let d=await l.text().catch(y=>Gu(y).message),p=kO(d),f=p?void 0:d;throw wr(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,i,c,f),this.makeStatusError(l.status,p,f,c)}return{response:l,options:r,controller:u}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new xp(this,r,e)}buildURL(e,t){let r=NO(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return fb(a)||(t={...a,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new T(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,a){let{signal:s,...i}=t||{};s&&s.addEventListener("abort",()=>a.abort());let o=setTimeout(()=>a.abort(),r),u={signal:a.signal,...i};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let a,s=r?.["retry-after-ms"];if(s){let o=parseFloat(s);Number.isNaN(o)||(a=o)}let i=r?.["retry-after"];if(i&&!a){let o=parseFloat(i);Number.isNaN(o)?a=Date.parse(i)-Date.now():a=o*1e3}if(!(a&&0<=a&&a<60*1e3)){let o=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,o)}return await vr(a),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){let s=t-e,i=Math.min(.5*Math.pow(2,s),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Vn}`}},ji=class{constructor(e,t,r,a){Wu.set(this,void 0),OO(this,Wu,e,"f"),this.options=a,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new T("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[a,s]of r)e.url.searchParams.set(a,s);t.query=void 0,t.path=e.url.toString()}return await IO(this,Wu,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Wu=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},xp=class extends Xu{constructor(e,t,r){super(t,async a=>new r(e,a.response,await db(a),a.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},gp=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),PO={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},D=n=>typeof n=="object"&&n!==null&&!fb(n)&&Object.keys(n).every(e=>hb(PO,e)),TO=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":ob(Deno.build.os),"X-Stainless-Arch":ib(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":ob(process.platform),"X-Stainless-Arch":ib(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};let n=SO();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function SO(){if(typeof navigator>"u"||!navigator)return null;let n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of n){let r=t.exec(navigator.userAgent);if(r){let a=r[1]||0,s=r[2]||0,i=r[3]||0;return{browser:e,version:`${a}.${s}.${i}`}}}return null}var ib=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",ob=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown"),ub,CO=()=>ub??(ub=TO()),kO=n=>{try{return JSON.parse(n)}catch{return}},RO=/^[a-z][a-z0-9+.-]*:/i,NO=n=>RO.test(n),vr=n=>new Promise(e=>setTimeout(e,n)),vp=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new T(`${n} must be an integer`);if(e<0)throw new T(`${n} must be a positive integer`);return e},Gu=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)};var Mi=n=>{if(typeof process<"u")return process.env?.[n]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(n)?.trim()};function fb(n){if(!n)return!0;for(let e in n)return!1;return!0}function hb(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function lb(n,e){for(let t in e){if(!hb(e,t))continue;let r=t.toLowerCase();if(!r)continue;let a=e[t];a===null?delete n[r]:a!==void 0&&(n[r]=a)}}var cb=new Set(["authorization","api-key"]);function wr(n,...e){if(typeof process<"u"&&process?.env?.DEBUG==="true"){let t=e.map(r=>{if(!r)return r;if(r.headers){let s={...r,headers:{...r.headers}};for(let i in r.headers)cb.has(i.toLowerCase())&&(s.headers[i]="REDACTED");return s}let a=null;for(let s in r)cb.has(s.toLowerCase())&&(a??(a={...r}),a[s]="REDACTED");return a??r});console.log(`OpenAI:DEBUG:${n}`,...t)}}var $O=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{let e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),mb=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",jO=n=>typeof n?.get=="function";var Zu=(n,e)=>{let t=e.toLowerCase();if(jO(n)){let r=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(a,s,i)=>s+i.toUpperCase());for(let a of[e,t,e.toUpperCase(),r]){let s=n.get(a);if(s)return s}}for(let[r,a]of Object.entries(n))if(r.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};var gb=n=>{if(typeof Buffer<"u"){let e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(n),t=e.length,r=new Uint8Array(t);for(let a=0;a<t;a++)r[a]=e.charCodeAt(a);return Array.from(new Float32Array(r.buffer))}};function Li(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}var Gt=class extends ji{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},V=class extends ji{constructor(e,t,r,a){super(e,t,r,a),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}};var b=class{constructor(e){this._client=e}};var os=class extends b{list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,Qu,{query:t,...r})}};var Br=class extends b{constructor(){super(...arguments),this.messages=new os(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/chat/completions",qr,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}},qr=class extends V{},Qu=class extends V{};Br.ChatCompletionsPage=qr;Br.Messages=os;var Ar=class extends b{constructor(){super(...arguments),this.completions=new Br(this._client)}};Ar.Completions=Br;Ar.ChatCompletionsPage=qr;var us=class extends b{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}};var ls=class extends b{create(e,t){return this._client.post("/audio/transcriptions",We({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}};var cs=class extends b{create(e,t){return this._client.post("/audio/translations",We({body:e,...t,__metadata:{model:e.model}}))}};var Jt=class extends b{constructor(){super(...arguments),this.transcriptions=new ls(this._client),this.translations=new cs(this._client),this.speech=new us(this._client)}};Jt.Transcriptions=ls;Jt.Translations=cs;Jt.Speech=us;var Vr=class extends b{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/batches",Jn,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},Jn=class extends V{};Vr.BatchesPage=Jn;var Rt=function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},ae=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ap,el,tl,Di,Fi,rl,Ui,Er,zi,nl,al,ds,yb,Hr=class{constructor(){Ap.add(this),this.controller=new AbortController,el.set(this,void 0),tl.set(this,()=>{}),Di.set(this,()=>{}),Fi.set(this,void 0),rl.set(this,()=>{}),Ui.set(this,()=>{}),Er.set(this,{}),zi.set(this,!1),nl.set(this,!1),al.set(this,!1),ds.set(this,!1),Rt(this,el,new Promise((e,t)=>{Rt(this,tl,e,"f"),Rt(this,Di,t,"f")}),"f"),Rt(this,Fi,new Promise((e,t)=>{Rt(this,rl,e,"f"),Rt(this,Ui,t,"f")}),"f"),ae(this,el,"f").catch(()=>{}),ae(this,Fi,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},ae(this,Ap,"m",yb).bind(this))},0)}_connected(){this.ended||(ae(this,tl,"f").call(this),this._emit("connect"))}get ended(){return ae(this,zi,"f")}get errored(){return ae(this,nl,"f")}get aborted(){return ae(this,al,"f")}abort(){this.controller.abort()}on(e,t){return(ae(this,Er,"f")[e]||(ae(this,Er,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=ae(this,Er,"f")[e];if(!r)return this;let a=r.findIndex(s=>s.listener===t);return a>=0&&r.splice(a,1),this}once(e,t){return(ae(this,Er,"f")[e]||(ae(this,Er,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Rt(this,ds,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Rt(this,ds,!0,"f"),await ae(this,Fi,"f")}_emit(e,...t){if(ae(this,zi,"f"))return;e==="end"&&(Rt(this,zi,!0,"f"),ae(this,rl,"f").call(this));let r=ae(this,Er,"f")[e];if(r&&(ae(this,Er,"f")[e]=r.filter(a=>!a.once),r.forEach(({listener:a})=>a(...t))),e==="abort"){let a=t[0];!ae(this,ds,"f")&&!r?.length&&Promise.reject(a),ae(this,Di,"f").call(this,a),ae(this,Ui,"f").call(this,a),this._emit("end");return}if(e==="error"){let a=t[0];!ae(this,ds,"f")&&!r?.length&&Promise.reject(a),ae(this,Di,"f").call(this,a),ae(this,Ui,"f").call(this,a),this._emit("end")}}_emitFinal(){}};el=new WeakMap,tl=new WeakMap,Di=new WeakMap,Fi=new WeakMap,rl=new WeakMap,Ui=new WeakMap,Er=new WeakMap,zi=new WeakMap,nl=new WeakMap,al=new WeakMap,ds=new WeakMap,Ap=new WeakSet,yb=function(e){if(Rt(this,nl,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ne),e instanceof ne)return Rt(this,al,!0,"f"),this._emit("abort",e);if(e instanceof T)return this._emit("error",e);if(e instanceof Error){let t=new T(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new T(String(e)))};var k=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Qe=function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},Ee,Ep,Wt,sl,Nt,Zn,ps,Wn,ul,et,il,ol,Vi,Bi,qi,bb,_b,wb,vb,xb,Ab,Eb,Zt=class n extends Hr{constructor(){super(...arguments),Ee.add(this),Ep.set(this,[]),Wt.set(this,{}),sl.set(this,{}),Nt.set(this,void 0),Zn.set(this,void 0),ps.set(this,void 0),Wn.set(this,void 0),ul.set(this,void 0),et.set(this,void 0),il.set(this,void 0),ol.set(this,void 0),Vi.set(this,void 0)}[(Ep=new WeakMap,Wt=new WeakMap,sl=new WeakMap,Nt=new WeakMap,Zn=new WeakMap,ps=new WeakMap,Wn=new WeakMap,ul=new WeakMap,et=new WeakMap,il=new WeakMap,ol=new WeakMap,Vi=new WeakMap,Ee=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",a=>{let s=t.shift();s?s.resolve(a):e.push(a)}),this.on("end",()=>{r=!0;for(let a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{r=!0;for(let s of t)s.reject(a);t.length=0}),this.on("error",a=>{r=!0;for(let s of t)s.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,i)=>t.push({resolve:s,reject:i})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new n;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let a=Kt.fromReadableStream(e,this.controller);for await(let s of a)k(this,Ee,"m",Bi).call(this,s);if(a.controller.signal?.aborted)throw new ne;return this._addRun(k(this,Ee,"m",qi).call(this))}toReadableStream(){return new Kt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,a,s){let i=new n;return i._run(()=>i._runToolAssistantStream(e,t,r,a,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,r,a,s){let i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let o={...a,stream:!0},u=await e.submitToolOutputs(t,r,o,{...s,signal:this.controller.signal});this._connected();for await(let l of u)k(this,Ee,"m",Bi).call(this,l);if(u.controller.signal?.aborted)throw new ne;return this._addRun(k(this,Ee,"m",qi).call(this))}static createThreadAssistantStream(e,t,r){let a=new n;return a._run(()=>a._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(e,t,r,a){let s=new n;return s._run(()=>s._runAssistantStream(e,t,r,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return k(this,il,"f")}currentRun(){return k(this,ol,"f")}currentMessageSnapshot(){return k(this,Nt,"f")}currentRunStepSnapshot(){return k(this,Vi,"f")}async finalRunSteps(){return await this.done(),Object.values(k(this,Wt,"f"))}async finalMessages(){return await this.done(),Object.values(k(this,sl,"f"))}async finalRun(){if(await this.done(),!k(this,Zn,"f"))throw Error("Final run was not received.");return k(this,Zn,"f")}async _createThreadAssistantStream(e,t,r){let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let s={...t,stream:!0},i=await e.createAndRun(s,{...r,signal:this.controller.signal});this._connected();for await(let o of i)k(this,Ee,"m",Bi).call(this,o);if(i.controller.signal?.aborted)throw new ne;return this._addRun(k(this,Ee,"m",qi).call(this))}async _createAssistantStream(e,t,r,a){let s=a?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let i={...r,stream:!0},o=await e.create(t,i,{...a,signal:this.controller.signal});this._connected();for await(let u of o)k(this,Ee,"m",Bi).call(this,u);if(o.controller.signal?.aborted)throw new ne;return this._addRun(k(this,Ee,"m",qi).call(this))}static accumulateDelta(e,t){for(let[r,a]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=a;continue}let s=e[r];if(s==null){e[r]=a;continue}if(r==="index"||r==="type"){e[r]=a;continue}if(typeof s=="string"&&typeof a=="string")s+=a;else if(typeof s=="number"&&typeof a=="number")s+=a;else if(Li(s)&&Li(a))s=this.accumulateDelta(s,a);else if(Array.isArray(s)&&Array.isArray(a)){if(s.every(i=>typeof i=="string"||typeof i=="number")){s.push(...a);continue}for(let i of a){if(!Li(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);let o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);let u=s[o];u==null?s.push(i):s[o]=this.accumulateDelta(u,i)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${a}, accValue: ${s}`);e[r]=s}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,a){return await this._createAssistantStream(t,e,r,a)}async _runToolAssistantStream(e,t,r,a,s){return await this._createToolAssistantStream(r,e,t,a,s)}};Bi=function(e){if(!this.ended)switch(Qe(this,il,e,"f"),k(this,Ee,"m",wb).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":k(this,Ee,"m",Eb).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":k(this,Ee,"m",_b).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":k(this,Ee,"m",bb).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},qi=function(){if(this.ended)throw new T("stream has ended, this shouldn't happen");if(!k(this,Zn,"f"))throw Error("Final run has not been received");return k(this,Zn,"f")},bb=function(e){let[t,r]=k(this,Ee,"m",xb).call(this,e,k(this,Nt,"f"));Qe(this,Nt,t,"f"),k(this,sl,"f")[t.id]=t;for(let a of r){let s=t.content[a.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let a of e.data.delta.content){if(a.type=="text"&&a.text){let s=a.text,i=t.content[a.index];if(i&&i.type=="text")this._emit("textDelta",s,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(a.index!=k(this,ps,"f")){if(k(this,Wn,"f"))switch(k(this,Wn,"f").type){case"text":this._emit("textDone",k(this,Wn,"f").text,k(this,Nt,"f"));break;case"image_file":this._emit("imageFileDone",k(this,Wn,"f").image_file,k(this,Nt,"f"));break}Qe(this,ps,a.index,"f")}Qe(this,Wn,t.content[a.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(k(this,ps,"f")!==void 0){let a=e.data.content[k(this,ps,"f")];if(a)switch(a.type){case"image_file":this._emit("imageFileDone",a.image_file,k(this,Nt,"f"));break;case"text":this._emit("textDone",a.text,k(this,Nt,"f"));break}}k(this,Nt,"f")&&this._emit("messageDone",e.data),Qe(this,Nt,void 0,"f")}},_b=function(e){let t=k(this,Ee,"m",vb).call(this,e);switch(Qe(this,Vi,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let s of r.step_details.tool_calls)s.index==k(this,ul,"f")?this._emit("toolCallDelta",s,t.step_details.tool_calls[s.index]):(k(this,et,"f")&&this._emit("toolCallDone",k(this,et,"f")),Qe(this,ul,s.index,"f"),Qe(this,et,t.step_details.tool_calls[s.index],"f"),k(this,et,"f")&&this._emit("toolCallCreated",k(this,et,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Qe(this,Vi,void 0,"f"),e.data.step_details.type=="tool_calls"&&k(this,et,"f")&&(this._emit("toolCallDone",k(this,et,"f")),Qe(this,et,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},wb=function(e){k(this,Ep,"f").push(e),this._emit("event",e)},vb=function(e){switch(e.event){case"thread.run.step.created":return k(this,Wt,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=k(this,Wt,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let a=Zt.accumulateDelta(t,r.delta);k(this,Wt,"f")[e.data.id]=a}return k(this,Wt,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":k(this,Wt,"f")[e.data.id]=e.data;break}if(k(this,Wt,"f")[e.data.id])return k(this,Wt,"f")[e.data.id];throw new Error("No snapshot available")},xb=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=e.data;if(a.delta.content)for(let s of a.delta.content)if(s.index in t.content){let i=t.content[s.index];t.content[s.index]=k(this,Ee,"m",Ab).call(this,s,i)}else t.content[s.index]=s,r.push(s);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Ab=function(e,t){return Zt.accumulateDelta(t,e)},Eb=function(e){switch(Qe(this,ol,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Qe(this,Zn,e.data,"f"),k(this,et,"f")&&(this._emit("toolCallDone",k(this,et,"f")),Qe(this,et,void 0,"f"));break;case"thread.run.cancelling":break}};var Xn=class extends b{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/assistants",fs,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}},fs=class extends V{};Xn.AssistantsPage=fs;function Op(n){return typeof n.parse=="function"}var Kr=n=>n?.role==="assistant",Ip=n=>n?.role==="function",Pp=n=>n?.role==="tool";function Hi(n){return n?.$brand==="auto-parseable-response-format"}function Yn(n){return n?.$brand==="auto-parseable-tool"}function Ob(n,e){return!e||!Tp(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Ki(n,e)}function Ki(n,e){let t=n.choices.map(r=>{if(r.finish_reason==="length")throw new ss;if(r.finish_reason==="content_filter")throw new is;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:r.message.tool_calls?.map(a=>qO(e,a))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?BO(e,r.message.content):null}}});return{...n,choices:t}}function BO(n,e){return n.response_format?.type!=="json_schema"?null:n.response_format?.type==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function qO(n,e){let t=n.tools?.find(r=>r.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:Yn(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function Ib(n,e){if(!n)return!1;let t=n.tools?.find(r=>r.function?.name===e.function.name);return Yn(t)||t?.function.strict||!1}function Tp(n){return Hi(n.response_format)?!0:n.tools?.some(e=>Yn(e)||e.type==="function"&&e.function.strict===!0)??!1}function Pb(n){for(let e of n??[]){if(e.type!=="function")throw new T(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new T(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Ze=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ne,Sp,ll,Cp,kp,Rp,Sb,Np,Tb=10,hs=class extends Hr{constructor(){super(...arguments),Ne.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Ip(e)||Pp(e))&&e.content)this._emit("functionCallResult",e.content);else if(Kr(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Kr(e)&&e.tool_calls)for(let r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new T("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Ze(this,Ne,"m",Sp).call(this)}async finalMessage(){return await this.done(),Ze(this,Ne,"m",ll).call(this)}async finalFunctionCall(){return await this.done(),Ze(this,Ne,"m",Cp).call(this)}async finalFunctionCallResult(){return await this.done(),Ze(this,Ne,"m",kp).call(this)}async totalUsage(){return await this.done(),Ze(this,Ne,"m",Rp).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=Ze(this,Ne,"m",ll).call(this);t&&this._emit("finalMessage",t);let r=Ze(this,Ne,"m",Sp).call(this);r&&this._emit("finalContent",r);let a=Ze(this,Ne,"m",Cp).call(this);a&&this._emit("finalFunctionCall",a);let s=Ze(this,Ne,"m",kp).call(this);s!=null&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",Ze(this,Ne,"m",Rp).call(this))}async _createChatCompletion(e,t,r){let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),Ze(this,Ne,"m",Sb).call(this,t);let s=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Ki(s,t))}async _runChatCompletion(e,t,r){for(let a of t.messages)this._addMessage(a,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){let a="function",{function_call:s="auto",stream:i,...o}=t,u=typeof s!="string"&&s?.name,{maxChatCompletions:l=Tb}=r||{},c={};for(let p of t.functions)c[p.name||p.function.name]=p;let d=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(let p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){let h=(await this._createChatCompletion(e,{...o,function_call:s,functions:d,messages:[...this.messages]},r)).choices[0]?.message;if(!h)throw new T("missing message in ChatCompletion response");if(!h.function_call)return;let{name:m,arguments:y}=h.function_call,x=c[m];if(x){if(u&&u!==m){let N=`Invalid function_call: ${JSON.stringify(m)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:a,name:m,content:N});continue}}else{let N=`Invalid function_call: ${JSON.stringify(m)}. Available options are: ${d.map(W=>JSON.stringify(W.name)).join(", ")}. Please try again`;this._addMessage({role:a,name:m,content:N});continue}let v;try{v=Op(x)?await x.parse(y):y}catch(N){this._addMessage({role:a,name:m,content:N instanceof Error?N.message:String(N)});continue}let P=await x.function(v,this),j=Ze(this,Ne,"m",Np).call(this,P);if(this._addMessage({role:a,name:m,content:j}),u)return}}async _runTools(e,t,r){let a="tool",{tool_choice:s="auto",stream:i,...o}=t,u=typeof s!="string"&&s?.function?.name,{maxChatCompletions:l=Tb}=r||{},c=t.tools.map(f=>{if(Yn(f)){if(!f.$callback)throw new T("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:f.$callback,name:f.function.name,description:f.function.description||"",parameters:f.function.parameters,parse:f.$parseRaw,strict:!0}}}return f}),d={};for(let f of c)f.type==="function"&&(d[f.function.name||f.function.function.name]=f.function);let p="tools"in t?c.map(f=>f.type==="function"?{type:"function",function:{name:f.function.name||f.function.function.name,parameters:f.function.parameters,description:f.function.description,strict:f.function.strict}}:f):void 0;for(let f of t.messages)this._addMessage(f,!1);for(let f=0;f<l;++f){let m=(await this._createChatCompletion(e,{...o,tool_choice:s,tools:p,messages:[...this.messages]},r)).choices[0]?.message;if(!m)throw new T("missing message in ChatCompletion response");if(!m.tool_calls?.length)return;for(let y of m.tool_calls){if(y.type!=="function")continue;let x=y.id,{name:v,arguments:P}=y.function,j=d[v];if(j){if(u&&u!==v){let Z=`Invalid tool_call: ${JSON.stringify(v)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:a,tool_call_id:x,content:Z});continue}}else{let Z=`Invalid tool_call: ${JSON.stringify(v)}. Available options are: ${Object.keys(d).map(ue=>JSON.stringify(ue)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:x,content:Z});continue}let N;try{N=Op(j)?await j.parse(P):P}catch(Z){let ue=Z instanceof Error?Z.message:String(Z);this._addMessage({role:a,tool_call_id:x,content:ue});continue}let W=await j.function(N,this),Y=Ze(this,Ne,"m",Np).call(this,W);if(this._addMessage({role:a,tool_call_id:x,content:Y}),u)return}}}};Ne=new WeakSet,Sp=function(){return Ze(this,Ne,"m",ll).call(this).content??null},ll=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(Kr(t)){let{function_call:r,...a}=t,s={...a,content:t.content??null,refusal:t.refusal??null};return r&&(s.function_call=r),s}}throw new T("stream ended without producing a ChatCompletionMessage with role=assistant")},Cp=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Kr(t)&&t?.function_call)return t.function_call;if(Kr(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},kp=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Ip(t)&&t.content!=null||Pp(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>r.role==="assistant"&&r.tool_calls?.some(a=>a.type==="function"&&a.id===t.tool_call_id)))return t.content}},Rp=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Sb=function(e){if(e.n!=null&&e.n>1)throw new T("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Np=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Gi=class n extends hs{static runFunctions(e,t,r){let a=new n,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(e,t,s)),a}static runTools(e,t,r){let a=new n,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,s)),a}_addMessage(e,t=!0){super._addMessage(e,t),Kr(e)&&e.content&&this._emit("content",e.content)}};var be={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},$p=class extends Error{},jp=class extends Error{};function VO(n,e=be.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return HO(n.trim(),e)}var HO=(n,e)=>{let t=n.length,r=0,a=p=>{throw new $p(`${p} at position ${r}`)},s=p=>{throw new jp(`${p} at position ${r}`)},i=()=>(d(),r>=t&&a("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?u():n[r]==="["?l():n.substring(r,r+4)==="null"||be.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||be.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||be.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||be.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||be.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||be.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):c()),o=()=>{let p=r,f=!1;for(r++;r<t&&(n[r]!=='"'||f&&n[r-1]==="\\");)f=n[r]==="\\"?!f:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(p,++r-Number(f)))}catch(h){s(String(h))}else if(be.STR&e)try{return JSON.parse(n.substring(p,r-Number(f))+'"')}catch{return JSON.parse(n.substring(p,n.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},u=()=>{r++,d();let p={};try{for(;n[r]!=="}";){if(d(),r>=t&&be.OBJ&e)return p;let f=o();d(),r++;try{let h=i();Object.defineProperty(p,f,{value:h,writable:!0,enumerable:!0,configurable:!0})}catch(h){if(be.OBJ&e)return p;throw h}d(),n[r]===","&&r++}}catch{if(be.OBJ&e)return p;a("Expected '}' at end of object")}return r++,p},l=()=>{r++;let p=[];try{for(;n[r]!=="]";)p.push(i()),d(),n[r]===","&&r++}catch{if(be.ARR&e)return p;a("Expected ']' at end of array")}return r++,p},c=()=>{if(r===0){n==="-"&&be.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(n)}catch(f){if(be.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}s(String(f))}}let p=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(be.NUM&e)&&a("Unterminated number literal");try{return JSON.parse(n.substring(p,r))}catch{n.substring(p,r)==="-"&&be.NUM&e&&a("Not sure what '-' is");try{return JSON.parse(n.substring(p,n.lastIndexOf("e")))}catch(h){s(String(h))}}},d=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return i()},Mp=n=>VO(n,be.ALL^be.NUM);var ms=function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},Q=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ye,Or,gs,Gr,Lp,cl,Dp,Fp,Up,dl,zp,Cb,ys=class n extends hs{constructor(e){super(),ye.add(this),Or.set(this,void 0),gs.set(this,void 0),Gr.set(this,void 0),ms(this,Or,e,"f"),ms(this,gs,[],"f")}get currentChatCompletionSnapshot(){return Q(this,Gr,"f")}static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let a=new n(t);return a._run(()=>a._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(e,t,r){super._createChatCompletion;let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),Q(this,ye,"m",Lp).call(this);let s=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(let i of s)Q(this,ye,"m",Dp).call(this,i);if(s.controller.signal?.aborted)throw new ne;return this._addChatCompletion(Q(this,ye,"m",dl).call(this))}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Q(this,ye,"m",Lp).call(this),this._connected();let a=Kt.fromReadableStream(e,this.controller),s;for await(let i of a)s&&s!==i.id&&this._addChatCompletion(Q(this,ye,"m",dl).call(this)),Q(this,ye,"m",Dp).call(this,i),s=i.id;if(a.controller.signal?.aborted)throw new ne;return this._addChatCompletion(Q(this,ye,"m",dl).call(this))}[(Or=new WeakMap,gs=new WeakMap,Gr=new WeakMap,ye=new WeakSet,Lp=function(){this.ended||ms(this,Gr,void 0,"f")},cl=function(t){let r=Q(this,gs,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Q(this,gs,"f")[t.index]=r,r)},Dp=function(t){if(this.ended)return;let r=Q(this,ye,"m",Cb).call(this,t);this._emit("chunk",t,r);for(let a of t.choices){let s=r.choices[a.index];a.delta.content!=null&&s.message?.role==="assistant"&&s.message?.content&&(this._emit("content",a.delta.content,s.message.content),this._emit("content.delta",{delta:a.delta.content,snapshot:s.message.content,parsed:s.message.parsed})),a.delta.refusal!=null&&s.message?.role==="assistant"&&s.message?.refusal&&this._emit("refusal.delta",{delta:a.delta.refusal,snapshot:s.message.refusal}),a.logprobs?.content!=null&&s.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:a.logprobs?.content,snapshot:s.logprobs?.content??[]}),a.logprobs?.refusal!=null&&s.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:a.logprobs?.refusal,snapshot:s.logprobs?.refusal??[]});let i=Q(this,ye,"m",cl).call(this,s);s.finish_reason&&(Q(this,ye,"m",Up).call(this,s),i.current_tool_call_index!=null&&Q(this,ye,"m",Fp).call(this,s,i.current_tool_call_index));for(let o of a.delta.tool_calls??[])i.current_tool_call_index!==o.index&&(Q(this,ye,"m",Up).call(this,s),i.current_tool_call_index!=null&&Q(this,ye,"m",Fp).call(this,s,i.current_tool_call_index)),i.current_tool_call_index=o.index;for(let o of a.delta.tool_calls??[]){let u=s.message.tool_calls?.[o.index];u?.type&&(u?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:u.function?.name,index:o.index,arguments:u.function.arguments,parsed_arguments:u.function.parsed_arguments,arguments_delta:o.function?.arguments??""}):(u?.type,void 0))}}},Fp=function(t,r){if(Q(this,ye,"m",cl).call(this,t).done_tool_calls.has(r))return;let s=t.message.tool_calls?.[r];if(!s)throw new Error("no tool call snapshot");if(!s.type)throw new Error("tool call snapshot missing `type`");if(s.type==="function"){let i=Q(this,Or,"f")?.tools?.find(o=>o.type==="function"&&o.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:r,arguments:s.function.arguments,parsed_arguments:Yn(i)?i.$parseRaw(s.function.arguments):i?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},Up=function(t){let r=Q(this,ye,"m",cl).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;let a=Q(this,ye,"m",zp).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},dl=function(){if(this.ended)throw new T("stream has ended, this shouldn't happen");let t=Q(this,Gr,"f");if(!t)throw new T("request ended without sending any chunks");return ms(this,Gr,void 0,"f"),ms(this,gs,[],"f"),KO(t,Q(this,Or,"f"))},zp=function(){let t=Q(this,Or,"f")?.response_format;return Hi(t)?t:null},Cb=function(t){var r,a,s,i;let o=Q(this,Gr,"f"),{choices:u,...l}=t;o?Object.assign(o,l):o=ms(this,Gr,{...l,choices:[]},"f");for(let{delta:c,finish_reason:d,index:p,logprobs:f=null,...h}of t.choices){let m=o.choices[p];if(m||(m=o.choices[p]={finish_reason:d,index:p,message:{},logprobs:f,...h}),f)if(!m.logprobs)m.logprobs=Object.assign({},f);else{let{content:W,refusal:Y,...Z}=f;Object.assign(m.logprobs,Z),W&&((r=m.logprobs).content??(r.content=[]),m.logprobs.content.push(...W)),Y&&((a=m.logprobs).refusal??(a.refusal=[]),m.logprobs.refusal.push(...Y))}if(d&&(m.finish_reason=d,Q(this,Or,"f")&&Tp(Q(this,Or,"f")))){if(d==="length")throw new ss;if(d==="content_filter")throw new is}if(Object.assign(m,h),!c)continue;let{content:y,refusal:x,function_call:v,role:P,tool_calls:j,...N}=c;if(Object.assign(m.message,N),x&&(m.message.refusal=(m.message.refusal||"")+x),P&&(m.message.role=P),v&&(m.message.function_call?(v.name&&(m.message.function_call.name=v.name),v.arguments&&((s=m.message.function_call).arguments??(s.arguments=""),m.message.function_call.arguments+=v.arguments)):m.message.function_call=v),y&&(m.message.content=(m.message.content||"")+y,!m.message.refusal&&Q(this,ye,"m",zp).call(this)&&(m.message.parsed=Mp(m.message.content))),j){m.message.tool_calls||(m.message.tool_calls=[]);for(let{index:W,id:Y,type:Z,function:ue,...se}of j){let fe=(i=m.message.tool_calls)[W]??(i[W]={});Object.assign(fe,se),Y&&(fe.id=Y),Z&&(fe.type=Z),ue&&(fe.function??(fe.function={name:ue.name??"",arguments:""})),ue?.name&&(fe.function.name=ue.name),ue?.arguments&&(fe.function.arguments+=ue.arguments,Ib(Q(this,Or,"f"),fe)&&(fe.function.parsed_arguments=Mp(fe.function.arguments)))}}}return o},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",a=>{let s=t.shift();s?s.resolve(a):e.push(a)}),this.on("end",()=>{r=!0;for(let a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{r=!0;for(let s of t)s.reject(a);t.length=0}),this.on("error",a=>{r=!0;for(let s of t)s.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,i)=>t.push({resolve:s,reject:i})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Kt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function KO(n,e){let{id:t,choices:r,created:a,model:s,system_fingerprint:i,...o}=n,u={...o,id:t,choices:r.map(({message:l,finish_reason:c,index:d,logprobs:p,...f})=>{if(!c)throw new T(`missing finish_reason for choice ${d}`);let{content:h=null,function_call:m,tool_calls:y,...x}=l,v=l.role;if(!v)throw new T(`missing role for choice ${d}`);if(m){let{arguments:P,name:j}=m;if(P==null)throw new T(`missing function_call.arguments for choice ${d}`);if(!j)throw new T(`missing function_call.name for choice ${d}`);return{...f,message:{content:h,function_call:{arguments:P,name:j},role:v,refusal:l.refusal??null},finish_reason:c,index:d,logprobs:p}}return y?{...f,index:d,finish_reason:c,logprobs:p,message:{...x,role:v,content:h,refusal:l.refusal??null,tool_calls:y.map((P,j)=>{let{function:N,type:W,id:Y,...Z}=P,{arguments:ue,name:se,...fe}=N||{};if(Y==null)throw new T(`missing choices[${d}].tool_calls[${j}].id
${pl(n)}`);if(W==null)throw new T(`missing choices[${d}].tool_calls[${j}].type
${pl(n)}`);if(se==null)throw new T(`missing choices[${d}].tool_calls[${j}].function.name
${pl(n)}`);if(ue==null)throw new T(`missing choices[${d}].tool_calls[${j}].function.arguments
${pl(n)}`);return{...Z,id:Y,type:W,function:{...fe,name:se,arguments:ue}}})}}:{...f,message:{...x,content:h,role:v,refusal:l.refusal??null},finish_reason:c,index:d,logprobs:p}}),created:a,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Ob(u,e)}function pl(n){return JSON.stringify(n)}var Ji=class n extends ys{static fromReadableStream(e){let t=new n(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let a=new n(null),s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return a._run(()=>a._runFunctions(e,t,s)),a}static runTools(e,t,r){let a=new n(t),s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(e,t,s)),a}};var Wi=class extends b{parse(e,t){return Pb(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>Ki(r,e))}runFunctions(e,t){return e.stream?Ji.runFunctions(this._client,e,t):Gi.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Ji.runTools(this._client,e,t):Gi.runTools(this._client,e,t)}stream(e,t){return ys.createChatCompletion(this._client,e,t)}};var bs=class extends b{constructor(){super(...arguments),this.completions=new Wi(this._client)}};(function(n){n.Completions=Wi})(bs||(bs={}));var _s=class extends b{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var ws=class extends b{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}};var Jr=class extends b{constructor(){super(...arguments),this.sessions=new _s(this._client),this.transcriptionSessions=new ws(this._client)}};Jr.Sessions=_s;Jr.TranscriptionSessions=ws;var Qn=class extends b{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,a){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,vs,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},vs=class extends V{};Qn.MessagesPage=vs;var ea=class extends b{retrieve(e,t,r,a={},s){return D(a)?this.retrieve(e,t,r,{},a):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:a,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t,r={},a){return D(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,xs,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}},xs=class extends V{};ea.RunStepsPage=xs;var Ir=class extends b{constructor(){super(...arguments),this.steps=new ea(this._client)}create(e,t,r){let{include:a,...s}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:a},body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,a){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,As,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let a=await this.create(e,t,r);return await this.poll(e,a.id,r)}createAndStream(e,t,r){return Zt.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let a={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:s,response:i}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...a}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let u=i.headers.get("openai-poll-after-ms");if(u){let l=parseInt(u);isNaN(l)||(o=l)}}await vr(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,r){return Zt.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,a){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,a){let s=await this.submitToolOutputs(e,t,r,a);return await this.poll(e,s.id,a)}submitToolOutputsStream(e,t,r,a){return Zt.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,a)}},As=class extends V{};Ir.RunsPage=As;Ir.Steps=ea;Ir.RunStepsPage=xs;var Xt=class extends b{constructor(){super(...arguments),this.runs=new Ir(this._client),this.messages=new Qn(this._client)}create(e={},t){return D(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return Zt.createThreadAssistantStream(e,this._client.beta.threads,t)}};Xt.Runs=Ir;Xt.RunsPage=As;Xt.Messages=Qn;Xt.MessagesPage=vs;var $t=class extends b{constructor(){super(...arguments),this.realtime=new Jr(this._client),this.chat=new bs(this._client),this.assistants=new Xn(this._client),this.threads=new Xt(this._client)}};$t.Realtime=Jr;$t.Assistants=Xn;$t.AssistantsPage=fs;$t.Threads=Xt;var ta=class extends b{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var Es=class extends b{retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}/content`,{...r,headers:{Accept:"application/binary",...r?.headers},__binaryResponse:!0})}};var Wr=class extends b{constructor(){super(...arguments),this.content=new Es(this._client)}create(e,t,r){return this._client.post(`/containers/${e}/files`,We({body:t,...r}))}retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}`,r)}list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,Os,{query:t,...r})}del(e,t,r){return this._client.delete(`/containers/${e}/files/${t}`,{...r,headers:{Accept:"*/*",...r?.headers}})}},Os=class extends V{};Wr.FileListResponsesPage=Os;Wr.Content=Es;var Yt=class extends b{constructor(){super(...arguments),this.files=new Wr(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/containers",ra,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}},ra=class extends V{};Yt.ContainerListResponsesPage=ra;Yt.Files=Wr;Yt.FileListResponsesPage=Os;var na=class extends b{create(e,t){let r=!!e.encoding_format,a=r?e.encoding_format:"base64";r&&wr("Request","User defined encoding_format:",e.encoding_format);let s=this._client.post("/embeddings",{body:{...e,encoding_format:a},...t});return r?s:(wr("response","Decoding base64 embeddings to float32 array"),s._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{let u=o.embedding;o.embedding=gb(u)}),i)))}};var aa=class extends b{retrieve(e,t,r,a){return this._client.get(`/evals/${e}/runs/${t}/output_items/${r}`,a)}list(e,t,r={},a){return D(r)?this.list(e,t,{},r):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,Is,{query:r,...a})}},Is=class extends V{};aa.OutputItemListResponsesPage=Is;var Pr=class extends b{constructor(){super(...arguments),this.outputItems=new aa(this._client)}create(e,t,r){return this._client.post(`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){return this._client.get(`/evals/${e}/runs/${t}`,r)}list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Ps,{query:t,...r})}del(e,t,r){return this._client.delete(`/evals/${e}/runs/${t}`,r)}cancel(e,t,r){return this._client.post(`/evals/${e}/runs/${t}`,r)}},Ps=class extends V{};Pr.RunListResponsesPage=Ps;Pr.OutputItems=aa;Pr.OutputItemListResponsesPage=Is;var Qt=class extends b{constructor(){super(...arguments),this.runs=new Pr(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,r){return this._client.post(`/evals/${e}`,{body:t,...r})}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/evals",sa,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}},sa=class extends V{};Qt.EvalListResponsesPage=sa;Qt.Runs=Pr;Qt.RunListResponsesPage=Ps;var Zr=class extends b{create(e,t){return this._client.post("/files",We({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/files",ia,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){let a=new Set(["processed","error","deleted"]),s=Date.now(),i=await this.retrieve(e);for(;!i.status||!a.has(i.status);)if(await vr(t),i=await this.retrieve(e),Date.now()-s>r)throw new kt({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return i}},ia=class extends V{};Zr.FileObjectsPage=ia;var Ts=class extends b{};var Ss=class extends b{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var oa=class extends b{constructor(){super(...arguments),this.graders=new Ss(this._client)}};oa.Graders=Ss;var ua=class extends b{create(e,t,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Cs,{body:t,method:"post",...r})}retrieve(e,t={},r){return D(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}del(e,t,r){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,r)}},Cs=class extends Gt{};ua.PermissionCreateResponsesPage=Cs;var Xr=class extends b{constructor(){super(...arguments),this.permissions=new ua(this._client)}};Xr.Permissions=ua;Xr.PermissionCreateResponsesPage=Cs;var la=class extends b{list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ks,{query:t,...r})}},ks=class extends V{};la.FineTuningJobCheckpointsPage=ks;var er=class extends b{constructor(){super(...arguments),this.checkpoints=new la(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Rs,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return D(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Ns,{query:t,...r})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}},Rs=class extends V{},Ns=class extends V{};er.FineTuningJobsPage=Rs;er.FineTuningJobEventsPage=Ns;er.Checkpoints=la;er.FineTuningJobCheckpointsPage=ks;var tt=class extends b{constructor(){super(...arguments),this.methods=new Ts(this._client),this.jobs=new er(this._client),this.checkpoints=new Xr(this._client),this.alpha=new oa(this._client)}};tt.Methods=Ts;tt.Jobs=er;tt.FineTuningJobsPage=Rs;tt.FineTuningJobEventsPage=Ns;tt.Checkpoints=Xr;tt.Alpha=oa;var $s=class extends b{};var Yr=class extends b{constructor(){super(...arguments),this.graderModels=new $s(this._client)}};Yr.GraderModels=$s;var ca=class extends b{createVariation(e,t){return this._client.post("/images/variations",We({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",We({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var Qr=class extends b{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",da,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},da=class extends Gt{};Qr.ModelsPage=da;var pa=class extends b{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function kb(n,e){return!e||!mI(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:Bp(n,e)}function Bp(n,e){let t=n.output.map(a=>{if(a.type==="function_call")return{...a,parsed_arguments:bI(e,a)};if(a.type==="message"){let s=a.content.map(i=>i.type==="output_text"?{...i,parsed:hI(e,i.text)}:i);return{...a,content:s}}return a}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||qp(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(let a of r.output)if(a.type==="message"){for(let s of a.content)if(s.type==="output_text"&&s.parsed!==null)return s.parsed}return null}}),r}function hI(n,e){return n.text?.format?.type!=="json_schema"?null:"$parseRaw"in n.text?.format?(n.text?.format).$parseRaw(e):JSON.parse(e)}function mI(n){return!!Hi(n.text?.format)}function gI(n){return n?.$brand==="auto-parseable-tool"}function yI(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function bI(n,e){let t=yI(n.tools??[],e.name);return{...e,...e,parsed_arguments:gI(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function qp(n){let e=[];for(let t of n.output)if(t.type==="message")for(let r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var js=class extends b{list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,fl,{query:t,...r})}};var Ms=function(n,e,t,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!a:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(n,t):a?a.value=t:e.set(n,t),t},en=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ls,hl,tn,ml,Rb,Nb,$b,jb,gl=class n extends Hr{constructor(e){super(),Ls.add(this),hl.set(this,void 0),tn.set(this,void 0),ml.set(this,void 0),Ms(this,hl,e,"f")}static createResponse(e,t,r){let a=new n(t);return a._run(()=>a._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createOrRetrieveResponse(e,t,r){let a=r?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),en(this,Ls,"m",Rb).call(this);let s,i=null;"response_id"in t?(s=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):s=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(let o of s)en(this,Ls,"m",Nb).call(this,o,i);if(s.controller.signal?.aborted)throw new ne;return en(this,Ls,"m",$b).call(this)}[(hl=new WeakMap,tn=new WeakMap,ml=new WeakMap,Ls=new WeakSet,Rb=function(){this.ended||Ms(this,tn,void 0,"f")},Nb=function(t,r){if(this.ended)return;let a=(i,o)=>{(r==null||o.sequence_number>r)&&this._emit(i,o)},s=en(this,Ls,"m",jb).call(this,t);switch(a("event",t),t.type){case"response.output_text.delta":{let i=s.output[t.output_index];if(!i)throw new T(`missing output at index ${t.output_index}`);if(i.type==="message"){let o=i.content[t.content_index];if(!o)throw new T(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new T(`expected content to be 'output_text', got ${o.type}`);a("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{let i=s.output[t.output_index];if(!i)throw new T(`missing output at index ${t.output_index}`);i.type==="function_call"&&a("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:a(t.type,t);break}},$b=function(){if(this.ended)throw new T("stream has ended, this shouldn't happen");let t=en(this,tn,"f");if(!t)throw new T("request ended without sending any events");Ms(this,tn,void 0,"f");let r=wI(t,en(this,hl,"f"));return Ms(this,ml,r,"f"),r},jb=function(t){let r=en(this,tn,"f");if(!r){if(t.type!=="response.created")throw new T(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=Ms(this,tn,t.response,"f"),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{let a=r.output[t.output_index];if(!a)throw new T(`missing output at index ${t.output_index}`);a.type==="message"&&a.content.push(t.part);break}case"response.output_text.delta":{let a=r.output[t.output_index];if(!a)throw new T(`missing output at index ${t.output_index}`);if(a.type==="message"){let s=a.content[t.content_index];if(!s)throw new T(`missing content at index ${t.content_index}`);if(s.type!=="output_text")throw new T(`expected content to be 'output_text', got ${s.type}`);s.text+=t.delta}break}case"response.function_call_arguments.delta":{let a=r.output[t.output_index];if(!a)throw new T(`missing output at index ${t.output_index}`);a.type==="function_call"&&(a.arguments+=t.delta);break}case"response.completed":{Ms(this,tn,t.response,"f");break}}return r},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",a=>{let s=t.shift();s?s.resolve(a):e.push(a)}),this.on("end",()=>{r=!0;for(let a of t)a.resolve(void 0);t.length=0}),this.on("abort",a=>{r=!0;for(let s of t)s.reject(a);t.length=0}),this.on("error",a=>{r=!0;for(let s of t)s.reject(a);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,i)=>t.push({resolve:s,reject:i})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=en(this,ml,"f");if(!e)throw new T("stream ended without producing a ChatCompletion");return e}};function wI(n,e){return kb(n,e)}var rn=class extends b{constructor(){super(...arguments),this.inputItems=new js(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&qp(r),r))}retrieve(e,t={},r){return this._client.get(`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>Bp(r,e))}stream(e,t){return gl.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}},fl=class extends V{};rn.InputItems=js;var Ds=class extends b{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,We({body:t,...r}))}};var nn=class extends b{constructor(){super(...arguments),this.parts=new Ds(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}};nn.Parts=Ds;var Mb=async n=>{let e=await Promise.allSettled(n),t=e.filter(a=>a.status==="rejected");if(t.length){for(let a of t)console.error(a.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let r=[];for(let a of e)a.status==="fulfilled"&&r.push(a.value);return r};var an=class extends b{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,a){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}list(e,t={},r){return D(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,sn,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let a=await this.create(e,t,r);return await this.poll(e,a.id,r)}async poll(e,t,r){let a={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let s=await this.retrieve(e,t,{...r,headers:a}).withResponse(),i=s.data;switch(i.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let u=s.response.headers.get("openai-poll-after-ms");if(u){let l=parseInt(u);isNaN(l)||(o=l)}}await vr(o);break;case"failed":case"completed":return i}}}async upload(e,t,r){let a=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:a.id},r)}async uploadAndPoll(e,t,r){let a=await this.upload(e,t,r);return await this.poll(e,a.id,r)}content(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,Fs,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},sn=class extends V{},Fs=class extends Gt{};an.VectorStoreFilesPage=sn;an.FileContentResponsesPage=Fs;var Us=class extends b{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let a=await this.create(e,t);return await this.poll(e,a.id,r)}listFiles(e,t,r={},a){return D(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,sn,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a?.headers}})}async poll(e,t,r){let a={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(a["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:s,response:i}=await this.retrieve(e,t,{...r,headers:a}).withResponse();switch(s.status){case"in_progress":let o=5e3;if(r?.pollIntervalMs)o=r.pollIntervalMs;else{let u=i.headers.get("openai-poll-after-ms");if(u){let l=parseInt(u);isNaN(l)||(o=l)}}await vr(o);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},a){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let s=a?.maxConcurrency??5,i=Math.min(s,t.length),o=this._client,u=t.values(),l=[...r];async function c(p){for(let f of p){let h=await o.files.create({file:f,purpose:"assistants"},a);l.push(h.id)}}let d=Array(i).fill(u).map(c);return await Mb(d),await this.createAndPoll(e,{file_ids:l})}};var rt=class extends b{constructor(){super(...arguments),this.files=new an(this._client),this.fileBatches=new Us(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return D(e)?this.list({},e):this._client.getAPIList("/vector_stores",fa,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/search`,ha,{body:t,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}},fa=class extends V{},ha=class extends Gt{};rt.VectorStoresPage=fa;rt.VectorStoreSearchResponsesPage=ha;rt.Files=an;rt.VectorStoreFilesPage=sn;rt.FileContentResponsesPage=Fs;rt.FileBatches=Us;var Lb,L=class extends Yu{constructor({baseURL:e=Mi("OPENAI_BASE_URL"),apiKey:t=Mi("OPENAI_API_KEY"),organization:r=Mi("OPENAI_ORG_ID")??null,project:a=Mi("OPENAI_PROJECT_ID")??null,...s}={}){if(t===void 0)throw new T("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let i={apiKey:t,organization:r,project:a,...s,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&mb())throw new T(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new ta(this),this.chat=new Ar(this),this.embeddings=new na(this),this.files=new Zr(this),this.images=new ca(this),this.audio=new Jt(this),this.moderations=new pa(this),this.models=new Qr(this),this.fineTuning=new tt(this),this.graders=new Yr(this),this.vectorStores=new rt(this),this.beta=new $t(this),this.batches=new Vr(this),this.uploads=new nn(this),this.responses=new rn(this),this.evals=new Qt(this),this.containers=new Yt(this),this._options=i,this.apiKey=t,this.organization=r,this.project=a}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return ip(e,{arrayFormat:"brackets"})}};Lb=L;L.OpenAI=Lb;L.DEFAULT_TIMEOUT=6e5;L.OpenAIError=T;L.APIError=pe;L.APIConnectionError=_r;L.APIConnectionTimeoutError=kt;L.APIUserAbortError=ne;L.NotFoundError=es;L.ConflictError=ts;L.RateLimitError=ns;L.BadRequestError=Xa;L.AuthenticationError=Ya;L.InternalServerError=as;L.PermissionDeniedError=Qa;L.UnprocessableEntityError=rs;L.toFile=_p;L.fileFromPath=Hu;L.Completions=ta;L.Chat=Ar;L.ChatCompletionsPage=qr;L.Embeddings=na;L.Files=Zr;L.FileObjectsPage=ia;L.Images=ca;L.Audio=Jt;L.Moderations=pa;L.Models=Qr;L.ModelsPage=da;L.FineTuning=tt;L.Graders=Yr;L.VectorStores=rt;L.VectorStoresPage=fa;L.VectorStoreSearchResponsesPage=ha;L.Beta=$t;L.Batches=Vr;L.BatchesPage=Jn;L.Uploads=nn;L.Responses=rn;L.Evals=Qt;L.EvalListResponsesPage=sa;L.Containers=Yt;L.ContainerListResponsesPage=ra;Ua();Da();Pa();Un();Ua();Da();var OI=typeof window=="object"?window:{},B="0123456789abcdef".split(""),II=[-2147483648,8388608,32768,128],jt=[24,16,8,0];var _e=[];function Mt(n){n?(_e[0]=_e[16]=_e[1]=_e[2]=_e[3]=_e[4]=_e[5]=_e[6]=_e[7]=_e[8]=_e[9]=_e[10]=_e[11]=_e[12]=_e[13]=_e[14]=_e[15]=0,this.blocks=_e):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Mt.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===OI.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,a,s=n.length||0,i=this.blocks;r<s;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),e)for(a=this.start;r<s&&a<64;++r)i[a>>2]|=n[r]<<jt[a++&3];else for(a=this.start;r<s&&a<64;++r)t=n.charCodeAt(r),t<128?i[a>>2]|=t<<jt[a++&3]:t<2048?(i[a>>2]|=(192|t>>6)<<jt[a++&3],i[a>>2]|=(128|t&63)<<jt[a++&3]):t<55296||t>=57344?(i[a>>2]|=(224|t>>12)<<jt[a++&3],i[a>>2]|=(128|t>>6&63)<<jt[a++&3],i[a>>2]|=(128|t&63)<<jt[a++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),i[a>>2]|=(240|t>>18)<<jt[a++&3],i[a>>2]|=(128|t>>12&63)<<jt[a++&3],i[a>>2]|=(128|t>>6&63)<<jt[a++&3],i[a>>2]|=(128|t&63)<<jt[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=i[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Mt.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=II[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};Mt.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,a=this.h4,s,i,o,u=this.blocks;for(i=16;i<80;++i)o=u[i-3]^u[i-8]^u[i-14]^u[i-16],u[i]=o<<1|o>>>31;for(i=0;i<20;i+=5)s=e&t|~e&r,o=n<<5|n>>>27,a=o+s+a+1518500249+u[i]<<0,e=e<<30|e>>>2,s=n&e|~n&t,o=a<<5|a>>>27,r=o+s+r+1518500249+u[i+1]<<0,n=n<<30|n>>>2,s=a&n|~a&e,o=r<<5|r>>>27,t=o+s+t+1518500249+u[i+2]<<0,a=a<<30|a>>>2,s=r&a|~r&n,o=t<<5|t>>>27,e=o+s+e+1518500249+u[i+3]<<0,r=r<<30|r>>>2,s=t&r|~t&a,o=e<<5|e>>>27,n=o+s+n+1518500249+u[i+4]<<0,t=t<<30|t>>>2;for(;i<40;i+=5)s=e^t^r,o=n<<5|n>>>27,a=o+s+a+1859775393+u[i]<<0,e=e<<30|e>>>2,s=n^e^t,o=a<<5|a>>>27,r=o+s+r+1859775393+u[i+1]<<0,n=n<<30|n>>>2,s=a^n^e,o=r<<5|r>>>27,t=o+s+t+1859775393+u[i+2]<<0,a=a<<30|a>>>2,s=r^a^n,o=t<<5|t>>>27,e=o+s+e+1859775393+u[i+3]<<0,r=r<<30|r>>>2,s=t^r^a,o=e<<5|e>>>27,n=o+s+n+1859775393+u[i+4]<<0,t=t<<30|t>>>2;for(;i<60;i+=5)s=e&t|e&r|t&r,o=n<<5|n>>>27,a=o+s+a-1894007588+u[i]<<0,e=e<<30|e>>>2,s=n&e|n&t|e&t,o=a<<5|a>>>27,r=o+s+r-1894007588+u[i+1]<<0,n=n<<30|n>>>2,s=a&n|a&e|n&e,o=r<<5|r>>>27,t=o+s+t-1894007588+u[i+2]<<0,a=a<<30|a>>>2,s=r&a|r&n|a&n,o=t<<5|t>>>27,e=o+s+e-1894007588+u[i+3]<<0,r=r<<30|r>>>2,s=t&r|t&a|r&a,o=e<<5|e>>>27,n=o+s+n-1894007588+u[i+4]<<0,t=t<<30|t>>>2;for(;i<80;i+=5)s=e^t^r,o=n<<5|n>>>27,a=o+s+a-899497514+u[i]<<0,e=e<<30|e>>>2,s=n^e^t,o=a<<5|a>>>27,r=o+s+r-899497514+u[i+1]<<0,n=n<<30|n>>>2,s=a^n^e,o=r<<5|r>>>27,t=o+s+t-899497514+u[i+2]<<0,a=a<<30|a>>>2,s=r^a^n,o=t<<5|t>>>27,e=o+s+e-899497514+u[i+3]<<0,r=r<<30|r>>>2,s=t^r^a,o=e<<5|e>>>27,n=o+s+n-899497514+u[i+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+a<<0};Mt.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,a=this.h4;return B[n>>28&15]+B[n>>24&15]+B[n>>20&15]+B[n>>16&15]+B[n>>12&15]+B[n>>8&15]+B[n>>4&15]+B[n&15]+B[e>>28&15]+B[e>>24&15]+B[e>>20&15]+B[e>>16&15]+B[e>>12&15]+B[e>>8&15]+B[e>>4&15]+B[e&15]+B[t>>28&15]+B[t>>24&15]+B[t>>20&15]+B[t>>16&15]+B[t>>12&15]+B[t>>8&15]+B[t>>4&15]+B[t&15]+B[r>>28&15]+B[r>>24&15]+B[r>>20&15]+B[r>>16&15]+B[r>>12&15]+B[r>>8&15]+B[r>>4&15]+B[r&15]+B[a>>28&15]+B[a>>24&15]+B[a>>20&15]+B[a>>16&15]+B[a>>12&15]+B[a>>8&15]+B[a>>4&15]+B[a&15]};Mt.prototype.toString=Mt.prototype.hex;Mt.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,a=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,a>>24&255,a>>16&255,a>>8&255,a&255]};Mt.prototype.array=Mt.prototype.digest;Mt.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};var Vp=n=>new Mt(!0).update(n).hex();Lr();var Db=(...n)=>Vp(n.join("_"));var Hp=class{},PI=new Map,yl=class n extends Hp{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(Db(e,t))??null)}async update(e,t,r){this.cache.set(Db(e,t),r)}static global(){return new n(PI)}};Oi();Lr();yi();var Bb=nt(zb(),1),jI=Object.defineProperty,MI=(n,e,t)=>e in n?jI(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,LI=(n,e,t)=>(MI(n,typeof e!="symbol"?e+"":e,t),t);function DI(n,e){let t=Array.from({length:n.length},(r,a)=>({start:a,end:a+1}));for(;t.length>1;){let r=null;for(let a=0;a<t.length-1;a++){let s=n.slice(t[a].start,t[a+1].end),i=e.get(s.join(","));i!=null&&(r==null||i<r[0])&&(r=[i,a])}if(r!=null){let a=r[1];t[a]={start:t[a].start,end:t[a+1].end},t.splice(a+1,1)}else break}return t}function FI(n,e){return n.length===1?[e.get(n.join(","))]:DI(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function UI(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Gp=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(n,e){this.patStr=n.pat_str;let t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,a)=>{let[s,i,...o]=a.split(" "),u=Number.parseInt(i,10);return o.forEach((l,c)=>r[l]=u+c),r},{});for(let[r,a]of Object.entries(t)){let s=Bb.default.toByteArray(r);this.rankMap.set(s.join(","),a),this.textMap.set(a,s)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[a,s])=>(r[s]=this.textEncoder.encode(a),r),{})}encode(n,e=[],t="all"){let r=new RegExp(this.patStr,"ug"),a=Gp.specialTokenRegex(Object.keys(this.specialTokens)),s=[],i=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(l=>!i.has(l)):t);if(o.size>0){let l=Gp.specialTokenRegex([...o]),c=n.match(l);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let u=0;for(;;){let l=null,c=u;for(;a.lastIndex=c,l=a.exec(n),!(l==null||i.has(l[0]));)c=l.index+1;let d=l?.index??n.length;for(let f of n.substring(u,d).matchAll(r)){let h=this.textEncoder.encode(f[0]),m=this.rankMap.get(h.join(","));if(m!=null){s.push(m);continue}s.push(...FI(h,this.rankMap))}if(l==null)break;let p=this.specialTokens[l[0]];s.push(p),u=l.index+l[0].length}return s}decode(n){let e=[],t=0;for(let s=0;s<n.length;++s){let i=n[s],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(e.push(o),t+=o.length)}let r=new Uint8Array(t),a=0;for(let s of e)r.set(s,a),a+=s.length;return this.textDecoder.decode(r)}},_l=Gp;LI(_l,"specialTokenRegex",n=>new RegExp(n.map(e=>UI(e)).join("|"),"g"));function Jp(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}yi();var wl={},zI=new pr({});async function BI(n){return n in wl||(wl[n]=zI.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new _l(e)).catch(e=>{throw delete wl[n],e})),await wl[n]}async function qb(n){return BI(Jp(n))}yt();var qI=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n;var VI=()=>!1,Zi=class extends X{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??VI(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}},Xi=class extends Zi{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r.cache=="object"?this.cache=r.cache:r.cache?this.cache=yl.global():this.cache=void 0,this.caller=new pr(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await qb("modelName"in this?qI(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new Ba(e):Array.isArray(e)?new qa(e.map(Et)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){let r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([i,o])=>o!==void 0).map(([i,o])=>`${i}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}};Ma();yt();hu();cu();dr();function Yi(n){return typeof n?.parse=="function"}var vl=class n extends Xi{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptionsCompat(e){let[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){let r=n._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){if(this._streamResponseChunks===n.prototype._streamResponseChunks)yield this.invoke(e,t);else{let a=n._convertInputToPromptValue(e).toChatMessages(),[s,i]=this._separateRunnableConfigFromCallOptionsCompat(t),o={...s.metadata,...this.getLsParams(i)},u=await Ae.configure(s.callbacks,this.callbacks,s.tags,this.tags,o,this.metadata,{verbose:this.verbose}),l={options:i,invocation_params:this?.invocationParams(i),batch_size:1},c=await u?.handleChatModelStart(this.toJSON(),[a],s.runId,void 0,l,void 0,void 0,s.runName),d;try{for await(let p of this._streamResponseChunks(a,i,c?.[0])){if(p.message.id==null){let f=c?.at(0)?.runId;f!=null&&p.message._updateId(`run-${f}`)}p.message.response_metadata={...p.generationInfo,...p.message.response_metadata},yield p.message,d?d=d.concat(p):d=p}}catch(p){throw await Promise.all((c??[]).map(f=>f?.handleLLMError(p))),p}await Promise.all((c??[]).map(p=>p?.handleLLMEnd({generations:[[d]]})))}}getLsParams(e){return{ls_model_type:"chat",ls_stop:e.stop}}async _generateUncached(e,t,r){let a=e.map(f=>f.map(Et)),s={...r.metadata,...this.getLsParams(t)},i=await Ae.configure(r.callbacks,this.callbacks,r.tags,this.tags,s,this.metadata,{verbose:this.verbose}),o={options:t,invocation_params:this?.invocationParams(t),batch_size:1},u=await i?.handleChatModelStart(this.toJSON(),a,r.runId,void 0,o,void 0,void 0,r.runName),l=[],c=[];if(!!u?.[0].handlers.find(f=>gi(f)||mi(f))&&a.length===1&&this._streamResponseChunks!==n.prototype._streamResponseChunks)try{let f=await this._streamResponseChunks(a[0],t,u?.[0]),h;for await(let m of f){if(m.message.id==null){let y=u?.at(0)?.runId;y!=null&&m.message._updateId(`run-${y}`)}h===void 0?h=m:h=Re(h,m)}if(h===void 0)throw new Error("Received empty response from chat model call.");l.push([h]),await u?.[0].handleLLMEnd({generations:l,llmOutput:{}})}catch(f){throw await u?.[0].handleLLMError(f),f}else{let f=await Promise.allSettled(a.map((h,m)=>this._generate(h,{...t,promptIndex:m},u?.[m])));await Promise.all(f.map(async(h,m)=>{if(h.status==="fulfilled"){let y=h.value;for(let x of y.generations){if(x.message.id==null){let v=u?.at(0)?.runId;v!=null&&x.message._updateId(`run-${v}`)}x.message.response_metadata={...x.generationInfo,...x.message.response_metadata}}return y.generations.length===1&&(y.generations[0].message.response_metadata={...y.llmOutput,...y.generations[0].message.response_metadata}),l[m]=y.generations,c[m]=y.llmOutput,u?.[m]?.handleLLMEnd({generations:[y.generations],llmOutput:y.llmOutput})}else return await u?.[m]?.handleLLMError(h.reason),Promise.reject(h.reason)}))}let p={generations:l,llmOutput:c.length?this._combineLLMOutput?.(...c):void 0};return Object.defineProperty(p,du,{value:u?{runIds:u?.map(f=>f.runId)}:void 0,configurable:!0}),p}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:a,handledOptions:s}){let i=e.map(y=>y.map(Et)),o={...s.metadata,...this.getLsParams(a)},u=await Ae.configure(s.callbacks,this.callbacks,s.tags,this.tags,o,this.metadata,{verbose:this.verbose}),l={options:a,invocation_params:this?.invocationParams(a),batch_size:1,cached:!0},c=await u?.handleChatModelStart(this.toJSON(),i,s.runId,void 0,l,void 0,void 0,s.runName),d=[],f=(await Promise.allSettled(i.map(async(y,x)=>{let v=n._convertInputToPromptValue(y).toString(),P=await t.lookup(v,r);return P==null&&d.push(x),P}))).map((y,x)=>({result:y,runManager:c?.[x]})).filter(({result:y})=>y.status==="fulfilled"&&y.value!=null||y.status==="rejected"),h=[];await Promise.all(f.map(async({result:y,runManager:x},v)=>{if(y.status==="fulfilled"){let P=y.value;return h[v]=P,P.length&&await x?.handleLLMNewToken(P[0].text),x?.handleLLMEnd({generations:[P]})}else return await x?.handleLLMError(y.reason),Promise.reject(y.reason)}));let m={generations:h,missingPromptIndices:d};return Object.defineProperty(m,du,{value:c?{runIds:c?.map(y=>y.runId)}:void 0,configurable:!0}),m}async generate(e,t,r){let a;Array.isArray(t)?a={stop:t}:a=t;let s=e.map(f=>f.map(Et)),[i,o]=this._separateRunnableConfigFromCallOptionsCompat(a);if(i.callbacks=i.callbacks??r,!this.cache)return this._generateUncached(s,o,i);let{cache:u}=this,l=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d}=await this._generateCached({messages:s,cache:u,llmStringKey:l,parsedOptions:o,handledOptions:i}),p={};if(d.length>0){let f=await this._generateUncached(d.map(h=>s[h]),o,i);await Promise.all(f.generations.map(async(h,m)=>{let y=d[m];c[y]=h;let x=n._convertInputToPromptValue(s[y]).toString();return u.update(x,l,h)})),p=f.llmOutput??{}}return{generations:c,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){let a=e.map(s=>s.toChatMessages());return this.generate(a,t,r)}async call(e,t,r){return(await this.generate([e.map(Et)],t,r)).generations[0][0].message}async callPrompt(e,t,r){let a=e.toChatMessages();return this.call(a,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){let a=new Ke(e),s=await this.call([a],t,r);if(typeof s.content!="string")throw new Error("Cannot use predict when output is not a string.");return s.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');let r=e,a=t?.name,s=r.description??"A function available to call.",i=t?.method,o=t?.includeRaw;if(i==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=a??"extract",l;Yi(r)?l=[{type:"function",function:{name:u,description:s,parameters:gt(r)}}]:("name"in r&&(u=r.name),l=[{type:"function",function:{name:u,description:s,parameters:r}}]);let c=this.bindTools(l),d=gr.from(m=>{if(!m.tool_calls||m.tool_calls.length===0)throw new Error("No tool calls found in the response.");let y=m.tool_calls.find(x=>x.name===u);if(!y)throw new Error(`No tool call found with name ${u}.`);return y.args});if(!o)return c.pipe(d).withConfig({runName:"StructuredOutput"});let p=qt.assign({parsed:(m,y)=>d.invoke(m.raw,y)}),f=qt.assign({parsed:()=>null}),h=p.withFallbacks({fallbacks:[f]});return mr.from([{raw:c},h]).withConfig({runName:"StructuredOutputRunnable"})}};Un();yt();function Vb(n,e){let t=typeof e=="number"?void 0:e;return{name:n.name,description:n.description,parameters:gt(n.schema),...t?.strict!==void 0?{strict:t.strict}:{}}}function xl(n,e){let t=typeof e=="number"?void 0:e,r;return JI(n)?r={type:"function",function:Vb(n)}:r=n,t?.strict!==void 0&&(r.function.strict=t.strict),r}function HI(n){return n!==void 0&&Array.isArray(n.lc_namespace)}function KI(n){return n!==void 0&&X.isRunnable(n)&&"lc_name"in n.constructor&&typeof n.constructor.lc_name=="function"&&n.constructor.lc_name()==="RunnableToolLike"}function GI(n){return!!n&&typeof n=="object"&&"name"in n&&"schema"in n&&Yi(n.schema)}function JI(n){return GI(n)||KI(n)||HI(n)}Nn();function Zp(n,e){if(n.function===void 0)return;let t;if(e?.partial)try{t=ka(n.function.arguments??"{}")}catch{return}else try{t=JSON.parse(n.function.arguments)}catch(a){throw new zr([`Function "${n.function.name}" arguments:`,"",n.function.arguments,"","are not valid JSON.",`Error: ${a.message}`].join(`
`))}let r={name:n.function.name,args:t,type:"tool_call"};return e?.returnId&&(r.id=n.id),r}function Hb(n){if(n.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:n.id,type:"function",function:{name:n.name,arguments:JSON.stringify(n.args)}}}function Kb(n,e){return{name:n.function?.name,args:n.function?.arguments,id:n.id,error:e,type:"invalid_tool_call"}}var Wp=class extends Bn{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=e?.returnId??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){let r=e[0].message,a;if(li(r)&&r.tool_calls?.length?a=r.tool_calls.map(i=>{let{id:o,...u}=i;return this.returnId?{id:o,...u}:u}):r.additional_kwargs.tool_calls!==void 0&&(a=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(o=>Zp(o,{returnId:this.returnId,partial:t}))),!a)return[];let s=[];for(let i of a)if(i!==void 0){let o={type:i.name,args:i.args,id:i.id};Object.defineProperty(o,"name",{get(){return this.type}}),Object.defineProperty(o,"arguments",{get(){return this.args}}),s.push(o)}return s}},Qi=class extends Wp{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;let t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new zr(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){let r=(await super.parsePartialResult(e)).filter(s=>s.type===this.keyName),a=r;if(r.length)return this.returnId||(a=r.map(s=>s.args)),this.returnSingle?a[0]:a}async parseResult(e){let r=(await super.parsePartialResult(e,!1)).filter(i=>i.type===this.keyName),a=r;return r.length?(this.returnId||(a=r.map(i=>i.args)),this.returnSingle?this._validateResult(a[0]):await Promise.all(a.map(i=>this._validateResult(i)))):void 0}};Un();function on(n){let{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:a,baseURL:s,azureADTokenProvider:i}=n;if((r||i)&&a&&e)return`${a}/${e}`;if(r||i){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return s}Un();function zs(n){let e;return n.constructor.name===kt.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===ne.name?(e=new Error(n.message),e.name="AbortError"):e=n,e}function WI(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function Gb(n){let e=["namespace functions {",""];for(let t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(Jb(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function Jb(n,e){let t=[];for(let[r,a]of Object.entries(n.properties??{}))a.description&&e<2&&t.push(`// ${a.description}`),n.required?.includes(r)?t.push(`${r}: ${Al(a,e)},`):t.push(`${r}?: ${Al(a,e)},`);return t.map(r=>" ".repeat(e)+r).join(`
`)}function Al(n,e){if(WI(n))return n.anyOf.map(t=>Al(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",Jb(n,e+2),"}"].join(`
`);case"array":return n.items?`${Al(n.items,e)}[]`:"any[]";default:return""}}function ZI(n){return n.role!=="system"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function Xb(n){let e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!At.isInstance(n))throw new Error("Invalid generic chat message");return ZI(n)}default:throw new Error(`Unknown message type: ${e}`)}}function XI(n){let e=n.tool_calls;switch(n.role){case"assistant":{let t=[],r=[];for(let a of e??[])try{t.push(Zp(a,{returnId:!0}))}catch(s){r.push(Kb(a,s.message))}return new Xe({content:n.content||"",tool_calls:t,invalid_tool_calls:r,additional_kwargs:{function_call:n.function_call,tool_calls:e}})}default:return new At(n.content||"",n.role??"unknown")}}function YI(n,e){let t=n.role??e,r=n.content??"",a;if(n.function_call?a={function_call:n.function_call}:n.tool_calls?a={tool_calls:n.tool_calls}:a={},t==="user")return new Mn({content:r});if(t==="assistant"){let s=[];if(Array.isArray(n.tool_calls))for(let i of n.tool_calls)s.push({name:i.function?.name,args:i.function?.arguments,id:i.id,index:i.index});return new ft({content:r,tool_call_chunks:s,additional_kwargs:a})}else return t==="system"?new Dn({content:r}):t==="function"?new jn({content:r,additional_kwargs:a,name:n.name}):t==="tool"?new Ra({content:r,additional_kwargs:a,tool_call_id:n.tool_call_id}):new $n({content:r,role:t})}function Wb(n){return n.map(e=>{let t={role:Xb(e),content:e.content};return e.name!=null&&(t.name=e.name),e.additional_kwargs.function_call!=null&&(t.function_call=e.additional_kwargs.function_call),li(e)&&e.tool_calls?.length?t.tool_calls=e.tool_calls.map(Hb):(e.additional_kwargs.tool_calls!=null&&(t.tool_calls=e.additional_kwargs.tool_calls),e.tool_call_id!=null&&(t.tool_call_id=e.tool_call_id)),t})}var eo=class extends vl{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(e,t){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureADTokenProvider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=e?.apiKey??e?.openAIApiKey??te("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=e?.azureOpenAIApiKey??te("AZURE_OPENAI_API_KEY"),this.azureADTokenProvider=e?.azureADTokenProvider??void 0,!this.azureOpenAIApiKey&&!this.apiKey&&!this.azureADTokenProvider)throw new Error("OpenAI or Azure OpenAI API key or Token Provider not found");if(this.azureOpenAIApiInstanceName=e?.azureOpenAIApiInstanceName??te("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=e?.azureOpenAIApiDeploymentName??te("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=e?.azureOpenAIApiVersion??te("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=e?.azureOpenAIBasePath??te("AZURE_OPENAI_BASE_PATH"),this.organization=e?.configuration?.organization??te("OPENAI_ORGANIZATION"),this.modelName=e?.model??e?.modelName??this.model,this.model=this.modelName,this.modelKwargs=e?.modelKwargs??{},this.timeout=e?.timeout,this.temperature=e?.temperature??this.temperature,this.topP=e?.topP??this.topP,this.frequencyPenalty=e?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=e?.presencePenalty??this.presencePenalty,this.maxTokens=e?.maxTokens,this.logprobs=e?.logprobs,this.topLogprobs=e?.topLogprobs,this.n=e?.n??this.n,this.logitBias=e?.logitBias,this.stop=e?.stopSequences??e?.stop,this.stopSequences=this?.stop,this.user=e?.user,this.streaming=e?.streaming??!1,this.azureOpenAIApiKey||this.azureADTokenProvider){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw new Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw new Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw new Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:t?.basePath??e?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:t?.baseOptions?.headers??e?.configuration?.baseOptions?.headers,defaultQuery:t?.baseOptions?.params??e?.configuration?.baseOptions?.params,...t,...e?.configuration}}getLsParams(e){let t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){return this.bind({tools:e.map(xl),...t})}invocationParams(e){function t(a){return a!==void 0&&a.every(s=>Array.isArray(s.lc_namespace))}return{model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:e?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:e?.functions,function_call:e?.function_call,tools:t(e?.tools)?e?.tools.map(xl):e?.tools,tool_choice:e?.tool_choice,response_format:e?.response_format,seed:e?.seed,...e?.stream_options!==void 0?{stream_options:e.stream_options}:{},parallel_tool_calls:e?.parallel_tool_calls,...this.modelKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){let a=Wb(e),s={...this.invocationParams(t),messages:a,stream:!0},i,o=await this.completionWithRetry(s,t),u;for await(let l of o){let c=l?.choices[0];if(l.usage&&(u=l.usage),!c)continue;let{delta:d}=c;if(!d)continue;let p=YI(d,i);i=d.role??i;let f={prompt:t.promptIndex??0,completion:c.index??0};if(typeof p.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let h={...f};c.finish_reason!==void 0&&(h.finish_reason=c.finish_reason),this.logprobs&&(h.logprobs=c.logprobs);let m=new Dr({message:p,text:p.content,generationInfo:h});yield m,r?.handleLLMNewToken(m.text??"",f,void 0,void 0,void 0,{chunk:m})}if(u&&(yield new Dr({message:new ft({content:"",usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens}}),text:""})),t.signal?.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){let a={},s=this.invocationParams(t),i=Wb(e);if(s.stream){let o=this._streamResponseChunks(e,t,r),u={};for await(let h of o){h.message.response_metadata={...h.generationInfo,...h.message.response_metadata};let m=h.generationInfo?.completion??0;u[m]===void 0?u[m]=h:u[m]=u[m].concat(h)}let l=Object.entries(u).sort(([h],[m])=>parseInt(h,10)-parseInt(m,10)).map(([h,m])=>m),{functions:c,function_call:d}=this.invocationParams(t),p=await this.getEstimatedTokenCountFromPrompt(e,c,d),f=await this.getNumTokensFromGenerations(l);return a.promptTokens=p,a.completionTokens=f,a.totalTokens=p+f,{generations:l,llmOutput:{estimatedTokenUsage:a}}}else{let o=await this.completionWithRetry({...s,stream:!1,messages:i},{signal:t?.signal,...t?.options}),{completion_tokens:u,prompt_tokens:l,total_tokens:c}=o?.usage??{};u&&(a.completionTokens=(a.completionTokens??0)+u),l&&(a.promptTokens=(a.promptTokens??0)+l),c&&(a.totalTokens=(a.totalTokens??0)+c);let d=[];for(let p of o?.choices??[]){let h={text:p.message?.content??"",message:XI(p.message??{role:"assistant"})};h.generationInfo={...p.finish_reason?{finish_reason:p.finish_reason}:{},...p.logprobs?{logprobs:p.logprobs}:{}},li(h.message)&&(h.message.usage_metadata={input_tokens:a.promptTokens??0,output_tokens:a.completionTokens??0,total_tokens:a.totalTokens??0}),d.push(h)}return{generations:d,llmOutput:{tokenUsage:a}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let a=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){let s=Gb(t);a+=await this.getNumTokens(s),a+=9}return t&&e.find(s=>s._getType()==="system")&&(a-=4),r==="none"?a+=1:typeof r=="object"&&(a+=await this.getNumTokens(r.name)+4),a}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>r.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)))).reduce((r,a)=>r+a,0)}async getNumTokensFromMessages(e){let t=0,r=0,a=0;this.model==="gpt-3.5-turbo-0301"?(r=4,a=-1):(r=3,a=1);let s=await Promise.all(e.map(async i=>{let o=await this.getNumTokens(i.content),u=await this.getNumTokens(Xb(i)),l=i.name!==void 0?a+await this.getNumTokens(i.name):0,c=o+r+u+l,d=i;if(d._getType()==="function"&&(c-=2),d.additional_kwargs?.function_call&&(c+=3),d?.additional_kwargs.function_call?.name&&(c+=await this.getNumTokens(d.additional_kwargs.function_call?.name)),d.additional_kwargs.function_call?.arguments)try{c+=await this.getNumTokens(JSON.stringify(JSON.parse(d.additional_kwargs.function_call?.arguments)))}catch(p){console.error("Error parsing function arguments",p,JSON.stringify(d.additional_kwargs.function_call)),c+=await this.getNumTokens(d.additional_kwargs.function_call?.arguments)}return t+=c,c}));return t+=3,{totalCount:t,countPerMessage:s}}async completionWithRetry(e,t){let r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(a){throw zs(a)}})}_getClientOptions(e){if(!this.client){let r={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},a=on(r),s={...this.clientConfig,baseURL:a,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new L(s)}let t={...this.clientConfig,...e};return this.azureOpenAIApiKey&&(t.headers={"api-key":this.azureOpenAIApiKey,...t.headers},t.query={"api-version":this.azureOpenAIApiVersion,...t.query}),t}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let r,a,s,i;QI(e)?(r=e.schema,a=e.name,s=e.method,i=e.includeRaw):(r=e,a=t?.name,s=t?.method,i=t?.includeRaw);let o,u;if(s==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Zb(r)?u=Mu.fromZodSchema(r):u=new Lu;else{let p=a??"extract";if(Zb(r)){let f=gt(r);o=this.bind({tools:[{type:"function",function:{name:p,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:p}}}),u=new Qi({returnSingle:!0,keyName:p,zodSchema:r})}else{let f;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(f=r,p=r.name):(p=r.title??p,f={name:p,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:p}}}),u=new Qi({returnSingle:!0,keyName:p})}}if(!i)return o.pipe(u);let l=qt.assign({parsed:(p,f)=>u.invoke(p.raw,f)}),c=qt.assign({parsed:()=>null}),d=l.withFallbacks({fallbacks:[c]});return mr.from([{raw:o},d])}};function Zb(n){return typeof n?.parse=="function"}function QI(n){return n!==void 0&&typeof n.schema=="object"}Ua();Da();Ma();hu();cu();dr();yi();po();Ma();Fn();Na();La();au();var Xp=class extends Zi{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=e?.verboseParsingErrors??this.verboseParsingErrors,this.responseFormat=e?.responseFormat??this.responseFormat}async invoke(e,t){let r,a;Ca(e)?(r=e.id,a=e.args):a=e;let s=G(t);return this.call(a,{...s,configurable:{...s.configurable,tool_call_id:r}})}async call(e,t,r){let a;try{a=await this.schema.parseAsync(e)}catch(f){let h="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(h=`${h}
Details: ${f.message}`),new Sa(h,JSON.stringify(e))}let s=qg(t),o=await(await Ae.configure(s.callbacks,this.callbacks,s.tags||r,this.tags,s.metadata,this.metadata,{verbose:this.verbose}))?.handleToolStart(this.toJSON(),typeof a=="string"?a:JSON.stringify(a),s.runId,void 0,void 0,void 0,s.runName);delete s.runId;let u;try{u=await this._call(a,o,s)}catch(f){throw await o?.handleToolError(f),f}let l,c;if(this.responseFormat==="content_and_artifact")if(Array.isArray(u)&&u.length===2)[l,c]=u;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(u)}`);else l=u;let d;s&&"configurable"in s&&(d=s.configurable.tool_call_id);let p=tP({content:l,artifact:c,toolCallId:d,name:this.name});return await o?.handleToolEnd(p),p}},El=class extends Xp{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:Be.object({input:Be.string().optional()}).transform(t=>t.input)})}call(e,t){return super.call(typeof e=="string"||!e?{input:e}:e,t)}};function tP(n){let{content:e,artifact:t,toolCallId:r}=n;return r?typeof e=="string"||Array.isArray(e)&&e.every(a=>typeof a=="object")?new lr({content:e,artifact:t,tool_call_id:r,name:n.name}):new lr({content:rP(e),artifact:t,tool_call_id:r,name:n.name}):e}function rP(n){try{return JSON.stringify(n,null,2)}catch{return`${n}`}}var Yp=class extends El{static lc_name(){return"DallEAPIWrapper"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=e?.apiKey??e?.openAIApiKey??te("OPENAI_API_KEY"),r=e?.organization??te("OPENAI_ORGANIZATION"),a={apiKey:t,organization:r,dangerouslyAllowBrowser:!0};this.client=new L(a),this.model=e?.model??e?.modelName??this.model,this.style=e?.style??this.style,this.quality=e?.quality??this.quality,this.n=e?.n??this.n,this.size=e?.size??this.size,this.responseFormat=e?.responseFormat??this.responseFormat,this.user=e?.user}async _call(e){let t=await this.client.images.generate({model:this.model,prompt:e,n:this.n,size:this.size,response_format:this.responseFormat,style:this.style,quality:this.quality,user:this.user}),r="";return this.responseFormat==="url"?[r]=t.data.map(a=>a.url).filter(a=>a!=="undefined"):[r]=t.data.map(a=>a.b64_json).filter(a=>a!=="undefined"),r}};Object.defineProperty(Yp,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"});var LB=nt(r_());var Ol,oP=new Uint8Array(16);function Qp(){if(!Ol&&(Ol=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ol))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ol(oP)}var Oe=[];for(let n=0;n<256;++n)Oe.push((n+256).toString(16).slice(1));function n_(n,e=0){return Oe[n[e+0]]+Oe[n[e+1]]+Oe[n[e+2]]+Oe[n[e+3]]+"-"+Oe[n[e+4]]+Oe[n[e+5]]+"-"+Oe[n[e+6]]+Oe[n[e+7]]+"-"+Oe[n[e+8]]+Oe[n[e+9]]+"-"+Oe[n[e+10]]+Oe[n[e+11]]+Oe[n[e+12]]+Oe[n[e+13]]+Oe[n[e+14]]+Oe[n[e+15]]}var uP=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ef={randomUUID:uP};function lP(n,e,t){if(ef.randomUUID&&!e&&!n)return ef.randomUUID();n=n||{};let r=n.random||(n.rng||Qp)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let a=0;a<16;++a)e[t+a]=r[a];return e}return n_(r)}var tf=lP;var Il=class{constructor(e){this.secret=e}_encode(e){return new TextEncoder().encode(e)}_decode(e){return new TextDecoder().decode(e)}async _importKey(e){let t=await crypto.subtle.importKey("raw",this._encode(e),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:this._encode("salt"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async _encrypt(e){let t=await this._importKey(this.secret),r=crypto.getRandomValues(new Uint8Array(12)),a=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,this._encode(e));return{iv:r,encrypted:a}}async _decrypt(e,t){let r=await this._importKey(this.secret),a=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},r,e);return this._decode(a)}async saveAPIKey(e,t){let{iv:r,encrypted:a}=await this._encrypt(t),s={iv:Array.from(r),encrypted:Array.from(new Uint8Array(a))};localStorage.setItem(e,JSON.stringify(s))}async getAPIKey(e){let t=localStorage.getItem(e);if(!t)return null;let{iv:r,encrypted:a}=JSON.parse(t);return await this._decrypt(new Uint8Array(a),new Uint8Array(r))}deleteAPIKey(e){localStorage.removeItem(e)}apiKeyExists(e){return localStorage.getItem(e)!==null}};var rf='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14L21 3m0 0l-6.5 18a.55.55 0 0 1-1 0L10 14l-7-3.5a.55.55 0 0 1 0-1L21 3"/></svg>';var a_='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-stop"><circle cx="12" cy="12" r="10"/><rect width="6" height="6" x="9" y="9"/></svg>';var Pl=acode.require("fs"),cP=acode.require("select"),qB=acode.require("prompt"),VB=acode.require("dialogBox"),HB=acode.require("helpers"),KB=acode.require("loader"),s_=acode.require("sidebarApps"),GB=acode.require("toInternalUrl"),JB=acode.require("contextMenu"),to=acode.require("selectionMenu"),{editor:i_}=editorManager,Tl=window.DATA_STORAGE+"chatgpt";var nf=class{async init(e,t,r){console.log("AIAssistant init called"),console.log("sidebarApps available:",!!s_),console.log("selectionMenu available:",!!to),this.$page=e,this.cacheFile=t,this.cacheFileUrl=r,this.$githubDarkFile=tag("link",{rel:"stylesheet",href:this.baseUrl+"assets/github-dark.css"}),this.$higlightJsFile=tag("script",{src:this.baseUrl+"assets/highlight.min.js"}),this.$markdownItFile=tag("script",{src:this.baseUrl+"assets/markdown-it.min.js"}),this.$style=tag("style",{textContent:of}),document.head.append(this.$githubDarkFile,this.$higlightJsFile,this.$markdownItFile,this.$style),this.apiKeyManager=new Il("acode-ai-assistant-secret"),this.sessions=[],this.currentSession=null,this.currentView="chat",this.isGenerating=!1;try{this.setupSidebar(),console.log("Sidebar setup completed")}catch(a){console.error("Sidebar setup failed:",a)}try{this.setupSelectionMenu(),console.log("Selection menu setup completed")}catch(a){console.error("Selection menu setup failed:",a)}}setupSidebar(){console.log("Setting up sidebar..."),console.log("baseUrl:",this.baseUrl),acode.addIcon("ai-assistant-icon",this.baseUrl+"icon.png"),console.log("Icon added successfully"),s_.add("ai-assistant-icon","ai-assistant-sidebar","AI Assistant",e=>{console.log("Initializing sidebar container"),this.createSidebarContent(e)},!1,e=>{console.log("AI Assistant sidebar selected"),this.onSidebarSelected(e)}),console.log("Sidebar app added successfully")}createSidebarContent(e){console.log("Creating sidebar content directly in container"),e.className="ai-assistant-sidebar";let t=tag("div",{className:"ai-header"}),r=tag("div",{className:"ai-nav"}),a=tag("button",{className:"ai-nav-btn active",textContent:"Chat",onclick:()=>this.switchView("chat",e)}),s=tag("button",{className:"ai-nav-btn",textContent:"History",onclick:()=>this.switchView("history",e)}),i=tag("button",{className:"ai-nav-btn",textContent:"Settings",onclick:()=>this.switchView("settings",e)});r.appendChild(a),r.appendChild(s),r.appendChild(i),t.appendChild(r);let o=tag("div",{className:"ai-content scroll"}),u=tag("div",{className:"ai-chat-area",id:"ai-chat-area"}),l=tag("div",{className:"ai-history-area",id:"ai-history-area",style:{display:"none"}}),c=tag("div",{className:"ai-settings-area",id:"ai-settings-area",style:{display:"none"}});o.appendChild(u),o.appendChild(l),o.appendChild(c);let d=tag("div",{className:"ai-welcome-message",innerHTML:`
        <div class="ai-welcome-content">
          <h3>Welcome to AI Assistant</h3>
          <p>Start a conversation by typing your message below.</p>
        </div>
      `});u.appendChild(d);let p=tag("h3",{textContent:"Chat History"}),f=tag("div",{className:"ai-history-list"});l.appendChild(p),l.appendChild(f);let h=tag("div",{className:"ai-settings-form",innerHTML:`
        <div class="setting-group">
          <label for="base-url">Base URL</label>
          <input type="text" id="base-url" placeholder="https://api.openai.com/v1" />
        </div>
        <div class="setting-group">
          <label for="api-key">API Key</label>
          <input type="password" id="api-key" placeholder="Enter your API key" />
        </div>
        <div class="setting-group">
          <label for="model-input">Model</label>
          <input type="text" id="model-input" placeholder="gpt-3.5-turbo, gemini-pro, llama2, etc." />
        </div>
        <button type="button" class="save-settings-btn">Save Settings</button>
      `});c.appendChild(h);let m=h.querySelector(".save-settings-btn");m.onclick=()=>this.saveSettings(e),this.loadSettings(e);let y=tag("div",{className:"ai-footer"}),x=tag("div",{className:"ai-input-container"}),v=tag("textarea",{className:"ai-input",placeholder:"Type your message...",rows:1,onkeydown:j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),this.sendMessage(e))}}),P=tag("button",{className:"ai-send-btn",innerHTML:rf,onclick:()=>this.sendMessage(e)});x.appendChild(v),x.appendChild(P),y.appendChild(x),e.appendChild(t),e.appendChild(o),e.appendChild(y),this.loadChatHistory(e),console.log("Sidebar content created and appended successfully")}setupSelectionMenu(){console.log("Setting up selection menu..."),to.add(async()=>{console.log("Selection menu clicked");let e=await cP("AI Actions",["Explain Code","Rewrite","Generate Code"],{onHide:()=>{window.toast("Work is in progress...",3e3)}});console.log("Selected option:",e),e&&this.handleSelectionAction(e)},"\u2728","all"),console.log("Selection menu added successfully")}async handleSelectionAction(e){console.log("Handling selection action:",e);let t=i_.getSelectedText();if(!t){window.toast("Please select some text first",2e3);return}try{let r=this.getSettings();if(!r.apiKey||!r.baseUrl||!r.model){window.toast("Please configure API settings first",3e3);return}let a="";switch(e){case"Explain Code":a=`Explain this code:

${t}`;break;case"Rewrite":a=`Rewrite this code to be better:

${t}`;break;case"Generate Code":a=`Generate code based on this description:

${t}`;break}window.toast("Processing your request...",2e3);let s=await this.callAI(a,r);s&&(editorManager.editor.session.replace(i_.getRange(),s),window.toast(`${e} completed!`,2e3))}catch(r){console.error("Error in selection action:",r),window.toast("Error: "+r.message,3e3)}}switchView(e,t){console.log("Switching view to:",e),this.currentView=e;let r=t.querySelectorAll(".ai-nav-btn");r.forEach(o=>o.classList.remove("active"));let a=t.querySelector("#ai-chat-area"),s=t.querySelector("#ai-history-area"),i=t.querySelector("#ai-settings-area");switch(a.style.display="none",s.style.display="none",i.style.display="none",e){case"chat":r[0].classList.add("active"),a.style.display="block";break;case"history":r[1].classList.add("active"),s.style.display="block",this.loadChatHistory(t);break;case"settings":r[2].classList.add("active"),i.style.display="block";break}}async sendMessage(e){let t=e.querySelector(".ai-input"),r=t.value.trim();if(!r||this.isGenerating)return;let s=e.querySelector("#ai-chat-area").querySelector(".ai-welcome-message");s&&s.remove(),this.addMessageToChat("user",r,e),t.value="",this.isGenerating=!0;let i=e.querySelector(".ai-send-btn");i.innerHTML=a_;try{let o=this.getSettings();if(!o.apiKey||!o.baseUrl||!o.model){window.toast("Please configure API settings first",3e3),this.switchView("settings",e);return}let u=this.addMessageToChat("assistant","",e),l=await this.callAI(r,o);this.updateMessage(u,l,e),this.currentSession||(this.currentSession={id:tf(),messages:[]},this.sessions.push(this.currentSession)),this.currentSession.messages.push({role:"user",content:r}),this.currentSession.messages.push({role:"assistant",content:l}),this.saveSession()}catch(o){console.error("Error generating response:",o),window.toast("Error generating response: "+o.message,3e3)}finally{this.isGenerating=!1,i.innerHTML=rf}}addMessageToChat(e,t,r){let a=r.querySelector("#ai-chat-area"),s=tag("div",{className:`ai-message ${e}-message`}),i=tag("div",{className:"ai-avatar",innerHTML:e==="user"?"\u{1F464}":"\u{1F916}"}),o=tag("div",{className:"ai-message-content",innerHTML:t});return s.appendChild(i),s.appendChild(o),a.appendChild(s),a.scrollTop=a.scrollHeight,o}updateMessage(e,t,r){e.innerHTML=this.formatAIResponse(t),this.highlightCode(r)}formatAIResponse(e){if(window.markdownit){let t=window.markdownit({highlight:function(r,a){if(a&&window.hljs)try{return'<pre><code class="hljs">'+window.hljs.highlight(r,{language:a}).value+"</code></pre>"}catch{}return"<pre><code>"+t.utils.escapeHtml(r)+"</code></pre>"}});return t.render(e)}return e.replace(/\n/g,"<br>")}highlightCode(e){window.hljs&&e.querySelectorAll("pre code").forEach(t=>{window.hljs.highlightElement(t)})}async callAI(e,t){let{apiKey:r,baseUrl:a,model:s}=t;if(!r||!a||!s)throw new Error("Please configure API settings first");let i=new eo({openAIApiKey:r,modelName:s,configuration:{baseURL:a}});return await Za.fromMessages([["system","You are a helpful assistant."],["human","{input}"]]).pipe(i).pipe(new ju).invoke({input:e})}getSettings(){return{apiKey:localStorage.getItem("ai-api-key")||"",baseUrl:localStorage.getItem("ai-base-url")||"https://api.openai.com/v1",model:localStorage.getItem("ai-model")||"gpt-3.5-turbo"}}async saveSettings(e){let t=e.querySelector(".ai-settings-form"),r=t.querySelector("#api-key").value,a=t.querySelector("#base-url").value,s=t.querySelector("#model-input").value;r&&await this.apiKeyManager.saveAPIKey("default",r),localStorage.setItem("ai-base-url",a),localStorage.setItem("ai-model",s),window.toast("Settings saved successfully!",2e3)}async loadSettings(e){let t=this.getSettings(),r=e.querySelector(".ai-settings-form");r.querySelector("#base-url").value=t.baseUrl,r.querySelector("#model-input").value=t.model;let a=await this.apiKeyManager.getAPIKey("default");a&&(r.querySelector("#api-key").value=a)}async loadChatHistory(e){try{let t=await Pl.readdir(Tl),r=e.querySelector(".ai-history-list");r.innerHTML="";for(let a of t)if(a.endsWith(".json")){let s=await Pl.readFile(Tl+"/"+a),i=JSON.parse(s),o=tag("div",{className:"history-session-item",onclick:()=>this.loadSession(i,e)}),u=tag("div",{className:"session-title",textContent:`Session ${i.id.substring(0,8)}...`}),l=tag("div",{className:"session-date",textContent:new Date(i.timestamp).toLocaleDateString()});o.appendChild(u),o.appendChild(l),r.appendChild(o)}}catch(t){console.log("No history found or error loading history:",t)}}async loadSession(e,t){this.currentSession=e,this.switchView("chat",t);let r=t.querySelector("#ai-chat-area");r.innerHTML="",e.messages.forEach(a=>{this.addMessageToChat(a.role,a.content,t)})}async saveSession(){if(this.currentSession)try{await Pl.createDirectory(Tl,!0),this.currentSession.timestamp=Date.now();let e=JSON.stringify(this.currentSession,null,2),t=`${this.currentSession.id}.json`;await Pl.writeFile(Tl+"/"+t,e)}catch(e){console.error("Error saving session:",e)}}onSidebarSelected(e){console.log("AI Assistant sidebar selected")}async destroy(){console.log("Destroying AI Assistant");try{to&&typeof to.remove=="function"&&to.remove("\u2728")}catch(e){console.error("Error removing selection menu:",e)}this.$githubDarkFile&&this.$githubDarkFile.remove(),this.$higlightJsFile&&this.$higlightJsFile.remove(),this.$markdownItFile&&this.$markdownItFile.remove(),this.$style&&this.$style.remove()}};if(window.acode){console.log("Acode available, initializing AI Assistant plugin...");let n=new nf;acode.setPluginInit(kl.id,async(e,t,{cacheFileUrl:r,cacheFile:a})=>{console.log("Plugin init callback called"),e.endsWith("/")||(e+="/"),n.baseUrl=e,await n.init(t,a,r)}),acode.setPluginUnmount(kl.id,()=>{n.destroy()})}})();
/*! Bundled license information:

@langchain/core/dist/utils/fast-json-patch/src/helpers.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

@langchain/core/dist/utils/fast-json-patch/src/duplex.js:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2013-2021 Joachim Wester
   * MIT license
   *)

mustache/mustache.mjs:
  (*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   *)

@langchain/core/dist/utils/js-sha1/hash.js:
  (*
   * [js-sha1]{@link https://github.com/emn178/js-sha1}
   *
   * @version 0.6.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   *)
*/
